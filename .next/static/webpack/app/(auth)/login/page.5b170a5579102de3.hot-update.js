"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdate_N_E"]("app/(auth)/login/page",{

/***/ "(app-pages-browser)/./src/server/services/auth/cognitoService.ts":
/*!****************************************************!*\
  !*** ./src/server/services/auth/cognitoService.ts ***!
  \****************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval(__webpack_require__.ts("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   CognitoAuthService: () => (/* binding */ CognitoAuthService),\n/* harmony export */   cognitoService: () => (/* binding */ cognitoService)\n/* harmony export */ });\n/* harmony import */ var _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @aws-sdk/client-cognito-identity-provider */ \"(app-pages-browser)/./node_modules/@aws-sdk/client-cognito-identity-provider/dist-es/commands/SignUpCommand.js\");\n/* harmony import */ var _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @aws-sdk/client-cognito-identity-provider */ \"(app-pages-browser)/./node_modules/@aws-sdk/client-cognito-identity-provider/dist-es/commands/ConfirmSignUpCommand.js\");\n/* harmony import */ var _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @aws-sdk/client-cognito-identity-provider */ \"(app-pages-browser)/./node_modules/@aws-sdk/client-cognito-identity-provider/dist-es/commands/ResendConfirmationCodeCommand.js\");\n/* harmony import */ var _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @aws-sdk/client-cognito-identity-provider */ \"(app-pages-browser)/./node_modules/@aws-sdk/client-cognito-identity-provider/dist-es/commands/InitiateAuthCommand.js\");\n/* harmony import */ var _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @aws-sdk/client-cognito-identity-provider */ \"(app-pages-browser)/./node_modules/@aws-sdk/client-cognito-identity-provider/dist-es/commands/GetUserCommand.js\");\n/* harmony import */ var _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @aws-sdk/client-cognito-identity-provider */ \"(app-pages-browser)/./node_modules/@aws-sdk/client-cognito-identity-provider/dist-es/commands/GlobalSignOutCommand.js\");\n/* harmony import */ var _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @aws-sdk/client-cognito-identity-provider */ \"(app-pages-browser)/./node_modules/@aws-sdk/client-cognito-identity-provider/dist-es/commands/AdminCreateUserCommand.js\");\n/* harmony import */ var _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! @aws-sdk/client-cognito-identity-provider */ \"(app-pages-browser)/./node_modules/@aws-sdk/client-cognito-identity-provider/dist-es/CognitoIdentityProviderClient.js\");\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! crypto */ \"(app-pages-browser)/./node_modules/next/dist/compiled/crypto-browserify/index.js\");\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(crypto__WEBPACK_IMPORTED_MODULE_0__);\n/* provided dependency */ var process = __webpack_require__(/*! process */ \"(app-pages-browser)/../../../node_modules/process/browser.js\");\n// src/server/services/auth/cognitoService.ts\n\n\nclass CognitoAuthService {\n    // Método para calcular el SECRET_HASH\n    // En cognitoService.ts\n    calculateSecretHash(username) {\n        if (!this.clientSecret) {\n            console.error('Cliente secret no está configurado');\n            throw new Error('Client secret is not configured');\n        }\n        // El formato correcto es USERNAME + CLIENT_ID\n        const message = username + this.clientId;\n        const hmac = crypto__WEBPACK_IMPORTED_MODULE_0__.createHmac('sha256', this.clientSecret);\n        hmac.update(message);\n        return hmac.digest('base64');\n    }\n    // Registrar un nuevo usuario\n    async registerUser(params) {\n        try {\n            const { email, password, name } = params;\n            // Crear el usuario en Cognito\n            const signUpCommand = new _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_1__.SignUpCommand({\n                ClientId: this.clientId,\n                Username: email,\n                Password: password,\n                SecretHash: this.calculateSecretHash(email),\n                UserAttributes: [\n                    {\n                        Name: 'email',\n                        Value: email\n                    },\n                    {\n                        Name: 'name',\n                        Value: name\n                    }\n                ]\n            });\n            const response = await this.client.send(signUpCommand);\n            return {\n                success: true,\n                userId: response.UserSub,\n                message: 'Usuario registrado correctamente. Por favor, verifique su correo electrónico para completar el registro.'\n            };\n        } catch (error) {\n            console.error('Error al registrar usuario:', error);\n            // Manejar errores específicos\n            if (error.name === 'UsernameExistsException') {\n                return {\n                    success: false,\n                    message: 'El correo electrónico ya está registrado.'\n                };\n            }\n            if (error.name === 'InvalidPasswordException') {\n                return {\n                    success: false,\n                    message: 'La contraseña no cumple con los requisitos de seguridad.'\n                };\n            }\n            throw error;\n        }\n    }\n    // Confirmar el registro con el código de verificación\n    async confirmRegistration(email, confirmationCode) {\n        try {\n            const command = new _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_2__.ConfirmSignUpCommand({\n                ClientId: this.clientId,\n                Username: email,\n                ConfirmationCode: confirmationCode,\n                SecretHash: this.calculateSecretHash(email) // Añadir SECRET_HASH\n            });\n            await this.client.send(command);\n            return {\n                success: true,\n                message: 'Registro confirmado correctamente.'\n            };\n        } catch (error) {\n            console.error('Error al confirmar registro:', error);\n            if (error.name === 'CodeMismatchException') {\n                return {\n                    success: false,\n                    message: 'El código de verificación es incorrecto.'\n                };\n            }\n            if (error.name === 'ExpiredCodeException') {\n                return {\n                    success: false,\n                    message: 'El código de verificación ha expirado.'\n                };\n            }\n            return {\n                success: false,\n                message: 'Error al confirmar el registro. Por favor, intente nuevamente.'\n            };\n        }\n    }\n    // Reenviar código de confirmación\n    async resendConfirmationCode(email) {\n        try {\n            const command = new _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_3__.ResendConfirmationCodeCommand({\n                ClientId: this.clientId,\n                Username: email,\n                SecretHash: this.calculateSecretHash(email) // Añadir SECRET_HASH\n            });\n            await this.client.send(command);\n            return {\n                success: true,\n                message: 'Se ha enviado un nuevo código de verificación a su correo electrónico.'\n            };\n        } catch (error) {\n            console.error('Error al reenviar código:', error);\n            return {\n                success: false,\n                message: 'Error al reenviar el código de verificación. Por favor, intente nuevamente.'\n            };\n        }\n    }\n    // Login con Cognito\n    // En login de cognitoService.ts\n    async login(credentials) {\n        try {\n            var _this_userPoolId, _this_clientId;\n            const { email, password } = credentials;\n            console.log(\"1. Iniciando login con Cognito para:\", email);\n            // Verificar que tenemos los valores de configuración\n            console.log(\"2. Verificando configuración:\", {\n                region: process.env.AWS_REGION,\n                userPoolId: ((_this_userPoolId = this.userPoolId) === null || _this_userPoolId === void 0 ? void 0 : _this_userPoolId.substring(0, 5)) + '...',\n                clientId: ((_this_clientId = this.clientId) === null || _this_clientId === void 0 ? void 0 : _this_clientId.substring(0, 5)) + '...',\n                hasSecret: !!this.clientSecret\n            });\n            // Si usamos secreto, calcular SECRET_HASH\n            let secretHash;\n            if (this.clientSecret) {\n                try {\n                    secretHash = this.calculateSecretHash(email);\n                    console.log(\"3. SECRET_HASH calculado correctamente\");\n                } catch (error) {\n                    console.error(\"Error al calcular SECRET_HASH:\", error);\n                    throw error;\n                }\n            }\n            // Crear parámetros de autenticación\n            const authParams = {\n                USERNAME: email,\n                PASSWORD: password\n            };\n            // Añadir SECRET_HASH si existe\n            if (secretHash) {\n                authParams.SECRET_HASH = secretHash;\n            }\n            console.log(\"4. Parámetros de autenticación preparados\");\n            const command = new _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_4__.InitiateAuthCommand({\n                AuthFlow: \"USER_PASSWORD_AUTH\",\n                ClientId: this.clientId,\n                AuthParameters: authParams\n            });\n            console.log(\"5. Enviando solicitud a Cognito...\");\n            const response = await this.client.send(command);\n            console.log(\"6. Respuesta recibida de Cognito:\", (response === null || response === void 0 ? void 0 : response.AuthenticationResult) ? \"Con tokens\" : \"Sin tokens\", (response === null || response === void 0 ? void 0 : response.ChallengeName) ? \"Desaf\\xedo: \".concat(response.ChallengeName) : \"Sin desafío\");\n            if (!response.AuthenticationResult) {\n                if (response.ChallengeName) {\n                    throw new Error(\"Se requiere completar desaf\\xedo: \".concat(response.ChallengeName));\n                }\n                throw new Error('Error de autenticación: No se recibieron tokens de autenticación');\n            }\n            // Obtener información del usuario autenticado\n            console.log(\"7. Obteniendo información del usuario...\");\n            const userInfo = await this.getUserInfo(response.AuthenticationResult.AccessToken);\n            console.log(\"8. Información de usuario obtenida:\", userInfo.email);\n            return {\n                user: userInfo,\n                accessToken: response.AuthenticationResult.AccessToken,\n                refreshToken: response.AuthenticationResult.RefreshToken,\n                idToken: response.AuthenticationResult.IdToken,\n                expiresIn: response.AuthenticationResult.ExpiresIn || 3600\n            };\n        } catch (error) {\n            console.error('Error detallado en login Cognito:', error);\n            if (error.$metadata) {\n                console.error('Metadatos del error:', error.$metadata);\n            }\n            if (error.__type) {\n                console.error('Tipo de error AWS:', error.__type);\n            }\n            if (error.message) {\n                console.error('Mensaje de error:', error.message);\n            }\n            throw error;\n        }\n    }\n    // Obtener información del usuario desde Cognito\n    async getUserInfo(accessToken) {\n        try {\n            var _attributes_find, _attributes_find1, _attributes_find2;\n            const command = new _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_5__.GetUserCommand({\n                AccessToken: accessToken\n            });\n            const response = await this.client.send(command);\n            // Mapear atributos de Cognito a nuestro modelo de usuario\n            const attributes = response.UserAttributes || [];\n            const email = ((_attributes_find = attributes.find((attr)=>attr.Name === 'email')) === null || _attributes_find === void 0 ? void 0 : _attributes_find.Value) || '';\n            const name = ((_attributes_find1 = attributes.find((attr)=>attr.Name === 'name')) === null || _attributes_find1 === void 0 ? void 0 : _attributes_find1.Value) || '';\n            const sub = ((_attributes_find2 = attributes.find((attr)=>attr.Name === 'sub')) === null || _attributes_find2 === void 0 ? void 0 : _attributes_find2.Value) || '';\n            // Aquí deberíamos obtener el usuario de nuestra base de datos\n            // usando el sub como identificador externo\n            // Por ahora, devolvemos un usuario básico\n            return {\n                id: sub,\n                email,\n                name,\n                roleId: 'user',\n                createdAt: new Date(),\n                updatedAt: new Date(),\n                sucursalId: null\n            };\n        } catch (error) {\n            console.error('Error al obtener info de usuario:', error);\n            throw error;\n        }\n    }\n    // Cerrar sesión\n    async logout(accessToken) {\n        try {\n            const command = new _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_6__.GlobalSignOutCommand({\n                AccessToken: accessToken\n            });\n            await this.client.send(command);\n        } catch (error) {\n            console.error('Error al cerrar sesión:', error);\n            throw error;\n        }\n    }\n    // Refrescar token\n    // En src/server/services/auth/cognitoService.ts\n    async refreshToken(refreshToken) {\n        try {\n            // Para el refresh token necesitamos conocer el username\n            // Intentar extraer el username del token (normalmente estará en el payload)\n            let username = '';\n            try {\n                // Intentar extraer del payload del JWT\n                const tokenParts = refreshToken.split('.');\n                if (tokenParts.length >= 2) {\n                    const payload = JSON.parse(atob(tokenParts[1]));\n                    username = payload.username || payload.email || '';\n                }\n            } catch (e) {\n                console.error('No se pudo extraer username del token:', e);\n                // Si no se puede extraer, usar un valor almacenado en localStorage\n                if (typeof localStorage !== 'undefined') {\n                    username = localStorage.getItem('userEmail') || '';\n                }\n            }\n            // Si no tenemos username, no podemos generar SECRET_HASH\n            if (!username && this.clientSecret) {\n                throw new Error('Se requiere el username para el refresh token cuando se usa client secret');\n            }\n            // Parámetros para el refresh token\n            const authParams = {\n                REFRESH_TOKEN: refreshToken\n            };\n            // Añadir SECRET_HASH si tenemos username y clientSecret\n            if (username && this.clientSecret) {\n                authParams.SECRET_HASH = this.calculateSecretHash(username);\n            }\n            const command = new _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_4__.InitiateAuthCommand({\n                AuthFlow: \"REFRESH_TOKEN_AUTH\",\n                ClientId: this.clientId,\n                AuthParameters: authParams\n            });\n            const response = await this.client.send(command);\n            if (!response.AuthenticationResult) {\n                throw new Error('Error al refrescar token');\n            }\n            return {\n                accessToken: response.AuthenticationResult.AccessToken,\n                idToken: response.AuthenticationResult.IdToken,\n                refreshToken: refreshToken,\n                expiresIn: response.AuthenticationResult.ExpiresIn || 3600\n            };\n        } catch (error) {\n            console.error('Error al refrescar token:', error);\n            throw error;\n        }\n    }\n    // Crear usuario (solo admin)\n    async createUser(user) {\n        try {\n            const command = new _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_7__.AdminCreateUserCommand({\n                UserPoolId: this.userPoolId,\n                Username: user.email,\n                TemporaryPassword: user.password,\n                UserAttributes: [\n                    {\n                        Name: 'email',\n                        Value: user.email\n                    },\n                    {\n                        Name: 'email_verified',\n                        Value: 'true'\n                    },\n                    {\n                        Name: 'name',\n                        Value: user.name\n                    },\n                    {\n                        Name: 'custom:role',\n                        Value: user.roleId\n                    }\n                ]\n            });\n            await this.client.send(command);\n        // Aquí deberíamos crear también el usuario en nuestra BD\n        // y vincular el id de Cognito\n        } catch (error) {\n            console.error('Error al crear usuario:', error);\n            throw error;\n        }\n    }\n    constructor(){\n        this.client = new _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_8__.CognitoIdentityProviderClient({\n            region: process.env.AWS_REGION\n        });\n        this.userPoolId = process.env.COGNITO_USER_POOL_ID;\n        this.clientId = process.env.COGNITO_CLIENT_ID;\n        this.clientSecret = process.env.COGNITO_CLIENT_SECRET;\n    }\n}\n// Singleton para uso en la aplicación\nconst cognitoService = new CognitoAuthService();\n\n\n;\n    // Wrapped in an IIFE to avoid polluting the global scope\n    ;\n    (function () {\n        var _a, _b;\n        // Legacy CSS implementations will `eval` browser code in a Node.js context\n        // to extract CSS. For backwards compatibility, we need to check we're in a\n        // browser context before continuing.\n        if (typeof self !== 'undefined' &&\n            // AMP / No-JS mode does not inject these helpers:\n            '$RefreshHelpers$' in self) {\n            // @ts-ignore __webpack_module__ is global\n            var currentExports = module.exports;\n            // @ts-ignore __webpack_module__ is global\n            var prevSignature = (_b = (_a = module.hot.data) === null || _a === void 0 ? void 0 : _a.prevSignature) !== null && _b !== void 0 ? _b : null;\n            // This cannot happen in MainTemplate because the exports mismatch between\n            // templating and execution.\n            self.$RefreshHelpers$.registerExportsForReactRefresh(currentExports, module.id);\n            // A module can be accepted automatically based on its exports, e.g. when\n            // it is a Refresh Boundary.\n            if (self.$RefreshHelpers$.isReactRefreshBoundary(currentExports)) {\n                // Save the previous exports signature on update so we can compare the boundary\n                // signatures. We avoid saving exports themselves since it causes memory leaks (https://github.com/vercel/next.js/pull/53797)\n                module.hot.dispose(function (data) {\n                    data.prevSignature =\n                        self.$RefreshHelpers$.getRefreshBoundarySignature(currentExports);\n                });\n                // Unconditionally accept an update to this module, we'll check if it's\n                // still a Refresh Boundary later.\n                // @ts-ignore importMeta is replaced in the loader\n                module.hot.accept();\n                // This field is set when the previous version of this module was a\n                // Refresh Boundary, letting us know we need to check for invalidation or\n                // enqueue an update.\n                if (prevSignature !== null) {\n                    // A boundary can become ineligible if its exports are incompatible\n                    // with the previous exports.\n                    //\n                    // For example, if you add/remove/change exports, we'll want to\n                    // re-execute the importing modules, and force those components to\n                    // re-render. Similarly, if you convert a class component to a\n                    // function, we want to invalidate the boundary.\n                    if (self.$RefreshHelpers$.shouldInvalidateReactRefreshBoundary(prevSignature, self.$RefreshHelpers$.getRefreshBoundarySignature(currentExports))) {\n                        module.hot.invalidate();\n                    }\n                    else {\n                        self.$RefreshHelpers$.scheduleUpdate();\n                    }\n                }\n            }\n            else {\n                // Since we just executed the code for the module, it's possible that the\n                // new exports made it ineligible for being a boundary.\n                // We only care about the case when we were _previously_ a boundary,\n                // because we already accepted this update (accidental side effect).\n                var isNoLongerABoundary = prevSignature !== null;\n                if (isNoLongerABoundary) {\n                    module.hot.invalidate();\n                }\n            }\n        }\n    })();\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwcC1wYWdlcy1icm93c2VyKS8uL3NyYy9zZXJ2ZXIvc2VydmljZXMvYXV0aC9jb2duaXRvU2VydmljZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsNkNBQTZDO0FBWU07QUFFbEI7QUFzQjFCLE1BQU1TO0lBZ0JiLHNDQUFzQztJQUN0Qyx1QkFBdUI7SUFDZkMsb0JBQW9CQyxRQUFnQixFQUFVO1FBQ3BELElBQUksQ0FBQyxJQUFJLENBQUNDLFlBQVksRUFBRTtZQUN0QkMsUUFBUUMsS0FBSyxDQUFDO1lBQ2QsTUFBTSxJQUFJQyxNQUFNO1FBQ2xCO1FBRUEsOENBQThDO1FBQzlDLE1BQU1DLFVBQVVMLFdBQVcsSUFBSSxDQUFDTSxRQUFRO1FBQ3hDLE1BQU1DLE9BQU9WLDhDQUFpQixDQUFDLFVBQVUsSUFBSSxDQUFDSSxZQUFZO1FBQzFETSxLQUFLRSxNQUFNLENBQUNKO1FBQ1osT0FBT0UsS0FBS0csTUFBTSxDQUFDO0lBQ3JCO0lBRUEsNkJBQTZCO0lBQzdCLE1BQU1DLGFBQWFDLE1BQTBCLEVBQW9FO1FBQy9HLElBQUk7WUFDRixNQUFNLEVBQUVDLEtBQUssRUFBRUMsUUFBUSxFQUFFQyxJQUFJLEVBQUUsR0FBR0g7WUFFbEMsOEJBQThCO1lBQzlCLE1BQU1JLGdCQUFnQixJQUFJdEIsb0ZBQWFBLENBQUM7Z0JBQ3RDdUIsVUFBVSxJQUFJLENBQUNYLFFBQVE7Z0JBQ3ZCWSxVQUFVTDtnQkFDVk0sVUFBVUw7Z0JBQ1ZNLFlBQVksSUFBSSxDQUFDckIsbUJBQW1CLENBQUNjO2dCQUNyQ1EsZ0JBQWdCO29CQUNkO3dCQUNFQyxNQUFNO3dCQUNOQyxPQUFPVjtvQkFDVDtvQkFDQTt3QkFDRVMsTUFBTTt3QkFDTkMsT0FBT1I7b0JBQ1Q7aUJBQ0Q7WUFDSDtZQUVBLE1BQU1TLFdBQVcsTUFBTSxJQUFJLENBQUNDLE1BQU0sQ0FBQ0MsSUFBSSxDQUFDVjtZQUV4QyxPQUFPO2dCQUNMVyxTQUFTO2dCQUNUQyxRQUFRSixTQUFTSyxPQUFPO2dCQUN4QnhCLFNBQVM7WUFDWDtRQUNGLEVBQUUsT0FBT0YsT0FBWTtZQUNuQkQsUUFBUUMsS0FBSyxDQUFDLCtCQUErQkE7WUFFN0MsOEJBQThCO1lBQzlCLElBQUlBLE1BQU1ZLElBQUksS0FBSywyQkFBMkI7Z0JBQzVDLE9BQU87b0JBQ0xZLFNBQVM7b0JBQ1R0QixTQUFTO2dCQUNYO1lBQ0Y7WUFFQSxJQUFJRixNQUFNWSxJQUFJLEtBQUssNEJBQTRCO2dCQUM3QyxPQUFPO29CQUNMWSxTQUFTO29CQUNUdEIsU0FBUztnQkFDWDtZQUNGO1lBRUEsTUFBTUY7UUFDUjtJQUNGO0lBRUEsc0RBQXNEO0lBQ3RELE1BQU0yQixvQkFBb0JqQixLQUFhLEVBQUVrQixnQkFBd0IsRUFBa0Q7UUFDakgsSUFBSTtZQUNGLE1BQU1DLFVBQVUsSUFBSXJDLDJGQUFvQkEsQ0FBQztnQkFDdkNzQixVQUFVLElBQUksQ0FBQ1gsUUFBUTtnQkFDdkJZLFVBQVVMO2dCQUNWb0Isa0JBQWtCRjtnQkFDbEJYLFlBQVksSUFBSSxDQUFDckIsbUJBQW1CLENBQUNjLE9BQU8scUJBQXFCO1lBQ25FO1lBRUEsTUFBTSxJQUFJLENBQUNZLE1BQU0sQ0FBQ0MsSUFBSSxDQUFDTTtZQUV2QixPQUFPO2dCQUNMTCxTQUFTO2dCQUNUdEIsU0FBUztZQUNYO1FBQ0YsRUFBRSxPQUFPRixPQUFZO1lBQ25CRCxRQUFRQyxLQUFLLENBQUMsZ0NBQWdDQTtZQUU5QyxJQUFJQSxNQUFNWSxJQUFJLEtBQUsseUJBQXlCO2dCQUMxQyxPQUFPO29CQUNMWSxTQUFTO29CQUNUdEIsU0FBUztnQkFDWDtZQUNGO1lBRUEsSUFBSUYsTUFBTVksSUFBSSxLQUFLLHdCQUF3QjtnQkFDekMsT0FBTztvQkFDTFksU0FBUztvQkFDVHRCLFNBQVM7Z0JBQ1g7WUFDRjtZQUVBLE9BQU87Z0JBQ0xzQixTQUFTO2dCQUNUdEIsU0FBUztZQUNYO1FBQ0Y7SUFDRjtJQUVBLGtDQUFrQztJQUNsQyxNQUFNNkIsdUJBQXVCckIsS0FBYSxFQUFrRDtRQUMxRixJQUFJO1lBQ0YsTUFBTW1CLFVBQVUsSUFBSXBDLG9HQUE2QkEsQ0FBQztnQkFDaERxQixVQUFVLElBQUksQ0FBQ1gsUUFBUTtnQkFDdkJZLFVBQVVMO2dCQUNWTyxZQUFZLElBQUksQ0FBQ3JCLG1CQUFtQixDQUFDYyxPQUFPLHFCQUFxQjtZQUNuRTtZQUVBLE1BQU0sSUFBSSxDQUFDWSxNQUFNLENBQUNDLElBQUksQ0FBQ007WUFFdkIsT0FBTztnQkFDTEwsU0FBUztnQkFDVHRCLFNBQVM7WUFDWDtRQUNGLEVBQUUsT0FBT0YsT0FBTztZQUNkRCxRQUFRQyxLQUFLLENBQUMsNkJBQTZCQTtZQUUzQyxPQUFPO2dCQUNMd0IsU0FBUztnQkFDVHRCLFNBQVM7WUFDWDtRQUNGO0lBQ0Y7SUFFQSxvQkFBb0I7SUFDcEIsZ0NBQWdDO0lBQ2hDLE1BQU04QixNQUFNQyxXQUE2QixFQUF1QjtRQUM5RCxJQUFJO2dCQU9ZLGtCQUNGO1lBUFosTUFBTSxFQUFFdkIsS0FBSyxFQUFFQyxRQUFRLEVBQUUsR0FBR3NCO1lBQzVCbEMsUUFBUW1DLEdBQUcsQ0FBQyx3Q0FBd0N4QjtZQUVwRCxxREFBcUQ7WUFDckRYLFFBQVFtQyxHQUFHLENBQUMsaUNBQWlDO2dCQUMzQ0MsUUFBUUMsT0FBT0EsQ0FBQ0MsR0FBRyxDQUFDQyxVQUFVO2dCQUM5QkMsWUFBWSx5QkFBSSxDQUFDQSxVQUFVLGNBQWYsd0RBQWlCQyxTQUFTLENBQUMsR0FBRyxNQUFLO2dCQUMvQ3JDLFVBQVUsdUJBQUksQ0FBQ0EsUUFBUSxjQUFiLG9EQUFlcUMsU0FBUyxDQUFDLEdBQUcsTUFBSztnQkFDM0NDLFdBQVcsQ0FBQyxDQUFDLElBQUksQ0FBQzNDLFlBQVk7WUFDaEM7WUFFQSwwQ0FBMEM7WUFDMUMsSUFBSTRDO1lBQ0osSUFBSSxJQUFJLENBQUM1QyxZQUFZLEVBQUU7Z0JBQ3JCLElBQUk7b0JBQ0Y0QyxhQUFhLElBQUksQ0FBQzlDLG1CQUFtQixDQUFDYztvQkFDdENYLFFBQVFtQyxHQUFHLENBQUM7Z0JBQ2QsRUFBRSxPQUFPbEMsT0FBTztvQkFDZEQsUUFBUUMsS0FBSyxDQUFDLGtDQUFrQ0E7b0JBQ2hELE1BQU1BO2dCQUNSO1lBQ0Y7WUFFQSxvQ0FBb0M7WUFDcEMsTUFBTTJDLGFBQXFDO2dCQUN6Q0MsVUFBVWxDO2dCQUNWbUMsVUFBVWxDO1lBQ1o7WUFFQSwrQkFBK0I7WUFDL0IsSUFBSStCLFlBQVk7Z0JBQ2RDLFdBQVdHLFdBQVcsR0FBR0o7WUFDM0I7WUFFQTNDLFFBQVFtQyxHQUFHLENBQUM7WUFFWixNQUFNTCxVQUFVLElBQUkxQywwRkFBbUJBLENBQUM7Z0JBQ3RDNEQsVUFBVTtnQkFDVmpDLFVBQVUsSUFBSSxDQUFDWCxRQUFRO2dCQUN2QjZDLGdCQUFnQkw7WUFDbEI7WUFFQTVDLFFBQVFtQyxHQUFHLENBQUM7WUFDWixNQUFNYixXQUFXLE1BQU0sSUFBSSxDQUFDQyxNQUFNLENBQUNDLElBQUksQ0FBQ007WUFDeEM5QixRQUFRbUMsR0FBRyxDQUFDLHFDQUNWYixDQUFBQSxxQkFBQUEsK0JBQUFBLFNBQVU0QixvQkFBb0IsSUFBRyxlQUFlLGNBQ2hENUIsQ0FBQUEscUJBQUFBLCtCQUFBQSxTQUFVNkIsYUFBYSxJQUFHLGVBQW1DLE9BQXZCN0IsU0FBUzZCLGFBQWEsSUFBSztZQUduRSxJQUFJLENBQUM3QixTQUFTNEIsb0JBQW9CLEVBQUU7Z0JBQ2xDLElBQUk1QixTQUFTNkIsYUFBYSxFQUFFO29CQUMxQixNQUFNLElBQUlqRCxNQUFNLHFDQUF5RCxPQUF2Qm9CLFNBQVM2QixhQUFhO2dCQUMxRTtnQkFDQSxNQUFNLElBQUlqRCxNQUFNO1lBQ2xCO1lBRUEsOENBQThDO1lBQzlDRixRQUFRbUMsR0FBRyxDQUFDO1lBQ1osTUFBTWlCLFdBQVcsTUFBTSxJQUFJLENBQUNDLFdBQVcsQ0FBQy9CLFNBQVM0QixvQkFBb0IsQ0FBQ0ksV0FBVztZQUNqRnRELFFBQVFtQyxHQUFHLENBQUMsdUNBQXVDaUIsU0FBU3pDLEtBQUs7WUFFakUsT0FBTztnQkFDTDRDLE1BQU1IO2dCQUNOSSxhQUFhbEMsU0FBUzRCLG9CQUFvQixDQUFDSSxXQUFXO2dCQUN0REcsY0FBY25DLFNBQVM0QixvQkFBb0IsQ0FBQ1EsWUFBWTtnQkFDeERDLFNBQVNyQyxTQUFTNEIsb0JBQW9CLENBQUNVLE9BQU87Z0JBQzlDQyxXQUFXdkMsU0FBUzRCLG9CQUFvQixDQUFDWSxTQUFTLElBQUk7WUFDeEQ7UUFDRixFQUFFLE9BQU83RCxPQUFZO1lBQ25CRCxRQUFRQyxLQUFLLENBQUMscUNBQXFDQTtZQUNuRCxJQUFJQSxNQUFNOEQsU0FBUyxFQUFFO2dCQUNuQi9ELFFBQVFDLEtBQUssQ0FBQyx3QkFBd0JBLE1BQU04RCxTQUFTO1lBQ3ZEO1lBQ0EsSUFBSTlELE1BQU0rRCxNQUFNLEVBQUU7Z0JBQ2hCaEUsUUFBUUMsS0FBSyxDQUFDLHNCQUFzQkEsTUFBTStELE1BQU07WUFDbEQ7WUFDQSxJQUFJL0QsTUFBTUUsT0FBTyxFQUFFO2dCQUNqQkgsUUFBUUMsS0FBSyxDQUFDLHFCQUFxQkEsTUFBTUUsT0FBTztZQUNsRDtZQUNBLE1BQU1GO1FBQ1I7SUFDRjtJQUVBLGdEQUFnRDtJQUNoRCxNQUFjb0QsWUFBWUcsV0FBbUIsRUFBbUM7UUFDOUUsSUFBSTtnQkFTWVMsa0JBQ0RBLG1CQUNEQTtZQVZaLE1BQU1uQyxVQUFVLElBQUl6QyxxRkFBY0EsQ0FBQztnQkFDakNpRSxhQUFhRTtZQUNmO1lBRUEsTUFBTWxDLFdBQVcsTUFBTSxJQUFJLENBQUNDLE1BQU0sQ0FBQ0MsSUFBSSxDQUFDTTtZQUV4QywwREFBMEQ7WUFDMUQsTUFBTW1DLGFBQWEzQyxTQUFTSCxjQUFjLElBQUksRUFBRTtZQUNoRCxNQUFNUixRQUFRc0QsRUFBQUEsbUJBQUFBLFdBQVdDLElBQUksQ0FBQ0MsQ0FBQUEsT0FBUUEsS0FBSy9DLElBQUksS0FBSyxzQkFBdEM2Qyx1Q0FBQUEsaUJBQWdENUMsS0FBSyxLQUFJO1lBQ3ZFLE1BQU1SLE9BQU9vRCxFQUFBQSxvQkFBQUEsV0FBV0MsSUFBSSxDQUFDQyxDQUFBQSxPQUFRQSxLQUFLL0MsSUFBSSxLQUFLLHFCQUF0QzZDLHdDQUFBQSxrQkFBK0M1QyxLQUFLLEtBQUk7WUFDckUsTUFBTStDLE1BQU1ILEVBQUFBLG9CQUFBQSxXQUFXQyxJQUFJLENBQUNDLENBQUFBLE9BQVFBLEtBQUsvQyxJQUFJLEtBQUssb0JBQXRDNkMsd0NBQUFBLGtCQUE4QzVDLEtBQUssS0FBSTtZQUVuRSw4REFBOEQ7WUFDOUQsMkNBQTJDO1lBQzNDLDBDQUEwQztZQUUxQyxPQUFPO2dCQUNMZ0QsSUFBSUQ7Z0JBQ0p6RDtnQkFDQUU7Z0JBQ0F5RCxRQUFRO2dCQUNSQyxXQUFXLElBQUlDO2dCQUNmQyxXQUFXLElBQUlEO2dCQUNmRSxZQUFZO1lBQ2Q7UUFDRixFQUFFLE9BQU96RSxPQUFPO1lBQ2RELFFBQVFDLEtBQUssQ0FBQyxxQ0FBcUNBO1lBQ25ELE1BQU1BO1FBQ1I7SUFDRjtJQUVBLGdCQUFnQjtJQUNoQixNQUFNMEUsT0FBT25CLFdBQW1CLEVBQWlCO1FBQy9DLElBQUk7WUFDRixNQUFNMUIsVUFBVSxJQUFJdkMsMkZBQW9CQSxDQUFDO2dCQUN2QytELGFBQWFFO1lBQ2Y7WUFFQSxNQUFNLElBQUksQ0FBQ2pDLE1BQU0sQ0FBQ0MsSUFBSSxDQUFDTTtRQUN6QixFQUFFLE9BQU83QixPQUFPO1lBQ2RELFFBQVFDLEtBQUssQ0FBQywyQkFBMkJBO1lBQ3pDLE1BQU1BO1FBQ1I7SUFDRjtJQUVBLGtCQUFrQjtJQUNsQixnREFBZ0Q7SUFDaEQsTUFBTXdELGFBQWFBLFlBQW9CLEVBQXFDO1FBQzFFLElBQUk7WUFDRix3REFBd0Q7WUFDeEQsNEVBQTRFO1lBQzVFLElBQUkzRCxXQUFXO1lBQ2YsSUFBSTtnQkFDRix1Q0FBdUM7Z0JBQ3ZDLE1BQU04RSxhQUFhbkIsYUFBYW9CLEtBQUssQ0FBQztnQkFDdEMsSUFBSUQsV0FBV0UsTUFBTSxJQUFJLEdBQUc7b0JBQzFCLE1BQU1DLFVBQVVDLEtBQUtDLEtBQUssQ0FBQ0MsS0FBS04sVUFBVSxDQUFDLEVBQUU7b0JBQzdDOUUsV0FBV2lGLFFBQVFqRixRQUFRLElBQUlpRixRQUFRcEUsS0FBSyxJQUFJO2dCQUNsRDtZQUNGLEVBQUUsT0FBT3dFLEdBQUc7Z0JBQ1ZuRixRQUFRQyxLQUFLLENBQUMsMENBQTBDa0Y7Z0JBQ3hELG1FQUFtRTtnQkFDbkUsSUFBSSxPQUFPQyxpQkFBaUIsYUFBYTtvQkFDdkN0RixXQUFXc0YsYUFBYUMsT0FBTyxDQUFDLGdCQUFnQjtnQkFDbEQ7WUFDRjtZQUVBLHlEQUF5RDtZQUN6RCxJQUFJLENBQUN2RixZQUFZLElBQUksQ0FBQ0MsWUFBWSxFQUFFO2dCQUNsQyxNQUFNLElBQUlHLE1BQU07WUFDbEI7WUFFQSxtQ0FBbUM7WUFDbkMsTUFBTTBDLGFBQXFDO2dCQUN6QzBDLGVBQWU3QjtZQUNqQjtZQUVBLHdEQUF3RDtZQUN4RCxJQUFJM0QsWUFBWSxJQUFJLENBQUNDLFlBQVksRUFBRTtnQkFDakM2QyxXQUFXRyxXQUFXLEdBQUcsSUFBSSxDQUFDbEQsbUJBQW1CLENBQUNDO1lBQ3BEO1lBRUEsTUFBTWdDLFVBQVUsSUFBSTFDLDBGQUFtQkEsQ0FBQztnQkFDdEM0RCxVQUFVO2dCQUNWakMsVUFBVSxJQUFJLENBQUNYLFFBQVE7Z0JBQ3ZCNkMsZ0JBQWdCTDtZQUNsQjtZQUVBLE1BQU10QixXQUFXLE1BQU0sSUFBSSxDQUFDQyxNQUFNLENBQUNDLElBQUksQ0FBQ007WUFFeEMsSUFBSSxDQUFDUixTQUFTNEIsb0JBQW9CLEVBQUU7Z0JBQ2xDLE1BQU0sSUFBSWhELE1BQU07WUFDbEI7WUFFQSxPQUFPO2dCQUNMc0QsYUFBYWxDLFNBQVM0QixvQkFBb0IsQ0FBQ0ksV0FBVztnQkFDdERLLFNBQVNyQyxTQUFTNEIsb0JBQW9CLENBQUNVLE9BQU87Z0JBQzlDSCxjQUFjQTtnQkFDZEksV0FBV3ZDLFNBQVM0QixvQkFBb0IsQ0FBQ1ksU0FBUyxJQUFJO1lBQ3hEO1FBQ0YsRUFBRSxPQUFPN0QsT0FBTztZQUNkRCxRQUFRQyxLQUFLLENBQUMsNkJBQTZCQTtZQUMzQyxNQUFNQTtRQUNSO0lBQ0Y7SUFFQSw2QkFBNkI7SUFDN0IsTUFBTXNGLFdBQVdoQyxJQUtoQixFQUFpQjtRQUNoQixJQUFJO1lBQ0YsTUFBTXpCLFVBQVUsSUFBSXhDLDZGQUFzQkEsQ0FBQztnQkFDekNrRyxZQUFZLElBQUksQ0FBQ2hELFVBQVU7Z0JBQzNCeEIsVUFBVXVDLEtBQUs1QyxLQUFLO2dCQUNwQjhFLG1CQUFtQmxDLEtBQUszQyxRQUFRO2dCQUNoQ08sZ0JBQWdCO29CQUNkO3dCQUNFQyxNQUFNO3dCQUNOQyxPQUFPa0MsS0FBSzVDLEtBQUs7b0JBQ25CO29CQUNBO3dCQUNFUyxNQUFNO3dCQUNOQyxPQUFPO29CQUNUO29CQUNBO3dCQUNFRCxNQUFNO3dCQUNOQyxPQUFPa0MsS0FBSzFDLElBQUk7b0JBQ2xCO29CQUNBO3dCQUNFTyxNQUFNO3dCQUNOQyxPQUFPa0MsS0FBS2UsTUFBTTtvQkFDcEI7aUJBQ0Q7WUFDSDtZQUVBLE1BQU0sSUFBSSxDQUFDL0MsTUFBTSxDQUFDQyxJQUFJLENBQUNNO1FBRXZCLHlEQUF5RDtRQUN6RCw4QkFBOEI7UUFDaEMsRUFBRSxPQUFPN0IsT0FBTztZQUNkRCxRQUFRQyxLQUFLLENBQUMsMkJBQTJCQTtZQUN6QyxNQUFNQTtRQUNSO0lBQ0Y7SUExWEF5RixhQUFjO1FBQ1osSUFBSSxDQUFDbkUsTUFBTSxHQUFHLElBQUlwQyxvR0FBNkJBLENBQUM7WUFDOUNpRCxRQUFRQyxPQUFPQSxDQUFDQyxHQUFHLENBQUNDLFVBQVU7UUFDaEM7UUFFQSxJQUFJLENBQUNDLFVBQVUsR0FBR0gsT0FBT0EsQ0FBQ0MsR0FBRyxDQUFDcUQsb0JBQW9CO1FBQ2xELElBQUksQ0FBQ3ZGLFFBQVEsR0FBR2lDLE9BQU9BLENBQUNDLEdBQUcsQ0FBQ3NELGlCQUFpQjtRQUM3QyxJQUFJLENBQUM3RixZQUFZLEdBQUdzQyxPQUFPQSxDQUFDQyxHQUFHLENBQUN1RCxxQkFBcUI7SUFDdkQ7QUFtWEE7QUFFQSxzQ0FBc0M7QUFDL0IsTUFBTUMsaUJBQWlCLElBQUlsRyxxQkFBcUIiLCJzb3VyY2VzIjpbIi9Vc2Vycy9nYXN0b25tb3JhL0Rlc2t0b3AvUHJveWVjdG9zL1R1bHVtL3NyYy9zZXJ2ZXIvc2VydmljZXMvYXV0aC9jb2duaXRvU2VydmljZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBzcmMvc2VydmVyL3NlcnZpY2VzL2F1dGgvY29nbml0b1NlcnZpY2UudHNcbmltcG9ydCB7IFxuICBDb2duaXRvSWRlbnRpdHlQcm92aWRlckNsaWVudCwgXG4gIEluaXRpYXRlQXV0aENvbW1hbmQsXG4gIFJlc3BvbmRUb0F1dGhDaGFsbGVuZ2VDb21tYW5kLFxuICBHZXRVc2VyQ29tbWFuZCxcbiAgQWRtaW5HZXRVc2VyQ29tbWFuZCxcbiAgQWRtaW5DcmVhdGVVc2VyQ29tbWFuZCxcbiAgR2xvYmFsU2lnbk91dENvbW1hbmQsXG4gIFNpZ25VcENvbW1hbmQsXG4gIENvbmZpcm1TaWduVXBDb21tYW5kLFxuICBSZXNlbmRDb25maXJtYXRpb25Db2RlQ29tbWFuZFxufSBmcm9tIFwiQGF3cy1zZGsvY2xpZW50LWNvZ25pdG8taWRlbnRpdHktcHJvdmlkZXJcIjtcbmltcG9ydCB7IHR5cGUgVXNlciB9IGZyb20gJ0BwcmlzbWEvY2xpZW50JztcbmltcG9ydCAqIGFzIGNyeXB0byBmcm9tICdjcnlwdG8nO1xuXG5pbnRlcmZhY2UgUmVnaXN0ZXJVc2VyUGFyYW1zIHtcbmVtYWlsOiBzdHJpbmc7XG5wYXNzd29yZDogc3RyaW5nO1xubmFtZTogc3RyaW5nO1xufVxuXG4vLyBJbnRlcmZhY2VzXG5leHBvcnQgaW50ZXJmYWNlIExvZ2luQ3JlZGVudGlhbHMge1xuICBlbWFpbDogc3RyaW5nO1xuICBwYXNzd29yZDogc3RyaW5nO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEF1dGhSZXN1bHQge1xudXNlcjogT21pdDxVc2VyLCAncGFzc3dvcmQnPjtcbmFjY2Vzc1Rva2VuOiBzdHJpbmc7XG5yZWZyZXNoVG9rZW46IHN0cmluZztcbmlkVG9rZW46IHN0cmluZztcbmV4cGlyZXNJbjogbnVtYmVyO1xufVxuXG5leHBvcnQgY2xhc3MgQ29nbml0b0F1dGhTZXJ2aWNlIHtcbnByaXZhdGUgY2xpZW50OiBDb2duaXRvSWRlbnRpdHlQcm92aWRlckNsaWVudDtcbnByaXZhdGUgdXNlclBvb2xJZDogc3RyaW5nO1xucHJpdmF0ZSBjbGllbnRJZDogc3RyaW5nO1xucHJpdmF0ZSBjbGllbnRTZWNyZXQ6IHN0cmluZztcblxuY29uc3RydWN0b3IoKSB7XG4gIHRoaXMuY2xpZW50ID0gbmV3IENvZ25pdG9JZGVudGl0eVByb3ZpZGVyQ2xpZW50KHtcbiAgICByZWdpb246IHByb2Nlc3MuZW52LkFXU19SRUdJT04gYXMgc3RyaW5nXG4gIH0pO1xuICBcbiAgdGhpcy51c2VyUG9vbElkID0gcHJvY2Vzcy5lbnYuQ09HTklUT19VU0VSX1BPT0xfSUQgYXMgc3RyaW5nO1xuICB0aGlzLmNsaWVudElkID0gcHJvY2Vzcy5lbnYuQ09HTklUT19DTElFTlRfSUQgYXMgc3RyaW5nO1xuICB0aGlzLmNsaWVudFNlY3JldCA9IHByb2Nlc3MuZW52LkNPR05JVE9fQ0xJRU5UX1NFQ1JFVCBhcyBzdHJpbmc7XG59XG5cbi8vIE3DqXRvZG8gcGFyYSBjYWxjdWxhciBlbCBTRUNSRVRfSEFTSFxuLy8gRW4gY29nbml0b1NlcnZpY2UudHNcbnByaXZhdGUgY2FsY3VsYXRlU2VjcmV0SGFzaCh1c2VybmFtZTogc3RyaW5nKTogc3RyaW5nIHtcbiAgaWYgKCF0aGlzLmNsaWVudFNlY3JldCkge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0NsaWVudGUgc2VjcmV0IG5vIGVzdMOhIGNvbmZpZ3VyYWRvJyk7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdDbGllbnQgc2VjcmV0IGlzIG5vdCBjb25maWd1cmVkJyk7XG4gIH1cbiAgXG4gIC8vIEVsIGZvcm1hdG8gY29ycmVjdG8gZXMgVVNFUk5BTUUgKyBDTElFTlRfSURcbiAgY29uc3QgbWVzc2FnZSA9IHVzZXJuYW1lICsgdGhpcy5jbGllbnRJZDtcbiAgY29uc3QgaG1hYyA9IGNyeXB0by5jcmVhdGVIbWFjKCdzaGEyNTYnLCB0aGlzLmNsaWVudFNlY3JldCk7XG4gIGhtYWMudXBkYXRlKG1lc3NhZ2UpO1xuICByZXR1cm4gaG1hYy5kaWdlc3QoJ2Jhc2U2NCcpO1xufVxuXG4vLyBSZWdpc3RyYXIgdW4gbnVldm8gdXN1YXJpb1xuYXN5bmMgcmVnaXN0ZXJVc2VyKHBhcmFtczogUmVnaXN0ZXJVc2VyUGFyYW1zKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IHVzZXJJZD86IHN0cmluZzsgbWVzc2FnZT86IHN0cmluZyB9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgeyBlbWFpbCwgcGFzc3dvcmQsIG5hbWUgfSA9IHBhcmFtcztcbiAgICBcbiAgICAvLyBDcmVhciBlbCB1c3VhcmlvIGVuIENvZ25pdG9cbiAgICBjb25zdCBzaWduVXBDb21tYW5kID0gbmV3IFNpZ25VcENvbW1hbmQoe1xuICAgICAgQ2xpZW50SWQ6IHRoaXMuY2xpZW50SWQsXG4gICAgICBVc2VybmFtZTogZW1haWwsXG4gICAgICBQYXNzd29yZDogcGFzc3dvcmQsXG4gICAgICBTZWNyZXRIYXNoOiB0aGlzLmNhbGN1bGF0ZVNlY3JldEhhc2goZW1haWwpLCAvLyBBw7FhZGlyIFNFQ1JFVF9IQVNIXG4gICAgICBVc2VyQXR0cmlidXRlczogW1xuICAgICAgICB7XG4gICAgICAgICAgTmFtZTogJ2VtYWlsJyxcbiAgICAgICAgICBWYWx1ZTogZW1haWxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIE5hbWU6ICduYW1lJyxcbiAgICAgICAgICBWYWx1ZTogbmFtZVxuICAgICAgICB9XG4gICAgICBdXG4gICAgfSk7XG4gICAgXG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLmNsaWVudC5zZW5kKHNpZ25VcENvbW1hbmQpO1xuICAgIFxuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgdXNlcklkOiByZXNwb25zZS5Vc2VyU3ViLFxuICAgICAgbWVzc2FnZTogJ1VzdWFyaW8gcmVnaXN0cmFkbyBjb3JyZWN0YW1lbnRlLiBQb3IgZmF2b3IsIHZlcmlmaXF1ZSBzdSBjb3JyZW8gZWxlY3Ryw7NuaWNvIHBhcmEgY29tcGxldGFyIGVsIHJlZ2lzdHJvLidcbiAgICB9O1xuICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgYWwgcmVnaXN0cmFyIHVzdWFyaW86JywgZXJyb3IpO1xuICAgIFxuICAgIC8vIE1hbmVqYXIgZXJyb3JlcyBlc3BlY8OtZmljb3NcbiAgICBpZiAoZXJyb3IubmFtZSA9PT0gJ1VzZXJuYW1lRXhpc3RzRXhjZXB0aW9uJykge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdFbCBjb3JyZW8gZWxlY3Ryw7NuaWNvIHlhIGVzdMOhIHJlZ2lzdHJhZG8uJ1xuICAgICAgfTtcbiAgICB9XG4gICAgXG4gICAgaWYgKGVycm9yLm5hbWUgPT09ICdJbnZhbGlkUGFzc3dvcmRFeGNlcHRpb24nKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogJ0xhIGNvbnRyYXNlw7FhIG5vIGN1bXBsZSBjb24gbG9zIHJlcXVpc2l0b3MgZGUgc2VndXJpZGFkLidcbiAgICAgIH07XG4gICAgfVxuICAgIFxuICAgIHRocm93IGVycm9yO1xuICB9XG59XG5cbi8vIENvbmZpcm1hciBlbCByZWdpc3RybyBjb24gZWwgY8OzZGlnbyBkZSB2ZXJpZmljYWNpw7NuXG5hc3luYyBjb25maXJtUmVnaXN0cmF0aW9uKGVtYWlsOiBzdHJpbmcsIGNvbmZpcm1hdGlvbkNvZGU6IHN0cmluZyk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuOyBtZXNzYWdlOiBzdHJpbmcgfT4ge1xuICB0cnkge1xuICAgIGNvbnN0IGNvbW1hbmQgPSBuZXcgQ29uZmlybVNpZ25VcENvbW1hbmQoe1xuICAgICAgQ2xpZW50SWQ6IHRoaXMuY2xpZW50SWQsXG4gICAgICBVc2VybmFtZTogZW1haWwsXG4gICAgICBDb25maXJtYXRpb25Db2RlOiBjb25maXJtYXRpb25Db2RlLFxuICAgICAgU2VjcmV0SGFzaDogdGhpcy5jYWxjdWxhdGVTZWNyZXRIYXNoKGVtYWlsKSAvLyBBw7FhZGlyIFNFQ1JFVF9IQVNIXG4gICAgfSk7XG4gICAgXG4gICAgYXdhaXQgdGhpcy5jbGllbnQuc2VuZChjb21tYW5kKTtcbiAgICBcbiAgICByZXR1cm4ge1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIG1lc3NhZ2U6ICdSZWdpc3RybyBjb25maXJtYWRvIGNvcnJlY3RhbWVudGUuJ1xuICAgIH07XG4gIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBhbCBjb25maXJtYXIgcmVnaXN0cm86JywgZXJyb3IpO1xuICAgIFxuICAgIGlmIChlcnJvci5uYW1lID09PSAnQ29kZU1pc21hdGNoRXhjZXB0aW9uJykge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdFbCBjw7NkaWdvIGRlIHZlcmlmaWNhY2nDs24gZXMgaW5jb3JyZWN0by4nXG4gICAgICB9O1xuICAgIH1cbiAgICBcbiAgICBpZiAoZXJyb3IubmFtZSA9PT0gJ0V4cGlyZWRDb2RlRXhjZXB0aW9uJykge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdFbCBjw7NkaWdvIGRlIHZlcmlmaWNhY2nDs24gaGEgZXhwaXJhZG8uJ1xuICAgICAgfTtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgbWVzc2FnZTogJ0Vycm9yIGFsIGNvbmZpcm1hciBlbCByZWdpc3Ryby4gUG9yIGZhdm9yLCBpbnRlbnRlIG51ZXZhbWVudGUuJ1xuICAgIH07XG4gIH1cbn1cblxuLy8gUmVlbnZpYXIgY8OzZGlnbyBkZSBjb25maXJtYWNpw7NuXG5hc3luYyByZXNlbmRDb25maXJtYXRpb25Db2RlKGVtYWlsOiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbWVzc2FnZTogc3RyaW5nIH0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBjb21tYW5kID0gbmV3IFJlc2VuZENvbmZpcm1hdGlvbkNvZGVDb21tYW5kKHtcbiAgICAgIENsaWVudElkOiB0aGlzLmNsaWVudElkLFxuICAgICAgVXNlcm5hbWU6IGVtYWlsLFxuICAgICAgU2VjcmV0SGFzaDogdGhpcy5jYWxjdWxhdGVTZWNyZXRIYXNoKGVtYWlsKSAvLyBBw7FhZGlyIFNFQ1JFVF9IQVNIXG4gICAgfSk7XG4gICAgXG4gICAgYXdhaXQgdGhpcy5jbGllbnQuc2VuZChjb21tYW5kKTtcbiAgICBcbiAgICByZXR1cm4ge1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIG1lc3NhZ2U6ICdTZSBoYSBlbnZpYWRvIHVuIG51ZXZvIGPDs2RpZ28gZGUgdmVyaWZpY2FjacOzbiBhIHN1IGNvcnJlbyBlbGVjdHLDs25pY28uJ1xuICAgIH07XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgYWwgcmVlbnZpYXIgY8OzZGlnbzonLCBlcnJvcik7XG4gICAgXG4gICAgcmV0dXJuIHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgbWVzc2FnZTogJ0Vycm9yIGFsIHJlZW52aWFyIGVsIGPDs2RpZ28gZGUgdmVyaWZpY2FjacOzbi4gUG9yIGZhdm9yLCBpbnRlbnRlIG51ZXZhbWVudGUuJ1xuICAgIH07XG4gIH1cbn1cblxuLy8gTG9naW4gY29uIENvZ25pdG9cbi8vIEVuIGxvZ2luIGRlIGNvZ25pdG9TZXJ2aWNlLnRzXG5hc3luYyBsb2dpbihjcmVkZW50aWFsczogTG9naW5DcmVkZW50aWFscyk6IFByb21pc2U8QXV0aFJlc3VsdD4ge1xuICB0cnkge1xuICAgIGNvbnN0IHsgZW1haWwsIHBhc3N3b3JkIH0gPSBjcmVkZW50aWFscztcbiAgICBjb25zb2xlLmxvZyhcIjEuIEluaWNpYW5kbyBsb2dpbiBjb24gQ29nbml0byBwYXJhOlwiLCBlbWFpbCk7XG4gICAgXG4gICAgLy8gVmVyaWZpY2FyIHF1ZSB0ZW5lbW9zIGxvcyB2YWxvcmVzIGRlIGNvbmZpZ3VyYWNpw7NuXG4gICAgY29uc29sZS5sb2coXCIyLiBWZXJpZmljYW5kbyBjb25maWd1cmFjacOzbjpcIiwge1xuICAgICAgcmVnaW9uOiBwcm9jZXNzLmVudi5BV1NfUkVHSU9OLFxuICAgICAgdXNlclBvb2xJZDogdGhpcy51c2VyUG9vbElkPy5zdWJzdHJpbmcoMCwgNSkgKyAnLi4uJyxcbiAgICAgIGNsaWVudElkOiB0aGlzLmNsaWVudElkPy5zdWJzdHJpbmcoMCwgNSkgKyAnLi4uJyxcbiAgICAgIGhhc1NlY3JldDogISF0aGlzLmNsaWVudFNlY3JldFxuICAgIH0pO1xuICAgIFxuICAgIC8vIFNpIHVzYW1vcyBzZWNyZXRvLCBjYWxjdWxhciBTRUNSRVRfSEFTSFxuICAgIGxldCBzZWNyZXRIYXNoO1xuICAgIGlmICh0aGlzLmNsaWVudFNlY3JldCkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgc2VjcmV0SGFzaCA9IHRoaXMuY2FsY3VsYXRlU2VjcmV0SGFzaChlbWFpbCk7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiMy4gU0VDUkVUX0hBU0ggY2FsY3VsYWRvIGNvcnJlY3RhbWVudGVcIik7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgYWwgY2FsY3VsYXIgU0VDUkVUX0hBU0g6XCIsIGVycm9yKTtcbiAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIC8vIENyZWFyIHBhcsOhbWV0cm9zIGRlIGF1dGVudGljYWNpw7NuXG4gICAgY29uc3QgYXV0aFBhcmFtczogUmVjb3JkPHN0cmluZywgc3RyaW5nPiA9IHtcbiAgICAgIFVTRVJOQU1FOiBlbWFpbCxcbiAgICAgIFBBU1NXT1JEOiBwYXNzd29yZFxuICAgIH07XG4gICAgXG4gICAgLy8gQcOxYWRpciBTRUNSRVRfSEFTSCBzaSBleGlzdGVcbiAgICBpZiAoc2VjcmV0SGFzaCkge1xuICAgICAgYXV0aFBhcmFtcy5TRUNSRVRfSEFTSCA9IHNlY3JldEhhc2g7XG4gICAgfVxuICAgIFxuICAgIGNvbnNvbGUubG9nKFwiNC4gUGFyw6FtZXRyb3MgZGUgYXV0ZW50aWNhY2nDs24gcHJlcGFyYWRvc1wiKTtcbiAgICBcbiAgICBjb25zdCBjb21tYW5kID0gbmV3IEluaXRpYXRlQXV0aENvbW1hbmQoe1xuICAgICAgQXV0aEZsb3c6IFwiVVNFUl9QQVNTV09SRF9BVVRIXCIsXG4gICAgICBDbGllbnRJZDogdGhpcy5jbGllbnRJZCxcbiAgICAgIEF1dGhQYXJhbWV0ZXJzOiBhdXRoUGFyYW1zXG4gICAgfSk7XG4gICAgXG4gICAgY29uc29sZS5sb2coXCI1LiBFbnZpYW5kbyBzb2xpY2l0dWQgYSBDb2duaXRvLi4uXCIpO1xuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy5jbGllbnQuc2VuZChjb21tYW5kKTtcbiAgICBjb25zb2xlLmxvZyhcIjYuIFJlc3B1ZXN0YSByZWNpYmlkYSBkZSBDb2duaXRvOlwiLCBcbiAgICAgIHJlc3BvbnNlPy5BdXRoZW50aWNhdGlvblJlc3VsdCA/IFwiQ29uIHRva2Vuc1wiIDogXCJTaW4gdG9rZW5zXCIsXG4gICAgICByZXNwb25zZT8uQ2hhbGxlbmdlTmFtZSA/IGBEZXNhZsOtbzogJHtyZXNwb25zZS5DaGFsbGVuZ2VOYW1lfWAgOiBcIlNpbiBkZXNhZsOtb1wiXG4gICAgKTtcbiAgICBcbiAgICBpZiAoIXJlc3BvbnNlLkF1dGhlbnRpY2F0aW9uUmVzdWx0KSB7XG4gICAgICBpZiAocmVzcG9uc2UuQ2hhbGxlbmdlTmFtZSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFNlIHJlcXVpZXJlIGNvbXBsZXRhciBkZXNhZsOtbzogJHtyZXNwb25zZS5DaGFsbGVuZ2VOYW1lfWApO1xuICAgICAgfVxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdFcnJvciBkZSBhdXRlbnRpY2FjacOzbjogTm8gc2UgcmVjaWJpZXJvbiB0b2tlbnMgZGUgYXV0ZW50aWNhY2nDs24nKTtcbiAgICB9XG4gICAgXG4gICAgLy8gT2J0ZW5lciBpbmZvcm1hY2nDs24gZGVsIHVzdWFyaW8gYXV0ZW50aWNhZG9cbiAgICBjb25zb2xlLmxvZyhcIjcuIE9idGVuaWVuZG8gaW5mb3JtYWNpw7NuIGRlbCB1c3VhcmlvLi4uXCIpO1xuICAgIGNvbnN0IHVzZXJJbmZvID0gYXdhaXQgdGhpcy5nZXRVc2VySW5mbyhyZXNwb25zZS5BdXRoZW50aWNhdGlvblJlc3VsdC5BY2Nlc3NUb2tlbiBhcyBzdHJpbmcpO1xuICAgIGNvbnNvbGUubG9nKFwiOC4gSW5mb3JtYWNpw7NuIGRlIHVzdWFyaW8gb2J0ZW5pZGE6XCIsIHVzZXJJbmZvLmVtYWlsKTtcbiAgICBcbiAgICByZXR1cm4ge1xuICAgICAgdXNlcjogdXNlckluZm8sXG4gICAgICBhY2Nlc3NUb2tlbjogcmVzcG9uc2UuQXV0aGVudGljYXRpb25SZXN1bHQuQWNjZXNzVG9rZW4gYXMgc3RyaW5nLFxuICAgICAgcmVmcmVzaFRva2VuOiByZXNwb25zZS5BdXRoZW50aWNhdGlvblJlc3VsdC5SZWZyZXNoVG9rZW4gYXMgc3RyaW5nLFxuICAgICAgaWRUb2tlbjogcmVzcG9uc2UuQXV0aGVudGljYXRpb25SZXN1bHQuSWRUb2tlbiBhcyBzdHJpbmcsXG4gICAgICBleHBpcmVzSW46IHJlc3BvbnNlLkF1dGhlbnRpY2F0aW9uUmVzdWx0LkV4cGlyZXNJbiB8fCAzNjAwXG4gICAgfTtcbiAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGRldGFsbGFkbyBlbiBsb2dpbiBDb2duaXRvOicsIGVycm9yKTtcbiAgICBpZiAoZXJyb3IuJG1ldGFkYXRhKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdNZXRhZGF0b3MgZGVsIGVycm9yOicsIGVycm9yLiRtZXRhZGF0YSk7XG4gICAgfVxuICAgIGlmIChlcnJvci5fX3R5cGUpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1RpcG8gZGUgZXJyb3IgQVdTOicsIGVycm9yLl9fdHlwZSk7XG4gICAgfVxuICAgIGlmIChlcnJvci5tZXNzYWdlKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdNZW5zYWplIGRlIGVycm9yOicsIGVycm9yLm1lc3NhZ2UpO1xuICAgIH1cbiAgICB0aHJvdyBlcnJvcjtcbiAgfVxufVxuXG4vLyBPYnRlbmVyIGluZm9ybWFjacOzbiBkZWwgdXN1YXJpbyBkZXNkZSBDb2duaXRvXG5wcml2YXRlIGFzeW5jIGdldFVzZXJJbmZvKGFjY2Vzc1Rva2VuOiBzdHJpbmcpOiBQcm9taXNlPE9taXQ8VXNlciwgJ3Bhc3N3b3JkJz4+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBjb21tYW5kID0gbmV3IEdldFVzZXJDb21tYW5kKHtcbiAgICAgIEFjY2Vzc1Rva2VuOiBhY2Nlc3NUb2tlblxuICAgIH0pO1xuICAgIFxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy5jbGllbnQuc2VuZChjb21tYW5kKTtcbiAgICBcbiAgICAvLyBNYXBlYXIgYXRyaWJ1dG9zIGRlIENvZ25pdG8gYSBudWVzdHJvIG1vZGVsbyBkZSB1c3VhcmlvXG4gICAgY29uc3QgYXR0cmlidXRlcyA9IHJlc3BvbnNlLlVzZXJBdHRyaWJ1dGVzIHx8IFtdO1xuICAgIGNvbnN0IGVtYWlsID0gYXR0cmlidXRlcy5maW5kKGF0dHIgPT4gYXR0ci5OYW1lID09PSAnZW1haWwnKT8uVmFsdWUgfHwgJyc7XG4gICAgY29uc3QgbmFtZSA9IGF0dHJpYnV0ZXMuZmluZChhdHRyID0+IGF0dHIuTmFtZSA9PT0gJ25hbWUnKT8uVmFsdWUgfHwgJyc7XG4gICAgY29uc3Qgc3ViID0gYXR0cmlidXRlcy5maW5kKGF0dHIgPT4gYXR0ci5OYW1lID09PSAnc3ViJyk/LlZhbHVlIHx8ICcnO1xuICAgIFxuICAgIC8vIEFxdcOtIGRlYmVyw61hbW9zIG9idGVuZXIgZWwgdXN1YXJpbyBkZSBudWVzdHJhIGJhc2UgZGUgZGF0b3NcbiAgICAvLyB1c2FuZG8gZWwgc3ViIGNvbW8gaWRlbnRpZmljYWRvciBleHRlcm5vXG4gICAgLy8gUG9yIGFob3JhLCBkZXZvbHZlbW9zIHVuIHVzdWFyaW8gYsOhc2ljb1xuICAgIFxuICAgIHJldHVybiB7XG4gICAgICBpZDogc3ViLFxuICAgICAgZW1haWwsXG4gICAgICBuYW1lLFxuICAgICAgcm9sZUlkOiAndXNlcicsIC8vIFBvciBkZWZlY3RvLCBsdWVnbyBhY3R1YWxpemFtb3MgY29uIGluZm8gZGUgQkRcbiAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIHN1Y3Vyc2FsSWQ6IG51bGxcbiAgICB9O1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGFsIG9idGVuZXIgaW5mbyBkZSB1c3VhcmlvOicsIGVycm9yKTtcbiAgICB0aHJvdyBlcnJvcjtcbiAgfVxufVxuXG4vLyBDZXJyYXIgc2VzacOzblxuYXN5bmMgbG9nb3V0KGFjY2Vzc1Rva2VuOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBjb21tYW5kID0gbmV3IEdsb2JhbFNpZ25PdXRDb21tYW5kKHtcbiAgICAgIEFjY2Vzc1Rva2VuOiBhY2Nlc3NUb2tlblxuICAgIH0pO1xuICAgIFxuICAgIGF3YWl0IHRoaXMuY2xpZW50LnNlbmQoY29tbWFuZCk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgYWwgY2VycmFyIHNlc2nDs246JywgZXJyb3IpO1xuICAgIHRocm93IGVycm9yO1xuICB9XG59XG5cbi8vIFJlZnJlc2NhciB0b2tlblxuLy8gRW4gc3JjL3NlcnZlci9zZXJ2aWNlcy9hdXRoL2NvZ25pdG9TZXJ2aWNlLnRzXG5hc3luYyByZWZyZXNoVG9rZW4ocmVmcmVzaFRva2VuOiBzdHJpbmcpOiBQcm9taXNlPE9taXQ8QXV0aFJlc3VsdCwgJ3VzZXInPj4ge1xuICB0cnkge1xuICAgIC8vIFBhcmEgZWwgcmVmcmVzaCB0b2tlbiBuZWNlc2l0YW1vcyBjb25vY2VyIGVsIHVzZXJuYW1lXG4gICAgLy8gSW50ZW50YXIgZXh0cmFlciBlbCB1c2VybmFtZSBkZWwgdG9rZW4gKG5vcm1hbG1lbnRlIGVzdGFyw6EgZW4gZWwgcGF5bG9hZClcbiAgICBsZXQgdXNlcm5hbWUgPSAnJztcbiAgICB0cnkge1xuICAgICAgLy8gSW50ZW50YXIgZXh0cmFlciBkZWwgcGF5bG9hZCBkZWwgSldUXG4gICAgICBjb25zdCB0b2tlblBhcnRzID0gcmVmcmVzaFRva2VuLnNwbGl0KCcuJyk7XG4gICAgICBpZiAodG9rZW5QYXJ0cy5sZW5ndGggPj0gMikge1xuICAgICAgICBjb25zdCBwYXlsb2FkID0gSlNPTi5wYXJzZShhdG9iKHRva2VuUGFydHNbMV0pKTtcbiAgICAgICAgdXNlcm5hbWUgPSBwYXlsb2FkLnVzZXJuYW1lIHx8IHBheWxvYWQuZW1haWwgfHwgJyc7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgY29uc29sZS5lcnJvcignTm8gc2UgcHVkbyBleHRyYWVyIHVzZXJuYW1lIGRlbCB0b2tlbjonLCBlKTtcbiAgICAgIC8vIFNpIG5vIHNlIHB1ZWRlIGV4dHJhZXIsIHVzYXIgdW4gdmFsb3IgYWxtYWNlbmFkbyBlbiBsb2NhbFN0b3JhZ2VcbiAgICAgIGlmICh0eXBlb2YgbG9jYWxTdG9yYWdlICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICB1c2VybmFtZSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCd1c2VyRW1haWwnKSB8fCAnJztcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBTaSBubyB0ZW5lbW9zIHVzZXJuYW1lLCBubyBwb2RlbW9zIGdlbmVyYXIgU0VDUkVUX0hBU0hcbiAgICBpZiAoIXVzZXJuYW1lICYmIHRoaXMuY2xpZW50U2VjcmV0KSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1NlIHJlcXVpZXJlIGVsIHVzZXJuYW1lIHBhcmEgZWwgcmVmcmVzaCB0b2tlbiBjdWFuZG8gc2UgdXNhIGNsaWVudCBzZWNyZXQnKTtcbiAgICB9XG4gICAgXG4gICAgLy8gUGFyw6FtZXRyb3MgcGFyYSBlbCByZWZyZXNoIHRva2VuXG4gICAgY29uc3QgYXV0aFBhcmFtczogUmVjb3JkPHN0cmluZywgc3RyaW5nPiA9IHtcbiAgICAgIFJFRlJFU0hfVE9LRU46IHJlZnJlc2hUb2tlblxuICAgIH07XG4gICAgXG4gICAgLy8gQcOxYWRpciBTRUNSRVRfSEFTSCBzaSB0ZW5lbW9zIHVzZXJuYW1lIHkgY2xpZW50U2VjcmV0XG4gICAgaWYgKHVzZXJuYW1lICYmIHRoaXMuY2xpZW50U2VjcmV0KSB7XG4gICAgICBhdXRoUGFyYW1zLlNFQ1JFVF9IQVNIID0gdGhpcy5jYWxjdWxhdGVTZWNyZXRIYXNoKHVzZXJuYW1lKTtcbiAgICB9XG4gICAgXG4gICAgY29uc3QgY29tbWFuZCA9IG5ldyBJbml0aWF0ZUF1dGhDb21tYW5kKHtcbiAgICAgIEF1dGhGbG93OiBcIlJFRlJFU0hfVE9LRU5fQVVUSFwiLFxuICAgICAgQ2xpZW50SWQ6IHRoaXMuY2xpZW50SWQsXG4gICAgICBBdXRoUGFyYW1ldGVyczogYXV0aFBhcmFtc1xuICAgIH0pO1xuICAgIFxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy5jbGllbnQuc2VuZChjb21tYW5kKTtcbiAgICBcbiAgICBpZiAoIXJlc3BvbnNlLkF1dGhlbnRpY2F0aW9uUmVzdWx0KSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0Vycm9yIGFsIHJlZnJlc2NhciB0b2tlbicpO1xuICAgIH1cbiAgICBcbiAgICByZXR1cm4ge1xuICAgICAgYWNjZXNzVG9rZW46IHJlc3BvbnNlLkF1dGhlbnRpY2F0aW9uUmVzdWx0LkFjY2Vzc1Rva2VuIGFzIHN0cmluZyxcbiAgICAgIGlkVG9rZW46IHJlc3BvbnNlLkF1dGhlbnRpY2F0aW9uUmVzdWx0LklkVG9rZW4gYXMgc3RyaW5nLFxuICAgICAgcmVmcmVzaFRva2VuOiByZWZyZXNoVG9rZW4sIC8vIE1hbnRlbmVyIGVsIG1pc21vIHJlZnJlc2ggdG9rZW5cbiAgICAgIGV4cGlyZXNJbjogcmVzcG9uc2UuQXV0aGVudGljYXRpb25SZXN1bHQuRXhwaXJlc0luIHx8IDM2MDBcbiAgICB9O1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGFsIHJlZnJlc2NhciB0b2tlbjonLCBlcnJvcik7XG4gICAgdGhyb3cgZXJyb3I7XG4gIH1cbn1cblxuLy8gQ3JlYXIgdXN1YXJpbyAoc29sbyBhZG1pbilcbmFzeW5jIGNyZWF0ZVVzZXIodXNlcjoge1xuICBlbWFpbDogc3RyaW5nO1xuICBuYW1lOiBzdHJpbmc7XG4gIHBhc3N3b3JkOiBzdHJpbmc7XG4gIHJvbGVJZDogc3RyaW5nO1xufSk6IFByb21pc2U8dm9pZD4ge1xuICB0cnkge1xuICAgIGNvbnN0IGNvbW1hbmQgPSBuZXcgQWRtaW5DcmVhdGVVc2VyQ29tbWFuZCh7XG4gICAgICBVc2VyUG9vbElkOiB0aGlzLnVzZXJQb29sSWQsXG4gICAgICBVc2VybmFtZTogdXNlci5lbWFpbCxcbiAgICAgIFRlbXBvcmFyeVBhc3N3b3JkOiB1c2VyLnBhc3N3b3JkLFxuICAgICAgVXNlckF0dHJpYnV0ZXM6IFtcbiAgICAgICAge1xuICAgICAgICAgIE5hbWU6ICdlbWFpbCcsXG4gICAgICAgICAgVmFsdWU6IHVzZXIuZW1haWxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIE5hbWU6ICdlbWFpbF92ZXJpZmllZCcsXG4gICAgICAgICAgVmFsdWU6ICd0cnVlJ1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgTmFtZTogJ25hbWUnLFxuICAgICAgICAgIFZhbHVlOiB1c2VyLm5hbWVcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIE5hbWU6ICdjdXN0b206cm9sZScsXG4gICAgICAgICAgVmFsdWU6IHVzZXIucm9sZUlkXG4gICAgICAgIH1cbiAgICAgIF1cbiAgICB9KTtcbiAgICBcbiAgICBhd2FpdCB0aGlzLmNsaWVudC5zZW5kKGNvbW1hbmQpO1xuICAgIFxuICAgIC8vIEFxdcOtIGRlYmVyw61hbW9zIGNyZWFyIHRhbWJpw6luIGVsIHVzdWFyaW8gZW4gbnVlc3RyYSBCRFxuICAgIC8vIHkgdmluY3VsYXIgZWwgaWQgZGUgQ29nbml0b1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGFsIGNyZWFyIHVzdWFyaW86JywgZXJyb3IpO1xuICAgIHRocm93IGVycm9yO1xuICB9XG59XG59XG5cbi8vIFNpbmdsZXRvbiBwYXJhIHVzbyBlbiBsYSBhcGxpY2FjacOzblxuZXhwb3J0IGNvbnN0IGNvZ25pdG9TZXJ2aWNlID0gbmV3IENvZ25pdG9BdXRoU2VydmljZSgpOyJdLCJuYW1lcyI6WyJDb2duaXRvSWRlbnRpdHlQcm92aWRlckNsaWVudCIsIkluaXRpYXRlQXV0aENvbW1hbmQiLCJHZXRVc2VyQ29tbWFuZCIsIkFkbWluQ3JlYXRlVXNlckNvbW1hbmQiLCJHbG9iYWxTaWduT3V0Q29tbWFuZCIsIlNpZ25VcENvbW1hbmQiLCJDb25maXJtU2lnblVwQ29tbWFuZCIsIlJlc2VuZENvbmZpcm1hdGlvbkNvZGVDb21tYW5kIiwiY3J5cHRvIiwiQ29nbml0b0F1dGhTZXJ2aWNlIiwiY2FsY3VsYXRlU2VjcmV0SGFzaCIsInVzZXJuYW1lIiwiY2xpZW50U2VjcmV0IiwiY29uc29sZSIsImVycm9yIiwiRXJyb3IiLCJtZXNzYWdlIiwiY2xpZW50SWQiLCJobWFjIiwiY3JlYXRlSG1hYyIsInVwZGF0ZSIsImRpZ2VzdCIsInJlZ2lzdGVyVXNlciIsInBhcmFtcyIsImVtYWlsIiwicGFzc3dvcmQiLCJuYW1lIiwic2lnblVwQ29tbWFuZCIsIkNsaWVudElkIiwiVXNlcm5hbWUiLCJQYXNzd29yZCIsIlNlY3JldEhhc2giLCJVc2VyQXR0cmlidXRlcyIsIk5hbWUiLCJWYWx1ZSIsInJlc3BvbnNlIiwiY2xpZW50Iiwic2VuZCIsInN1Y2Nlc3MiLCJ1c2VySWQiLCJVc2VyU3ViIiwiY29uZmlybVJlZ2lzdHJhdGlvbiIsImNvbmZpcm1hdGlvbkNvZGUiLCJjb21tYW5kIiwiQ29uZmlybWF0aW9uQ29kZSIsInJlc2VuZENvbmZpcm1hdGlvbkNvZGUiLCJsb2dpbiIsImNyZWRlbnRpYWxzIiwibG9nIiwicmVnaW9uIiwicHJvY2VzcyIsImVudiIsIkFXU19SRUdJT04iLCJ1c2VyUG9vbElkIiwic3Vic3RyaW5nIiwiaGFzU2VjcmV0Iiwic2VjcmV0SGFzaCIsImF1dGhQYXJhbXMiLCJVU0VSTkFNRSIsIlBBU1NXT1JEIiwiU0VDUkVUX0hBU0giLCJBdXRoRmxvdyIsIkF1dGhQYXJhbWV0ZXJzIiwiQXV0aGVudGljYXRpb25SZXN1bHQiLCJDaGFsbGVuZ2VOYW1lIiwidXNlckluZm8iLCJnZXRVc2VySW5mbyIsIkFjY2Vzc1Rva2VuIiwidXNlciIsImFjY2Vzc1Rva2VuIiwicmVmcmVzaFRva2VuIiwiUmVmcmVzaFRva2VuIiwiaWRUb2tlbiIsIklkVG9rZW4iLCJleHBpcmVzSW4iLCJFeHBpcmVzSW4iLCIkbWV0YWRhdGEiLCJfX3R5cGUiLCJhdHRyaWJ1dGVzIiwiZmluZCIsImF0dHIiLCJzdWIiLCJpZCIsInJvbGVJZCIsImNyZWF0ZWRBdCIsIkRhdGUiLCJ1cGRhdGVkQXQiLCJzdWN1cnNhbElkIiwibG9nb3V0IiwidG9rZW5QYXJ0cyIsInNwbGl0IiwibGVuZ3RoIiwicGF5bG9hZCIsIkpTT04iLCJwYXJzZSIsImF0b2IiLCJlIiwibG9jYWxTdG9yYWdlIiwiZ2V0SXRlbSIsIlJFRlJFU0hfVE9LRU4iLCJjcmVhdGVVc2VyIiwiVXNlclBvb2xJZCIsIlRlbXBvcmFyeVBhc3N3b3JkIiwiY29uc3RydWN0b3IiLCJDT0dOSVRPX1VTRVJfUE9PTF9JRCIsIkNPR05JVE9fQ0xJRU5UX0lEIiwiQ09HTklUT19DTElFTlRfU0VDUkVUIiwiY29nbml0b1NlcnZpY2UiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(app-pages-browser)/./src/server/services/auth/cognitoService.ts\n"));

/***/ })

});