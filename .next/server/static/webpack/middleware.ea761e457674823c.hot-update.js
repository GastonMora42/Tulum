"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdate_N_E"]("middleware",{

/***/ "(middleware)/./src/middleware.ts":
/*!***************************!*\
  !*** ./src/middleware.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   middleware: () => (/* binding */ middleware)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(middleware)/./node_modules/next/dist/esm/api/server.js\");\n// src/middleware.ts\n\n// Mapeo de rutas a roles permitidos\nconst routePermissions = {\n    '/admin': [\n        'admin'\n    ],\n    '/admin/usuarios': [\n        'admin'\n    ],\n    '/admin/productos': [\n        'admin'\n    ],\n    '/admin/stock': [\n        'admin'\n    ],\n    '/fabrica': [\n        'admin',\n        'fabrica'\n    ],\n    '/pdv': [\n        'admin',\n        'vendedor'\n    ]\n};\n// APIs públicas que no requieren autenticación\nconst publicApis = [\n    '/api/auth/login',\n    '/api/auth/refresh',\n    '/api/auth/register',\n    '/api/auth/confirm',\n    '/api/auth/resend-code'\n];\n// Rutas públicas de páginas\nconst publicPages = [\n    '/login',\n    '/register'\n];\n// APIs de desarrollo para facilitar la creación inicial de usuarios\n// IMPORTANTE: Eliminar o proteger estas rutas en producción\nconst devApis =  true ? [\n    '/api/admin/users',\n    '/api/admin/roles',\n    '/api/admin/ubicaciones'\n] : 0;\n// src/middleware.ts\nasync function middleware(request) {\n    // Verificar si la ruta requiere autenticación\n    const path = request.nextUrl.pathname;\n    console.log('Middleware procesando ruta:', path);\n    // Si es ruta pública, permitir acceso\n    if (publicPages.includes(path) || publicApis.some((api)=>path.startsWith(api)) || devApis.some((api)=>path.startsWith(api))) {\n        console.log('Ruta pública, permitiendo acceso');\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.next();\n    }\n    // Verificar token de acceso (simplificado para debugging)\n    const token = request.cookies.get('accessToken')?.value || request.headers.get('authorization')?.replace('Bearer ', '');\n    if (!token) {\n        // Redireccionar a login si no hay token\n        console.log('No hay token, redirigiendo a login');\n        const url = new URL('/login', request.url);\n        url.searchParams.set('redirect', path);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.redirect(url);\n    }\n    // Permitir acceso para rutas de admin sin verificar rol durante desarrollo\n    if (path.startsWith('/admin')) {\n        console.log('Acceso a ruta de admin permitido');\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.next();\n    }\n    // Para otras rutas, continuar con el flujo normal\n    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.next();\n}\n// Configuración para que el middleware se ejecute en estas rutas\nconst config = {\n    matcher: [\n        '/admin/:path*',\n        '/fabrica/:path*',\n        '/pdv/:path*',\n        '/api/:path*',\n        '/login',\n        '/register'\n    ]\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKG1pZGRsZXdhcmUpLy4vc3JjL21pZGRsZXdhcmUudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsb0JBQW9CO0FBQ29DO0FBRXhELG9DQUFvQztBQUNwQyxNQUFNQyxtQkFBNkM7SUFDakQsVUFBVTtRQUFDO0tBQVE7SUFDbkIsbUJBQW1CO1FBQUM7S0FBUTtJQUM1QixvQkFBb0I7UUFBQztLQUFRO0lBQzdCLGdCQUFnQjtRQUFDO0tBQVE7SUFDekIsWUFBWTtRQUFDO1FBQVM7S0FBVTtJQUNoQyxRQUFRO1FBQUM7UUFBUztLQUFXO0FBQy9CO0FBRUEsK0NBQStDO0FBQy9DLE1BQU1DLGFBQWE7SUFDakI7SUFDQTtJQUNBO0lBQ0E7SUFDQTtDQUNEO0FBRUQsNEJBQTRCO0FBQzVCLE1BQU1DLGNBQWM7SUFDbEI7SUFDQTtDQUNEO0FBRUQsb0VBQW9FO0FBQ3BFLDREQUE0RDtBQUM1RCxNQUFNQyxVQUFVQyxLQUFzQyxHQUFHO0lBQ3ZEO0lBQ0E7SUFDQTtDQUNELEdBQUcsQ0FBRTtBQUVOLG9CQUFvQjtBQUNiLGVBQWVDLFdBQVdDLE9BQW9CO0lBQ25ELDhDQUE4QztJQUM5QyxNQUFNQyxPQUFPRCxRQUFRRSxPQUFPLENBQUNDLFFBQVE7SUFFckNDLFFBQVFDLEdBQUcsQ0FBQywrQkFBK0JKO0lBRTNDLHNDQUFzQztJQUN0QyxJQUNFTCxZQUFZVSxRQUFRLENBQUNMLFNBQ3JCTixXQUFXWSxJQUFJLENBQUNDLENBQUFBLE1BQU9QLEtBQUtRLFVBQVUsQ0FBQ0QsU0FDdkNYLFFBQVFVLElBQUksQ0FBQ0MsQ0FBQUEsTUFBT1AsS0FBS1EsVUFBVSxDQUFDRCxPQUNwQztRQUNBSixRQUFRQyxHQUFHLENBQUM7UUFDWixPQUFPWixxREFBWUEsQ0FBQ2lCLElBQUk7SUFDMUI7SUFFQSwwREFBMEQ7SUFDMUQsTUFBTUMsUUFBUVgsUUFBUVksT0FBTyxDQUFDQyxHQUFHLENBQUMsZ0JBQWdCQyxTQUNwQ2QsUUFBUWUsT0FBTyxDQUFDRixHQUFHLENBQUMsa0JBQWtCRyxRQUFRLFdBQVc7SUFFdkUsSUFBSSxDQUFDTCxPQUFPO1FBQ1Ysd0NBQXdDO1FBQ3hDUCxRQUFRQyxHQUFHLENBQUM7UUFDWixNQUFNWSxNQUFNLElBQUlDLElBQUksVUFBVWxCLFFBQVFpQixHQUFHO1FBQ3pDQSxJQUFJRSxZQUFZLENBQUNDLEdBQUcsQ0FBQyxZQUFZbkI7UUFDakMsT0FBT1IscURBQVlBLENBQUM0QixRQUFRLENBQUNKO0lBQy9CO0lBRUEsMkVBQTJFO0lBQzNFLElBQUloQixLQUFLUSxVQUFVLENBQUMsV0FBVztRQUM3QkwsUUFBUUMsR0FBRyxDQUFDO1FBQ1osT0FBT1oscURBQVlBLENBQUNpQixJQUFJO0lBQzFCO0lBRUEsa0RBQWtEO0lBQ2xELE9BQU9qQixxREFBWUEsQ0FBQ2lCLElBQUk7QUFDMUI7QUFFQSxpRUFBaUU7QUFDMUQsTUFBTVksU0FBUztJQUNwQkMsU0FBUztRQUNQO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtLQUNEO0FBQ0gsRUFBRSIsInNvdXJjZXMiOlsiL1VzZXJzL2dhc3Rvbm1vcmEvRGVza3RvcC9Qcm95ZWN0b3MvVHVsdW0vc3JjL21pZGRsZXdhcmUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gc3JjL21pZGRsZXdhcmUudHNcbmltcG9ydCB7IE5leHRSZXF1ZXN0LCBOZXh0UmVzcG9uc2UgfSBmcm9tICduZXh0L3NlcnZlcic7XG5cbi8vIE1hcGVvIGRlIHJ1dGFzIGEgcm9sZXMgcGVybWl0aWRvc1xuY29uc3Qgcm91dGVQZXJtaXNzaW9uczogUmVjb3JkPHN0cmluZywgc3RyaW5nW10+ID0ge1xuICAnL2FkbWluJzogWydhZG1pbiddLFxuICAnL2FkbWluL3VzdWFyaW9zJzogWydhZG1pbiddLFxuICAnL2FkbWluL3Byb2R1Y3Rvcyc6IFsnYWRtaW4nXSxcbiAgJy9hZG1pbi9zdG9jayc6IFsnYWRtaW4nXSxcbiAgJy9mYWJyaWNhJzogWydhZG1pbicsICdmYWJyaWNhJ10sXG4gICcvcGR2JzogWydhZG1pbicsICd2ZW5kZWRvciddXG59O1xuXG4vLyBBUElzIHDDumJsaWNhcyBxdWUgbm8gcmVxdWllcmVuIGF1dGVudGljYWNpw7NuXG5jb25zdCBwdWJsaWNBcGlzID0gW1xuICAnL2FwaS9hdXRoL2xvZ2luJyxcbiAgJy9hcGkvYXV0aC9yZWZyZXNoJyxcbiAgJy9hcGkvYXV0aC9yZWdpc3RlcicsXG4gICcvYXBpL2F1dGgvY29uZmlybScsXG4gICcvYXBpL2F1dGgvcmVzZW5kLWNvZGUnXG5dO1xuXG4vLyBSdXRhcyBww7pibGljYXMgZGUgcMOhZ2luYXNcbmNvbnN0IHB1YmxpY1BhZ2VzID0gW1xuICAnL2xvZ2luJyxcbiAgJy9yZWdpc3Rlcidcbl07XG5cbi8vIEFQSXMgZGUgZGVzYXJyb2xsbyBwYXJhIGZhY2lsaXRhciBsYSBjcmVhY2nDs24gaW5pY2lhbCBkZSB1c3Vhcmlvc1xuLy8gSU1QT1JUQU5URTogRWxpbWluYXIgbyBwcm90ZWdlciBlc3RhcyBydXRhcyBlbiBwcm9kdWNjacOzblxuY29uc3QgZGV2QXBpcyA9IHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAnZGV2ZWxvcG1lbnQnID8gW1xuICAnL2FwaS9hZG1pbi91c2VycycsXG4gICcvYXBpL2FkbWluL3JvbGVzJyxcbiAgJy9hcGkvYWRtaW4vdWJpY2FjaW9uZXMnXG5dIDogW107XG5cbi8vIHNyYy9taWRkbGV3YXJlLnRzXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbWlkZGxld2FyZShyZXF1ZXN0OiBOZXh0UmVxdWVzdCkge1xuICAvLyBWZXJpZmljYXIgc2kgbGEgcnV0YSByZXF1aWVyZSBhdXRlbnRpY2FjacOzblxuICBjb25zdCBwYXRoID0gcmVxdWVzdC5uZXh0VXJsLnBhdGhuYW1lO1xuICBcbiAgY29uc29sZS5sb2coJ01pZGRsZXdhcmUgcHJvY2VzYW5kbyBydXRhOicsIHBhdGgpO1xuICBcbiAgLy8gU2kgZXMgcnV0YSBww7pibGljYSwgcGVybWl0aXIgYWNjZXNvXG4gIGlmIChcbiAgICBwdWJsaWNQYWdlcy5pbmNsdWRlcyhwYXRoKSB8fCBcbiAgICBwdWJsaWNBcGlzLnNvbWUoYXBpID0+IHBhdGguc3RhcnRzV2l0aChhcGkpKSB8fFxuICAgIGRldkFwaXMuc29tZShhcGkgPT4gcGF0aC5zdGFydHNXaXRoKGFwaSkpXG4gICkge1xuICAgIGNvbnNvbGUubG9nKCdSdXRhIHDDumJsaWNhLCBwZXJtaXRpZW5kbyBhY2Nlc28nKTtcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLm5leHQoKTtcbiAgfVxuICBcbiAgLy8gVmVyaWZpY2FyIHRva2VuIGRlIGFjY2VzbyAoc2ltcGxpZmljYWRvIHBhcmEgZGVidWdnaW5nKVxuICBjb25zdCB0b2tlbiA9IHJlcXVlc3QuY29va2llcy5nZXQoJ2FjY2Vzc1Rva2VuJyk/LnZhbHVlIHx8IFxuICAgICAgICAgICAgICAgIHJlcXVlc3QuaGVhZGVycy5nZXQoJ2F1dGhvcml6YXRpb24nKT8ucmVwbGFjZSgnQmVhcmVyICcsICcnKTtcbiAgXG4gIGlmICghdG9rZW4pIHtcbiAgICAvLyBSZWRpcmVjY2lvbmFyIGEgbG9naW4gc2kgbm8gaGF5IHRva2VuXG4gICAgY29uc29sZS5sb2coJ05vIGhheSB0b2tlbiwgcmVkaXJpZ2llbmRvIGEgbG9naW4nKTtcbiAgICBjb25zdCB1cmwgPSBuZXcgVVJMKCcvbG9naW4nLCByZXF1ZXN0LnVybCk7XG4gICAgdXJsLnNlYXJjaFBhcmFtcy5zZXQoJ3JlZGlyZWN0JywgcGF0aCk7XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5yZWRpcmVjdCh1cmwpO1xuICB9XG4gIFxuICAvLyBQZXJtaXRpciBhY2Nlc28gcGFyYSBydXRhcyBkZSBhZG1pbiBzaW4gdmVyaWZpY2FyIHJvbCBkdXJhbnRlIGRlc2Fycm9sbG9cbiAgaWYgKHBhdGguc3RhcnRzV2l0aCgnL2FkbWluJykpIHtcbiAgICBjb25zb2xlLmxvZygnQWNjZXNvIGEgcnV0YSBkZSBhZG1pbiBwZXJtaXRpZG8nKTtcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLm5leHQoKTtcbiAgfVxuICBcbiAgLy8gUGFyYSBvdHJhcyBydXRhcywgY29udGludWFyIGNvbiBlbCBmbHVqbyBub3JtYWxcbiAgcmV0dXJuIE5leHRSZXNwb25zZS5uZXh0KCk7XG59XG5cbi8vIENvbmZpZ3VyYWNpw7NuIHBhcmEgcXVlIGVsIG1pZGRsZXdhcmUgc2UgZWplY3V0ZSBlbiBlc3RhcyBydXRhc1xuZXhwb3J0IGNvbnN0IGNvbmZpZyA9IHtcbiAgbWF0Y2hlcjogW1xuICAgICcvYWRtaW4vOnBhdGgqJyxcbiAgICAnL2ZhYnJpY2EvOnBhdGgqJyxcbiAgICAnL3Bkdi86cGF0aConLFxuICAgICcvYXBpLzpwYXRoKicsXG4gICAgJy9sb2dpbicsXG4gICAgJy9yZWdpc3RlcidcbiAgXSxcbn07Il0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsInJvdXRlUGVybWlzc2lvbnMiLCJwdWJsaWNBcGlzIiwicHVibGljUGFnZXMiLCJkZXZBcGlzIiwicHJvY2VzcyIsIm1pZGRsZXdhcmUiLCJyZXF1ZXN0IiwicGF0aCIsIm5leHRVcmwiLCJwYXRobmFtZSIsImNvbnNvbGUiLCJsb2ciLCJpbmNsdWRlcyIsInNvbWUiLCJhcGkiLCJzdGFydHNXaXRoIiwibmV4dCIsInRva2VuIiwiY29va2llcyIsImdldCIsInZhbHVlIiwiaGVhZGVycyIsInJlcGxhY2UiLCJ1cmwiLCJVUkwiLCJzZWFyY2hQYXJhbXMiLCJzZXQiLCJyZWRpcmVjdCIsImNvbmZpZyIsIm1hdGNoZXIiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(middleware)/./src/middleware.ts\n");

/***/ })

});