"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdate_N_E"]("middleware",{

/***/ "(middleware)/./src/middleware.ts":
/*!***************************!*\
  !*** ./src/middleware.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   middleware: () => (/* binding */ middleware)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(middleware)/./node_modules/next/dist/esm/api/server.js\");\n// src/middleware.ts\n\n// Mapeo de rutas a roles permitidos\nconst routePermissions = {\n    '/admin': [\n        'admin'\n    ],\n    '/admin/usuarios': [\n        'admin'\n    ],\n    '/admin/productos': [\n        'admin'\n    ],\n    '/admin/stock': [\n        'admin'\n    ],\n    '/fabrica': [\n        'admin',\n        'fabrica'\n    ],\n    '/pdv': [\n        'admin',\n        'vendedor'\n    ]\n};\n// APIs públicas que no requieren autenticación\nconst publicApis = [\n    '/api/auth/login',\n    '/api/auth/refresh',\n    '/api/auth/register',\n    '/api/auth/confirm',\n    '/api/auth/resend-code'\n];\n// Rutas públicas de páginas\nconst publicPages = [\n    '/login',\n    '/register'\n];\n// APIs de desarrollo para facilitar la creación inicial de usuarios\n// IMPORTANTE: Eliminar o proteger estas rutas en producción\nconst devApis =  true ? [\n    '/api/admin/users',\n    '/api/admin/roles',\n    '/api/admin/ubicaciones'\n] : 0;\nasync function middleware(request) {\n    // Verificar si la ruta requiere autenticación\n    const path = request.nextUrl.pathname;\n    // Si es ruta pública, permitir acceso\n    if (publicPages.includes(path) || publicApis.includes(path) || devApis.some((api)=>path.startsWith(api))) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.next();\n    }\n    // Verificar token de acceso\n    const token = request.cookies.get('accessToken')?.value;\n    if (!token) {\n        // Redireccionar a login si no hay token\n        const url = new URL('/login', request.url);\n        url.searchParams.set('redirect', path);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.redirect(url);\n    }\n    // Verificar permisos para rutas específicas\n    // Verificar permisos para rutas específicas\n    for (const [route, allowedRoles] of Object.entries(routePermissions)){\n        if (path.startsWith(route)) {\n            try {\n                // Decodificar token para obtener rol\n                const payload = JSON.parse(atob(token.split('.')[1]));\n                let userRole = payload.role?.name || payload.roleName || 'user';\n                // Si el roleId tiene formato 'role-admin', extraer solo 'admin'\n                if (payload.roleId && payload.roleId.startsWith('role-')) {\n                    userRole = payload.roleId.substring(5); // Extraer parte después de 'role-'\n                }\n                console.log('Middleware - Rol del usuario:', userRole);\n                if (!allowedRoles.includes(userRole)) {\n                    // Usuario no autorizado, redireccionar a dashboard general\n                    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.redirect(new URL('/', request.url));\n                }\n            } catch (error) {\n                console.error('Error al verificar token:', error);\n                // Token inválido, redireccionar a login\n                const url = new URL('/login', request.url);\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.redirect(url);\n            }\n        }\n    }\n    // Permitir acceso\n    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.next();\n}\n// Configuración para que el middleware se ejecute en estas rutas\nconst config = {\n    matcher: [\n        '/admin/:path*',\n        '/fabrica/:path*',\n        '/pdv/:path*',\n        '/api/:path*',\n        '/login',\n        '/register'\n    ]\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LEVBQUUiLCJzb3VyY2VzIjpbIi9Vc2Vycy9nYXN0b25tb3JhL0Rlc2t0b3AvUHJveWVjdG9zL1R1bHVtL3NyYy9taWRkbGV3YXJlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIHNyYy9taWRkbGV3YXJlLnRzXG5pbXBvcnQgeyBOZXh0UmVxdWVzdCwgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInO1xuXG4vLyBNYXBlbyBkZSBydXRhcyBhIHJvbGVzIHBlcm1pdGlkb3NcbmNvbnN0IHJvdXRlUGVybWlzc2lvbnM6IFJlY29yZDxzdHJpbmcsIHN0cmluZ1tdPiA9IHtcbiAgJy9hZG1pbic6IFsnYWRtaW4nXSxcbiAgJy9hZG1pbi91c3Vhcmlvcyc6IFsnYWRtaW4nXSxcbiAgJy9hZG1pbi9wcm9kdWN0b3MnOiBbJ2FkbWluJ10sXG4gICcvYWRtaW4vc3RvY2snOiBbJ2FkbWluJ10sXG4gICcvZmFicmljYSc6IFsnYWRtaW4nLCAnZmFicmljYSddLFxuICAnL3Bkdic6IFsnYWRtaW4nLCAndmVuZGVkb3InXVxufTtcblxuLy8gQVBJcyBww7pibGljYXMgcXVlIG5vIHJlcXVpZXJlbiBhdXRlbnRpY2FjacOzblxuY29uc3QgcHVibGljQXBpcyA9IFtcbiAgJy9hcGkvYXV0aC9sb2dpbicsXG4gICcvYXBpL2F1dGgvcmVmcmVzaCcsXG4gICcvYXBpL2F1dGgvcmVnaXN0ZXInLFxuICAnL2FwaS9hdXRoL2NvbmZpcm0nLFxuICAnL2FwaS9hdXRoL3Jlc2VuZC1jb2RlJ1xuXTtcblxuLy8gUnV0YXMgcMO6YmxpY2FzIGRlIHDDoWdpbmFzXG5jb25zdCBwdWJsaWNQYWdlcyA9IFtcbiAgJy9sb2dpbicsXG4gICcvcmVnaXN0ZXInXG5dO1xuXG4vLyBBUElzIGRlIGRlc2Fycm9sbG8gcGFyYSBmYWNpbGl0YXIgbGEgY3JlYWNpw7NuIGluaWNpYWwgZGUgdXN1YXJpb3Ncbi8vIElNUE9SVEFOVEU6IEVsaW1pbmFyIG8gcHJvdGVnZXIgZXN0YXMgcnV0YXMgZW4gcHJvZHVjY2nDs25cbmNvbnN0IGRldkFwaXMgPSBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ2RldmVsb3BtZW50JyA/IFtcbiAgJy9hcGkvYWRtaW4vdXNlcnMnLFxuICAnL2FwaS9hZG1pbi9yb2xlcycsXG4gICcvYXBpL2FkbWluL3ViaWNhY2lvbmVzJ1xuXSA6IFtdO1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbWlkZGxld2FyZShyZXF1ZXN0OiBOZXh0UmVxdWVzdCkge1xuICAvLyBWZXJpZmljYXIgc2kgbGEgcnV0YSByZXF1aWVyZSBhdXRlbnRpY2FjacOzblxuICBjb25zdCBwYXRoID0gcmVxdWVzdC5uZXh0VXJsLnBhdGhuYW1lO1xuICBcbiAgLy8gU2kgZXMgcnV0YSBww7pibGljYSwgcGVybWl0aXIgYWNjZXNvXG4gIGlmIChcbiAgICBwdWJsaWNQYWdlcy5pbmNsdWRlcyhwYXRoKSB8fCBcbiAgICBwdWJsaWNBcGlzLmluY2x1ZGVzKHBhdGgpIHx8XG4gICAgZGV2QXBpcy5zb21lKGFwaSA9PiBwYXRoLnN0YXJ0c1dpdGgoYXBpKSlcbiAgKSB7XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5uZXh0KCk7XG4gIH1cbiAgXG4gIC8vIFZlcmlmaWNhciB0b2tlbiBkZSBhY2Nlc29cbiAgY29uc3QgdG9rZW4gPSByZXF1ZXN0LmNvb2tpZXMuZ2V0KCdhY2Nlc3NUb2tlbicpPy52YWx1ZTtcbiAgXG4gIGlmICghdG9rZW4pIHtcbiAgICAvLyBSZWRpcmVjY2lvbmFyIGEgbG9naW4gc2kgbm8gaGF5IHRva2VuXG4gICAgY29uc3QgdXJsID0gbmV3IFVSTCgnL2xvZ2luJywgcmVxdWVzdC51cmwpO1xuICAgIHVybC5zZWFyY2hQYXJhbXMuc2V0KCdyZWRpcmVjdCcsIHBhdGgpO1xuICAgIHJldHVybiBOZXh0UmVzcG9uc2UucmVkaXJlY3QodXJsKTtcbiAgfVxuICBcbiAgLy8gVmVyaWZpY2FyIHBlcm1pc29zIHBhcmEgcnV0YXMgZXNwZWPDrWZpY2FzXG4vLyBWZXJpZmljYXIgcGVybWlzb3MgcGFyYSBydXRhcyBlc3BlY8OtZmljYXNcbmZvciAoY29uc3QgW3JvdXRlLCBhbGxvd2VkUm9sZXNdIG9mIE9iamVjdC5lbnRyaWVzKHJvdXRlUGVybWlzc2lvbnMpKSB7XG4gIGlmIChwYXRoLnN0YXJ0c1dpdGgocm91dGUpKSB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIERlY29kaWZpY2FyIHRva2VuIHBhcmEgb2J0ZW5lciByb2xcbiAgICAgIGNvbnN0IHBheWxvYWQgPSBKU09OLnBhcnNlKGF0b2IodG9rZW4uc3BsaXQoJy4nKVsxXSkpO1xuICAgICAgbGV0IHVzZXJSb2xlID0gcGF5bG9hZC5yb2xlPy5uYW1lIHx8IHBheWxvYWQucm9sZU5hbWUgfHwgJ3VzZXInO1xuICAgICAgXG4gICAgICAvLyBTaSBlbCByb2xlSWQgdGllbmUgZm9ybWF0byAncm9sZS1hZG1pbicsIGV4dHJhZXIgc29sbyAnYWRtaW4nXG4gICAgICBpZiAocGF5bG9hZC5yb2xlSWQgJiYgcGF5bG9hZC5yb2xlSWQuc3RhcnRzV2l0aCgncm9sZS0nKSkge1xuICAgICAgICB1c2VyUm9sZSA9IHBheWxvYWQucm9sZUlkLnN1YnN0cmluZyg1KTsgLy8gRXh0cmFlciBwYXJ0ZSBkZXNwdcOpcyBkZSAncm9sZS0nXG4gICAgICB9XG4gICAgICBcbiAgICAgIGNvbnNvbGUubG9nKCdNaWRkbGV3YXJlIC0gUm9sIGRlbCB1c3VhcmlvOicsIHVzZXJSb2xlKTtcbiAgICAgIFxuICAgICAgaWYgKCFhbGxvd2VkUm9sZXMuaW5jbHVkZXModXNlclJvbGUpKSB7XG4gICAgICAgIC8vIFVzdWFyaW8gbm8gYXV0b3JpemFkbywgcmVkaXJlY2Npb25hciBhIGRhc2hib2FyZCBnZW5lcmFsXG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UucmVkaXJlY3QobmV3IFVSTCgnLycsIHJlcXVlc3QudXJsKSk7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGFsIHZlcmlmaWNhciB0b2tlbjonLCBlcnJvcik7XG4gICAgICAvLyBUb2tlbiBpbnbDoWxpZG8sIHJlZGlyZWNjaW9uYXIgYSBsb2dpblxuICAgICAgY29uc3QgdXJsID0gbmV3IFVSTCgnL2xvZ2luJywgcmVxdWVzdC51cmwpO1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5yZWRpcmVjdCh1cmwpO1xuICAgIH1cbiAgfVxufVxuICBcbiAgLy8gUGVybWl0aXIgYWNjZXNvXG4gIHJldHVybiBOZXh0UmVzcG9uc2UubmV4dCgpO1xufVxuXG4vLyBDb25maWd1cmFjacOzbiBwYXJhIHF1ZSBlbCBtaWRkbGV3YXJlIHNlIGVqZWN1dGUgZW4gZXN0YXMgcnV0YXNcbmV4cG9ydCBjb25zdCBjb25maWcgPSB7XG4gIG1hdGNoZXI6IFtcbiAgICAnL2FkbWluLzpwYXRoKicsXG4gICAgJy9mYWJyaWNhLzpwYXRoKicsXG4gICAgJy9wZHYvOnBhdGgqJyxcbiAgICAnL2FwaS86cGF0aConLFxuICAgICcvbG9naW4nLFxuICAgICcvcmVnaXN0ZXInXG4gIF0sXG59OyJdLCJuYW1lcyI6WyJOZXh0UmVzcG9uc2UiLCJyb3V0ZVBlcm1pc3Npb25zIiwicHVibGljQXBpcyIsInB1YmxpY1BhZ2VzIiwiZGV2QXBpcyIsInByb2Nlc3MiLCJtaWRkbGV3YXJlIiwicmVxdWVzdCIsInBhdGgiLCJuZXh0VXJsIiwicGF0aG5hbWUiLCJpbmNsdWRlcyIsInNvbWUiLCJhcGkiLCJzdGFydHNXaXRoIiwibmV4dCIsInRva2VuIiwiY29va2llcyIsImdldCIsInZhbHVlIiwidXJsIiwiVVJMIiwic2VhcmNoUGFyYW1zIiwic2V0IiwicmVkaXJlY3QiLCJyb3V0ZSIsImFsbG93ZWRSb2xlcyIsIk9iamVjdCIsImVudHJpZXMiLCJwYXlsb2FkIiwiSlNPTiIsInBhcnNlIiwiYXRvYiIsInNwbGl0IiwidXNlclJvbGUiLCJyb2xlIiwibmFtZSIsInJvbGVOYW1lIiwicm9sZUlkIiwic3Vic3RyaW5nIiwiY29uc29sZSIsImxvZyIsImVycm9yIiwiY29uZmlnIiwibWF0Y2hlciJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(middleware)/./src/middleware.ts\n");

/***/ })

});