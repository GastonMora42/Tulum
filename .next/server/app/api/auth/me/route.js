/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/auth/me/route";
exports.ids = ["app/api/auth/me/route"];
exports.modules = {

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fauth%2Fme%2Froute&page=%2Fapi%2Fauth%2Fme%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fauth%2Fme%2Froute.ts&appDir=%2FUsers%2Fgastonmora%2FDesktop%2FProyectos%2FTulum%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fgastonmora%2FDesktop%2FProyectos%2FTulum&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!*************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fauth%2Fme%2Froute&page=%2Fapi%2Fauth%2Fme%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fauth%2Fme%2Froute.ts&appDir=%2FUsers%2Fgastonmora%2FDesktop%2FProyectos%2FTulum%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fgastonmora%2FDesktop%2FProyectos%2FTulum&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \*************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   workAsyncStorage: () => (/* binding */ workAsyncStorage),\n/* harmony export */   workUnitAsyncStorage: () => (/* binding */ workUnitAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/route-kind */ \"(rsc)/./node_modules/next/dist/server/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_gastonmora_Desktop_Proyectos_Tulum_src_app_api_auth_me_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/auth/me/route.ts */ \"(rsc)/./src/app/api/auth/me/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/auth/me/route\",\n        pathname: \"/api/auth/me\",\n        filename: \"route\",\n        bundlePath: \"app/api/auth/me/route\"\n    },\n    resolvedPagePath: \"/Users/gastonmora/Desktop/Proyectos/Tulum/src/app/api/auth/me/route.ts\",\n    nextConfigOutput,\n    userland: _Users_gastonmora_Desktop_Proyectos_Tulum_src_app_api_auth_me_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { workAsyncStorage, workUnitAsyncStorage, serverHooks } = routeModule;\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        workAsyncStorage,\n        workUnitAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIvaW5kZXguanM/bmFtZT1hcHAlMkZhcGklMkZhdXRoJTJGbWUlMkZyb3V0ZSZwYWdlPSUyRmFwaSUyRmF1dGglMkZtZSUyRnJvdXRlJmFwcFBhdGhzPSZwYWdlUGF0aD1wcml2YXRlLW5leHQtYXBwLWRpciUyRmFwaSUyRmF1dGglMkZtZSUyRnJvdXRlLnRzJmFwcERpcj0lMkZVc2VycyUyRmdhc3Rvbm1vcmElMkZEZXNrdG9wJTJGUHJveWVjdG9zJTJGVHVsdW0lMkZzcmMlMkZhcHAmcGFnZUV4dGVuc2lvbnM9dHN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPWpzeCZwYWdlRXh0ZW5zaW9ucz1qcyZyb290RGlyPSUyRlVzZXJzJTJGZ2FzdG9ubW9yYSUyRkRlc2t0b3AlMkZQcm95ZWN0b3MlMkZUdWx1bSZpc0Rldj10cnVlJnRzY29uZmlnUGF0aD10c2NvbmZpZy5qc29uJmJhc2VQYXRoPSZhc3NldFByZWZpeD0mbmV4dENvbmZpZ091dHB1dD0mcHJlZmVycmVkUmVnaW9uPSZtaWRkbGV3YXJlQ29uZmlnPWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7QUFBK0Y7QUFDdkM7QUFDcUI7QUFDc0I7QUFDbkc7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLHlHQUFtQjtBQUMzQztBQUNBLGNBQWMsa0VBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLFlBQVk7QUFDWixDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsUUFBUSxzREFBc0Q7QUFDOUQ7QUFDQSxXQUFXLDRFQUFXO0FBQ3RCO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDMEY7O0FBRTFGIiwic291cmNlcyI6WyIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwUm91dGVSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL3JvdXRlLW1vZHVsZXMvYXBwLXJvdXRlL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgcGF0Y2hGZXRjaCBhcyBfcGF0Y2hGZXRjaCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi9wYXRjaC1mZXRjaFwiO1xuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIi9Vc2Vycy9nYXN0b25tb3JhL0Rlc2t0b3AvUHJveWVjdG9zL1R1bHVtL3NyYy9hcHAvYXBpL2F1dGgvbWUvcm91dGUudHNcIjtcbi8vIFdlIGluamVjdCB0aGUgbmV4dENvbmZpZ091dHB1dCBoZXJlIHNvIHRoYXQgd2UgY2FuIHVzZSB0aGVtIGluIHRoZSByb3V0ZVxuLy8gbW9kdWxlLlxuY29uc3QgbmV4dENvbmZpZ091dHB1dCA9IFwiXCJcbmNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IEFwcFJvdXRlUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLkFQUF9ST1VURSxcbiAgICAgICAgcGFnZTogXCIvYXBpL2F1dGgvbWUvcm91dGVcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9hdXRoL21lXCIsXG4gICAgICAgIGZpbGVuYW1lOiBcInJvdXRlXCIsXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiYXBwL2FwaS9hdXRoL21lL3JvdXRlXCJcbiAgICB9LFxuICAgIHJlc29sdmVkUGFnZVBhdGg6IFwiL1VzZXJzL2dhc3Rvbm1vcmEvRGVza3RvcC9Qcm95ZWN0b3MvVHVsdW0vc3JjL2FwcC9hcGkvYXV0aC9tZS9yb3V0ZS50c1wiLFxuICAgIG5leHRDb25maWdPdXRwdXQsXG4gICAgdXNlcmxhbmRcbn0pO1xuLy8gUHVsbCBvdXQgdGhlIGV4cG9ydHMgdGhhdCB3ZSBuZWVkIHRvIGV4cG9zZSBmcm9tIHRoZSBtb2R1bGUuIFRoaXMgc2hvdWxkXG4vLyBiZSBlbGltaW5hdGVkIHdoZW4gd2UndmUgbW92ZWQgdGhlIG90aGVyIHJvdXRlcyB0byB0aGUgbmV3IGZvcm1hdC4gVGhlc2Vcbi8vIGFyZSB1c2VkIHRvIGhvb2sgaW50byB0aGUgcm91dGUuXG5jb25zdCB7IHdvcmtBc3luY1N0b3JhZ2UsIHdvcmtVbml0QXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcyB9ID0gcm91dGVNb2R1bGU7XG5mdW5jdGlvbiBwYXRjaEZldGNoKCkge1xuICAgIHJldHVybiBfcGF0Y2hGZXRjaCh7XG4gICAgICAgIHdvcmtBc3luY1N0b3JhZ2UsXG4gICAgICAgIHdvcmtVbml0QXN5bmNTdG9yYWdlXG4gICAgfSk7XG59XG5leHBvcnQgeyByb3V0ZU1vZHVsZSwgd29ya0FzeW5jU3RvcmFnZSwgd29ya1VuaXRBc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzLCBwYXRjaEZldGNoLCAgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXBwLXJvdXRlLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fauth%2Fme%2Froute&page=%2Fapi%2Fauth%2Fme%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fauth%2Fme%2Froute.ts&appDir=%2FUsers%2Fgastonmora%2FDesktop%2FProyectos%2FTulum%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fgastonmora%2FDesktop%2FProyectos%2FTulum&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true!":
/*!******************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true! ***!
  \******************************************************************************************************/
/***/ (() => {



/***/ }),

/***/ "(rsc)/./src/app/api/auth/me/route.ts":
/*!**************************************!*\
  !*** ./src/app/api/auth/me/route.ts ***!
  \**************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _server_services_auth_authService__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/server/services/auth/authService */ \"(rsc)/./src/server/services/auth/authService.ts\");\n// src/app/api/auth/me/route.ts\n\n\nasync function GET(req) {\n    try {\n        // Obtener token de la cabecera\n        const authHeader = req.headers.get('authorization');\n        if (!authHeader || !authHeader.startsWith('Bearer ')) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: 'Token no proporcionado'\n            }, {\n                status: 401\n            });\n        }\n        const token = authHeader.split(' ')[1];\n        // Verificar token con servicio de autenticación\n        try {\n            // Obtener payload del token\n            const payload = JSON.parse(atob(token.split('.')[1]));\n            const userId = payload.sub;\n            // Obtener usuario de nuestra BD\n            const user = await _server_services_auth_authService__WEBPACK_IMPORTED_MODULE_1__.authService.getUserById(userId);\n            if (!user) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: 'Usuario no encontrado'\n                }, {\n                    status: 401\n                });\n            }\n            // Retornar información del usuario\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                user\n            });\n        } catch (error) {\n            console.error('Error al verificar token:', error);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: 'Token inválido'\n            }, {\n                status: 401\n            });\n        }\n    } catch (error) {\n        console.error('Error en ruta /api/auth/me:', error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: 'Error del servidor'\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBwL2FwaS9hdXRoL21lL3JvdXRlLnRzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLCtCQUErQjtBQUN5QjtBQUNTO0FBRTFELGVBQWVFLElBQUlDLEdBQWdCO0lBQ3hDLElBQUk7UUFDRiwrQkFBK0I7UUFDL0IsTUFBTUMsYUFBYUQsSUFBSUUsT0FBTyxDQUFDQyxHQUFHLENBQUM7UUFDbkMsSUFBSSxDQUFDRixjQUFjLENBQUNBLFdBQVdHLFVBQVUsQ0FBQyxZQUFZO1lBQ3BELE9BQU9QLHFEQUFZQSxDQUFDUSxJQUFJLENBQ3RCO2dCQUFFQyxPQUFPO1lBQXlCLEdBQ2xDO2dCQUFFQyxRQUFRO1lBQUk7UUFFbEI7UUFFQSxNQUFNQyxRQUFRUCxXQUFXUSxLQUFLLENBQUMsSUFBSSxDQUFDLEVBQUU7UUFFdEMsZ0RBQWdEO1FBQ2hELElBQUk7WUFDRiw0QkFBNEI7WUFDNUIsTUFBTUMsVUFBVUMsS0FBS0MsS0FBSyxDQUFDQyxLQUFLTCxNQUFNQyxLQUFLLENBQUMsSUFBSSxDQUFDLEVBQUU7WUFDbkQsTUFBTUssU0FBU0osUUFBUUssR0FBRztZQUUxQixnQ0FBZ0M7WUFDaEMsTUFBTUMsT0FBTyxNQUFNbEIsMEVBQVdBLENBQUNtQixXQUFXLENBQUNIO1lBQzNDLElBQUksQ0FBQ0UsTUFBTTtnQkFDVCxPQUFPbkIscURBQVlBLENBQUNRLElBQUksQ0FDdEI7b0JBQUVDLE9BQU87Z0JBQXdCLEdBQ2pDO29CQUFFQyxRQUFRO2dCQUFJO1lBRWxCO1lBRUEsbUNBQW1DO1lBQ25DLE9BQU9WLHFEQUFZQSxDQUFDUSxJQUFJLENBQUM7Z0JBQUVXO1lBQUs7UUFFbEMsRUFBRSxPQUFPVixPQUFPO1lBQ2RZLFFBQVFaLEtBQUssQ0FBQyw2QkFBNkJBO1lBQzNDLE9BQU9ULHFEQUFZQSxDQUFDUSxJQUFJLENBQ3RCO2dCQUFFQyxPQUFPO1lBQWlCLEdBQzFCO2dCQUFFQyxRQUFRO1lBQUk7UUFFbEI7SUFDRixFQUFFLE9BQU9ELE9BQU87UUFDZFksUUFBUVosS0FBSyxDQUFDLCtCQUErQkE7UUFDN0MsT0FBT1QscURBQVlBLENBQUNRLElBQUksQ0FDdEI7WUFBRUMsT0FBTztRQUFxQixHQUM5QjtZQUFFQyxRQUFRO1FBQUk7SUFFbEI7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL2dhc3Rvbm1vcmEvRGVza3RvcC9Qcm95ZWN0b3MvVHVsdW0vc3JjL2FwcC9hcGkvYXV0aC9tZS9yb3V0ZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBzcmMvYXBwL2FwaS9hdXRoL21lL3JvdXRlLnRzXG5pbXBvcnQgeyBOZXh0UmVxdWVzdCwgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInO1xuaW1wb3J0IHsgYXV0aFNlcnZpY2UgfSBmcm9tICdAL3NlcnZlci9zZXJ2aWNlcy9hdXRoL2F1dGhTZXJ2aWNlJztcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIEdFVChyZXE6IE5leHRSZXF1ZXN0KSB7XG4gIHRyeSB7XG4gICAgLy8gT2J0ZW5lciB0b2tlbiBkZSBsYSBjYWJlY2VyYVxuICAgIGNvbnN0IGF1dGhIZWFkZXIgPSByZXEuaGVhZGVycy5nZXQoJ2F1dGhvcml6YXRpb24nKTtcbiAgICBpZiAoIWF1dGhIZWFkZXIgfHwgIWF1dGhIZWFkZXIuc3RhcnRzV2l0aCgnQmVhcmVyICcpKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgZXJyb3I6ICdUb2tlbiBubyBwcm9wb3JjaW9uYWRvJyB9LFxuICAgICAgICB7IHN0YXR1czogNDAxIH1cbiAgICAgICk7XG4gICAgfVxuICAgIFxuICAgIGNvbnN0IHRva2VuID0gYXV0aEhlYWRlci5zcGxpdCgnICcpWzFdO1xuICAgIFxuICAgIC8vIFZlcmlmaWNhciB0b2tlbiBjb24gc2VydmljaW8gZGUgYXV0ZW50aWNhY2nDs25cbiAgICB0cnkge1xuICAgICAgLy8gT2J0ZW5lciBwYXlsb2FkIGRlbCB0b2tlblxuICAgICAgY29uc3QgcGF5bG9hZCA9IEpTT04ucGFyc2UoYXRvYih0b2tlbi5zcGxpdCgnLicpWzFdKSk7XG4gICAgICBjb25zdCB1c2VySWQgPSBwYXlsb2FkLnN1YjtcbiAgICAgIFxuICAgICAgLy8gT2J0ZW5lciB1c3VhcmlvIGRlIG51ZXN0cmEgQkRcbiAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBhdXRoU2VydmljZS5nZXRVc2VyQnlJZCh1c2VySWQpO1xuICAgICAgaWYgKCF1c2VyKSB7XG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgICB7IGVycm9yOiAnVXN1YXJpbyBubyBlbmNvbnRyYWRvJyB9LFxuICAgICAgICAgIHsgc3RhdHVzOiA0MDEgfVxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBSZXRvcm5hciBpbmZvcm1hY2nDs24gZGVsIHVzdWFyaW9cbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IHVzZXIgfSk7XG4gICAgICBcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgYWwgdmVyaWZpY2FyIHRva2VuOicsIGVycm9yKTtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBlcnJvcjogJ1Rva2VuIGludsOhbGlkbycgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMSB9XG4gICAgICApO1xuICAgIH1cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBlbiBydXRhIC9hcGkvYXV0aC9tZTonLCBlcnJvcik7XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgeyBlcnJvcjogJ0Vycm9yIGRlbCBzZXJ2aWRvcicgfSxcbiAgICAgIHsgc3RhdHVzOiA1MDAgfVxuICAgICk7XG4gIH1cbn0iXSwibmFtZXMiOlsiTmV4dFJlc3BvbnNlIiwiYXV0aFNlcnZpY2UiLCJHRVQiLCJyZXEiLCJhdXRoSGVhZGVyIiwiaGVhZGVycyIsImdldCIsInN0YXJ0c1dpdGgiLCJqc29uIiwiZXJyb3IiLCJzdGF0dXMiLCJ0b2tlbiIsInNwbGl0IiwicGF5bG9hZCIsIkpTT04iLCJwYXJzZSIsImF0b2IiLCJ1c2VySWQiLCJzdWIiLCJ1c2VyIiwiZ2V0VXNlckJ5SWQiLCJjb25zb2xlIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/auth/me/route.ts\n");

/***/ }),

/***/ "(rsc)/./src/server/db/client.ts":
/*!*********************************!*\
  !*** ./src/server/db/client.ts ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @prisma/client */ \"@prisma/client\");\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_prisma_client__WEBPACK_IMPORTED_MODULE_0__);\n// src/server/db/client.ts\n\n// Evitar múltiples instancias en desarrollo\nconst globalForPrisma = global;\nconst prisma = globalForPrisma.prisma ?? new _prisma_client__WEBPACK_IMPORTED_MODULE_0__.PrismaClient({\n    log:  true ? [\n        'query',\n        'error',\n        'warn'\n    ] : 0\n});\nif (true) globalForPrisma.prisma = prisma;\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (prisma);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmVyL2RiL2NsaWVudC50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSwwQkFBMEI7QUFDb0I7QUFFOUMsNENBQTRDO0FBQzVDLE1BQU1DLGtCQUFrQkM7QUFJeEIsTUFBTUMsU0FBU0YsZ0JBQWdCRSxNQUFNLElBQ25DLElBQUlILHdEQUFZQSxDQUFDO0lBQ2ZJLEtBQUtDLEtBQXNDLEdBQ3ZDO1FBQUM7UUFBUztRQUFTO0tBQU8sR0FDMUIsQ0FBUztBQUNmO0FBRUYsSUFBSUEsSUFBcUMsRUFBRUosZ0JBQWdCRSxNQUFNLEdBQUdBO0FBRXBFLGlFQUFlQSxNQUFNQSxFQUFDIiwic291cmNlcyI6WyIvVXNlcnMvZ2FzdG9ubW9yYS9EZXNrdG9wL1Byb3llY3Rvcy9UdWx1bS9zcmMvc2VydmVyL2RiL2NsaWVudC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBzcmMvc2VydmVyL2RiL2NsaWVudC50c1xuaW1wb3J0IHsgUHJpc21hQ2xpZW50IH0gZnJvbSAnQHByaXNtYS9jbGllbnQnO1xuXG4vLyBFdml0YXIgbcO6bHRpcGxlcyBpbnN0YW5jaWFzIGVuIGRlc2Fycm9sbG9cbmNvbnN0IGdsb2JhbEZvclByaXNtYSA9IGdsb2JhbCBhcyB1bmtub3duIGFzIHtcbiAgcHJpc21hOiBQcmlzbWFDbGllbnQgfCB1bmRlZmluZWQ7XG59O1xuXG5jb25zdCBwcmlzbWEgPSBnbG9iYWxGb3JQcmlzbWEucHJpc21hID8/IFxuICBuZXcgUHJpc21hQ2xpZW50KHtcbiAgICBsb2c6IHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAnZGV2ZWxvcG1lbnQnIFxuICAgICAgPyBbJ3F1ZXJ5JywgJ2Vycm9yJywgJ3dhcm4nXSBcbiAgICAgIDogWydlcnJvciddLFxuICB9KTtcblxuaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicpIGdsb2JhbEZvclByaXNtYS5wcmlzbWEgPSBwcmlzbWE7XG5cbmV4cG9ydCBkZWZhdWx0IHByaXNtYTsiXSwibmFtZXMiOlsiUHJpc21hQ2xpZW50IiwiZ2xvYmFsRm9yUHJpc21hIiwiZ2xvYmFsIiwicHJpc21hIiwibG9nIiwicHJvY2VzcyJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/server/db/client.ts\n");

/***/ }),

/***/ "(rsc)/./src/server/services/auth/authService.ts":
/*!*************************************************!*\
  !*** ./src/server/services/auth/authService.ts ***!
  \*************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   AuthService: () => (/* binding */ AuthService),\n/* harmony export */   authService: () => (/* binding */ authService),\n/* harmony export */   refreshToken: () => (/* binding */ refreshToken)\n/* harmony export */ });\n/* harmony import */ var _server_db_client__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/server/db/client */ \"(rsc)/./src/server/db/client.ts\");\n/* harmony import */ var _cognitoService__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./cognitoService */ \"(rsc)/./src/server/services/auth/cognitoService.ts\");\n// src/server/services/auth/authService.ts\n\n\n// Servicio de autenticación que actúa como fachada para Cognito\nclass AuthService {\n    // Login\n    async login(credentials) {\n        try {\n            // Autenticar con Cognito\n            const cognitoResult = await _cognitoService__WEBPACK_IMPORTED_MODULE_1__.cognitoService.login(credentials);\n            // Buscar usuario en nuestra BD\n            let user = await _server_db_client__WEBPACK_IMPORTED_MODULE_0__[\"default\"].user.findFirst({\n                where: {\n                    email: credentials.email\n                },\n                include: {\n                    role: true\n                }\n            });\n            console.log('Usuario encontrado:', user);\n            console.log('Rol del usuario:', user?.role);\n            // Si no existe el usuario, lo creamos\n            if (!user) {\n                console.log(\"Usuario no encontrado en BD local, creando...\");\n                // Buscar primero un rol (preferiblemente admin)\n                let role = await _server_db_client__WEBPACK_IMPORTED_MODULE_0__[\"default\"].role.findFirst({\n                    where: {\n                        name: 'admin'\n                    }\n                });\n                // Si no existe ningún rol, necesitamos crear al menos uno\n                if (!role) {\n                    console.log(\"Creando rol 'admin' porque no existe\");\n                    role = await _server_db_client__WEBPACK_IMPORTED_MODULE_0__[\"default\"].role.create({\n                        data: {\n                            name: 'admin',\n                            permissions: [\n                                '*'\n                            ] // Todos los permisos como JSON\n                        }\n                    });\n                }\n                // Crear el usuario con el rol encontrado o creado\n                user = await _server_db_client__WEBPACK_IMPORTED_MODULE_0__[\"default\"].user.create({\n                    data: {\n                        id: cognitoResult.user.id,\n                        email: credentials.email,\n                        name: cognitoResult.user.name || credentials.email.split('@')[0],\n                        roleId: role.id\n                    },\n                    include: {\n                        role: true\n                    }\n                });\n                console.log(\"Usuario creado exitosamente:\", user.id);\n            }\n            // Devolvemos el resultado combinado\n            return {\n                ...cognitoResult,\n                user: {\n                    ...user,\n                    // Asegurarse de que usamos los datos de nuestra BD\n                    id: user.id,\n                    roleId: user.roleId\n                }\n            };\n        } catch (error) {\n            console.error('Error en login:', error);\n            throw error; // Propagar el error para que el cliente pueda manejarlo\n        }\n    }\n    // Cerrar sesión\n    async logout(accessToken) {\n        try {\n            await _cognitoService__WEBPACK_IMPORTED_MODULE_1__.cognitoService.logout(accessToken);\n            return true;\n        } catch (error) {\n            console.error('Error en logout:', error);\n            return false;\n        }\n    }\n    // Refrescar token\n    async refreshUserToken(refreshToken, emailParam) {\n        try {\n            // Usar el email almacenado en localStorage para el SECRET_HASH o el parámetro proporcionado\n            let emailToUse = emailParam || '';\n            if (typeof localStorage !== 'undefined' && !emailToUse) {\n                emailToUse = localStorage.getItem('userEmail') || '';\n            }\n            return await _cognitoService__WEBPACK_IMPORTED_MODULE_1__.cognitoService.refreshToken(refreshToken, emailToUse);\n        } catch (error) {\n            console.error('Error al refrescar token:', error);\n            return null;\n        }\n    }\n    // Obtener usuario por ID\n    async getUserById(userId) {\n        try {\n            const user = await _server_db_client__WEBPACK_IMPORTED_MODULE_0__[\"default\"].user.findUnique({\n                where: {\n                    id: userId\n                },\n                include: {\n                    role: true\n                }\n            });\n            if (!user) return null;\n            return user;\n        } catch (error) {\n            console.error('Error al obtener usuario:', error);\n            return null;\n        }\n    }\n    // Registrar en Cognito\n    async registerUser(userData) {\n        try {\n            // Verificación de rol para creación desde admin (código existente)\n            if (userData.isAdminCreation && !userData.roleId) {\n                return {\n                    success: false,\n                    message: 'Se requiere especificar un rol para la creación de usuarios desde administración'\n                };\n            }\n            // Registrar en Cognito\n            const cognitoResult = await _cognitoService__WEBPACK_IMPORTED_MODULE_1__.cognitoService.registerUser({\n                email: userData.email,\n                name: userData.name,\n                password: userData.password,\n                roleId: userData.roleId\n            });\n            if (!cognitoResult.success) {\n                return {\n                    success: false,\n                    message: cognitoResult.message || 'Error al registrar usuario en Cognito',\n                    userId: cognitoResult.userId\n                };\n            }\n            console.log(\"Usuario registrado en Cognito con éxito, ID:\", cognitoResult.userId);\n            // Si es creación desde admin y queremos confirmación automática (no es nuestro caso ahora)\n            if (userData.isAdminCreation && cognitoResult.userId && !userData.skipAutoConfirmation) {\n                try {\n                    console.log(\"Confirmando usuario automáticamente...\");\n                    await _cognitoService__WEBPACK_IMPORTED_MODULE_1__.cognitoService.confirmRegistration(userData.email, '', true);\n                } catch (confirmError) {\n                    console.error('Error en confirmación automática:', confirmError);\n                }\n                // Crear usuario en la base de datos local\n                try {\n                    // Asegurarnos de que existe el rol predeterminado si no se especifica uno\n                    if (!userData.roleId) {\n                        const defaultRole = await _server_db_client__WEBPACK_IMPORTED_MODULE_0__[\"default\"].role.findFirst({\n                            where: {\n                                name: 'vendedor'\n                            } // O el rol predeterminado que prefieras\n                        });\n                        if (!defaultRole) {\n                            return {\n                                success: false,\n                                message: 'No se encontró un rol predeterminado',\n                                userId: cognitoResult.userId\n                            };\n                        }\n                        userData.roleId = defaultRole.id;\n                    }\n                    // Crear el usuario en la base de datos\n                    const user = await _server_db_client__WEBPACK_IMPORTED_MODULE_0__[\"default\"].user.create({\n                        data: {\n                            id: cognitoResult.userId,\n                            email: userData.email,\n                            name: userData.name,\n                            roleId: userData.roleId,\n                            sucursalId: userData.sucursalId || null\n                        }\n                    });\n                    console.log(`Usuario ${user.id} creado en la base de datos local`);\n                } catch (dbError) {\n                    console.error('Error al crear usuario en la base de datos:', dbError);\n                    return {\n                        success: false,\n                        message: 'Error al crear usuario en la base de datos local',\n                        userId: cognitoResult.userId\n                    };\n                }\n            }\n            return {\n                success: true,\n                message: userData.isAdminCreation ? 'Usuario creado y confirmado correctamente' : 'Usuario registrado correctamente. Por favor, verifique su correo electrónico para completar el registro.',\n                userId: cognitoResult.userId\n            };\n        } catch (error) {\n            console.error('Error en registro:', error);\n            return {\n                success: false,\n                message: 'Error al registrar usuario'\n            };\n        }\n    }\n    // En authService.ts - Agregar función para confirmación administrativa\n    async adminConfirmUser(email) {\n        try {\n            console.log(\"Confirmando usuario administrativamente:\", email);\n            const result = await _cognitoService__WEBPACK_IMPORTED_MODULE_1__.cognitoService.confirmRegistration(email, '', true);\n            if (result.success) {\n                console.log(\"Usuario confirmado con éxito:\", email);\n                return {\n                    success: true,\n                    message: 'Usuario confirmado correctamente'\n                };\n            } else {\n                return {\n                    success: false,\n                    message: result.message\n                };\n            }\n        } catch (error) {\n            console.error('Error al confirmar usuario administrativamente:', error);\n            return {\n                success: false,\n                message: 'Error al confirmar usuario'\n            };\n        }\n    }\n    // En authService.ts - Implementar método para creación y sincronización de usuarios\n    async createOrSyncUser(userData) {\n        try {\n            // Verificar si el usuario existe en la BD local\n            const existingLocalUser = await _server_db_client__WEBPACK_IMPORTED_MODULE_0__[\"default\"].user.findUnique({\n                where: {\n                    email: userData.email\n                }\n            });\n            // Verificar si el usuario existe en Cognito\n            let existingCognitoUser = null;\n            try {\n                existingCognitoUser = await _cognitoService__WEBPACK_IMPORTED_MODULE_1__.cognitoService.getUserByUsername(userData.email);\n            } catch (cognitoError) {\n                // Ignorar error de usuario no encontrado\n                if (cognitoError instanceof Error && cognitoError.name !== 'UserNotFoundException') {\n                    throw cognitoError;\n                }\n            }\n            // Caso 1: Usuario existe en ambos sistemas\n            if (existingLocalUser && existingCognitoUser) {\n                return {\n                    success: false,\n                    message: 'El usuario ya existe en el sistema',\n                    user: existingLocalUser,\n                    isNewUser: false\n                };\n            }\n            // Caso 2: Usuario existe en Cognito pero no en BD local (desincronización)\n            if (!existingLocalUser && existingCognitoUser) {\n                console.log(`Usuario ${userData.email} existe en Cognito pero no en BD local. Sincronizando...`);\n                // Crear usuario en BD local con el ID de Cognito\n                const userId = existingCognitoUser.Username || existingCognitoUser.User?.Username;\n                const syncedUser = await _server_db_client__WEBPACK_IMPORTED_MODULE_0__[\"default\"].user.create({\n                    data: {\n                        id: userId,\n                        email: userData.email,\n                        name: userData.name,\n                        roleId: userData.roleId,\n                        sucursalId: userData.sucursalId\n                    }\n                });\n                return {\n                    success: true,\n                    message: 'Usuario sincronizado con el sistema de autenticación',\n                    user: syncedUser,\n                    isNewUser: false\n                };\n            }\n            // Caso 3: Usuario existe en BD local pero no en Cognito (muy raro, pero posible)\n            if (existingLocalUser && !existingCognitoUser) {\n                console.log(`Usuario ${userData.email} existe en BD local pero no en Cognito. Creando en Cognito...`);\n                // Registrar en Cognito\n                const cognitoResult = await _cognitoService__WEBPACK_IMPORTED_MODULE_1__.cognitoService.registerUser({\n                    email: userData.email,\n                    name: userData.name,\n                    password: userData.password,\n                    roleId: userData.roleId\n                });\n                if (!cognitoResult.success) {\n                    throw new Error(cognitoResult.message || 'Error al crear usuario en el sistema de autenticación');\n                }\n                return {\n                    success: true,\n                    message: 'Usuario sincronizado con el sistema de autenticación',\n                    user: existingLocalUser,\n                    isNewUser: false\n                };\n            }\n            // Caso 4: Usuario no existe en ningún sistema (caso normal de creación)\n            console.log(`Creando nuevo usuario ${userData.email} en ambos sistemas...`);\n            // Registrar en Cognito\n            const cognitoResult = await _cognitoService__WEBPACK_IMPORTED_MODULE_1__.cognitoService.registerUser({\n                email: userData.email,\n                name: userData.name,\n                password: userData.password,\n                roleId: userData.roleId\n            });\n            if (!cognitoResult.success) {\n                throw new Error(cognitoResult.message || 'Error al crear usuario en el sistema de autenticación');\n            }\n            // Crear en BD local\n            const newUser = await _server_db_client__WEBPACK_IMPORTED_MODULE_0__[\"default\"].user.create({\n                data: {\n                    id: cognitoResult.userId,\n                    email: userData.email,\n                    name: userData.name,\n                    roleId: userData.roleId,\n                    sucursalId: userData.sucursalId\n                }\n            });\n            return {\n                success: true,\n                message: 'Usuario creado correctamente. Por favor, verifique el correo para activar la cuenta.',\n                user: newUser,\n                isNewUser: true\n            };\n        } catch (error) {\n            console.error('Error en creación/sincronización de usuario:', error);\n            throw error;\n        }\n    }\n    // Confirmar registro\n    async confirmRegistration(email, code) {\n        try {\n            return await _cognitoService__WEBPACK_IMPORTED_MODULE_1__.cognitoService.confirmRegistration(email, code);\n        } catch (error) {\n            console.error('Error al confirmar registro:', error);\n            return {\n                success: false,\n                message: 'Error al confirmar el registro'\n            };\n        }\n    }\n    // Reenviar código de confirmación\n    async resendConfirmationCode(email) {\n        try {\n            return await _cognitoService__WEBPACK_IMPORTED_MODULE_1__.cognitoService.resendConfirmationCode(email);\n        } catch (error) {\n            console.error('Error al reenviar código:', error);\n            return {\n                success: false,\n                message: 'Error al reenviar el código de verificación'\n            };\n        }\n    }\n}\n// Singleton para uso en la aplicación\nconst authService = new AuthService();\n// Función para el cliente (frontend)\nasync function refreshToken() {\n    const refreshToken = localStorage.getItem('refreshToken');\n    if (!refreshToken) return false;\n    try {\n        const response = await fetch('/api/auth/refresh', {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json'\n            },\n            body: JSON.stringify({\n                refreshToken\n            })\n        });\n        if (!response.ok) return false;\n        const data = await response.json();\n        // Actualizar tokens\n        localStorage.setItem('accessToken', data.accessToken);\n        localStorage.setItem('idToken', data.idToken);\n        return true;\n    } catch (error) {\n        console.error('Error al refrescar token:', error);\n        return false;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmVyL3NlcnZpY2VzL2F1dGgvYXV0aFNlcnZpY2UudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQSwwQ0FBMEM7QUFFRjtBQUN3QztBQUVoRixnRUFBZ0U7QUFDekQsTUFBTUU7SUFDWCxRQUFRO0lBQ1IsTUFBTUMsTUFBTUMsV0FBNkIsRUFBOEI7UUFDckUsSUFBSTtZQUNGLHlCQUF5QjtZQUN6QixNQUFNQyxnQkFBZ0IsTUFBTUosMkRBQWNBLENBQUNFLEtBQUssQ0FBQ0M7WUFFakQsK0JBQStCO1lBQy9CLElBQUlFLE9BQU8sTUFBTU4seURBQU1BLENBQUNNLElBQUksQ0FBQ0MsU0FBUyxDQUFDO2dCQUNyQ0MsT0FBTztvQkFDTEMsT0FBT0wsWUFBWUssS0FBSztnQkFDMUI7Z0JBQ0FDLFNBQVM7b0JBQ1BDLE1BQU07Z0JBQ1I7WUFDRjtZQUVBQyxRQUFRQyxHQUFHLENBQUMsdUJBQXVCUDtZQUNuQ00sUUFBUUMsR0FBRyxDQUFDLG9CQUFvQlAsTUFBTUs7WUFFdEMsc0NBQXNDO1lBQ3RDLElBQUksQ0FBQ0wsTUFBTTtnQkFDVE0sUUFBUUMsR0FBRyxDQUFDO2dCQUVaLGdEQUFnRDtnQkFDaEQsSUFBSUYsT0FBTyxNQUFNWCx5REFBTUEsQ0FBQ1csSUFBSSxDQUFDSixTQUFTLENBQUM7b0JBQ3JDQyxPQUFPO3dCQUFFTSxNQUFNO29CQUFRO2dCQUN6QjtnQkFFQSwwREFBMEQ7Z0JBQzFELElBQUksQ0FBQ0gsTUFBTTtvQkFDVEMsUUFBUUMsR0FBRyxDQUFDO29CQUNaRixPQUFPLE1BQU1YLHlEQUFNQSxDQUFDVyxJQUFJLENBQUNJLE1BQU0sQ0FBQzt3QkFDOUJDLE1BQU07NEJBQ0pGLE1BQU07NEJBQ05HLGFBQWE7Z0NBQUM7NkJBQUksQ0FBQywrQkFBK0I7d0JBQ3BEO29CQUNGO2dCQUNGO2dCQUVBLGtEQUFrRDtnQkFDbERYLE9BQU8sTUFBTU4seURBQU1BLENBQUNNLElBQUksQ0FBQ1MsTUFBTSxDQUFDO29CQUM5QkMsTUFB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QyxvQkFBb0I7UUFDcEJ6QyxhQUFhMEMsT0FBTyxDQUFDLGVBQWV0RCxLQUFLTyxXQUFXO1FBQ3BESyxhQUFhMEMsT0FBTyxDQUFDLFdBQVd0RCxLQUFLdUQsT0FBTztRQUU1QyxPQUFPO0lBQ1QsRUFBRSxPQUFPbEQsT0FBTztRQUNkVCxRQUFRUyxLQUFLLENBQUMsNkJBQTZCQTtRQUMzQyxPQUFPO0lBQ1Q7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL2dhc3Rvbm1vcmEvRGVza3RvcC9Qcm95ZWN0b3MvVHVsdW0vc3JjL3NlcnZlci9zZXJ2aWNlcy9hdXRoL2F1dGhTZXJ2aWNlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIHNyYy9zZXJ2ZXIvc2VydmljZXMvYXV0aC9hdXRoU2VydmljZS50c1xuaW1wb3J0IHsgVXNlciB9IGZyb20gJ0BwcmlzbWEvY2xpZW50JztcbmltcG9ydCBwcmlzbWEgZnJvbSAnQC9zZXJ2ZXIvZGIvY2xpZW50JztcbmltcG9ydCB7IGNvZ25pdG9TZXJ2aWNlLCBMb2dpbkNyZWRlbnRpYWxzLCBBdXRoUmVzdWx0IH0gZnJvbSAnLi9jb2duaXRvU2VydmljZSc7XG5cbi8vIFNlcnZpY2lvIGRlIGF1dGVudGljYWNpw7NuIHF1ZSBhY3TDumEgY29tbyBmYWNoYWRhIHBhcmEgQ29nbml0b1xuZXhwb3J0IGNsYXNzIEF1dGhTZXJ2aWNlIHtcbiAgLy8gTG9naW5cbiAgYXN5bmMgbG9naW4oY3JlZGVudGlhbHM6IExvZ2luQ3JlZGVudGlhbHMpOiBQcm9taXNlPEF1dGhSZXN1bHQgfCBudWxsPiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIEF1dGVudGljYXIgY29uIENvZ25pdG9cbiAgICAgIGNvbnN0IGNvZ25pdG9SZXN1bHQgPSBhd2FpdCBjb2duaXRvU2VydmljZS5sb2dpbihjcmVkZW50aWFscyk7XG4gICAgICBcbiAgICAgIC8vIEJ1c2NhciB1c3VhcmlvIGVuIG51ZXN0cmEgQkRcbiAgICAgIGxldCB1c2VyID0gYXdhaXQgcHJpc21hLnVzZXIuZmluZEZpcnN0KHtcbiAgICAgICAgd2hlcmU6IHsgXG4gICAgICAgICAgZW1haWw6IGNyZWRlbnRpYWxzLmVtYWlsIFxuICAgICAgICB9LFxuICAgICAgICBpbmNsdWRlOiB7IFxuICAgICAgICAgIHJvbGU6IHRydWUgXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgXG4gICAgICBjb25zb2xlLmxvZygnVXN1YXJpbyBlbmNvbnRyYWRvOicsIHVzZXIpO1xuICAgICAgY29uc29sZS5sb2coJ1JvbCBkZWwgdXN1YXJpbzonLCB1c2VyPy5yb2xlKTtcbiAgICBcbiAgICAgIC8vIFNpIG5vIGV4aXN0ZSBlbCB1c3VhcmlvLCBsbyBjcmVhbW9zXG4gICAgICBpZiAoIXVzZXIpIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJVc3VhcmlvIG5vIGVuY29udHJhZG8gZW4gQkQgbG9jYWwsIGNyZWFuZG8uLi5cIik7XG4gICAgICAgIFxuICAgICAgICAvLyBCdXNjYXIgcHJpbWVybyB1biByb2wgKHByZWZlcmlibGVtZW50ZSBhZG1pbilcbiAgICAgICAgbGV0IHJvbGUgPSBhd2FpdCBwcmlzbWEucm9sZS5maW5kRmlyc3Qoe1xuICAgICAgICAgIHdoZXJlOiB7IG5hbWU6ICdhZG1pbicgfVxuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIC8vIFNpIG5vIGV4aXN0ZSBuaW5nw7puIHJvbCwgbmVjZXNpdGFtb3MgY3JlYXIgYWwgbWVub3MgdW5vXG4gICAgICAgIGlmICghcm9sZSkge1xuICAgICAgICAgIGNvbnNvbGUubG9nKFwiQ3JlYW5kbyByb2wgJ2FkbWluJyBwb3JxdWUgbm8gZXhpc3RlXCIpO1xuICAgICAgICAgIHJvbGUgPSBhd2FpdCBwcmlzbWEucm9sZS5jcmVhdGUoe1xuICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICBuYW1lOiAnYWRtaW4nLFxuICAgICAgICAgICAgICBwZXJtaXNzaW9uczogWycqJ10gLy8gVG9kb3MgbG9zIHBlcm1pc29zIGNvbW8gSlNPTlxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICAvLyBDcmVhciBlbCB1c3VhcmlvIGNvbiBlbCByb2wgZW5jb250cmFkbyBvIGNyZWFkb1xuICAgICAgICB1c2VyID0gYXdhaXQgcHJpc21hLnVzZXIuY3JlYXRlKHtcbiAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICBpZDogY29nbml0b1Jlc3VsdC51c2VyLmlkLCAvLyBVc2FyIGVsIHN1YiBkZSBDb2duaXRvIGNvbW8gSURcbiAgICAgICAgICAgIGVtYWlsOiBjcmVkZW50aWFscy5lbWFpbCxcbiAgICAgICAgICAgIG5hbWU6IGNvZ25pdG9SZXN1bHQudXNlci5uYW1lIHx8IGNyZWRlbnRpYWxzLmVtYWlsLnNwbGl0KCdAJylbMF0sXG4gICAgICAgICAgICByb2xlSWQ6IHJvbGUuaWQsXG4gICAgICAgICAgICAvLyBObyBpbmNsdWltb3Mgc3VjdXJzYWxJZCB5YSBxdWUgZXMgb3BjaW9uYWwgZW4gdHUgZXNxdWVtYVxuICAgICAgICAgIH0sXG4gICAgICAgICAgaW5jbHVkZTogeyBcbiAgICAgICAgICAgIHJvbGU6IHRydWUgXG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIGNvbnNvbGUubG9nKFwiVXN1YXJpbyBjcmVhZG8gZXhpdG9zYW1lbnRlOlwiLCB1c2VyLmlkKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gRGV2b2x2ZW1vcyBlbCByZXN1bHRhZG8gY29tYmluYWRvXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5jb2duaXRvUmVzdWx0LFxuICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgLi4udXNlcixcbiAgICAgICAgICAvLyBBc2VndXJhcnNlIGRlIHF1ZSB1c2Ftb3MgbG9zIGRhdG9zIGRlIG51ZXN0cmEgQkRcbiAgICAgICAgICBpZDogdXNlci5pZCxcbiAgICAgICAgICByb2xlSWQ6IHVzZXIucm9sZUlkXG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGVuIGxvZ2luOicsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yOyAvLyBQcm9wYWdhciBlbCBlcnJvciBwYXJhIHF1ZSBlbCBjbGllbnRlIHB1ZWRhIG1hbmVqYXJsb1xuICAgIH1cbiAgfVxuICBcbiAgLy8gQ2VycmFyIHNlc2nDs25cbiAgYXN5bmMgbG9nb3V0KGFjY2Vzc1Rva2VuOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgY29nbml0b1NlcnZpY2UubG9nb3V0KGFjY2Vzc1Rva2VuKTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBlbiBsb2dvdXQ6JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuICBcbiAgLy8gUmVmcmVzY2FyIHRva2VuXG4gIGFzeW5jIHJlZnJlc2hVc2VyVG9rZW4ocmVmcmVzaFRva2VuOiBzdHJpbmcsIGVtYWlsUGFyYW0/OiBzdHJpbmcpOiBQcm9taXNlPE9taXQ8QXV0aFJlc3VsdCwgJ3VzZXInPiB8IG51bGw+IHtcbiAgICB0cnkge1xuICAgICAgLy8gVXNhciBlbCBlbWFpbCBhbG1hY2VuYWRvIGVuIGxvY2FsU3RvcmFnZSBwYXJhIGVsIFNFQ1JFVF9IQVNIIG8gZWwgcGFyw6FtZXRybyBwcm9wb3JjaW9uYWRvXG4gICAgICBsZXQgZW1haWxUb1VzZSA9IGVtYWlsUGFyYW0gfHwgJyc7XG4gICAgICBpZiAodHlwZW9mIGxvY2FsU3RvcmFnZSAhPT0gJ3VuZGVmaW5lZCcgJiYgIWVtYWlsVG9Vc2UpIHtcbiAgICAgICAgZW1haWxUb1VzZSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCd1c2VyRW1haWwnKSB8fCAnJztcbiAgICAgIH1cbiAgICAgIFxuICAgICAgcmV0dXJuIGF3YWl0IGNvZ25pdG9TZXJ2aWNlLnJlZnJlc2hUb2tlbihyZWZyZXNoVG9rZW4sIGVtYWlsVG9Vc2UpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBhbCByZWZyZXNjYXIgdG9rZW46JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICB9XG4gIFxuICAvLyBPYnRlbmVyIHVzdWFyaW8gcG9yIElEXG4gIGFzeW5jIGdldFVzZXJCeUlkKHVzZXJJZDogc3RyaW5nKTogUHJvbWlzZTxPbWl0PFVzZXIsICdwYXNzd29yZCc+IHwgbnVsbD4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB1c2VyID0gYXdhaXQgcHJpc21hLnVzZXIuZmluZFVuaXF1ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkOiB1c2VySWQgfSxcbiAgICAgICAgaW5jbHVkZTogeyByb2xlOiB0cnVlIH1cbiAgICAgIH0pO1xuICAgICAgXG4gICAgICBpZiAoIXVzZXIpIHJldHVybiBudWxsO1xuICAgICAgXG4gICAgICByZXR1cm4gdXNlcjtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgYWwgb2J0ZW5lciB1c3VhcmlvOicsIGVycm9yKTtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgfVxuXG4gICAgICAvLyBSZWdpc3RyYXIgZW4gQ29nbml0b1xuICAgICAgYXN5bmMgcmVnaXN0ZXJVc2VyKHVzZXJEYXRhOiB7XG4gICAgICAgIGVtYWlsOiBzdHJpbmc7XG4gICAgICAgIG5hbWU6IHN0cmluZztcbiAgICAgICAgcGFzc3dvcmQ6IHN0cmluZztcbiAgICAgICAgcm9sZUlkPzogc3RyaW5nO1xuICAgICAgICBzdWN1cnNhbElkPzogc3RyaW5nIHwgbnVsbDtcbiAgICAgICAgaXNBZG1pbkNyZWF0aW9uPzogYm9vbGVhbjtcbiAgICAgICAgc2tpcEF1dG9Db25maXJtYXRpb24/OiBib29sZWFuOyAvLyBOdWV2byBwYXLDoW1ldHJvIHBhcmEgY29udHJvbGFyIHNpIHF1ZXJlbW9zIHNhbHRhciBsYSBjb25maXJtYWNpw7NuIGF1dG9tw6F0aWNhXG4gICAgICB9KTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG1lc3NhZ2U6IHN0cmluZzsgdXNlcklkPzogc3RyaW5nIH0+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAvLyBWZXJpZmljYWNpw7NuIGRlIHJvbCBwYXJhIGNyZWFjacOzbiBkZXNkZSBhZG1pbiAoY8OzZGlnbyBleGlzdGVudGUpXG4gICAgICAgICAgaWYgKHVzZXJEYXRhLmlzQWRtaW5DcmVhdGlvbiAmJiAhdXNlckRhdGEucm9sZUlkKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICAgICAgbWVzc2FnZTogJ1NlIHJlcXVpZXJlIGVzcGVjaWZpY2FyIHVuIHJvbCBwYXJhIGxhIGNyZWFjacOzbiBkZSB1c3VhcmlvcyBkZXNkZSBhZG1pbmlzdHJhY2nDs24nXG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH1cbiAgICAgIFxuICAgICAgICAgIC8vIFJlZ2lzdHJhciBlbiBDb2duaXRvXG4gICAgICAgICAgY29uc3QgY29nbml0b1Jlc3VsdCA9IGF3YWl0IGNvZ25pdG9TZXJ2aWNlLnJlZ2lzdGVyVXNlcih7XG4gICAgICAgICAgICBlbWFpbDogdXNlckRhdGEuZW1haWwsXG4gICAgICAgICAgICBuYW1lOiB1c2VyRGF0YS5uYW1lLFxuICAgICAgICAgICAgcGFzc3dvcmQ6IHVzZXJEYXRhLnBhc3N3b3JkLFxuICAgICAgICAgICAgcm9sZUlkOiB1c2VyRGF0YS5yb2xlSWRcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBcbiAgICAgICAgICBpZiAoIWNvZ25pdG9SZXN1bHQuc3VjY2Vzcykge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgICAgIG1lc3NhZ2U6IGNvZ25pdG9SZXN1bHQubWVzc2FnZSB8fCAnRXJyb3IgYWwgcmVnaXN0cmFyIHVzdWFyaW8gZW4gQ29nbml0bycsXG4gICAgICAgICAgICAgIHVzZXJJZDogY29nbml0b1Jlc3VsdC51c2VySWRcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfVxuICAgICAgICAgIFxuICAgICAgICAgIGNvbnNvbGUubG9nKFwiVXN1YXJpbyByZWdpc3RyYWRvIGVuIENvZ25pdG8gY29uIMOpeGl0bywgSUQ6XCIsIGNvZ25pdG9SZXN1bHQudXNlcklkKTtcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBTaSBlcyBjcmVhY2nDs24gZGVzZGUgYWRtaW4geSBxdWVyZW1vcyBjb25maXJtYWNpw7NuIGF1dG9tw6F0aWNhIChubyBlcyBudWVzdHJvIGNhc28gYWhvcmEpXG4gICAgICAgICAgaWYgKHVzZXJEYXRhLmlzQWRtaW5DcmVhdGlvbiAmJiBjb2duaXRvUmVzdWx0LnVzZXJJZCAmJiAhdXNlckRhdGEuc2tpcEF1dG9Db25maXJtYXRpb24pIHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiQ29uZmlybWFuZG8gdXN1YXJpbyBhdXRvbcOhdGljYW1lbnRlLi4uXCIpO1xuICAgICAgICAgICAgICBhd2FpdCBjb2duaXRvU2VydmljZS5jb25maXJtUmVnaXN0cmF0aW9uKHVzZXJEYXRhLmVtYWlsLCAnJywgdHJ1ZSk7XG4gICAgICAgICAgICB9IGNhdGNoIChjb25maXJtRXJyb3IpIHtcbiAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZW4gY29uZmlybWFjacOzbiBhdXRvbcOhdGljYTonLCBjb25maXJtRXJyb3IpO1xuICAgICAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLy8gQ3JlYXIgdXN1YXJpbyBlbiBsYSBiYXNlIGRlIGRhdG9zIGxvY2FsXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgLy8gQXNlZ3VyYXJub3MgZGUgcXVlIGV4aXN0ZSBlbCByb2wgcHJlZGV0ZXJtaW5hZG8gc2kgbm8gc2UgZXNwZWNpZmljYSB1bm9cbiAgICAgICAgICBpZiAoIXVzZXJEYXRhLnJvbGVJZCkge1xuICAgICAgICAgICAgY29uc3QgZGVmYXVsdFJvbGUgPSBhd2FpdCBwcmlzbWEucm9sZS5maW5kRmlyc3Qoe1xuICAgICAgICAgICAgICB3aGVyZTogeyBuYW1lOiAndmVuZGVkb3InIH0gLy8gTyBlbCByb2wgcHJlZGV0ZXJtaW5hZG8gcXVlIHByZWZpZXJhc1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmICghZGVmYXVsdFJvbGUpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiAnTm8gc2UgZW5jb250csOzIHVuIHJvbCBwcmVkZXRlcm1pbmFkbycsXG4gICAgICAgICAgICAgICAgdXNlcklkOiBjb2duaXRvUmVzdWx0LnVzZXJJZFxuICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICB1c2VyRGF0YS5yb2xlSWQgPSBkZWZhdWx0Um9sZS5pZDtcbiAgICAgICAgICB9XG4gICAgICAgICAgXG4gICAgICAgICAgLy8gQ3JlYXIgZWwgdXN1YXJpbyBlbiBsYSBiYXNlIGRlIGRhdG9zXG4gICAgICAgICAgY29uc3QgdXNlciA9IGF3YWl0IHByaXNtYS51c2VyLmNyZWF0ZSh7XG4gICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgIGlkOiBjb2duaXRvUmVzdWx0LnVzZXJJZCxcbiAgICAgICAgICAgICAgZW1haWw6IHVzZXJEYXRhLmVtYWlsLFxuICAgICAgICAgICAgICBuYW1lOiB1c2VyRGF0YS5uYW1lLFxuICAgICAgICAgICAgICByb2xlSWQ6IHVzZXJEYXRhLnJvbGVJZCxcbiAgICAgICAgICAgICAgc3VjdXJzYWxJZDogdXNlckRhdGEuc3VjdXJzYWxJZCB8fCBudWxsXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgXG4gICAgICAgICAgY29uc29sZS5sb2coYFVzdWFyaW8gJHt1c2VyLmlkfSBjcmVhZG8gZW4gbGEgYmFzZSBkZSBkYXRvcyBsb2NhbGApO1xuICAgICAgICB9IGNhdGNoIChkYkVycm9yKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgYWwgY3JlYXIgdXN1YXJpbyBlbiBsYSBiYXNlIGRlIGRhdG9zOicsIGRiRXJyb3IpO1xuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdFcnJvciBhbCBjcmVhciB1c3VhcmlvIGVuIGxhIGJhc2UgZGUgZGF0b3MgbG9jYWwnLFxuICAgICAgICAgICAgdXNlcklkOiBjb2duaXRvUmVzdWx0LnVzZXJJZFxuICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIFxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgbWVzc2FnZTogdXNlckRhdGEuaXNBZG1pbkNyZWF0aW9uIFxuICAgICAgICAgID8gJ1VzdWFyaW8gY3JlYWRvIHkgY29uZmlybWFkbyBjb3JyZWN0YW1lbnRlJ1xuICAgICAgICAgIDogJ1VzdWFyaW8gcmVnaXN0cmFkbyBjb3JyZWN0YW1lbnRlLiBQb3IgZmF2b3IsIHZlcmlmaXF1ZSBzdSBjb3JyZW8gZWxlY3Ryw7NuaWNvIHBhcmEgY29tcGxldGFyIGVsIHJlZ2lzdHJvLicsXG4gICAgICAgIHVzZXJJZDogY29nbml0b1Jlc3VsdC51c2VySWRcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGVuIHJlZ2lzdHJvOicsIGVycm9yKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnRXJyb3IgYWwgcmVnaXN0cmFyIHVzdWFyaW8nXG4gICAgICB9O1xuICAgIH1cbiAgfVxuXG4gIC8vIEVuIGF1dGhTZXJ2aWNlLnRzIC0gQWdyZWdhciBmdW5jacOzbiBwYXJhIGNvbmZpcm1hY2nDs24gYWRtaW5pc3RyYXRpdmFcblxuYXN5bmMgYWRtaW5Db25maXJtVXNlcihlbWFpbDogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG1lc3NhZ2U6IHN0cmluZyB9PiB7XG4gIHRyeSB7XG4gICAgY29uc29sZS5sb2coXCJDb25maXJtYW5kbyB1c3VhcmlvIGFkbWluaXN0cmF0aXZhbWVudGU6XCIsIGVtYWlsKTtcbiAgICBcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb2duaXRvU2VydmljZS5jb25maXJtUmVnaXN0cmF0aW9uKGVtYWlsLCAnJywgdHJ1ZSk7XG4gICAgXG4gICAgaWYgKHJlc3VsdC5zdWNjZXNzKSB7XG4gICAgICBjb25zb2xlLmxvZyhcIlVzdWFyaW8gY29uZmlybWFkbyBjb24gw6l4aXRvOlwiLCBlbWFpbCk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBtZXNzYWdlOiAnVXN1YXJpbyBjb25maXJtYWRvIGNvcnJlY3RhbWVudGUnXG4gICAgICB9O1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogcmVzdWx0Lm1lc3NhZ2VcbiAgICAgIH07XG4gICAgfVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGFsIGNvbmZpcm1hciB1c3VhcmlvIGFkbWluaXN0cmF0aXZhbWVudGU6JywgZXJyb3IpO1xuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIG1lc3NhZ2U6ICdFcnJvciBhbCBjb25maXJtYXIgdXN1YXJpbydcbiAgICB9O1xuICB9XG59XG5cbi8vIEVuIGF1dGhTZXJ2aWNlLnRzIC0gSW1wbGVtZW50YXIgbcOpdG9kbyBwYXJhIGNyZWFjacOzbiB5IHNpbmNyb25pemFjacOzbiBkZSB1c3Vhcmlvc1xuXG5hc3luYyBjcmVhdGVPclN5bmNVc2VyKHVzZXJEYXRhOiB7XG4gIGVtYWlsOiBzdHJpbmc7XG4gIG5hbWU6IHN0cmluZztcbiAgcGFzc3dvcmQ6IHN0cmluZztcbiAgcm9sZUlkOiBzdHJpbmc7XG4gIHN1Y3Vyc2FsSWQ/OiBzdHJpbmcgfCBudWxsO1xufSk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuOyBtZXNzYWdlOiBzdHJpbmc7IHVzZXI/OiBVc2VyOyBpc05ld1VzZXI/OiBib29sZWFuIH0+IHtcbiAgdHJ5IHtcbiAgICAvLyBWZXJpZmljYXIgc2kgZWwgdXN1YXJpbyBleGlzdGUgZW4gbGEgQkQgbG9jYWxcbiAgICBjb25zdCBleGlzdGluZ0xvY2FsVXNlciA9IGF3YWl0IHByaXNtYS51c2VyLmZpbmRVbmlxdWUoe1xuICAgICAgd2hlcmU6IHsgZW1haWw6IHVzZXJEYXRhLmVtYWlsIH1cbiAgICB9KTtcbiAgICBcbiAgICAvLyBWZXJpZmljYXIgc2kgZWwgdXN1YXJpbyBleGlzdGUgZW4gQ29nbml0b1xuICAgIGxldCBleGlzdGluZ0NvZ25pdG9Vc2VyID0gbnVsbDtcbiAgICB0cnkge1xuICAgICAgZXhpc3RpbmdDb2duaXRvVXNlciA9IGF3YWl0IGNvZ25pdG9TZXJ2aWNlLmdldFVzZXJCeVVzZXJuYW1lKHVzZXJEYXRhLmVtYWlsKTtcbiAgICB9IGNhdGNoIChjb2duaXRvRXJyb3I6IHVua25vd24pIHtcbiAgICAgIC8vIElnbm9yYXIgZXJyb3IgZGUgdXN1YXJpbyBubyBlbmNvbnRyYWRvXG4gICAgICBpZiAoY29nbml0b0Vycm9yIGluc3RhbmNlb2YgRXJyb3IgJiYgY29nbml0b0Vycm9yLm5hbWUgIT09ICdVc2VyTm90Rm91bmRFeGNlcHRpb24nKSB7XG4gICAgICAgIHRocm93IGNvZ25pdG9FcnJvcjtcbiAgICAgIH1cbiAgICB9XG4gICAgLy8gQ2FzbyAxOiBVc3VhcmlvIGV4aXN0ZSBlbiBhbWJvcyBzaXN0ZW1hc1xuICAgIGlmIChleGlzdGluZ0xvY2FsVXNlciAmJiBleGlzdGluZ0NvZ25pdG9Vc2VyKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogJ0VsIHVzdWFyaW8geWEgZXhpc3RlIGVuIGVsIHNpc3RlbWEnLFxuICAgICAgICB1c2VyOiBleGlzdGluZ0xvY2FsVXNlcixcbiAgICAgICAgaXNOZXdVc2VyOiBmYWxzZVxuICAgICAgfTtcbiAgICB9XG4gICAgXG4gICAgLy8gQ2FzbyAyOiBVc3VhcmlvIGV4aXN0ZSBlbiBDb2duaXRvIHBlcm8gbm8gZW4gQkQgbG9jYWwgKGRlc2luY3Jvbml6YWNpw7NuKVxuICAgIGlmICghZXhpc3RpbmdMb2NhbFVzZXIgJiYgZXhpc3RpbmdDb2duaXRvVXNlcikge1xuICAgICAgY29uc29sZS5sb2coYFVzdWFyaW8gJHt1c2VyRGF0YS5lbWFpbH0gZXhpc3RlIGVuIENvZ25pdG8gcGVybyBubyBlbiBCRCBsb2NhbC4gU2luY3Jvbml6YW5kby4uLmApO1xuICAgICAgXG4gICAgICAvLyBDcmVhciB1c3VhcmlvIGVuIEJEIGxvY2FsIGNvbiBlbCBJRCBkZSBDb2duaXRvXG4gICAgICBjb25zdCB1c2VySWQgPSBleGlzdGluZ0NvZ25pdG9Vc2VyLlVzZXJuYW1lIHx8IGV4aXN0aW5nQ29nbml0b1VzZXIuVXNlcj8uVXNlcm5hbWU7XG4gICAgICBcbiAgICAgIGNvbnN0IHN5bmNlZFVzZXIgPSBhd2FpdCBwcmlzbWEudXNlci5jcmVhdGUoe1xuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgaWQ6IHVzZXJJZCxcbiAgICAgICAgICBlbWFpbDogdXNlckRhdGEuZW1haWwsXG4gICAgICAgICAgbmFtZTogdXNlckRhdGEubmFtZSxcbiAgICAgICAgICByb2xlSWQ6IHVzZXJEYXRhLnJvbGVJZCxcbiAgICAgICAgICBzdWN1cnNhbElkOiB1c2VyRGF0YS5zdWN1cnNhbElkXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgXG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBtZXNzYWdlOiAnVXN1YXJpbyBzaW5jcm9uaXphZG8gY29uIGVsIHNpc3RlbWEgZGUgYXV0ZW50aWNhY2nDs24nLFxuICAgICAgICB1c2VyOiBzeW5jZWRVc2VyLFxuICAgICAgICBpc05ld1VzZXI6IGZhbHNlXG4gICAgICB9O1xuICAgIH1cbiAgICBcbiAgICAvLyBDYXNvIDM6IFVzdWFyaW8gZXhpc3RlIGVuIEJEIGxvY2FsIHBlcm8gbm8gZW4gQ29nbml0byAobXV5IHJhcm8sIHBlcm8gcG9zaWJsZSlcbiAgICBpZiAoZXhpc3RpbmdMb2NhbFVzZXIgJiYgIWV4aXN0aW5nQ29nbml0b1VzZXIpIHtcbiAgICAgIGNvbnNvbGUubG9nKGBVc3VhcmlvICR7dXNlckRhdGEuZW1haWx9IGV4aXN0ZSBlbiBCRCBsb2NhbCBwZXJvIG5vIGVuIENvZ25pdG8uIENyZWFuZG8gZW4gQ29nbml0by4uLmApO1xuICAgICAgXG4gICAgICAvLyBSZWdpc3RyYXIgZW4gQ29nbml0b1xuICAgICAgY29uc3QgY29nbml0b1Jlc3VsdCA9IGF3YWl0IGNvZ25pdG9TZXJ2aWNlLnJlZ2lzdGVyVXNlcih7XG4gICAgICAgIGVtYWlsOiB1c2VyRGF0YS5lbWFpbCxcbiAgICAgICAgbmFtZTogdXNlckRhdGEubmFtZSxcbiAgICAgICAgcGFzc3dvcmQ6IHVzZXJEYXRhLnBhc3N3b3JkLFxuICAgICAgICByb2xlSWQ6IHVzZXJEYXRhLnJvbGVJZFxuICAgICAgfSk7XG4gICAgICBcbiAgICAgIGlmICghY29nbml0b1Jlc3VsdC5zdWNjZXNzKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihjb2duaXRvUmVzdWx0Lm1lc3NhZ2UgfHwgJ0Vycm9yIGFsIGNyZWFyIHVzdWFyaW8gZW4gZWwgc2lzdGVtYSBkZSBhdXRlbnRpY2FjacOzbicpO1xuICAgICAgfVxuICAgICAgXG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBtZXNzYWdlOiAnVXN1YXJpbyBzaW5jcm9uaXphZG8gY29uIGVsIHNpc3RlbWEgZGUgYXV0ZW50aWNhY2nDs24nLFxuICAgICAgICB1c2VyOiBleGlzdGluZ0xvY2FsVXNlcixcbiAgICAgICAgaXNOZXdVc2VyOiBmYWxzZVxuICAgICAgfTtcbiAgICB9XG4gICAgXG4gICAgLy8gQ2FzbyA0OiBVc3VhcmlvIG5vIGV4aXN0ZSBlbiBuaW5nw7puIHNpc3RlbWEgKGNhc28gbm9ybWFsIGRlIGNyZWFjacOzbilcbiAgICBjb25zb2xlLmxvZyhgQ3JlYW5kbyBudWV2byB1c3VhcmlvICR7dXNlckRhdGEuZW1haWx9IGVuIGFtYm9zIHNpc3RlbWFzLi4uYCk7XG4gICAgXG4gICAgLy8gUmVnaXN0cmFyIGVuIENvZ25pdG9cbiAgICBjb25zdCBjb2duaXRvUmVzdWx0ID0gYXdhaXQgY29nbml0b1NlcnZpY2UucmVnaXN0ZXJVc2VyKHtcbiAgICAgIGVtYWlsOiB1c2VyRGF0YS5lbWFpbCxcbiAgICAgIG5hbWU6IHVzZXJEYXRhLm5hbWUsXG4gICAgICBwYXNzd29yZDogdXNlckRhdGEucGFzc3dvcmQsXG4gICAgICByb2xlSWQ6IHVzZXJEYXRhLnJvbGVJZFxuICAgIH0pO1xuICAgIFxuICAgIGlmICghY29nbml0b1Jlc3VsdC5zdWNjZXNzKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoY29nbml0b1Jlc3VsdC5tZXNzYWdlIHx8ICdFcnJvciBhbCBjcmVhciB1c3VhcmlvIGVuIGVsIHNpc3RlbWEgZGUgYXV0ZW50aWNhY2nDs24nKTtcbiAgICB9XG4gICAgXG4gICAgLy8gQ3JlYXIgZW4gQkQgbG9jYWxcbiAgICBjb25zdCBuZXdVc2VyID0gYXdhaXQgcHJpc21hLnVzZXIuY3JlYXRlKHtcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgaWQ6IGNvZ25pdG9SZXN1bHQudXNlcklkLFxuICAgICAgICBlbWFpbDogdXNlckRhdGEuZW1haWwsXG4gICAgICAgIG5hbWU6IHVzZXJEYXRhLm5hbWUsXG4gICAgICAgIHJvbGVJZDogdXNlckRhdGEucm9sZUlkLFxuICAgICAgICBzdWN1cnNhbElkOiB1c2VyRGF0YS5zdWN1cnNhbElkXG4gICAgICB9XG4gICAgfSk7XG4gICAgXG4gICAgcmV0dXJuIHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBtZXNzYWdlOiAnVXN1YXJpbyBjcmVhZG8gY29ycmVjdGFtZW50ZS4gUG9yIGZhdm9yLCB2ZXJpZmlxdWUgZWwgY29ycmVvIHBhcmEgYWN0aXZhciBsYSBjdWVudGEuJyxcbiAgICAgIHVzZXI6IG5ld1VzZXIsXG4gICAgICBpc05ld1VzZXI6IHRydWVcbiAgICB9O1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGVuIGNyZWFjacOzbi9zaW5jcm9uaXphY2nDs24gZGUgdXN1YXJpbzonLCBlcnJvcik7XG4gICAgdGhyb3cgZXJyb3I7XG4gIH1cbn1cblxuICAvLyBDb25maXJtYXIgcmVnaXN0cm9cbiAgYXN5bmMgY29uZmlybVJlZ2lzdHJhdGlvbihlbWFpbDogc3RyaW5nLCBjb2RlOiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbWVzc2FnZTogc3RyaW5nIH0+IHtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIGF3YWl0IGNvZ25pdG9TZXJ2aWNlLmNvbmZpcm1SZWdpc3RyYXRpb24oZW1haWwsIGNvZGUpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBhbCBjb25maXJtYXIgcmVnaXN0cm86JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdFcnJvciBhbCBjb25maXJtYXIgZWwgcmVnaXN0cm8nXG4gICAgICB9O1xuICAgIH1cbiAgfVxuXG4gIC8vIFJlZW52aWFyIGPDs2RpZ28gZGUgY29uZmlybWFjacOzblxuICBhc3luYyByZXNlbmRDb25maXJtYXRpb25Db2RlKGVtYWlsOiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbWVzc2FnZTogc3RyaW5nIH0+IHtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIGF3YWl0IGNvZ25pdG9TZXJ2aWNlLnJlc2VuZENvbmZpcm1hdGlvbkNvZGUoZW1haWwpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBhbCByZWVudmlhciBjw7NkaWdvOicsIGVycm9yKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnRXJyb3IgYWwgcmVlbnZpYXIgZWwgY8OzZGlnbyBkZSB2ZXJpZmljYWNpw7NuJ1xuICAgICAgfTtcbiAgICB9XG4gIH1cbn1cblxuLy8gU2luZ2xldG9uIHBhcmEgdXNvIGVuIGxhIGFwbGljYWNpw7NuXG5leHBvcnQgY29uc3QgYXV0aFNlcnZpY2UgPSBuZXcgQXV0aFNlcnZpY2UoKTtcblxuLy8gRnVuY2nDs24gcGFyYSBlbCBjbGllbnRlIChmcm9udGVuZClcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiByZWZyZXNoVG9rZW4oKTogUHJvbWlzZTxib29sZWFuPiB7XG4gIGNvbnN0IHJlZnJlc2hUb2tlbiA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdyZWZyZXNoVG9rZW4nKTtcbiAgaWYgKCFyZWZyZXNoVG9rZW4pIHJldHVybiBmYWxzZTtcbiAgXG4gIHRyeSB7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCgnL2FwaS9hdXRoL3JlZnJlc2gnLCB7XG4gICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgIGhlYWRlcnM6IHsgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyB9LFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyByZWZyZXNoVG9rZW4gfSlcbiAgICB9KTtcbiAgICBcbiAgICBpZiAoIXJlc3BvbnNlLm9rKSByZXR1cm4gZmFsc2U7XG4gICAgXG4gICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICBcbiAgICAvLyBBY3R1YWxpemFyIHRva2Vuc1xuICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdhY2Nlc3NUb2tlbicsIGRhdGEuYWNjZXNzVG9rZW4pO1xuICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdpZFRva2VuJywgZGF0YS5pZFRva2VuKTtcbiAgICBcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBhbCByZWZyZXNjYXIgdG9rZW46JywgZXJyb3IpO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxufSJdLCJuYW1lcyI6WyJwcmlzbWEiLCJjb2duaXRvU2VydmljZSIsIkF1dGhTZXJ2aWNlIiwibG9naW4iLCJjcmVkZW50aWFscyIsImNvZ25pdG9SZXN1bHQiLCJ1c2VyIiwiZmluZEZpcnN0Iiwid2hlcmUiLCJlbWFpbCIsImluY2x1ZGUiLCJyb2xlIiwiY29uc29sZSIsImxvZyIsIm5hbWUiLCJjcmVhdGUiLCJkYXRhIiwicGVybWlzc2lvbnMiLCJpZCIsInNwbGl0Iiwicm9sZUlkIiwiZXJyb3IiLCJsb2dvdXQiLCJhY2Nlc3NUb2tlbiIsInJlZnJlc2hVc2VyVG9rZW4iLCJyZWZyZXNoVG9rZW4iLCJlbWFpbFBhcmFtIiwiZW1haWxUb1VzZSIsImxvY2FsU3RvcmFnZSIsImdldEl0ZW0iLCJnZXRVc2VyQnlJZCIsInVzZXJJZCIsImZpbmRVbmlxdWUiLCJyZWdpc3RlclVzZXIiLCJ1c2VyRGF0YSIsImlzQWRtaW5DcmVhdGlvbiIsInN1Y2Nlc3MiLCJtZXNzYWdlIiwicGFzc3dvcmQiLCJza2lwQXV0b0NvbmZpcm1hdGlvbiIsImNvbmZpcm1SZWdpc3RyYXRpb24iLCJjb25maXJtRXJyb3IiLCJkZWZhdWx0Um9sZSIsInN1Y3Vyc2FsSWQiLCJkYkVycm9yIiwiYWRtaW5Db25maXJtVXNlciIsInJlc3VsdCIsImNyZWF0ZU9yU3luY1VzZXIiLCJleGlzdGluZ0xvY2FsVXNlciIsImV4aXN0aW5nQ29nbml0b1VzZXIiLCJnZXRVc2VyQnlVc2VybmFtZSIsImNvZ25pdG9FcnJvciIsIkVycm9yIiwiaXNOZXdVc2VyIiwiVXNlcm5hbWUiLCJVc2VyIiwic3luY2VkVXNlciIsIm5ld1VzZXIiLCJjb2RlIiwicmVzZW5kQ29uZmlybWF0aW9uQ29kZSIsImF1dGhTZXJ2aWNlIiwicmVzcG9uc2UiLCJmZXRjaCIsIm1ldGhvZCIsImhlYWRlcnMiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsIm9rIiwianNvbiIsInNldEl0ZW0iLCJpZFRva2VuIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/server/services/auth/authService.ts\n");

/***/ }),

/***/ "(rsc)/./src/server/services/auth/cognitoService.ts":
/*!****************************************************!*\
  !*** ./src/server/services/auth/cognitoService.ts ***!
  \****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   CognitoAuthService: () => (/* binding */ CognitoAuthService),\n/* harmony export */   cognitoService: () => (/* binding */ cognitoService)\n/* harmony export */ });\n/* harmony import */ var _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @aws-sdk/client-cognito-identity-provider */ \"(rsc)/./node_modules/@aws-sdk/client-cognito-identity-provider/dist-es/CognitoIdentityProviderClient.js\");\n/* harmony import */ var _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @aws-sdk/client-cognito-identity-provider */ \"(rsc)/./node_modules/@aws-sdk/client-cognito-identity-provider/dist-es/commands/AdminDeleteUserCommand.js\");\n/* harmony import */ var _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @aws-sdk/client-cognito-identity-provider */ \"(rsc)/./node_modules/@aws-sdk/client-cognito-identity-provider/dist-es/commands/SignUpCommand.js\");\n/* harmony import */ var _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @aws-sdk/client-cognito-identity-provider */ \"(rsc)/./node_modules/@aws-sdk/client-cognito-identity-provider/dist-es/commands/AdminConfirmSignUpCommand.js\");\n/* harmony import */ var _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @aws-sdk/client-cognito-identity-provider */ \"(rsc)/./node_modules/@aws-sdk/client-cognito-identity-provider/dist-es/commands/ConfirmSignUpCommand.js\");\n/* harmony import */ var _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @aws-sdk/client-cognito-identity-provider */ \"(rsc)/./node_modules/@aws-sdk/client-cognito-identity-provider/dist-es/commands/ResendConfirmationCodeCommand.js\");\n/* harmony import */ var _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @aws-sdk/client-cognito-identity-provider */ \"(rsc)/./node_modules/@aws-sdk/client-cognito-identity-provider/dist-es/commands/InitiateAuthCommand.js\");\n/* harmony import */ var _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! @aws-sdk/client-cognito-identity-provider */ \"(rsc)/./node_modules/@aws-sdk/client-cognito-identity-provider/dist-es/commands/GetUserCommand.js\");\n/* harmony import */ var _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! @aws-sdk/client-cognito-identity-provider */ \"(rsc)/./node_modules/@aws-sdk/client-cognito-identity-provider/dist-es/commands/GlobalSignOutCommand.js\");\n/* harmony import */ var _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! @aws-sdk/client-cognito-identity-provider */ \"(rsc)/./node_modules/@aws-sdk/client-cognito-identity-provider/dist-es/commands/AdminGetUserCommand.js\");\n/* harmony import */ var _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! @aws-sdk/client-cognito-identity-provider */ \"(rsc)/./node_modules/@aws-sdk/client-cognito-identity-provider/dist-es/commands/AdminSetUserPasswordCommand.js\");\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! crypto */ \"crypto\");\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(crypto__WEBPACK_IMPORTED_MODULE_0__);\n// src/server/services/auth/cognitoService.ts\n\n\nclass CognitoAuthService {\n    // En src/server/services/auth/cognitoService.ts\n    constructor(){\n        // Verificar variables críticas\n        if (!process.env.AWS_REGION || !process.env.COGNITO_USER_POOL_ID || !process.env.COGNITO_CLIENT_ID) {\n            console.error(\"Faltan variables de entorno críticas para Cognito\");\n        }\n        // Configurar el cliente de AWS con credenciales explícitas\n        this.client = new _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_1__.CognitoIdentityProviderClient({\n            region: process.env.AWS_REGION,\n            credentials: {\n                accessKeyId: process.env.AWS_ACCESS_KEY_ID,\n                secretAccessKey: process.env.AWS_SECRET_ACCESS_KEY\n            }\n        });\n        this.userPoolId = process.env.COGNITO_USER_POOL_ID;\n        this.clientId = process.env.COGNITO_CLIENT_ID;\n        this.clientSecret = process.env.COGNITO_CLIENT_SECRET;\n        console.log(\"Cliente Cognito inicializado con región:\", process.env.AWS_REGION);\n    }\n    // Método para calcular el SECRET_HASH\n    calculateSecretHash(username) {\n        if (!this.clientSecret) {\n            console.error('Cliente secret no está configurado');\n            throw new Error('Client secret is not configured');\n        }\n        // El formato correcto es USERNAME + CLIENT_ID\n        const message = username + this.clientId;\n        const hmac = crypto__WEBPACK_IMPORTED_MODULE_0__.createHmac('sha256', this.clientSecret);\n        hmac.update(message);\n        return hmac.digest('base64');\n    }\n    // Método para eliminar un usuario de Cognito\n    async deleteUser(username) {\n        try {\n            const command = new _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_2__.AdminDeleteUserCommand({\n                UserPoolId: this.userPoolId,\n                Username: username\n            });\n            await this.client.send(command);\n            console.log(`Usuario ${username} eliminado de Cognito`);\n            return true;\n        } catch (error) {\n            console.error('Error al eliminar usuario de Cognito:', error);\n            return false;\n        }\n    }\n    // Registrar un nuevo usuario\n    // En cognitoService.ts - Método simplificado\n    async registerUser(params) {\n        try {\n            const { email, password, name, roleId } = params;\n            console.log(`Iniciando registro de ${email} en Cognito`);\n            // Preparar atributos\n            const userAttributes = [\n                {\n                    Name: 'email',\n                    Value: email\n                },\n                {\n                    Name: 'name',\n                    Value: name\n                }\n            ];\n            if (roleId) {\n                userAttributes.push({\n                    Name: 'custom:role',\n                    Value: roleId\n                });\n            }\n            // Registro con SignUp\n            const signUpCommand = new _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_3__.SignUpCommand({\n                ClientId: this.clientId,\n                Username: email,\n                Password: password,\n                SecretHash: this.clientSecret ? this.calculateSecretHash(email) : undefined,\n                UserAttributes: userAttributes\n            });\n            console.log(\"Enviando comando SignUp a Cognito...\");\n            const response = await this.client.send(signUpCommand);\n            console.log(\"Respuesta de SignUp recibida:\", response.UserSub);\n            return {\n                success: true,\n                userId: response.UserSub,\n                message: 'Usuario registrado correctamente. Por favor, verifique su correo para completar el registro.'\n            };\n        } catch (error) {\n            console.error('Error detallado en registerUser:', error);\n            // Manejar errores comunes\n            if (error.name === 'UsernameExistsException') {\n                return {\n                    success: false,\n                    message: 'El correo electrónico ya está registrado.'\n                };\n            }\n            if (error.name === 'InvalidPasswordException') {\n                return {\n                    success: false,\n                    message: 'La contraseña no cumple con los requisitos de seguridad.'\n                };\n            }\n            // Para depuración\n            console.error('Tipo de error:', error.name);\n            console.error('Mensaje de error:', error.message);\n            if (error.$metadata) {\n                console.error('Metadatos del error:', error.$metadata);\n            }\n            // Propagar el error para manejo superior\n            throw error;\n        }\n    }\n    // Confirmar el registro con el código de verificación\n    async confirmRegistration(email, confirmationCode, isAdminConfirmation = false) {\n        try {\n            // Para confirmaciones desde admin, usamos AdminConfirmSignUp que no requiere código\n            if (isAdminConfirmation) {\n                const command = new _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_4__.AdminConfirmSignUpCommand({\n                    UserPoolId: this.userPoolId,\n                    Username: email\n                });\n                await this.client.send(command);\n                return {\n                    success: true,\n                    message: 'Usuario confirmado correctamente por admin.'\n                };\n            } else {\n                // Confirmación normal con código\n                const command = new _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_5__.ConfirmSignUpCommand({\n                    ClientId: this.clientId,\n                    Username: email,\n                    ConfirmationCode: confirmationCode,\n                    SecretHash: this.calculateSecretHash(email)\n                });\n                await this.client.send(command);\n                return {\n                    success: true,\n                    message: 'Registro confirmado correctamente.'\n                };\n            }\n        } catch (error) {\n            console.error('Error al confirmar registro:', error);\n            if (error.name === 'CodeMismatchException') {\n                return {\n                    success: false,\n                    message: 'El código de verificación es incorrecto.'\n                };\n            }\n            if (error.name === 'ExpiredCodeException') {\n                return {\n                    success: false,\n                    message: 'El código de verificación ha expirado.'\n                };\n            }\n            return {\n                success: false,\n                message: 'Error al confirmar el registro. Por favor, intente nuevamente.'\n            };\n        }\n    }\n    // Reenviar código de confirmación\n    async resendConfirmationCode(email) {\n        try {\n            const command = new _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_6__.ResendConfirmationCodeCommand({\n                ClientId: this.clientId,\n                Username: email,\n                SecretHash: this.calculateSecretHash(email)\n            });\n            await this.client.send(command);\n            return {\n                success: true,\n                message: 'Se ha enviado un nuevo código de verificación a su correo electrónico.'\n            };\n        } catch (error) {\n            console.error('Error al reenviar código:', error);\n            return {\n                success: false,\n                message: 'Error al reenviar el código de verificación. Por favor, intente nuevamente.'\n            };\n        }\n    }\n    // Login con Cognito\n    async login(credentials) {\n        try {\n            const { email, password } = credentials;\n            console.log(\"1. Iniciando login con Cognito para:\", email);\n            // Verificar que tenemos los valores de configuración\n            console.log(\"2. Verificando configuración:\", {\n                region: process.env.AWS_REGION,\n                userPoolId: this.userPoolId?.substring(0, 5) + '...',\n                clientId: this.clientId?.substring(0, 5) + '...',\n                hasSecret: !!this.clientSecret\n            });\n            // Si usamos secreto, calcular SECRET_HASH\n            let secretHash;\n            if (this.clientSecret) {\n                try {\n                    secretHash = this.calculateSecretHash(email);\n                    console.log(\"3. SECRET_HASH calculado correctamente\");\n                } catch (error) {\n                    console.error(\"Error al calcular SECRET_HASH:\", error);\n                    throw error;\n                }\n            }\n            // Crear parámetros de autenticación\n            const authParams = {\n                USERNAME: email,\n                PASSWORD: password\n            };\n            // Añadir SECRET_HASH si existe\n            if (secretHash) {\n                authParams.SECRET_HASH = secretHash;\n            }\n            console.log(\"4. Parámetros de autenticación preparados\");\n            const command = new _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_7__.InitiateAuthCommand({\n                AuthFlow: \"USER_PASSWORD_AUTH\",\n                ClientId: this.clientId,\n                AuthParameters: authParams\n            });\n            console.log(\"5. Enviando solicitud a Cognito...\");\n            const response = await this.client.send(command);\n            console.log(\"6. Respuesta recibida de Cognito:\", response?.AuthenticationResult ? \"Con tokens\" : \"Sin tokens\", response?.ChallengeName ? `Desafío: ${response.ChallengeName}` : \"Sin desafío\");\n            if (!response.AuthenticationResult) {\n                if (response.ChallengeName) {\n                    throw new Error(`Se requiere completar desafío: ${response.ChallengeName}`);\n                }\n                throw new Error('Error de autenticación: No se recibieron tokens de autenticación');\n            }\n            // Obtener información del usuario autenticado\n            console.log(\"7. Obteniendo información del usuario...\");\n            const userInfo = await this.getUserInfo(response.AuthenticationResult.AccessToken);\n            console.log(\"8. Información de usuario obtenida:\", userInfo.email);\n            return {\n                user: userInfo,\n                accessToken: response.AuthenticationResult.AccessToken,\n                refreshToken: response.AuthenticationResult.RefreshToken,\n                idToken: response.AuthenticationResult.IdToken,\n                expiresIn: response.AuthenticationResult.ExpiresIn || 3600\n            };\n        } catch (error) {\n            console.error('Error detallado en login Cognito:', error);\n            if (error.$metadata) {\n                console.error('Metadatos del error:', error.$metadata);\n            }\n            if (error.__type) {\n                console.error('Tipo de error AWS:', error.__type);\n            }\n            if (error.message) {\n                console.error('Mensaje de error:', error.message);\n            }\n            throw error;\n        }\n    }\n    // Obtener información del usuario desde Cognito\n    async getUserInfo(accessToken) {\n        try {\n            const command = new _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_8__.GetUserCommand({\n                AccessToken: accessToken\n            });\n            const response = await this.client.send(command);\n            // Mapear atributos de Cognito a nuestro modelo de usuario\n            const attributes = response.UserAttributes || [];\n            const email = attributes.find((attr)=>attr.Name === 'email')?.Value || '';\n            const name = attributes.find((attr)=>attr.Name === 'name')?.Value || '';\n            const sub = attributes.find((attr)=>attr.Name === 'sub')?.Value || '';\n            // Aquí deberíamos obtener el usuario de nuestra base de datos\n            // usando el sub como identificador externo\n            // Por ahora, devolvemos un usuario básico\n            return {\n                id: sub,\n                email,\n                name,\n                roleId: 'user',\n                createdAt: new Date(),\n                updatedAt: new Date(),\n                sucursalId: null\n            };\n        } catch (error) {\n            console.error('Error al obtener info de usuario:', error);\n            throw error;\n        }\n    }\n    // Cerrar sesión\n    async logout(accessToken) {\n        try {\n            const command = new _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_9__.GlobalSignOutCommand({\n                AccessToken: accessToken\n            });\n            await this.client.send(command);\n        } catch (error) {\n            console.error('Error al cerrar sesión:', error);\n            throw error;\n        }\n    }\n    async refreshToken(refreshToken, email) {\n        try {\n            // Si tenemos email, usarlo; de lo contrario, intentar extraerlo del token\n            let username = email || '';\n            // Si no tenemos username, no podemos generar SECRET_HASH\n            if (!username && this.clientSecret) {\n                throw new Error('Se requiere el email para el refresh token cuando se usa client secret');\n            }\n            // Parámetros para el refresh token\n            const authParams = {\n                REFRESH_TOKEN: refreshToken\n            };\n            // Añadir SECRET_HASH si tenemos username y clientSecret\n            if (username && this.clientSecret) {\n                authParams.SECRET_HASH = this.calculateSecretHash(username);\n            }\n            const command = new _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_7__.InitiateAuthCommand({\n                AuthFlow: \"REFRESH_TOKEN_AUTH\",\n                ClientId: this.clientId,\n                AuthParameters: authParams\n            });\n            const response = await this.client.send(command);\n            if (!response.AuthenticationResult) {\n                throw new Error('Error al refrescar token');\n            }\n            return {\n                accessToken: response.AuthenticationResult.AccessToken,\n                idToken: response.AuthenticationResult.IdToken,\n                refreshToken: refreshToken,\n                expiresIn: response.AuthenticationResult.ExpiresIn || 3600\n            };\n        } catch (error) {\n            console.error('Error al refrescar token:', error);\n            throw error;\n        }\n    }\n    async getUserByUsername(username) {\n        try {\n            const command = new _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_10__.AdminGetUserCommand({\n                UserPoolId: this.userPoolId,\n                Username: username\n            });\n            return await this.client.send(command);\n        } catch (error) {\n            console.error(`Error al obtener usuario ${username} de Cognito:`, error);\n            throw error;\n        }\n    }\n    // Establecer contraseña para un usuario\n    async setUserPassword(username, password) {\n        try {\n            const command = new _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_11__.AdminSetUserPasswordCommand({\n                UserPoolId: this.userPoolId,\n                Username: username,\n                Password: password,\n                Permanent: true\n            });\n            await this.client.send(command);\n            return true;\n        } catch (error) {\n            console.error('Error al establecer contraseña:', error);\n            return false;\n        }\n    }\n}\n// Singleton para uso en la aplicación\nconst cognitoService = new CognitoAuthService();\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmVyL3NlcnZpY2VzL2F1dGgvY29nbml0b1NlcnZpY2UudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsNkNBQTZDO0FBZ0JNO0FBRWxCO0FBd0IxQixNQUFNWTtJQU1iLGdEQUFnRDtJQUVoREMsYUFBYztRQUNaLCtCQUErQjtRQUMvQixJQUFJLENBQUNDLFFBQVFDLEdBQUcsQ0FBQ0MsVUFBVSxJQUFJLENBQUNGLFFBQVFDLEdBQUcsQ0FBQ0Usb0JBQW9CLElBQUksQ0FBQ0gsUUFBUUMsR0FBRyxDQUFDRyxpQkFBaUIsRUFBRTtZQUNsR0MsUUFBUUMsS0FBSyxDQUFDO1FBQ2hCO1FBRUEsMkRBQTJEO1FBQzNELElBQUksQ0FBQ0MsTUFBTSxHQUFHLElBQUlyQixvR0FBNkJBLENBQUM7WUFDOUNzQixRQUFRUixRQUFRQyxHQUFHLENBQUNDLFVBQVU7WUFDOUJPLGFBQWE7Z0JBQ1hDLGFBQWFWLFFBQVFDLEdBQUcsQ0FBQ1UsaUJBQWlCO2dCQUMxQ0MsaUJBQWlCWixRQUFRQyxHQUFHLENBQUNZLHFCQUFxQjtZQUNwRDtRQUNGO1FBRUEsSUFBSSxDQUFDQyxVQUFVLEdBQUdkLFFBQVFDLEdBQUcsQ0FBQ0Usb0JBQW9CO1FBQ2xELElBQUksQ0FBQ1ksUUFBUSxHQUFHZixRQUFRQyxHQUFHLENBQUNHLGlCQUFpQjtRQUM3QyxJQUFJLENBQUNZLFlBQVksR0FBR2hCLFFBQVFDLEdBQUcsQ0FBQ2dCLHFCQUFxQjtRQUVyRFosUUFBUWEsR0FBRyxDQUFDLDRDQUE0Q2xCLFFBQVFDLEdBQUcsQ0FBQ0MsVUFBVTtJQUNoRjtJQUVFLHNDQUFzQztJQUM5QmlCLG9CQUFvQkMsUUFBZ0IsRUFBVTtRQUNwRCxJQUFJLENBQUMsSUFBSSxDQUFDSixZQUFZLEVBQUU7WUFDdEJYLFFBQVFDLEtBQUssQ0FBQztZQUNkLE1BQU0sSUFBSWUsTUFBTTtRQUNsQjtRQUVBLDhDQUE4QztRQUM5QyxNQUFNQyxVQUFVRixXQUFXLElBQUksQ0FB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SUFBSTtZQUN4RDtRQUNGLEVBQUUsT0FBTzFFLE9BQU87WUFDZEQsUUFBUUMsS0FBSyxDQUFDLDZCQUE2QkE7WUFDM0MsTUFBTUE7UUFDUjtJQUNGO0lBRUEsTUFBTXVGLGtCQUFrQnpFLFFBQWdCLEVBQWdCO1FBQ3RELElBQUk7WUFDRixNQUFNUSxVQUFVLElBQUl2QywyRkFBbUJBLENBQUM7Z0JBQ3RDd0MsWUFBWSxJQUFJLENBQUNmLFVBQVU7Z0JBQzNCZ0IsVUFBVVY7WUFDWjtZQUVBLE9BQU8sTUFBTSxJQUFJLENBQUNiLE1BQU0sQ0FBQ3dCLElBQUksQ0FBQ0g7UUFDaEMsRUFBRSxPQUFPdEIsT0FBTztZQUNkRCxRQUFRQyxLQUFLLENBQUMsQ0FBQyx5QkFBeUIsRUFBRWMsU0FBUyxZQUFZLENBQUMsRUFBRWQ7WUFDbEUsTUFBTUE7UUFDUjtJQUNGO0lBRUEsd0NBQXdDO0lBQ3hDLE1BQU13RixnQkFBZ0IxRSxRQUFnQixFQUFFZSxRQUFnQixFQUFvQjtRQUMxRSxJQUFJO1lBQ0YsTUFBTVAsVUFBVSxJQUFJbEMsbUdBQTJCQSxDQUFDO2dCQUM5Q21DLFlBQVksSUFBSSxDQUFDZixVQUFVO2dCQUMzQmdCLFVBQVVWO2dCQUNWd0IsVUFBVVQ7Z0JBQ1Y0RCxXQUFXO1lBQ2I7WUFFQSxNQUFNLElBQUksQ0FBQ3hGLE1BQU0sQ0FBQ3dCLElBQUksQ0FBQ0g7WUFDdkIsT0FBTztRQUNULEVBQUUsT0FBT3RCLE9BQU87WUFDZEQsUUFBUUMsS0FBSyxDQUFDLG1DQUFtQ0E7WUFDakQsT0FBTztRQUNUO0lBQ0Y7QUFDRjtBQUVBLHNDQUFzQztBQUMvQixNQUFNMEYsaUJBQWlCLElBQUlsRyxxQkFBcUIiLCJzb3VyY2VzIjpbIi9Vc2Vycy9nYXN0b25tb3JhL0Rlc2t0b3AvUHJveWVjdG9zL1R1bHVtL3NyYy9zZXJ2ZXIvc2VydmljZXMvYXV0aC9jb2duaXRvU2VydmljZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBzcmMvc2VydmVyL3NlcnZpY2VzL2F1dGgvY29nbml0b1NlcnZpY2UudHNcbmltcG9ydCB7IFxuICBDb2duaXRvSWRlbnRpdHlQcm92aWRlckNsaWVudCwgXG4gIEluaXRpYXRlQXV0aENvbW1hbmQsXG4gIFJlc3BvbmRUb0F1dGhDaGFsbGVuZ2VDb21tYW5kLFxuICBHZXRVc2VyQ29tbWFuZCxcbiAgQWRtaW5HZXRVc2VyQ29tbWFuZCxcbiAgR2xvYmFsU2lnbk91dENvbW1hbmQsXG4gIFNpZ25VcENvbW1hbmQsXG4gIENvbmZpcm1TaWduVXBDb21tYW5kLFxuICBSZXNlbmRDb25maXJtYXRpb25Db2RlQ29tbWFuZCxcbiAgQWRtaW5DcmVhdGVVc2VyQ29tbWFuZCxcbiAgQWRtaW5TZXRVc2VyUGFzc3dvcmRDb21tYW5kLFxuICBBZG1pblVwZGF0ZVVzZXJBdHRyaWJ1dGVzQ29tbWFuZCxcbiAgQWRtaW5EZWxldGVVc2VyQ29tbWFuZCxcbiAgQWRtaW5Db25maXJtU2lnblVwQ29tbWFuZFxufSBmcm9tIFwiQGF3cy1zZGsvY2xpZW50LWNvZ25pdG8taWRlbnRpdHktcHJvdmlkZXJcIjtcbmltcG9ydCB7IHR5cGUgVXNlciB9IGZyb20gJ0BwcmlzbWEvY2xpZW50JztcbmltcG9ydCAqIGFzIGNyeXB0byBmcm9tICdjcnlwdG8nO1xuXG4vLyBJbnRlcmZhY2VzXG5pbnRlcmZhY2UgUmVnaXN0ZXJVc2VyUGFyYW1zIHtcbiAgZW1haWw6IHN0cmluZztcbiAgcGFzc3dvcmQ6IHN0cmluZztcbiAgbmFtZTogc3RyaW5nO1xuICByb2xlSWQ/OiBzdHJpbmc7XG4gIHN1Y3Vyc2FsSWQ/OiBzdHJpbmc7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgTG9naW5DcmVkZW50aWFscyB7XG4gIGVtYWlsOiBzdHJpbmc7XG4gIHBhc3N3b3JkOiBzdHJpbmc7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQXV0aFJlc3VsdCB7XG4gIHVzZXI6IE9taXQ8VXNlciwgJ3Bhc3N3b3JkJz47XG4gIGFjY2Vzc1Rva2VuOiBzdHJpbmc7XG4gIHJlZnJlc2hUb2tlbjogc3RyaW5nO1xuICBpZFRva2VuOiBzdHJpbmc7XG4gIGV4cGlyZXNJbjogbnVtYmVyO1xufVxuXG5leHBvcnQgY2xhc3MgQ29nbml0b0F1dGhTZXJ2aWNlIHtcbiAgcHJpdmF0ZSBjbGllbnQ6IENvZ25pdG9JZGVudGl0eVByb3ZpZGVyQ2xpZW50O1xuICBwcml2YXRlIHVzZXJQb29sSWQ6IHN0cmluZztcbiAgcHJpdmF0ZSBjbGllbnRJZDogc3RyaW5nO1xuICBwcml2YXRlIGNsaWVudFNlY3JldDogc3RyaW5nO1xuXG4vLyBFbiBzcmMvc2VydmVyL3NlcnZpY2VzL2F1dGgvY29nbml0b1NlcnZpY2UudHNcblxuY29uc3RydWN0b3IoKSB7XG4gIC8vIFZlcmlmaWNhciB2YXJpYWJsZXMgY3LDrXRpY2FzXG4gIGlmICghcHJvY2Vzcy5lbnYuQVdTX1JFR0lPTiB8fCAhcHJvY2Vzcy5lbnYuQ09HTklUT19VU0VSX1BPT0xfSUQgfHwgIXByb2Nlc3MuZW52LkNPR05JVE9fQ0xJRU5UX0lEKSB7XG4gICAgY29uc29sZS5lcnJvcihcIkZhbHRhbiB2YXJpYWJsZXMgZGUgZW50b3JubyBjcsOtdGljYXMgcGFyYSBDb2duaXRvXCIpO1xuICB9XG4gIFxuICAvLyBDb25maWd1cmFyIGVsIGNsaWVudGUgZGUgQVdTIGNvbiBjcmVkZW5jaWFsZXMgZXhwbMOtY2l0YXNcbiAgdGhpcy5jbGllbnQgPSBuZXcgQ29nbml0b0lkZW50aXR5UHJvdmlkZXJDbGllbnQoe1xuICAgIHJlZ2lvbjogcHJvY2Vzcy5lbnYuQVdTX1JFR0lPTiBhcyBzdHJpbmcsXG4gICAgY3JlZGVudGlhbHM6IHtcbiAgICAgIGFjY2Vzc0tleUlkOiBwcm9jZXNzLmVudi5BV1NfQUNDRVNTX0tFWV9JRCBhcyBzdHJpbmcsXG4gICAgICBzZWNyZXRBY2Nlc3NLZXk6IHByb2Nlc3MuZW52LkFXU19TRUNSRVRfQUNDRVNTX0tFWSBhcyBzdHJpbmdcbiAgICB9XG4gIH0pO1xuICBcbiAgdGhpcy51c2VyUG9vbElkID0gcHJvY2Vzcy5lbnYuQ09HTklUT19VU0VSX1BPT0xfSUQgYXMgc3RyaW5nO1xuICB0aGlzLmNsaWVudElkID0gcHJvY2Vzcy5lbnYuQ09HTklUT19DTElFTlRfSUQgYXMgc3RyaW5nO1xuICB0aGlzLmNsaWVudFNlY3JldCA9IHByb2Nlc3MuZW52LkNPR05JVE9fQ0xJRU5UX1NFQ1JFVCBhcyBzdHJpbmc7XG4gIFxuICBjb25zb2xlLmxvZyhcIkNsaWVudGUgQ29nbml0byBpbmljaWFsaXphZG8gY29uIHJlZ2nDs246XCIsIHByb2Nlc3MuZW52LkFXU19SRUdJT04pO1xufVxuXG4gIC8vIE3DqXRvZG8gcGFyYSBjYWxjdWxhciBlbCBTRUNSRVRfSEFTSFxuICBwcml2YXRlIGNhbGN1bGF0ZVNlY3JldEhhc2godXNlcm5hbWU6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgaWYgKCF0aGlzLmNsaWVudFNlY3JldCkge1xuICAgICAgY29uc29sZS5lcnJvcignQ2xpZW50ZSBzZWNyZXQgbm8gZXN0w6EgY29uZmlndXJhZG8nKTtcbiAgICAgIHRocm93IG5ldyBFcnJvcignQ2xpZW50IHNlY3JldCBpcyBub3QgY29uZmlndXJlZCcpO1xuICAgIH1cbiAgICBcbiAgICAvLyBFbCBmb3JtYXRvIGNvcnJlY3RvIGVzIFVTRVJOQU1FICsgQ0xJRU5UX0lEXG4gICAgY29uc3QgbWVzc2FnZSA9IHVzZXJuYW1lICsgdGhpcy5jbGllbnRJZDtcbiAgICBjb25zdCBobWFjID0gY3J5cHRvLmNyZWF0ZUhtYWMoJ3NoYTI1NicsIHRoaXMuY2xpZW50U2VjcmV0KTtcbiAgICBobWFjLnVwZGF0ZShtZXNzYWdlKTtcbiAgICByZXR1cm4gaG1hYy5kaWdlc3QoJ2Jhc2U2NCcpO1xuICB9XG5cbiAgLy8gTcOpdG9kbyBwYXJhIGVsaW1pbmFyIHVuIHVzdWFyaW8gZGUgQ29nbml0b1xuICBhc3luYyBkZWxldGVVc2VyKHVzZXJuYW1lOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgY29tbWFuZCA9IG5ldyBBZG1pbkRlbGV0ZVVzZXJDb21tYW5kKHtcbiAgICAgICAgVXNlclBvb2xJZDogdGhpcy51c2VyUG9vbElkLFxuICAgICAgICBVc2VybmFtZTogdXNlcm5hbWVcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICBhd2FpdCB0aGlzLmNsaWVudC5zZW5kKGNvbW1hbmQpO1xuICAgICAgY29uc29sZS5sb2coYFVzdWFyaW8gJHt1c2VybmFtZX0gZWxpbWluYWRvIGRlIENvZ25pdG9gKTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBhbCBlbGltaW5hciB1c3VhcmlvIGRlIENvZ25pdG86JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIC8vIFJlZ2lzdHJhciB1biBudWV2byB1c3VhcmlvXG4vLyBFbiBjb2duaXRvU2VydmljZS50cyAtIE3DqXRvZG8gc2ltcGxpZmljYWRvXG5cbmFzeW5jIHJlZ2lzdGVyVXNlcihwYXJhbXM6IFJlZ2lzdGVyVXNlclBhcmFtcyk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuOyB1c2VySWQ/OiBzdHJpbmc7IG1lc3NhZ2U/OiBzdHJpbmcgfT4ge1xuICB0cnkge1xuICAgIGNvbnN0IHsgZW1haWwsIHBhc3N3b3JkLCBuYW1lLCByb2xlSWQgfSA9IHBhcmFtcztcbiAgICBcbiAgICBjb25zb2xlLmxvZyhgSW5pY2lhbmRvIHJlZ2lzdHJvIGRlICR7ZW1haWx9IGVuIENvZ25pdG9gKTtcbiAgICBcbiAgICAvLyBQcmVwYXJhciBhdHJpYnV0b3NcbiAgICBjb25zdCB1c2VyQXR0cmlidXRlcyA9IFtcbiAgICAgIHsgTmFtZTogJ2VtYWlsJywgVmFsdWU6IGVtYWlsIH0sXG4gICAgICB7IE5hbWU6ICduYW1lJywgVmFsdWU6IG5hbWUgfVxuICAgIF07XG4gICAgXG4gICAgaWYgKHJvbGVJZCkge1xuICAgICAgdXNlckF0dHJpYnV0ZXMucHVzaCh7IE5hbWU6ICdjdXN0b206cm9sZScsIFZhbHVlOiByb2xlSWQgfSk7XG4gICAgfVxuICAgIFxuICAgIC8vIFJlZ2lzdHJvIGNvbiBTaWduVXBcbiAgICBjb25zdCBzaWduVXBDb21tYW5kID0gbmV3IFNpZ25VcENvbW1hbmQoe1xuICAgICAgQ2xpZW50SWQ6IHRoaXMuY2xpZW50SWQsXG4gICAgICBVc2VybmFtZTogZW1haWwsXG4gICAgICBQYXNzd29yZDogcGFzc3dvcmQsXG4gICAgICBTZWNyZXRIYXNoOiB0aGlzLmNsaWVudFNlY3JldCA/IHRoaXMuY2FsY3VsYXRlU2VjcmV0SGFzaChlbWFpbCkgOiB1bmRlZmluZWQsXG4gICAgICBVc2VyQXR0cmlidXRlczogdXNlckF0dHJpYnV0ZXNcbiAgICB9KTtcbiAgICBcbiAgICBjb25zb2xlLmxvZyhcIkVudmlhbmRvIGNvbWFuZG8gU2lnblVwIGEgQ29nbml0by4uLlwiKTtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHRoaXMuY2xpZW50LnNlbmQoc2lnblVwQ29tbWFuZCk7XG4gICAgY29uc29sZS5sb2coXCJSZXNwdWVzdGEgZGUgU2lnblVwIHJlY2liaWRhOlwiLCByZXNwb25zZS5Vc2VyU3ViKTtcbiAgICBcbiAgICByZXR1cm4ge1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIHVzZXJJZDogcmVzcG9uc2UuVXNlclN1YixcbiAgICAgIG1lc3NhZ2U6ICdVc3VhcmlvIHJlZ2lzdHJhZG8gY29ycmVjdGFtZW50ZS4gUG9yIGZhdm9yLCB2ZXJpZmlxdWUgc3UgY29ycmVvIHBhcmEgY29tcGxldGFyIGVsIHJlZ2lzdHJvLidcbiAgICB9O1xuICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgZGV0YWxsYWRvIGVuIHJlZ2lzdGVyVXNlcjonLCBlcnJvcik7XG4gICAgXG4gICAgLy8gTWFuZWphciBlcnJvcmVzIGNvbXVuZXNcbiAgICBpZiAoZXJyb3IubmFtZSA9PT0gJ1VzZXJuYW1lRXhpc3RzRXhjZXB0aW9uJykge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdFbCBjb3JyZW8gZWxlY3Ryw7NuaWNvIHlhIGVzdMOhIHJlZ2lzdHJhZG8uJ1xuICAgICAgfTtcbiAgICB9XG4gICAgXG4gICAgaWYgKGVycm9yLm5hbWUgPT09ICdJbnZhbGlkUGFzc3dvcmRFeGNlcHRpb24nKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogJ0xhIGNvbnRyYXNlw7FhIG5vIGN1bXBsZSBjb24gbG9zIHJlcXVpc2l0b3MgZGUgc2VndXJpZGFkLidcbiAgICAgIH07XG4gICAgfVxuICAgIFxuICAgIC8vIFBhcmEgZGVwdXJhY2nDs25cbiAgICBjb25zb2xlLmVycm9yKCdUaXBvIGRlIGVycm9yOicsIGVycm9yLm5hbWUpO1xuICAgIGNvbnNvbGUuZXJyb3IoJ01lbnNhamUgZGUgZXJyb3I6JywgZXJyb3IubWVzc2FnZSk7XG4gICAgaWYgKGVycm9yLiRtZXRhZGF0YSkge1xuICAgICAgY29uc29sZS5lcnJvcignTWV0YWRhdG9zIGRlbCBlcnJvcjonLCBlcnJvci4kbWV0YWRhdGEpO1xuICAgIH1cbiAgICBcbiAgICAvLyBQcm9wYWdhciBlbCBlcnJvciBwYXJhIG1hbmVqbyBzdXBlcmlvclxuICAgIHRocm93IGVycm9yO1xuICB9XG59XG5cbiAgLy8gQ29uZmlybWFyIGVsIHJlZ2lzdHJvIGNvbiBlbCBjw7NkaWdvIGRlIHZlcmlmaWNhY2nDs25cbiAgYXN5bmMgY29uZmlybVJlZ2lzdHJhdGlvbihlbWFpbDogc3RyaW5nLCBjb25maXJtYXRpb25Db2RlOiBzdHJpbmcsIGlzQWRtaW5Db25maXJtYXRpb24gPSBmYWxzZSk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuOyBtZXNzYWdlOiBzdHJpbmcgfT4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBQYXJhIGNvbmZpcm1hY2lvbmVzIGRlc2RlIGFkbWluLCB1c2Ftb3MgQWRtaW5Db25maXJtU2lnblVwIHF1ZSBubyByZXF1aWVyZSBjw7NkaWdvXG4gICAgICBpZiAoaXNBZG1pbkNvbmZpcm1hdGlvbikge1xuICAgICAgICBjb25zdCBjb21tYW5kID0gbmV3IEFkbWluQ29uZmlybVNpZ25VcENvbW1hbmQoe1xuICAgICAgICAgIFVzZXJQb29sSWQ6IHRoaXMudXNlclBvb2xJZCxcbiAgICAgICAgICBVc2VybmFtZTogZW1haWxcbiAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICBhd2FpdCB0aGlzLmNsaWVudC5zZW5kKGNvbW1hbmQpO1xuICAgICAgICBcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgIG1lc3NhZ2U6ICdVc3VhcmlvIGNvbmZpcm1hZG8gY29ycmVjdGFtZW50ZSBwb3IgYWRtaW4uJ1xuICAgICAgICB9O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gQ29uZmlybWFjacOzbiBub3JtYWwgY29uIGPDs2RpZ29cbiAgICAgICAgY29uc3QgY29tbWFuZCA9IG5ldyBDb25maXJtU2lnblVwQ29tbWFuZCh7XG4gICAgICAgICAgQ2xpZW50SWQ6IHRoaXMuY2xpZW50SWQsXG4gICAgICAgICAgVXNlcm5hbWU6IGVtYWlsLFxuICAgICAgICAgIENvbmZpcm1hdGlvbkNvZGU6IGNvbmZpcm1hdGlvbkNvZGUsXG4gICAgICAgICAgU2VjcmV0SGFzaDogdGhpcy5jYWxjdWxhdGVTZWNyZXRIYXNoKGVtYWlsKVxuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIGF3YWl0IHRoaXMuY2xpZW50LnNlbmQoY29tbWFuZCk7XG4gICAgICAgIFxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgICAgbWVzc2FnZTogJ1JlZ2lzdHJvIGNvbmZpcm1hZG8gY29ycmVjdGFtZW50ZS4nXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgYWwgY29uZmlybWFyIHJlZ2lzdHJvOicsIGVycm9yKTtcbiAgICAgIFxuICAgICAgaWYgKGVycm9yLm5hbWUgPT09ICdDb2RlTWlzbWF0Y2hFeGNlcHRpb24nKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgbWVzc2FnZTogJ0VsIGPDs2RpZ28gZGUgdmVyaWZpY2FjacOzbiBlcyBpbmNvcnJlY3RvLidcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgaWYgKGVycm9yLm5hbWUgPT09ICdFeHBpcmVkQ29kZUV4Y2VwdGlvbicpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBtZXNzYWdlOiAnRWwgY8OzZGlnbyBkZSB2ZXJpZmljYWNpw7NuIGhhIGV4cGlyYWRvLidcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdFcnJvciBhbCBjb25maXJtYXIgZWwgcmVnaXN0cm8uIFBvciBmYXZvciwgaW50ZW50ZSBudWV2YW1lbnRlLidcbiAgICAgIH07XG4gICAgfVxuICB9XG5cbiAgLy8gUmVlbnZpYXIgY8OzZGlnbyBkZSBjb25maXJtYWNpw7NuXG4gIGFzeW5jIHJlc2VuZENvbmZpcm1hdGlvbkNvZGUoZW1haWw6IHN0cmluZyk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuOyBtZXNzYWdlOiBzdHJpbmcgfT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBjb21tYW5kID0gbmV3IFJlc2VuZENvbmZpcm1hdGlvbkNvZGVDb21tYW5kKHtcbiAgICAgICAgQ2xpZW50SWQ6IHRoaXMuY2xpZW50SWQsXG4gICAgICAgIFVzZXJuYW1lOiBlbWFpbCxcbiAgICAgICAgU2VjcmV0SGFzaDogdGhpcy5jYWxjdWxhdGVTZWNyZXRIYXNoKGVtYWlsKVxuICAgICAgfSk7XG4gICAgICBcbiAgICAgIGF3YWl0IHRoaXMuY2xpZW50LnNlbmQoY29tbWFuZCk7XG4gICAgICBcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIG1lc3NhZ2U6ICdTZSBoYSBlbnZpYWRvIHVuIG51ZXZvIGPDs2RpZ28gZGUgdmVyaWZpY2FjacOzbiBhIHN1IGNvcnJlbyBlbGVjdHLDs25pY28uJ1xuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgYWwgcmVlbnZpYXIgY8OzZGlnbzonLCBlcnJvcik7XG4gICAgICBcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnRXJyb3IgYWwgcmVlbnZpYXIgZWwgY8OzZGlnbyBkZSB2ZXJpZmljYWNpw7NuLiBQb3IgZmF2b3IsIGludGVudGUgbnVldmFtZW50ZS4nXG4gICAgICB9O1xuICAgIH1cbiAgfVxuXG4gIC8vIExvZ2luIGNvbiBDb2duaXRvXG4gIGFzeW5jIGxvZ2luKGNyZWRlbnRpYWxzOiBMb2dpbkNyZWRlbnRpYWxzKTogUHJvbWlzZTxBdXRoUmVzdWx0PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHsgZW1haWwsIHBhc3N3b3JkIH0gPSBjcmVkZW50aWFscztcbiAgICAgIGNvbnNvbGUubG9nKFwiMS4gSW5pY2lhbmRvIGxvZ2luIGNvbiBDb2duaXRvIHBhcmE6XCIsIGVtYWlsKTtcbiAgICAgIFxuICAgICAgLy8gVmVyaWZpY2FyIHF1ZSB0ZW5lbW9zIGxvcyB2YWxvcmVzIGRlIGNvbmZpZ3VyYWNpw7NuXG4gICAgICBjb25zb2xlLmxvZyhcIjIuIFZlcmlmaWNhbmRvIGNvbmZpZ3VyYWNpw7NuOlwiLCB7XG4gICAgICAgIHJlZ2lvbjogcHJvY2Vzcy5lbnYuQVdTX1JFR0lPTixcbiAgICAgICAgdXNlclBvb2xJZDogdGhpcy51c2VyUG9vbElkPy5zdWJzdHJpbmcoMCwgNSkgKyAnLi4uJyxcbiAgICAgICAgY2xpZW50SWQ6IHRoaXMuY2xpZW50SWQ/LnN1YnN0cmluZygwLCA1KSArICcuLi4nLFxuICAgICAgICBoYXNTZWNyZXQ6ICEhdGhpcy5jbGllbnRTZWNyZXRcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICAvLyBTaSB1c2Ftb3Mgc2VjcmV0bywgY2FsY3VsYXIgU0VDUkVUX0hBU0hcbiAgICAgIGxldCBzZWNyZXRIYXNoO1xuICAgICAgaWYgKHRoaXMuY2xpZW50U2VjcmV0KSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgc2VjcmV0SGFzaCA9IHRoaXMuY2FsY3VsYXRlU2VjcmV0SGFzaChlbWFpbCk7XG4gICAgICAgICAgY29uc29sZS5sb2coXCIzLiBTRUNSRVRfSEFTSCBjYWxjdWxhZG8gY29ycmVjdGFtZW50ZVwiKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgYWwgY2FsY3VsYXIgU0VDUkVUX0hBU0g6XCIsIGVycm9yKTtcbiAgICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBDcmVhciBwYXLDoW1ldHJvcyBkZSBhdXRlbnRpY2FjacOzblxuICAgICAgY29uc3QgYXV0aFBhcmFtczogUmVjb3JkPHN0cmluZywgc3RyaW5nPiA9IHtcbiAgICAgICAgVVNFUk5BTUU6IGVtYWlsLFxuICAgICAgICBQQVNTV09SRDogcGFzc3dvcmRcbiAgICAgIH07XG4gICAgICBcbiAgICAgIC8vIEHDsWFkaXIgU0VDUkVUX0hBU0ggc2kgZXhpc3RlXG4gICAgICBpZiAoc2VjcmV0SGFzaCkge1xuICAgICAgICBhdXRoUGFyYW1zLlNFQ1JFVF9IQVNIID0gc2VjcmV0SGFzaDtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgY29uc29sZS5sb2coXCI0LiBQYXLDoW1ldHJvcyBkZSBhdXRlbnRpY2FjacOzbiBwcmVwYXJhZG9zXCIpO1xuICAgICAgXG4gICAgICBjb25zdCBjb21tYW5kID0gbmV3IEluaXRpYXRlQXV0aENvbW1hbmQoe1xuICAgICAgICBBdXRoRmxvdzogXCJVU0VSX1BBU1NXT1JEX0FVVEhcIixcbiAgICAgICAgQ2xpZW50SWQ6IHRoaXMuY2xpZW50SWQsXG4gICAgICAgIEF1dGhQYXJhbWV0ZXJzOiBhdXRoUGFyYW1zXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgY29uc29sZS5sb2coXCI1LiBFbnZpYW5kbyBzb2xpY2l0dWQgYSBDb2duaXRvLi4uXCIpO1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLmNsaWVudC5zZW5kKGNvbW1hbmQpO1xuICAgICAgY29uc29sZS5sb2coXCI2LiBSZXNwdWVzdGEgcmVjaWJpZGEgZGUgQ29nbml0bzpcIiwgXG4gICAgICAgIHJlc3BvbnNlPy5BdXRoZW50aWNhdGlvblJlc3VsdCA/IFwiQ29uIHRva2Vuc1wiIDogXCJTaW4gdG9rZW5zXCIsXG4gICAgICAgIHJlc3BvbnNlPy5DaGFsbGVuZ2VOYW1lID8gYERlc2Fmw61vOiAke3Jlc3BvbnNlLkNoYWxsZW5nZU5hbWV9YCA6IFwiU2luIGRlc2Fmw61vXCJcbiAgICAgICk7XG4gICAgICBcbiAgICAgIGlmICghcmVzcG9uc2UuQXV0aGVudGljYXRpb25SZXN1bHQpIHtcbiAgICAgICAgaWYgKHJlc3BvbnNlLkNoYWxsZW5nZU5hbWUpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFNlIHJlcXVpZXJlIGNvbXBsZXRhciBkZXNhZsOtbzogJHtyZXNwb25zZS5DaGFsbGVuZ2VOYW1lfWApO1xuICAgICAgICB9XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignRXJyb3IgZGUgYXV0ZW50aWNhY2nDs246IE5vIHNlIHJlY2liaWVyb24gdG9rZW5zIGRlIGF1dGVudGljYWNpw7NuJyk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIE9idGVuZXIgaW5mb3JtYWNpw7NuIGRlbCB1c3VhcmlvIGF1dGVudGljYWRvXG4gICAgICBjb25zb2xlLmxvZyhcIjcuIE9idGVuaWVuZG8gaW5mb3JtYWNpw7NuIGRlbCB1c3VhcmlvLi4uXCIpO1xuICAgICAgY29uc3QgdXNlckluZm8gPSBhd2FpdCB0aGlzLmdldFVzZXJJbmZvKHJlc3BvbnNlLkF1dGhlbnRpY2F0aW9uUmVzdWx0LkFjY2Vzc1Rva2VuIGFzIHN0cmluZyk7XG4gICAgICBjb25zb2xlLmxvZyhcIjguIEluZm9ybWFjacOzbiBkZSB1c3VhcmlvIG9idGVuaWRhOlwiLCB1c2VySW5mby5lbWFpbCk7XG4gICAgICBcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHVzZXI6IHVzZXJJbmZvLFxuICAgICAgICBhY2Nlc3NUb2tlbjogcmVzcG9uc2UuQXV0aGVudGljYXRpb25SZXN1bHQuQWNjZXNzVG9rZW4gYXMgc3RyaW5nLFxuICAgICAgICByZWZyZXNoVG9rZW46IHJlc3BvbnNlLkF1dGhlbnRpY2F0aW9uUmVzdWx0LlJlZnJlc2hUb2tlbiBhcyBzdHJpbmcsXG4gICAgICAgIGlkVG9rZW46IHJlc3BvbnNlLkF1dGhlbnRpY2F0aW9uUmVzdWx0LklkVG9rZW4gYXMgc3RyaW5nLFxuICAgICAgICBleHBpcmVzSW46IHJlc3BvbnNlLkF1dGhlbnRpY2F0aW9uUmVzdWx0LkV4cGlyZXNJbiB8fCAzNjAwXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGRldGFsbGFkbyBlbiBsb2dpbiBDb2duaXRvOicsIGVycm9yKTtcbiAgICAgIGlmIChlcnJvci4kbWV0YWRhdGEpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcignTWV0YWRhdG9zIGRlbCBlcnJvcjonLCBlcnJvci4kbWV0YWRhdGEpO1xuICAgICAgfVxuICAgICAgaWYgKGVycm9yLl9fdHlwZSkge1xuICAgICAgICBjb25zb2xlLmVycm9yKCdUaXBvIGRlIGVycm9yIEFXUzonLCBlcnJvci5fX3R5cGUpO1xuICAgICAgfVxuICAgICAgaWYgKGVycm9yLm1lc3NhZ2UpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcignTWVuc2FqZSBkZSBlcnJvcjonLCBlcnJvci5tZXNzYWdlKTtcbiAgICAgIH1cbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIC8vIE9idGVuZXIgaW5mb3JtYWNpw7NuIGRlbCB1c3VhcmlvIGRlc2RlIENvZ25pdG9cbiAgcHJpdmF0ZSBhc3luYyBnZXRVc2VySW5mbyhhY2Nlc3NUb2tlbjogc3RyaW5nKTogUHJvbWlzZTxPbWl0PFVzZXIsICdwYXNzd29yZCc+PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGNvbW1hbmQgPSBuZXcgR2V0VXNlckNvbW1hbmQoe1xuICAgICAgICBBY2Nlc3NUb2tlbjogYWNjZXNzVG9rZW5cbiAgICAgIH0pO1xuICAgICAgXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHRoaXMuY2xpZW50LnNlbmQoY29tbWFuZCk7XG4gICAgICBcbiAgICAgIC8vIE1hcGVhciBhdHJpYnV0b3MgZGUgQ29nbml0byBhIG51ZXN0cm8gbW9kZWxvIGRlIHVzdWFyaW9cbiAgICAgIGNvbnN0IGF0dHJpYnV0ZXMgPSByZXNwb25zZS5Vc2VyQXR0cmlidXRlcyB8fCBbXTtcbiAgICAgIGNvbnN0IGVtYWlsID0gYXR0cmlidXRlcy5maW5kKGF0dHIgPT4gYXR0ci5OYW1lID09PSAnZW1haWwnKT8uVmFsdWUgfHwgJyc7XG4gICAgICBjb25zdCBuYW1lID0gYXR0cmlidXRlcy5maW5kKGF0dHIgPT4gYXR0ci5OYW1lID09PSAnbmFtZScpPy5WYWx1ZSB8fCAnJztcbiAgICAgIGNvbnN0IHN1YiA9IGF0dHJpYnV0ZXMuZmluZChhdHRyID0+IGF0dHIuTmFtZSA9PT0gJ3N1YicpPy5WYWx1ZSB8fCAnJztcbiAgICAgIFxuICAgICAgLy8gQXF1w60gZGViZXLDrWFtb3Mgb2J0ZW5lciBlbCB1c3VhcmlvIGRlIG51ZXN0cmEgYmFzZSBkZSBkYXRvc1xuICAgICAgLy8gdXNhbmRvIGVsIHN1YiBjb21vIGlkZW50aWZpY2Fkb3IgZXh0ZXJub1xuICAgICAgLy8gUG9yIGFob3JhLCBkZXZvbHZlbW9zIHVuIHVzdWFyaW8gYsOhc2ljb1xuICAgICAgXG4gICAgICByZXR1cm4ge1xuICAgICAgICBpZDogc3ViLFxuICAgICAgICBlbWFpbCxcbiAgICAgICAgbmFtZSxcbiAgICAgICAgcm9sZUlkOiAndXNlcicsIC8vIFBvciBkZWZlY3RvLCBsdWVnbyBhY3R1YWxpemFtb3MgY29uIGluZm8gZGUgQkRcbiAgICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIHN1Y3Vyc2FsSWQ6IG51bGxcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGFsIG9idGVuZXIgaW5mbyBkZSB1c3VhcmlvOicsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIC8vIENlcnJhciBzZXNpw7NuXG4gIGFzeW5jIGxvZ291dChhY2Nlc3NUb2tlbjogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGNvbW1hbmQgPSBuZXcgR2xvYmFsU2lnbk91dENvbW1hbmQoe1xuICAgICAgICBBY2Nlc3NUb2tlbjogYWNjZXNzVG9rZW5cbiAgICAgIH0pO1xuICAgICAgXG4gICAgICBhd2FpdCB0aGlzLmNsaWVudC5zZW5kKGNvbW1hbmQpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBhbCBjZXJyYXIgc2VzacOzbjonLCBlcnJvcik7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICBhc3luYyByZWZyZXNoVG9rZW4ocmVmcmVzaFRva2VuOiBzdHJpbmcsIGVtYWlsPzogc3RyaW5nKTogUHJvbWlzZTxPbWl0PEF1dGhSZXN1bHQsICd1c2VyJz4+IHtcbiAgICB0cnkge1xuICAgICAgLy8gU2kgdGVuZW1vcyBlbWFpbCwgdXNhcmxvOyBkZSBsbyBjb250cmFyaW8sIGludGVudGFyIGV4dHJhZXJsbyBkZWwgdG9rZW5cbiAgICAgIGxldCB1c2VybmFtZSA9IGVtYWlsIHx8ICcnO1xuICAgICAgXG4gICAgICAvLyBTaSBubyB0ZW5lbW9zIHVzZXJuYW1lLCBubyBwb2RlbW9zIGdlbmVyYXIgU0VDUkVUX0hBU0hcbiAgICAgIGlmICghdXNlcm5hbWUgJiYgdGhpcy5jbGllbnRTZWNyZXQpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdTZSByZXF1aWVyZSBlbCBlbWFpbCBwYXJhIGVsIHJlZnJlc2ggdG9rZW4gY3VhbmRvIHNlIHVzYSBjbGllbnQgc2VjcmV0Jyk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIFBhcsOhbWV0cm9zIHBhcmEgZWwgcmVmcmVzaCB0b2tlblxuICAgICAgY29uc3QgYXV0aFBhcmFtczogUmVjb3JkPHN0cmluZywgc3RyaW5nPiA9IHtcbiAgICAgICAgUkVGUkVTSF9UT0tFTjogcmVmcmVzaFRva2VuXG4gICAgICB9O1xuICAgICAgXG4gICAgICAvLyBBw7FhZGlyIFNFQ1JFVF9IQVNIIHNpIHRlbmVtb3MgdXNlcm5hbWUgeSBjbGllbnRTZWNyZXRcbiAgICAgIGlmICh1c2VybmFtZSAmJiB0aGlzLmNsaWVudFNlY3JldCkge1xuICAgICAgICBhdXRoUGFyYW1zLlNFQ1JFVF9IQVNIID0gdGhpcy5jYWxjdWxhdGVTZWNyZXRIYXNoKHVzZXJuYW1lKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgY29uc3QgY29tbWFuZCA9IG5ldyBJbml0aWF0ZUF1dGhDb21tYW5kKHtcbiAgICAgICAgQXV0aEZsb3c6IFwiUkVGUkVTSF9UT0tFTl9BVVRIXCIsXG4gICAgICAgIENsaWVudElkOiB0aGlzLmNsaWVudElkLFxuICAgICAgICBBdXRoUGFyYW1ldGVyczogYXV0aFBhcmFtc1xuICAgICAgfSk7XG4gICAgICBcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy5jbGllbnQuc2VuZChjb21tYW5kKTtcbiAgICAgIFxuICAgICAgaWYgKCFyZXNwb25zZS5BdXRoZW50aWNhdGlvblJlc3VsdCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0Vycm9yIGFsIHJlZnJlc2NhciB0b2tlbicpO1xuICAgICAgfVxuICAgICAgXG4gICAgICByZXR1cm4ge1xuICAgICAgICBhY2Nlc3NUb2tlbjogcmVzcG9uc2UuQXV0aGVudGljYXRpb25SZXN1bHQuQWNjZXNzVG9rZW4gYXMgc3RyaW5nLFxuICAgICAgICBpZFRva2VuOiByZXNwb25zZS5BdXRoZW50aWNhdGlvblJlc3VsdC5JZFRva2VuIGFzIHN0cmluZyxcbiAgICAgICAgcmVmcmVzaFRva2VuOiByZWZyZXNoVG9rZW4sIC8vIE1hbnRlbmVyIGVsIG1pc21vIHJlZnJlc2ggdG9rZW5cbiAgICAgICAgZXhwaXJlc0luOiByZXNwb25zZS5BdXRoZW50aWNhdGlvblJlc3VsdC5FeHBpcmVzSW4gfHwgMzYwMFxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgYWwgcmVmcmVzY2FyIHRva2VuOicsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGdldFVzZXJCeVVzZXJuYW1lKHVzZXJuYW1lOiBzdHJpbmcpOiBQcm9taXNlPGFueT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBjb21tYW5kID0gbmV3IEFkbWluR2V0VXNlckNvbW1hbmQoe1xuICAgICAgICBVc2VyUG9vbElkOiB0aGlzLnVzZXJQb29sSWQsXG4gICAgICAgIFVzZXJuYW1lOiB1c2VybmFtZVxuICAgICAgfSk7XG4gICAgICBcbiAgICAgIHJldHVybiBhd2FpdCB0aGlzLmNsaWVudC5zZW5kKGNvbW1hbmQpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKGBFcnJvciBhbCBvYnRlbmVyIHVzdWFyaW8gJHt1c2VybmFtZX0gZGUgQ29nbml0bzpgLCBlcnJvcik7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICAvLyBFc3RhYmxlY2VyIGNvbnRyYXNlw7FhIHBhcmEgdW4gdXN1YXJpb1xuICBhc3luYyBzZXRVc2VyUGFzc3dvcmQodXNlcm5hbWU6IHN0cmluZywgcGFzc3dvcmQ6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBjb21tYW5kID0gbmV3IEFkbWluU2V0VXNlclBhc3N3b3JkQ29tbWFuZCh7XG4gICAgICAgIFVzZXJQb29sSWQ6IHRoaXMudXNlclBvb2xJZCxcbiAgICAgICAgVXNlcm5hbWU6IHVzZXJuYW1lLFxuICAgICAgICBQYXNzd29yZDogcGFzc3dvcmQsXG4gICAgICAgIFBlcm1hbmVudDogdHJ1ZVxuICAgICAgfSk7XG4gICAgICBcbiAgICAgIGF3YWl0IHRoaXMuY2xpZW50LnNlbmQoY29tbWFuZCk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgYWwgZXN0YWJsZWNlciBjb250cmFzZcOxYTonLCBlcnJvcik7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG59XG5cbi8vIFNpbmdsZXRvbiBwYXJhIHVzbyBlbiBsYSBhcGxpY2FjacOzblxuZXhwb3J0IGNvbnN0IGNvZ25pdG9TZXJ2aWNlID0gbmV3IENvZ25pdG9BdXRoU2VydmljZSgpOyJdLCJuYW1lcyI6WyJDb2duaXRvSWRlbnRpdHlQcm92aWRlckNsaWVudCIsIkluaXRpYXRlQXV0aENvbW1hbmQiLCJHZXRVc2VyQ29tbWFuZCIsIkFkbWluR2V0VXNlckNvbW1hbmQiLCJHbG9iYWxTaWduT3V0Q29tbWFuZCIsIlNpZ25VcENvbW1hbmQiLCJDb25maXJtU2lnblVwQ29tbWFuZCIsIlJlc2VuZENvbmZpcm1hdGlvbkNvZGVDb21tYW5kIiwiQWRtaW5TZXRVc2VyUGFzc3dvcmRDb21tYW5kIiwiQWRtaW5EZWxldGVVc2VyQ29tbWFuZCIsIkFkbWluQ29uZmlybVNpZ25VcENvbW1hbmQiLCJjcnlwdG8iLCJDb2duaXRvQXV0aFNlcnZpY2UiLCJjb25zdHJ1Y3RvciIsInByb2Nlc3MiLCJlbnYiLCJBV1NfUkVHSU9OIiwiQ09HTklUT19VU0VSX1BPT0xfSUQiLCJDT0dOSVRPX0NMSUVOVF9JRCIsImNvbnNvbGUiLCJlcnJvciIsImNsaWVudCIsInJlZ2lvbiIsImNyZWRlbnRpYWxzIiwiYWNjZXNzS2V5SWQiLCJBV1NfQUNDRVNTX0tFWV9JRCIsInNlY3JldEFjY2Vzc0tleSIsIkFXU19TRUNSRVRfQUNDRVNTX0tFWSIsInVzZXJQb29sSWQiLCJjbGllbnRJZCIsImNsaWVudFNlY3JldCIsIkNPR05JVE9fQ0xJRU5UX1NFQ1JFVCIsImxvZyIsImNhbGN1bGF0ZVNlY3JldEhhc2giLCJ1c2VybmFtZSIsIkVycm9yIiwibWVzc2FnZSIsImhtYWMiLCJjcmVhdGVIbWFjIiwidXBkYXRlIiwiZGlnZXN0IiwiZGVsZXRlVXNlciIsImNvbW1hbmQiLCJVc2VyUG9vbElkIiwiVXNlcm5hbWUiLCJzZW5kIiwicmVnaXN0ZXJVc2VyIiwicGFyYW1zIiwiZW1haWwiLCJwYXNzd29yZCIsIm5hbWUiLCJyb2xlSWQiLCJ1c2VyQXR0cmlidXRlcyIsIk5hbWUiLCJWYWx1ZSIsInB1c2giLCJzaWduVXBDb21tYW5kIiwiQ2xpZW50SWQiLCJQYXNzd29yZCIsIlNlY3JldEhhc2giLCJ1bmRlZmluZWQiLCJVc2VyQXR0cmlidXRlcyIsInJlc3BvbnNlIiwiVXNlclN1YiIsInN1Y2Nlc3MiLCJ1c2VySWQiLCIkbWV0YWRhdGEiLCJjb25maXJtUmVnaXN0cmF0aW9uIiwiY29uZmlybWF0aW9uQ29kZSIsImlzQWRtaW5Db25maXJtYXRpb24iLCJDb25maXJtYXRpb25Db2RlIiwicmVzZW5kQ29uZmlybWF0aW9uQ29kZSIsImxvZ2luIiwic3Vic3RyaW5nIiwiaGFzU2VjcmV0Iiwic2VjcmV0SGFzaCIsImF1dGhQYXJhbXMiLCJVU0VSTkFNRSIsIlBBU1NXT1JEIiwiU0VDUkVUX0hBU0giLCJBdXRoRmxvdyIsIkF1dGhQYXJhbWV0ZXJzIiwiQXV0aGVudGljYXRpb25SZXN1bHQiLCJDaGFsbGVuZ2VOYW1lIiwidXNlckluZm8iLCJnZXRVc2VySW5mbyIsIkFjY2Vzc1Rva2VuIiwidXNlciIsImFjY2Vzc1Rva2VuIiwicmVmcmVzaFRva2VuIiwiUmVmcmVzaFRva2VuIiwiaWRUb2tlbiIsIklkVG9rZW4iLCJleHBpcmVzSW4iLCJFeHBpcmVzSW4iLCJfX3R5cGUiLCJhdHRyaWJ1dGVzIiwiZmluZCIsImF0dHIiLCJzdWIiLCJpZCIsImNyZWF0ZWRBdCIsIkRhdGUiLCJ1cGRhdGVkQXQiLCJzdWN1cnNhbElkIiwibG9nb3V0IiwiUkVGUkVTSF9UT0tFTiIsImdldFVzZXJCeVVzZXJuYW1lIiwic2V0VXNlclBhc3N3b3JkIiwiUGVybWFuZW50IiwiY29nbml0b1NlcnZpY2UiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/server/services/auth/cognitoService.ts\n");

/***/ }),

/***/ "(ssr)/./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true!":
/*!******************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true! ***!
  \******************************************************************************************************/
/***/ (() => {



/***/ }),

/***/ "../app-render/after-task-async-storage.external":
/*!***********************************************************************************!*\
  !*** external "next/dist/server/app-render/after-task-async-storage.external.js" ***!
  \***********************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/after-task-async-storage.external.js");

/***/ }),

/***/ "../app-render/work-async-storage.external":
/*!*****************************************************************************!*\
  !*** external "next/dist/server/app-render/work-async-storage.external.js" ***!
  \*****************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/work-async-storage.external.js");

/***/ }),

/***/ "./work-unit-async-storage.external":
/*!**********************************************************************************!*\
  !*** external "next/dist/server/app-render/work-unit-async-storage.external.js" ***!
  \**********************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/work-unit-async-storage.external.js");

/***/ }),

/***/ "@prisma/client":
/*!*********************************!*\
  !*** external "@prisma/client" ***!
  \*********************************/
/***/ ((module) => {

"use strict";
module.exports = require("@prisma/client");

/***/ }),

/***/ "buffer":
/*!*************************!*\
  !*** external "buffer" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("buffer");

/***/ }),

/***/ "child_process":
/*!********************************!*\
  !*** external "child_process" ***!
  \********************************/
/***/ ((module) => {

"use strict";
module.exports = require("child_process");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("crypto");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

"use strict";
module.exports = require("fs");

/***/ }),

/***/ "fs/promises":
/*!******************************!*\
  !*** external "fs/promises" ***!
  \******************************/
/***/ ((module) => {

"use strict";
module.exports = require("fs/promises");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("http");

/***/ }),

/***/ "http2":
/*!************************!*\
  !*** external "http2" ***!
  \************************/
/***/ ((module) => {

"use strict";
module.exports = require("http2");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

"use strict";
module.exports = require("https");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "node:stream":
/*!******************************!*\
  !*** external "node:stream" ***!
  \******************************/
/***/ ((module) => {

"use strict";
module.exports = require("node:stream");

/***/ }),

/***/ "os":
/*!*********************!*\
  !*** external "os" ***!
  \*********************/
/***/ ((module) => {

"use strict";
module.exports = require("os");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("path");

/***/ }),

/***/ "process":
/*!**************************!*\
  !*** external "process" ***!
  \**************************/
/***/ ((module) => {

"use strict";
module.exports = require("process");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("stream");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = require("url");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("util");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/@aws-sdk","vendor-chunks/next","vendor-chunks/@smithy"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fauth%2Fme%2Froute&page=%2Fapi%2Fauth%2Fme%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fauth%2Fme%2Froute.ts&appDir=%2FUsers%2Fgastonmora%2FDesktop%2FProyectos%2FTulum%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fgastonmora%2FDesktop%2FProyectos%2FTulum&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();