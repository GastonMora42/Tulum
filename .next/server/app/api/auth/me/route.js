/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/auth/me/route";
exports.ids = ["app/api/auth/me/route"];
exports.modules = {

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fauth%2Fme%2Froute&page=%2Fapi%2Fauth%2Fme%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fauth%2Fme%2Froute.ts&appDir=%2FUsers%2Fgastonmora%2FDesktop%2FProyectos%2FTulum%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fgastonmora%2FDesktop%2FProyectos%2FTulum&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!*************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fauth%2Fme%2Froute&page=%2Fapi%2Fauth%2Fme%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fauth%2Fme%2Froute.ts&appDir=%2FUsers%2Fgastonmora%2FDesktop%2FProyectos%2FTulum%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fgastonmora%2FDesktop%2FProyectos%2FTulum&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \*************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   workAsyncStorage: () => (/* binding */ workAsyncStorage),\n/* harmony export */   workUnitAsyncStorage: () => (/* binding */ workUnitAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/route-kind */ \"(rsc)/./node_modules/next/dist/server/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_gastonmora_Desktop_Proyectos_Tulum_src_app_api_auth_me_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/auth/me/route.ts */ \"(rsc)/./src/app/api/auth/me/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/auth/me/route\",\n        pathname: \"/api/auth/me\",\n        filename: \"route\",\n        bundlePath: \"app/api/auth/me/route\"\n    },\n    resolvedPagePath: \"/Users/gastonmora/Desktop/Proyectos/Tulum/src/app/api/auth/me/route.ts\",\n    nextConfigOutput,\n    userland: _Users_gastonmora_Desktop_Proyectos_Tulum_src_app_api_auth_me_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { workAsyncStorage, workUnitAsyncStorage, serverHooks } = routeModule;\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        workAsyncStorage,\n        workUnitAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIvaW5kZXguanM/bmFtZT1hcHAlMkZhcGklMkZhdXRoJTJGbWUlMkZyb3V0ZSZwYWdlPSUyRmFwaSUyRmF1dGglMkZtZSUyRnJvdXRlJmFwcFBhdGhzPSZwYWdlUGF0aD1wcml2YXRlLW5leHQtYXBwLWRpciUyRmFwaSUyRmF1dGglMkZtZSUyRnJvdXRlLnRzJmFwcERpcj0lMkZVc2VycyUyRmdhc3Rvbm1vcmElMkZEZXNrdG9wJTJGUHJveWVjdG9zJTJGVHVsdW0lMkZzcmMlMkZhcHAmcGFnZUV4dGVuc2lvbnM9dHN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPWpzeCZwYWdlRXh0ZW5zaW9ucz1qcyZyb290RGlyPSUyRlVzZXJzJTJGZ2FzdG9ubW9yYSUyRkRlc2t0b3AlMkZQcm95ZWN0b3MlMkZUdWx1bSZpc0Rldj10cnVlJnRzY29uZmlnUGF0aD10c2NvbmZpZy5qc29uJmJhc2VQYXRoPSZhc3NldFByZWZpeD0mbmV4dENvbmZpZ091dHB1dD0mcHJlZmVycmVkUmVnaW9uPSZtaWRkbGV3YXJlQ29uZmlnPWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7QUFBK0Y7QUFDdkM7QUFDcUI7QUFDc0I7QUFDbkc7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLHlHQUFtQjtBQUMzQztBQUNBLGNBQWMsa0VBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLFlBQVk7QUFDWixDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsUUFBUSxzREFBc0Q7QUFDOUQ7QUFDQSxXQUFXLDRFQUFXO0FBQ3RCO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDMEY7O0FBRTFGIiwic291cmNlcyI6WyIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwUm91dGVSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL3JvdXRlLW1vZHVsZXMvYXBwLXJvdXRlL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgcGF0Y2hGZXRjaCBhcyBfcGF0Y2hGZXRjaCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi9wYXRjaC1mZXRjaFwiO1xuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIi9Vc2Vycy9nYXN0b25tb3JhL0Rlc2t0b3AvUHJveWVjdG9zL1R1bHVtL3NyYy9hcHAvYXBpL2F1dGgvbWUvcm91dGUudHNcIjtcbi8vIFdlIGluamVjdCB0aGUgbmV4dENvbmZpZ091dHB1dCBoZXJlIHNvIHRoYXQgd2UgY2FuIHVzZSB0aGVtIGluIHRoZSByb3V0ZVxuLy8gbW9kdWxlLlxuY29uc3QgbmV4dENvbmZpZ091dHB1dCA9IFwiXCJcbmNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IEFwcFJvdXRlUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLkFQUF9ST1VURSxcbiAgICAgICAgcGFnZTogXCIvYXBpL2F1dGgvbWUvcm91dGVcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9hdXRoL21lXCIsXG4gICAgICAgIGZpbGVuYW1lOiBcInJvdXRlXCIsXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiYXBwL2FwaS9hdXRoL21lL3JvdXRlXCJcbiAgICB9LFxuICAgIHJlc29sdmVkUGFnZVBhdGg6IFwiL1VzZXJzL2dhc3Rvbm1vcmEvRGVza3RvcC9Qcm95ZWN0b3MvVHVsdW0vc3JjL2FwcC9hcGkvYXV0aC9tZS9yb3V0ZS50c1wiLFxuICAgIG5leHRDb25maWdPdXRwdXQsXG4gICAgdXNlcmxhbmRcbn0pO1xuLy8gUHVsbCBvdXQgdGhlIGV4cG9ydHMgdGhhdCB3ZSBuZWVkIHRvIGV4cG9zZSBmcm9tIHRoZSBtb2R1bGUuIFRoaXMgc2hvdWxkXG4vLyBiZSBlbGltaW5hdGVkIHdoZW4gd2UndmUgbW92ZWQgdGhlIG90aGVyIHJvdXRlcyB0byB0aGUgbmV3IGZvcm1hdC4gVGhlc2Vcbi8vIGFyZSB1c2VkIHRvIGhvb2sgaW50byB0aGUgcm91dGUuXG5jb25zdCB7IHdvcmtBc3luY1N0b3JhZ2UsIHdvcmtVbml0QXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcyB9ID0gcm91dGVNb2R1bGU7XG5mdW5jdGlvbiBwYXRjaEZldGNoKCkge1xuICAgIHJldHVybiBfcGF0Y2hGZXRjaCh7XG4gICAgICAgIHdvcmtBc3luY1N0b3JhZ2UsXG4gICAgICAgIHdvcmtVbml0QXN5bmNTdG9yYWdlXG4gICAgfSk7XG59XG5leHBvcnQgeyByb3V0ZU1vZHVsZSwgd29ya0FzeW5jU3RvcmFnZSwgd29ya1VuaXRBc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzLCBwYXRjaEZldGNoLCAgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXBwLXJvdXRlLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fauth%2Fme%2Froute&page=%2Fapi%2Fauth%2Fme%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fauth%2Fme%2Froute.ts&appDir=%2FUsers%2Fgastonmora%2FDesktop%2FProyectos%2FTulum%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fgastonmora%2FDesktop%2FProyectos%2FTulum&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true!":
/*!******************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true! ***!
  \******************************************************************************************************/
/***/ (() => {



/***/ }),

/***/ "(rsc)/./src/app/api/auth/me/route.ts":
/*!**************************************!*\
  !*** ./src/app/api/auth/me/route.ts ***!
  \**************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _server_services_auth_authService__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/server/services/auth/authService */ \"(rsc)/./src/server/services/auth/authService.ts\");\n// src/app/api/auth/me/route.ts\n\n\nasync function GET(req) {\n    try {\n        // Obtener token de la cabecera\n        const authHeader = req.headers.get('authorization');\n        if (!authHeader || !authHeader.startsWith('Bearer ')) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: 'Token no proporcionado'\n            }, {\n                status: 401\n            });\n        }\n        const token = authHeader.split(' ')[1];\n        // Verificar token con servicio de autenticación\n        try {\n            // Obtener payload del token\n            const payload = JSON.parse(atob(token.split('.')[1]));\n            const userId = payload.sub;\n            // Obtener usuario de nuestra BD\n            const user = await _server_services_auth_authService__WEBPACK_IMPORTED_MODULE_1__.authService.getUserById(userId);\n            if (!user) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: 'Usuario no encontrado'\n                }, {\n                    status: 401\n                });\n            }\n            // Retornar información del usuario\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                user\n            });\n        } catch (error) {\n            console.error('Error al verificar token:', error);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: 'Token inválido'\n            }, {\n                status: 401\n            });\n        }\n    } catch (error) {\n        console.error('Error en ruta /api/auth/me:', error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: 'Error del servidor'\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBwL2FwaS9hdXRoL21lL3JvdXRlLnRzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLCtCQUErQjtBQUN5QjtBQUNTO0FBRTFELGVBQWVFLElBQUlDLEdBQWdCO0lBQ3hDLElBQUk7UUFDRiwrQkFBK0I7UUFDL0IsTUFBTUMsYUFBYUQsSUFBSUUsT0FBTyxDQUFDQyxHQUFHLENBQUM7UUFDbkMsSUFBSSxDQUFDRixjQUFjLENBQUNBLFdBQVdHLFVBQVUsQ0FBQyxZQUFZO1lBQ3BELE9BQU9QLHFEQUFZQSxDQUFDUSxJQUFJLENBQ3RCO2dCQUFFQyxPQUFPO1lBQXlCLEdBQ2xDO2dCQUFFQyxRQUFRO1lBQUk7UUFFbEI7UUFFQSxNQUFNQyxRQUFRUCxXQUFXUSxLQUFLLENBQUMsSUFBSSxDQUFDLEVBQUU7UUFFdEMsZ0RBQWdEO1FBQ2hELElBQUk7WUFDRiw0QkFBNEI7WUFDNUIsTUFBTUMsVUFBVUMsS0FBS0MsS0FBSyxDQUFDQyxLQUFLTCxNQUFNQyxLQUFLLENBQUMsSUFBSSxDQUFDLEVBQUU7WUFDbkQsTUFBTUssU0FBU0osUUFBUUssR0FBRztZQUUxQixnQ0FBZ0M7WUFDaEMsTUFBTUMsT0FBTyxNQUFNbEIsMEVBQVdBLENBQUNtQixXQUFXLENBQUNIO1lBQzNDLElBQUksQ0FBQ0UsTUFBTTtnQkFDVCxPQUFPbkIscURBQVlBLENBQUNRLElBQUksQ0FDdEI7b0JBQUVDLE9BQU87Z0JBQXdCLEdBQ2pDO29CQUFFQyxRQUFRO2dCQUFJO1lBRWxCO1lBRUEsbUNBQW1DO1lBQ25DLE9BQU9WLHFEQUFZQSxDQUFDUSxJQUFJLENBQUM7Z0JBQUVXO1lBQUs7UUFFbEMsRUFBRSxPQUFPVixPQUFPO1lBQ2RZLFFBQVFaLEtBQUssQ0FBQyw2QkFBNkJBO1lBQzNDLE9BQU9ULHFEQUFZQSxDQUFDUSxJQUFJLENBQ3RCO2dCQUFFQyxPQUFPO1lBQWlCLEdBQzFCO2dCQUFFQyxRQUFRO1lBQUk7UUFFbEI7SUFDRixFQUFFLE9BQU9ELE9BQU87UUFDZFksUUFBUVosS0FBSyxDQUFDLCtCQUErQkE7UUFDN0MsT0FBT1QscURBQVlBLENBQUNRLElBQUksQ0FDdEI7WUFBRUMsT0FBTztRQUFxQixHQUM5QjtZQUFFQyxRQUFRO1FBQUk7SUFFbEI7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL2dhc3Rvbm1vcmEvRGVza3RvcC9Qcm95ZWN0b3MvVHVsdW0vc3JjL2FwcC9hcGkvYXV0aC9tZS9yb3V0ZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBzcmMvYXBwL2FwaS9hdXRoL21lL3JvdXRlLnRzXG5pbXBvcnQgeyBOZXh0UmVxdWVzdCwgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInO1xuaW1wb3J0IHsgYXV0aFNlcnZpY2UgfSBmcm9tICdAL3NlcnZlci9zZXJ2aWNlcy9hdXRoL2F1dGhTZXJ2aWNlJztcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIEdFVChyZXE6IE5leHRSZXF1ZXN0KSB7XG4gIHRyeSB7XG4gICAgLy8gT2J0ZW5lciB0b2tlbiBkZSBsYSBjYWJlY2VyYVxuICAgIGNvbnN0IGF1dGhIZWFkZXIgPSByZXEuaGVhZGVycy5nZXQoJ2F1dGhvcml6YXRpb24nKTtcbiAgICBpZiAoIWF1dGhIZWFkZXIgfHwgIWF1dGhIZWFkZXIuc3RhcnRzV2l0aCgnQmVhcmVyICcpKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgZXJyb3I6ICdUb2tlbiBubyBwcm9wb3JjaW9uYWRvJyB9LFxuICAgICAgICB7IHN0YXR1czogNDAxIH1cbiAgICAgICk7XG4gICAgfVxuICAgIFxuICAgIGNvbnN0IHRva2VuID0gYXV0aEhlYWRlci5zcGxpdCgnICcpWzFdO1xuICAgIFxuICAgIC8vIFZlcmlmaWNhciB0b2tlbiBjb24gc2VydmljaW8gZGUgYXV0ZW50aWNhY2nDs25cbiAgICB0cnkge1xuICAgICAgLy8gT2J0ZW5lciBwYXlsb2FkIGRlbCB0b2tlblxuICAgICAgY29uc3QgcGF5bG9hZCA9IEpTT04ucGFyc2UoYXRvYih0b2tlbi5zcGxpdCgnLicpWzFdKSk7XG4gICAgICBjb25zdCB1c2VySWQgPSBwYXlsb2FkLnN1YjtcbiAgICAgIFxuICAgICAgLy8gT2J0ZW5lciB1c3VhcmlvIGRlIG51ZXN0cmEgQkRcbiAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBhdXRoU2VydmljZS5nZXRVc2VyQnlJZCh1c2VySWQpO1xuICAgICAgaWYgKCF1c2VyKSB7XG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgICB7IGVycm9yOiAnVXN1YXJpbyBubyBlbmNvbnRyYWRvJyB9LFxuICAgICAgICAgIHsgc3RhdHVzOiA0MDEgfVxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBSZXRvcm5hciBpbmZvcm1hY2nDs24gZGVsIHVzdWFyaW9cbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IHVzZXIgfSk7XG4gICAgICBcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgYWwgdmVyaWZpY2FyIHRva2VuOicsIGVycm9yKTtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBlcnJvcjogJ1Rva2VuIGludsOhbGlkbycgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMSB9XG4gICAgICApO1xuICAgIH1cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBlbiBydXRhIC9hcGkvYXV0aC9tZTonLCBlcnJvcik7XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgeyBlcnJvcjogJ0Vycm9yIGRlbCBzZXJ2aWRvcicgfSxcbiAgICAgIHsgc3RhdHVzOiA1MDAgfVxuICAgICk7XG4gIH1cbn0iXSwibmFtZXMiOlsiTmV4dFJlc3BvbnNlIiwiYXV0aFNlcnZpY2UiLCJHRVQiLCJyZXEiLCJhdXRoSGVhZGVyIiwiaGVhZGVycyIsImdldCIsInN0YXJ0c1dpdGgiLCJqc29uIiwiZXJyb3IiLCJzdGF0dXMiLCJ0b2tlbiIsInNwbGl0IiwicGF5bG9hZCIsIkpTT04iLCJwYXJzZSIsImF0b2IiLCJ1c2VySWQiLCJzdWIiLCJ1c2VyIiwiZ2V0VXNlckJ5SWQiLCJjb25zb2xlIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/auth/me/route.ts\n");

/***/ }),

/***/ "(rsc)/./src/server/db/client.ts":
/*!*********************************!*\
  !*** ./src/server/db/client.ts ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @prisma/client */ \"@prisma/client\");\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_prisma_client__WEBPACK_IMPORTED_MODULE_0__);\n// src/server/db/client.ts\n\n// Evitar múltiples instancias en desarrollo\nconst globalForPrisma = global;\nconst prisma = globalForPrisma.prisma ?? new _prisma_client__WEBPACK_IMPORTED_MODULE_0__.PrismaClient({\n    log:  true ? [\n        'query',\n        'error',\n        'warn'\n    ] : 0\n});\nif (true) globalForPrisma.prisma = prisma;\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (prisma);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmVyL2RiL2NsaWVudC50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSwwQkFBMEI7QUFDb0I7QUFFOUMsNENBQTRDO0FBQzVDLE1BQU1DLGtCQUFrQkM7QUFJeEIsTUFBTUMsU0FBU0YsZ0JBQWdCRSxNQUFNLElBQ25DLElBQUlILHdEQUFZQSxDQUFDO0lBQ2ZJLEtBQUtDLEtBQXNDLEdBQ3ZDO1FBQUM7UUFBUztRQUFTO0tBQU8sR0FDMUIsQ0FBUztBQUNmO0FBRUYsSUFBSUEsSUFBcUMsRUFBRUosZ0JBQWdCRSxNQUFNLEdBQUdBO0FBRXBFLGlFQUFlQSxNQUFNQSxFQUFDIiwic291cmNlcyI6WyIvVXNlcnMvZ2FzdG9ubW9yYS9EZXNrdG9wL1Byb3llY3Rvcy9UdWx1bS9zcmMvc2VydmVyL2RiL2NsaWVudC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBzcmMvc2VydmVyL2RiL2NsaWVudC50c1xuaW1wb3J0IHsgUHJpc21hQ2xpZW50IH0gZnJvbSAnQHByaXNtYS9jbGllbnQnO1xuXG4vLyBFdml0YXIgbcO6bHRpcGxlcyBpbnN0YW5jaWFzIGVuIGRlc2Fycm9sbG9cbmNvbnN0IGdsb2JhbEZvclByaXNtYSA9IGdsb2JhbCBhcyB1bmtub3duIGFzIHtcbiAgcHJpc21hOiBQcmlzbWFDbGllbnQgfCB1bmRlZmluZWQ7XG59O1xuXG5jb25zdCBwcmlzbWEgPSBnbG9iYWxGb3JQcmlzbWEucHJpc21hID8/IFxuICBuZXcgUHJpc21hQ2xpZW50KHtcbiAgICBsb2c6IHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAnZGV2ZWxvcG1lbnQnIFxuICAgICAgPyBbJ3F1ZXJ5JywgJ2Vycm9yJywgJ3dhcm4nXSBcbiAgICAgIDogWydlcnJvciddLFxuICB9KTtcblxuaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicpIGdsb2JhbEZvclByaXNtYS5wcmlzbWEgPSBwcmlzbWE7XG5cbmV4cG9ydCBkZWZhdWx0IHByaXNtYTsiXSwibmFtZXMiOlsiUHJpc21hQ2xpZW50IiwiZ2xvYmFsRm9yUHJpc21hIiwiZ2xvYmFsIiwicHJpc21hIiwibG9nIiwicHJvY2VzcyJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/server/db/client.ts\n");

/***/ }),

/***/ "(rsc)/./src/server/services/auth/authService.ts":
/*!*************************************************!*\
  !*** ./src/server/services/auth/authService.ts ***!
  \*************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   AuthService: () => (/* binding */ AuthService),\n/* harmony export */   authService: () => (/* binding */ authService),\n/* harmony export */   refreshToken: () => (/* binding */ refreshToken)\n/* harmony export */ });\n/* harmony import */ var _server_db_client__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/server/db/client */ \"(rsc)/./src/server/db/client.ts\");\n/* harmony import */ var _cognitoService__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./cognitoService */ \"(rsc)/./src/server/services/auth/cognitoService.ts\");\n// src/server/services/auth/authService.ts\n\n\n// Servicio de autenticación que actúa como fachada para Cognito\nclass AuthService {\n    // Login\n    async login(credentials) {\n        try {\n            // Autenticar con Cognito\n            const cognitoResult = await _cognitoService__WEBPACK_IMPORTED_MODULE_1__.cognitoService.login(credentials);\n            // Buscar usuario en nuestra BD\n            let user = await _server_db_client__WEBPACK_IMPORTED_MODULE_0__[\"default\"].user.findFirst({\n                where: {\n                    email: credentials.email\n                },\n                include: {\n                    role: true\n                }\n            });\n            console.log('Usuario encontrado:', user);\n            console.log('Rol del usuario:', user?.role);\n            // Si no existe el usuario, lo creamos\n            if (!user) {\n                console.log(\"Usuario no encontrado en BD local, creando...\");\n                // Buscar primero un rol (preferiblemente admin)\n                let role = await _server_db_client__WEBPACK_IMPORTED_MODULE_0__[\"default\"].role.findFirst({\n                    where: {\n                        name: 'admin'\n                    }\n                });\n                // Si no existe ningún rol, necesitamos crear al menos uno\n                if (!role) {\n                    console.log(\"Creando rol 'admin' porque no existe\");\n                    role = await _server_db_client__WEBPACK_IMPORTED_MODULE_0__[\"default\"].role.create({\n                        data: {\n                            name: 'admin',\n                            permissions: [\n                                '*'\n                            ] // Todos los permisos como JSON\n                        }\n                    });\n                }\n                // Crear el usuario con el rol encontrado o creado\n                user = await _server_db_client__WEBPACK_IMPORTED_MODULE_0__[\"default\"].user.create({\n                    data: {\n                        id: cognitoResult.user.id,\n                        email: credentials.email,\n                        name: cognitoResult.user.name || credentials.email.split('@')[0],\n                        roleId: role.id\n                    },\n                    include: {\n                        role: true\n                    }\n                });\n                console.log(\"Usuario creado exitosamente:\", user.id);\n            }\n            // Devolvemos el resultado combinado\n            return {\n                ...cognitoResult,\n                user: {\n                    ...user,\n                    // Asegurarse de que usamos los datos de nuestra BD\n                    id: user.id,\n                    roleId: user.roleId\n                }\n            };\n        } catch (error) {\n            console.error('Error en login:', error);\n            throw error; // Propagar el error para que el cliente pueda manejarlo\n        }\n    }\n    // Cerrar sesión\n    async logout(accessToken) {\n        try {\n            await _cognitoService__WEBPACK_IMPORTED_MODULE_1__.cognitoService.logout(accessToken);\n            return true;\n        } catch (error) {\n            console.error('Error en logout:', error);\n            return false;\n        }\n    }\n    // Refrescar token\n    async refreshUserToken(refreshToken) {\n        try {\n            // Usar el email almacenado en localStorage para el SECRET_HASH\n            let email = '';\n            if (typeof localStorage !== 'undefined') {\n                email = localStorage.getItem('userEmail') || '';\n            }\n            return await _cognitoService__WEBPACK_IMPORTED_MODULE_1__.cognitoService.refreshToken(refreshToken, email);\n        } catch (error) {\n            console.error('Error al refrescar token:', error);\n            return null;\n        }\n    }\n    // Obtener usuario por ID\n    async getUserById(userId) {\n        try {\n            const user = await _server_db_client__WEBPACK_IMPORTED_MODULE_0__[\"default\"].user.findUnique({\n                where: {\n                    id: userId\n                },\n                include: {\n                    role: true\n                }\n            });\n            if (!user) return null;\n            return user;\n        } catch (error) {\n            console.error('Error al obtener usuario:', error);\n            return null;\n        }\n    }\n    // Crear usuario (admin)\n    async createUser(userData) {\n        try {\n            // Verificar que el rol existe\n            const roleExists = await _server_db_client__WEBPACK_IMPORTED_MODULE_0__[\"default\"].role.findUnique({\n                where: {\n                    id: userData.roleId\n                }\n            });\n            if (!roleExists) {\n                throw new Error(`El rol con ID ${userData.roleId} no existe`);\n            }\n            // Si se proporciona sucursalId, verificar que existe\n            if (userData.sucursalId) {\n                const sucursalExists = await _server_db_client__WEBPACK_IMPORTED_MODULE_0__[\"default\"].ubicacion.findUnique({\n                    where: {\n                        id: userData.sucursalId\n                    }\n                });\n                if (!sucursalExists) {\n                    throw new Error(`La ubicación con ID ${userData.sucursalId} no existe`);\n                }\n            }\n            // Crear usuario en Cognito\n            await _cognitoService__WEBPACK_IMPORTED_MODULE_1__.cognitoService.createUser({\n                email: userData.email,\n                name: userData.name,\n                password: userData.password,\n                roleId: userData.roleId\n            });\n            // Crear usuario en nuestra BD\n            const user = await _server_db_client__WEBPACK_IMPORTED_MODULE_0__[\"default\"].user.create({\n                data: {\n                    email: userData.email,\n                    name: userData.name,\n                    roleId: userData.roleId,\n                    sucursalId: userData.sucursalId || null\n                }\n            });\n            return user;\n        } catch (error) {\n            console.error('Error al crear usuario:', error);\n            throw error;\n        }\n    }\n    // Registrar un nuevo usuario\n    async registerUser(userData) {\n        try {\n            // Registrar en Cognito\n            const cognitoResult = await _cognitoService__WEBPACK_IMPORTED_MODULE_1__.cognitoService.registerUser({\n                email: userData.email,\n                name: userData.name,\n                password: userData.password\n            });\n            if (!cognitoResult.success) {\n                return {\n                    success: false,\n                    message: cognitoResult.message || 'Error al registrar usuario en Cognito',\n                    userId: cognitoResult.userId\n                };\n            }\n            return {\n                success: true,\n                message: cognitoResult.message || 'Usuario registrado exitosamente',\n                userId: cognitoResult.userId\n            };\n        } catch (error) {\n            console.error('Error en registro:', error);\n            return {\n                success: false,\n                message: 'Error al registrar usuario'\n            };\n        }\n    }\n    // Confirmar registro\n    async confirmRegistration(email, code) {\n        try {\n            return await _cognitoService__WEBPACK_IMPORTED_MODULE_1__.cognitoService.confirmRegistration(email, code);\n        } catch (error) {\n            console.error('Error al confirmar registro:', error);\n            return {\n                success: false,\n                message: 'Error al confirmar el registro'\n            };\n        }\n    }\n    // Reenviar código de confirmación\n    async resendConfirmationCode(email) {\n        try {\n            return await _cognitoService__WEBPACK_IMPORTED_MODULE_1__.cognitoService.resendConfirmationCode(email);\n        } catch (error) {\n            console.error('Error al reenviar código:', error);\n            return {\n                success: false,\n                message: 'Error al reenviar el código de verificación'\n            };\n        }\n    }\n}\n// Singleton para uso en la aplicación\nconst authService = new AuthService();\n// Función para el cliente (frontend)\nasync function refreshToken() {\n    const refreshToken = localStorage.getItem('refreshToken');\n    if (!refreshToken) return false;\n    try {\n        const response = await fetch('/api/auth/refresh', {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json'\n            },\n            body: JSON.stringify({\n                refreshToken\n            })\n        });\n        if (!response.ok) return false;\n        const data = await response.json();\n        // Actualizar tokens\n        localStorage.setItem('accessToken', data.accessToken);\n        localStorage.setItem('idToken', data.idToken);\n        return true;\n    } catch (error) {\n        console.error('Error al refrescar token:', error);\n        return false;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmVyL3NlcnZpY2VzL2F1dGgvYXV0aFNlcnZpY2UudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQSwwQ0FBMEM7QUFFRjtBQUN3QztBQUVoRixnRUFBZ0U7QUFDekQsTUFBTUU7SUFDWCxRQUFRO0lBQ1IsTUFBTUMsTUFBTUMsV0FBNkIsRUFBOEI7UUFDckUsSUFBSTtZQUNGLHlCQUF5QjtZQUN6QixNQUFNQyxnQkFBZ0IsTUFBTUosMkRBQWNBLENBQUNFLEtBQUssQ0FBQ0M7WUFFakQsK0JBQStCO1lBQy9CLElBQUlFLE9BQU8sTUFBTU4seURBQU1BLENBQUNNLElBQUksQ0FBQ0MsU0FBUyxDQUFDO2dCQUNyQ0MsT0FBTztvQkFDTEMsT0FBT0wsWUFBWUssS0FBSztnQkFDMUI7Z0JBQ0FDLFNBQVM7b0JBQ1BDLE1BQU07Z0JBQ1I7WUFDRjtZQUVJQyxRQUFRQyxHQUFHLENBQUMsdUJBQXVCUDtZQUN6Q00sUUFBUUMsR0FBRyxDQUFDLG9CQUFvQlAsTUFBTUs7WUFFcEMsc0NBQXNDO1lBQ3RDLElBQUksQ0FBQ0wsTUFBTTtnQkFDVE0sUUFBUUMsR0FBRyxDQUFDO2dCQUVaLGdEQUFnRDtnQkFDaEQsSUFBSUYsT0FBTyxNQUFNWCx5REFBTUEsQ0FBQ1csSUFBSSxDQUFDSixTQUFTLENBQUM7b0JBQ3JDQyxPQUFPO3dCQUFFTSxNQUFNO29CQUFRO2dCQUN6QjtnQkFFQSwwREFBMEQ7Z0JBQzFELElBQUksQ0FBQ0gsTUFBTTtvQkFDVEMsUUFBUUMsR0FBRyxDQUFDO29CQUNaRixPQUFPLE1BQU1YLHlEQUFNQSxDQUFDVyxJQUFJLENBQUNJLE1BQU0sQ0FBQzt3QkFDOUJDLE1BQU07NEJBQ0pGLE1BQU07NEJBQ05HLGFBQWE7Z0NBQUM7NkJBQUksQ0FBQywrQkFBK0I7d0JBQ3BEO29CQUNGO2dCQUNGO2dCQUVBLGtEQUFrRDtnQkFDbERYLE9BQU8sTUFBTU4seURBQU1BLENBQUNNLElBQUksQ0FBQ1MsTUFBTSxDQUFDO29CQUM5QkMsTUFB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QUFPO0lBQ1QsRUFBRSxPQUFPbkMsT0FBTztRQUNkVCxRQUFRUyxLQUFLLENBQUMsNkJBQTZCQTtRQUMzQyxPQUFPO0lBQ1Q7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL2dhc3Rvbm1vcmEvRGVza3RvcC9Qcm95ZWN0b3MvVHVsdW0vc3JjL3NlcnZlci9zZXJ2aWNlcy9hdXRoL2F1dGhTZXJ2aWNlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIHNyYy9zZXJ2ZXIvc2VydmljZXMvYXV0aC9hdXRoU2VydmljZS50c1xuaW1wb3J0IHsgVXNlciB9IGZyb20gJ0BwcmlzbWEvY2xpZW50JztcbmltcG9ydCBwcmlzbWEgZnJvbSAnQC9zZXJ2ZXIvZGIvY2xpZW50JztcbmltcG9ydCB7IGNvZ25pdG9TZXJ2aWNlLCBMb2dpbkNyZWRlbnRpYWxzLCBBdXRoUmVzdWx0IH0gZnJvbSAnLi9jb2duaXRvU2VydmljZSc7XG5cbi8vIFNlcnZpY2lvIGRlIGF1dGVudGljYWNpw7NuIHF1ZSBhY3TDumEgY29tbyBmYWNoYWRhIHBhcmEgQ29nbml0b1xuZXhwb3J0IGNsYXNzIEF1dGhTZXJ2aWNlIHtcbiAgLy8gTG9naW5cbiAgYXN5bmMgbG9naW4oY3JlZGVudGlhbHM6IExvZ2luQ3JlZGVudGlhbHMpOiBQcm9taXNlPEF1dGhSZXN1bHQgfCBudWxsPiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIEF1dGVudGljYXIgY29uIENvZ25pdG9cbiAgICAgIGNvbnN0IGNvZ25pdG9SZXN1bHQgPSBhd2FpdCBjb2duaXRvU2VydmljZS5sb2dpbihjcmVkZW50aWFscyk7XG4gICAgICBcbiAgICAgIC8vIEJ1c2NhciB1c3VhcmlvIGVuIG51ZXN0cmEgQkRcbiAgICAgIGxldCB1c2VyID0gYXdhaXQgcHJpc21hLnVzZXIuZmluZEZpcnN0KHtcbiAgICAgICAgd2hlcmU6IHsgXG4gICAgICAgICAgZW1haWw6IGNyZWRlbnRpYWxzLmVtYWlsIFxuICAgICAgICB9LFxuICAgICAgICBpbmNsdWRlOiB7IFxuICAgICAgICAgIHJvbGU6IHRydWUgXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgXG4gICAgICAgICAgY29uc29sZS5sb2coJ1VzdWFyaW8gZW5jb250cmFkbzonLCB1c2VyKTtcbiAgICBjb25zb2xlLmxvZygnUm9sIGRlbCB1c3VhcmlvOicsIHVzZXI/LnJvbGUpO1xuICAgIFxuICAgICAgLy8gU2kgbm8gZXhpc3RlIGVsIHVzdWFyaW8sIGxvIGNyZWFtb3NcbiAgICAgIGlmICghdXNlcikge1xuICAgICAgICBjb25zb2xlLmxvZyhcIlVzdWFyaW8gbm8gZW5jb250cmFkbyBlbiBCRCBsb2NhbCwgY3JlYW5kby4uLlwiKTtcbiAgICAgICAgXG4gICAgICAgIC8vIEJ1c2NhciBwcmltZXJvIHVuIHJvbCAocHJlZmVyaWJsZW1lbnRlIGFkbWluKVxuICAgICAgICBsZXQgcm9sZSA9IGF3YWl0IHByaXNtYS5yb2xlLmZpbmRGaXJzdCh7XG4gICAgICAgICAgd2hlcmU6IHsgbmFtZTogJ2FkbWluJyB9XG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgLy8gU2kgbm8gZXhpc3RlIG5pbmfDum4gcm9sLCBuZWNlc2l0YW1vcyBjcmVhciBhbCBtZW5vcyB1bm9cbiAgICAgICAgaWYgKCFyb2xlKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coXCJDcmVhbmRvIHJvbCAnYWRtaW4nIHBvcnF1ZSBubyBleGlzdGVcIik7XG4gICAgICAgICAgcm9sZSA9IGF3YWl0IHByaXNtYS5yb2xlLmNyZWF0ZSh7XG4gICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgIG5hbWU6ICdhZG1pbicsXG4gICAgICAgICAgICAgIHBlcm1pc3Npb25zOiBbJyonXSAvLyBUb2RvcyBsb3MgcGVybWlzb3MgY29tbyBKU09OXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIC8vIENyZWFyIGVsIHVzdWFyaW8gY29uIGVsIHJvbCBlbmNvbnRyYWRvIG8gY3JlYWRvXG4gICAgICAgIHVzZXIgPSBhd2FpdCBwcmlzbWEudXNlci5jcmVhdGUoe1xuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIGlkOiBjb2duaXRvUmVzdWx0LnVzZXIuaWQsIC8vIFVzYXIgZWwgc3ViIGRlIENvZ25pdG8gY29tbyBJRFxuICAgICAgICAgICAgZW1haWw6IGNyZWRlbnRpYWxzLmVtYWlsLFxuICAgICAgICAgICAgbmFtZTogY29nbml0b1Jlc3VsdC51c2VyLm5hbWUgfHwgY3JlZGVudGlhbHMuZW1haWwuc3BsaXQoJ0AnKVswXSxcbiAgICAgICAgICAgIHJvbGVJZDogcm9sZS5pZCxcbiAgICAgICAgICAgIC8vIE5vIGluY2x1aW1vcyBzdWN1cnNhbElkIHlhIHF1ZSBlcyBvcGNpb25hbCBlbiB0dSBlc3F1ZW1hXG4gICAgICAgICAgfSxcbiAgICAgICAgICBpbmNsdWRlOiB7IFxuICAgICAgICAgICAgcm9sZTogdHJ1ZSBcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgY29uc29sZS5sb2coXCJVc3VhcmlvIGNyZWFkbyBleGl0b3NhbWVudGU6XCIsIHVzZXIuaWQpO1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBEZXZvbHZlbW9zIGVsIHJlc3VsdGFkbyBjb21iaW5hZG9cbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLmNvZ25pdG9SZXN1bHQsXG4gICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAuLi51c2VyLFxuICAgICAgICAgIC8vIEFzZWd1cmFyc2UgZGUgcXVlIHVzYW1vcyBsb3MgZGF0b3MgZGUgbnVlc3RyYSBCRFxuICAgICAgICAgIGlkOiB1c2VyLmlkLFxuICAgICAgICAgIHJvbGVJZDogdXNlci5yb2xlSWRcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZW4gbG9naW46JywgZXJyb3IpO1xuICAgICAgdGhyb3cgZXJyb3I7IC8vIFByb3BhZ2FyIGVsIGVycm9yIHBhcmEgcXVlIGVsIGNsaWVudGUgcHVlZGEgbWFuZWphcmxvXG4gICAgfVxuICB9XG4gIFxuICAvLyBDZXJyYXIgc2VzacOzblxuICBhc3luYyBsb2dvdXQoYWNjZXNzVG9rZW46IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCBjb2duaXRvU2VydmljZS5sb2dvdXQoYWNjZXNzVG9rZW4pO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGVuIGxvZ291dDonLCBlcnJvcik7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG4gIFxuICAvLyBSZWZyZXNjYXIgdG9rZW5cbiAgYXN5bmMgcmVmcmVzaFVzZXJUb2tlbihyZWZyZXNoVG9rZW46IHN0cmluZyk6IFByb21pc2U8T21pdDxBdXRoUmVzdWx0LCAndXNlcic+IHwgbnVsbD4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBVc2FyIGVsIGVtYWlsIGFsbWFjZW5hZG8gZW4gbG9jYWxTdG9yYWdlIHBhcmEgZWwgU0VDUkVUX0hBU0hcbiAgICAgIGxldCBlbWFpbCA9ICcnO1xuICAgICAgaWYgKHR5cGVvZiBsb2NhbFN0b3JhZ2UgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgIGVtYWlsID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3VzZXJFbWFpbCcpIHx8ICcnO1xuICAgICAgfVxuICAgICAgXG4gICAgICByZXR1cm4gYXdhaXQgY29nbml0b1NlcnZpY2UucmVmcmVzaFRva2VuKHJlZnJlc2hUb2tlbiwgZW1haWwpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBhbCByZWZyZXNjYXIgdG9rZW46JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICB9XG4gIFxuICAvLyBPYnRlbmVyIHVzdWFyaW8gcG9yIElEXG4gIGFzeW5jIGdldFVzZXJCeUlkKHVzZXJJZDogc3RyaW5nKTogUHJvbWlzZTxPbWl0PFVzZXIsICdwYXNzd29yZCc+IHwgbnVsbD4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB1c2VyID0gYXdhaXQgcHJpc21hLnVzZXIuZmluZFVuaXF1ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkOiB1c2VySWQgfSxcbiAgICAgICAgaW5jbHVkZTogeyByb2xlOiB0cnVlIH1cbiAgICAgIH0pO1xuICAgICAgXG4gICAgICBpZiAoIXVzZXIpIHJldHVybiBudWxsO1xuICAgICAgXG4gICAgICByZXR1cm4gdXNlcjtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgYWwgb2J0ZW5lciB1c3VhcmlvOicsIGVycm9yKTtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgfVxuICBcbiAgLy8gQ3JlYXIgdXN1YXJpbyAoYWRtaW4pXG4gIGFzeW5jIGNyZWF0ZVVzZXIodXNlckRhdGE6IHtcbiAgICBlbWFpbDogc3RyaW5nO1xuICAgIG5hbWU6IHN0cmluZztcbiAgICBwYXNzd29yZDogc3RyaW5nO1xuICAgIHJvbGVJZDogc3RyaW5nO1xuICAgIHN1Y3Vyc2FsSWQ/OiBzdHJpbmc7XG4gIH0pOiBQcm9taXNlPFVzZXIgfCBudWxsPiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIFZlcmlmaWNhciBxdWUgZWwgcm9sIGV4aXN0ZVxuICAgICAgY29uc3Qgcm9sZUV4aXN0cyA9IGF3YWl0IHByaXNtYS5yb2xlLmZpbmRVbmlxdWUoe1xuICAgICAgICB3aGVyZTogeyBpZDogdXNlckRhdGEucm9sZUlkIH1cbiAgICAgIH0pO1xuICAgICAgXG4gICAgICBpZiAoIXJvbGVFeGlzdHMpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBFbCByb2wgY29uIElEICR7dXNlckRhdGEucm9sZUlkfSBubyBleGlzdGVgKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gU2kgc2UgcHJvcG9yY2lvbmEgc3VjdXJzYWxJZCwgdmVyaWZpY2FyIHF1ZSBleGlzdGVcbiAgICAgIGlmICh1c2VyRGF0YS5zdWN1cnNhbElkKSB7XG4gICAgICAgIGNvbnN0IHN1Y3Vyc2FsRXhpc3RzID0gYXdhaXQgcHJpc21hLnViaWNhY2lvbi5maW5kVW5pcXVlKHtcbiAgICAgICAgICB3aGVyZTogeyBpZDogdXNlckRhdGEuc3VjdXJzYWxJZCB9XG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgaWYgKCFzdWN1cnNhbEV4aXN0cykge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgTGEgdWJpY2FjacOzbiBjb24gSUQgJHt1c2VyRGF0YS5zdWN1cnNhbElkfSBubyBleGlzdGVgKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBDcmVhciB1c3VhcmlvIGVuIENvZ25pdG9cbiAgICAgIGF3YWl0IGNvZ25pdG9TZXJ2aWNlLmNyZWF0ZVVzZXIoe1xuICAgICAgICBlbWFpbDogdXNlckRhdGEuZW1haWwsXG4gICAgICAgIG5hbWU6IHVzZXJEYXRhLm5hbWUsXG4gICAgICAgIHBhc3N3b3JkOiB1c2VyRGF0YS5wYXNzd29yZCxcbiAgICAgICAgcm9sZUlkOiB1c2VyRGF0YS5yb2xlSWRcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICAvLyBDcmVhciB1c3VhcmlvIGVuIG51ZXN0cmEgQkRcbiAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBwcmlzbWEudXNlci5jcmVhdGUoe1xuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgZW1haWw6IHVzZXJEYXRhLmVtYWlsLFxuICAgICAgICAgIG5hbWU6IHVzZXJEYXRhLm5hbWUsXG4gICAgICAgICAgcm9sZUlkOiB1c2VyRGF0YS5yb2xlSWQsXG4gICAgICAgICAgc3VjdXJzYWxJZDogdXNlckRhdGEuc3VjdXJzYWxJZCB8fCBudWxsXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgXG4gICAgICByZXR1cm4gdXNlcjtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgYWwgY3JlYXIgdXN1YXJpbzonLCBlcnJvcik7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICAvLyBSZWdpc3RyYXIgdW4gbnVldm8gdXN1YXJpb1xuICBhc3luYyByZWdpc3RlclVzZXIodXNlckRhdGE6IHtcbiAgICBlbWFpbDogc3RyaW5nO1xuICAgIG5hbWU6IHN0cmluZztcbiAgICBwYXNzd29yZDogc3RyaW5nO1xuICB9KTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG1lc3NhZ2U6IHN0cmluZzsgdXNlcklkPzogc3RyaW5nIH0+IHtcbiAgICB0cnkge1xuICAgICAgLy8gUmVnaXN0cmFyIGVuIENvZ25pdG9cbiAgICAgIGNvbnN0IGNvZ25pdG9SZXN1bHQgPSBhd2FpdCBjb2duaXRvU2VydmljZS5yZWdpc3RlclVzZXIoe1xuICAgICAgICBlbWFpbDogdXNlckRhdGEuZW1haWwsXG4gICAgICAgIG5hbWU6IHVzZXJEYXRhLm5hbWUsXG4gICAgICAgIHBhc3N3b3JkOiB1c2VyRGF0YS5wYXNzd29yZFxuICAgICAgfSk7XG4gICAgICBpZiAoIWNvZ25pdG9SZXN1bHQuc3VjY2Vzcykge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIG1lc3NhZ2U6IGNvZ25pdG9SZXN1bHQubWVzc2FnZSB8fCAnRXJyb3IgYWwgcmVnaXN0cmFyIHVzdWFyaW8gZW4gQ29nbml0bycsXG4gICAgICAgICAgdXNlcklkOiBjb2duaXRvUmVzdWx0LnVzZXJJZFxuICAgICAgICB9O1xuICAgICAgfVxuICAgICAgXG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBtZXNzYWdlOiBjb2duaXRvUmVzdWx0Lm1lc3NhZ2UgfHwgJ1VzdWFyaW8gcmVnaXN0cmFkbyBleGl0b3NhbWVudGUnLFxuICAgICAgICB1c2VySWQ6IGNvZ25pdG9SZXN1bHQudXNlcklkXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBlbiByZWdpc3RybzonLCBlcnJvcik7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogJ0Vycm9yIGFsIHJlZ2lzdHJhciB1c3VhcmlvJ1xuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICAvLyBDb25maXJtYXIgcmVnaXN0cm9cbiAgYXN5bmMgY29uZmlybVJlZ2lzdHJhdGlvbihlbWFpbDogc3RyaW5nLCBjb2RlOiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbWVzc2FnZTogc3RyaW5nIH0+IHtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIGF3YWl0IGNvZ25pdG9TZXJ2aWNlLmNvbmZpcm1SZWdpc3RyYXRpb24oZW1haWwsIGNvZGUpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBhbCBjb25maXJtYXIgcmVnaXN0cm86JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdFcnJvciBhbCBjb25maXJtYXIgZWwgcmVnaXN0cm8nXG4gICAgICB9O1xuICAgIH1cbiAgfVxuXG4gIC8vIFJlZW52aWFyIGPDs2RpZ28gZGUgY29uZmlybWFjacOzblxuICBhc3luYyByZXNlbmRDb25maXJtYXRpb25Db2RlKGVtYWlsOiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbWVzc2FnZTogc3RyaW5nIH0+IHtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIGF3YWl0IGNvZ25pdG9TZXJ2aWNlLnJlc2VuZENvbmZpcm1hdGlvbkNvZGUoZW1haWwpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBhbCByZWVudmlhciBjw7NkaWdvOicsIGVycm9yKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnRXJyb3IgYWwgcmVlbnZpYXIgZWwgY8OzZGlnbyBkZSB2ZXJpZmljYWNpw7NuJ1xuICAgICAgfTtcbiAgICB9XG4gIH1cbn1cblxuLy8gU2luZ2xldG9uIHBhcmEgdXNvIGVuIGxhIGFwbGljYWNpw7NuXG5leHBvcnQgY29uc3QgYXV0aFNlcnZpY2UgPSBuZXcgQXV0aFNlcnZpY2UoKTtcblxuLy8gRnVuY2nDs24gcGFyYSBlbCBjbGllbnRlIChmcm9udGVuZClcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiByZWZyZXNoVG9rZW4oKTogUHJvbWlzZTxib29sZWFuPiB7XG4gIGNvbnN0IHJlZnJlc2hUb2tlbiA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdyZWZyZXNoVG9rZW4nKTtcbiAgaWYgKCFyZWZyZXNoVG9rZW4pIHJldHVybiBmYWxzZTtcbiAgXG4gIHRyeSB7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCgnL2FwaS9hdXRoL3JlZnJlc2gnLCB7XG4gICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgIGhlYWRlcnM6IHsgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyB9LFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyByZWZyZXNoVG9rZW4gfSlcbiAgICB9KTtcbiAgICBcbiAgICBpZiAoIXJlc3BvbnNlLm9rKSByZXR1cm4gZmFsc2U7XG4gICAgXG4gICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICBcbiAgICAvLyBBY3R1YWxpemFyIHRva2Vuc1xuICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdhY2Nlc3NUb2tlbicsIGRhdGEuYWNjZXNzVG9rZW4pO1xuICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdpZFRva2VuJywgZGF0YS5pZFRva2VuKTtcbiAgICBcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBhbCByZWZyZXNjYXIgdG9rZW46JywgZXJyb3IpO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxufSJdLCJuYW1lcyI6WyJwcmlzbWEiLCJjb2duaXRvU2VydmljZSIsIkF1dGhTZXJ2aWNlIiwibG9naW4iLCJjcmVkZW50aWFscyIsImNvZ25pdG9SZXN1bHQiLCJ1c2VyIiwiZmluZEZpcnN0Iiwid2hlcmUiLCJlbWFpbCIsImluY2x1ZGUiLCJyb2xlIiwiY29uc29sZSIsImxvZyIsIm5hbWUiLCJjcmVhdGUiLCJkYXRhIiwicGVybWlzc2lvbnMiLCJpZCIsInNwbGl0Iiwicm9sZUlkIiwiZXJyb3IiLCJsb2dvdXQiLCJhY2Nlc3NUb2tlbiIsInJlZnJlc2hVc2VyVG9rZW4iLCJyZWZyZXNoVG9rZW4iLCJsb2NhbFN0b3JhZ2UiLCJnZXRJdGVtIiwiZ2V0VXNlckJ5SWQiLCJ1c2VySWQiLCJmaW5kVW5pcXVlIiwiY3JlYXRlVXNlciIsInVzZXJEYXRhIiwicm9sZUV4aXN0cyIsIkVycm9yIiwic3VjdXJzYWxJZCIsInN1Y3Vyc2FsRXhpc3RzIiwidWJpY2FjaW9uIiwicGFzc3dvcmQiLCJyZWdpc3RlclVzZXIiLCJzdWNjZXNzIiwibWVzc2FnZSIsImNvbmZpcm1SZWdpc3RyYXRpb24iLCJjb2RlIiwicmVzZW5kQ29uZmlybWF0aW9uQ29kZSIsImF1dGhTZXJ2aWNlIiwicmVzcG9uc2UiLCJmZXRjaCIsIm1ldGhvZCIsImhlYWRlcnMiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsIm9rIiwianNvbiIsInNldEl0ZW0iLCJpZFRva2VuIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/server/services/auth/authService.ts\n");

/***/ }),

/***/ "(rsc)/./src/server/services/auth/cognitoService.ts":
/*!****************************************************!*\
  !*** ./src/server/services/auth/cognitoService.ts ***!
  \****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   CognitoAuthService: () => (/* binding */ CognitoAuthService),\n/* harmony export */   cognitoService: () => (/* binding */ cognitoService)\n/* harmony export */ });\n/* harmony import */ var _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @aws-sdk/client-cognito-identity-provider */ \"(rsc)/./node_modules/@aws-sdk/client-cognito-identity-provider/dist-es/CognitoIdentityProviderClient.js\");\n/* harmony import */ var _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @aws-sdk/client-cognito-identity-provider */ \"(rsc)/./node_modules/@aws-sdk/client-cognito-identity-provider/dist-es/commands/SignUpCommand.js\");\n/* harmony import */ var _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @aws-sdk/client-cognito-identity-provider */ \"(rsc)/./node_modules/@aws-sdk/client-cognito-identity-provider/dist-es/commands/ConfirmSignUpCommand.js\");\n/* harmony import */ var _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @aws-sdk/client-cognito-identity-provider */ \"(rsc)/./node_modules/@aws-sdk/client-cognito-identity-provider/dist-es/commands/ResendConfirmationCodeCommand.js\");\n/* harmony import */ var _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @aws-sdk/client-cognito-identity-provider */ \"(rsc)/./node_modules/@aws-sdk/client-cognito-identity-provider/dist-es/commands/InitiateAuthCommand.js\");\n/* harmony import */ var _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @aws-sdk/client-cognito-identity-provider */ \"(rsc)/./node_modules/@aws-sdk/client-cognito-identity-provider/dist-es/commands/GetUserCommand.js\");\n/* harmony import */ var _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @aws-sdk/client-cognito-identity-provider */ \"(rsc)/./node_modules/@aws-sdk/client-cognito-identity-provider/dist-es/commands/GlobalSignOutCommand.js\");\n/* harmony import */ var _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! @aws-sdk/client-cognito-identity-provider */ \"(rsc)/./node_modules/@aws-sdk/client-cognito-identity-provider/dist-es/commands/AdminCreateUserCommand.js\");\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! crypto */ \"crypto\");\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(crypto__WEBPACK_IMPORTED_MODULE_0__);\n// src/server/services/auth/cognitoService.ts\n\n\nclass CognitoAuthService {\n    constructor(){\n        this.client = new _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_1__.CognitoIdentityProviderClient({\n            region: process.env.AWS_REGION\n        });\n        this.userPoolId = process.env.COGNITO_USER_POOL_ID;\n        this.clientId = process.env.COGNITO_CLIENT_ID;\n        this.clientSecret = process.env.COGNITO_CLIENT_SECRET;\n    }\n    // Método para calcular el SECRET_HASH\n    // En cognitoService.ts\n    calculateSecretHash(username) {\n        if (!this.clientSecret) {\n            console.error('Cliente secret no está configurado');\n            throw new Error('Client secret is not configured');\n        }\n        // El formato correcto es USERNAME + CLIENT_ID\n        const message = username + this.clientId;\n        const hmac = crypto__WEBPACK_IMPORTED_MODULE_0__.createHmac('sha256', this.clientSecret);\n        hmac.update(message);\n        return hmac.digest('base64');\n    }\n    // Registrar un nuevo usuario\n    async registerUser(params) {\n        try {\n            const { email, password, name } = params;\n            // Crear el usuario en Cognito\n            const signUpCommand = new _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_2__.SignUpCommand({\n                ClientId: this.clientId,\n                Username: email,\n                Password: password,\n                SecretHash: this.calculateSecretHash(email),\n                UserAttributes: [\n                    {\n                        Name: 'email',\n                        Value: email\n                    },\n                    {\n                        Name: 'name',\n                        Value: name\n                    }\n                ]\n            });\n            const response = await this.client.send(signUpCommand);\n            return {\n                success: true,\n                userId: response.UserSub,\n                message: 'Usuario registrado correctamente. Por favor, verifique su correo electrónico para completar el registro.'\n            };\n        } catch (error) {\n            console.error('Error al registrar usuario:', error);\n            // Manejar errores específicos\n            if (error.name === 'UsernameExistsException') {\n                return {\n                    success: false,\n                    message: 'El correo electrónico ya está registrado.'\n                };\n            }\n            if (error.name === 'InvalidPasswordException') {\n                return {\n                    success: false,\n                    message: 'La contraseña no cumple con los requisitos de seguridad.'\n                };\n            }\n            throw error;\n        }\n    }\n    // Confirmar el registro con el código de verificación\n    async confirmRegistration(email, confirmationCode) {\n        try {\n            const command = new _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_3__.ConfirmSignUpCommand({\n                ClientId: this.clientId,\n                Username: email,\n                ConfirmationCode: confirmationCode,\n                SecretHash: this.calculateSecretHash(email) // Añadir SECRET_HASH\n            });\n            await this.client.send(command);\n            return {\n                success: true,\n                message: 'Registro confirmado correctamente.'\n            };\n        } catch (error) {\n            console.error('Error al confirmar registro:', error);\n            if (error.name === 'CodeMismatchException') {\n                return {\n                    success: false,\n                    message: 'El código de verificación es incorrecto.'\n                };\n            }\n            if (error.name === 'ExpiredCodeException') {\n                return {\n                    success: false,\n                    message: 'El código de verificación ha expirado.'\n                };\n            }\n            return {\n                success: false,\n                message: 'Error al confirmar el registro. Por favor, intente nuevamente.'\n            };\n        }\n    }\n    // Reenviar código de confirmación\n    async resendConfirmationCode(email) {\n        try {\n            const command = new _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_4__.ResendConfirmationCodeCommand({\n                ClientId: this.clientId,\n                Username: email,\n                SecretHash: this.calculateSecretHash(email) // Añadir SECRET_HASH\n            });\n            await this.client.send(command);\n            return {\n                success: true,\n                message: 'Se ha enviado un nuevo código de verificación a su correo electrónico.'\n            };\n        } catch (error) {\n            console.error('Error al reenviar código:', error);\n            return {\n                success: false,\n                message: 'Error al reenviar el código de verificación. Por favor, intente nuevamente.'\n            };\n        }\n    }\n    // Login con Cognito\n    // En login de cognitoService.ts\n    async login(credentials) {\n        try {\n            const { email, password } = credentials;\n            console.log(\"1. Iniciando login con Cognito para:\", email);\n            // Verificar que tenemos los valores de configuración\n            console.log(\"2. Verificando configuración:\", {\n                region: process.env.AWS_REGION,\n                userPoolId: this.userPoolId?.substring(0, 5) + '...',\n                clientId: this.clientId?.substring(0, 5) + '...',\n                hasSecret: !!this.clientSecret\n            });\n            // Si usamos secreto, calcular SECRET_HASH\n            let secretHash;\n            if (this.clientSecret) {\n                try {\n                    secretHash = this.calculateSecretHash(email);\n                    console.log(\"3. SECRET_HASH calculado correctamente\");\n                } catch (error) {\n                    console.error(\"Error al calcular SECRET_HASH:\", error);\n                    throw error;\n                }\n            }\n            // Crear parámetros de autenticación\n            const authParams = {\n                USERNAME: email,\n                PASSWORD: password\n            };\n            // Añadir SECRET_HASH si existe\n            if (secretHash) {\n                authParams.SECRET_HASH = secretHash;\n            }\n            console.log(\"4. Parámetros de autenticación preparados\");\n            const command = new _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_5__.InitiateAuthCommand({\n                AuthFlow: \"USER_PASSWORD_AUTH\",\n                ClientId: this.clientId,\n                AuthParameters: authParams\n            });\n            console.log(\"5. Enviando solicitud a Cognito...\");\n            const response = await this.client.send(command);\n            console.log(\"6. Respuesta recibida de Cognito:\", response?.AuthenticationResult ? \"Con tokens\" : \"Sin tokens\", response?.ChallengeName ? `Desafío: ${response.ChallengeName}` : \"Sin desafío\");\n            if (!response.AuthenticationResult) {\n                if (response.ChallengeName) {\n                    throw new Error(`Se requiere completar desafío: ${response.ChallengeName}`);\n                }\n                throw new Error('Error de autenticación: No se recibieron tokens de autenticación');\n            }\n            // Obtener información del usuario autenticado\n            console.log(\"7. Obteniendo información del usuario...\");\n            const userInfo = await this.getUserInfo(response.AuthenticationResult.AccessToken);\n            console.log(\"8. Información de usuario obtenida:\", userInfo.email);\n            return {\n                user: userInfo,\n                accessToken: response.AuthenticationResult.AccessToken,\n                refreshToken: response.AuthenticationResult.RefreshToken,\n                idToken: response.AuthenticationResult.IdToken,\n                expiresIn: response.AuthenticationResult.ExpiresIn || 3600\n            };\n        } catch (error) {\n            console.error('Error detallado en login Cognito:', error);\n            if (error.$metadata) {\n                console.error('Metadatos del error:', error.$metadata);\n            }\n            if (error.__type) {\n                console.error('Tipo de error AWS:', error.__type);\n            }\n            if (error.message) {\n                console.error('Mensaje de error:', error.message);\n            }\n            throw error;\n        }\n    }\n    // Obtener información del usuario desde Cognito\n    async getUserInfo(accessToken) {\n        try {\n            const command = new _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_6__.GetUserCommand({\n                AccessToken: accessToken\n            });\n            const response = await this.client.send(command);\n            // Mapear atributos de Cognito a nuestro modelo de usuario\n            const attributes = response.UserAttributes || [];\n            const email = attributes.find((attr)=>attr.Name === 'email')?.Value || '';\n            const name = attributes.find((attr)=>attr.Name === 'name')?.Value || '';\n            const sub = attributes.find((attr)=>attr.Name === 'sub')?.Value || '';\n            // Aquí deberíamos obtener el usuario de nuestra base de datos\n            // usando el sub como identificador externo\n            // Por ahora, devolvemos un usuario básico\n            return {\n                id: sub,\n                email,\n                name,\n                roleId: 'user',\n                createdAt: new Date(),\n                updatedAt: new Date(),\n                sucursalId: null\n            };\n        } catch (error) {\n            console.error('Error al obtener info de usuario:', error);\n            throw error;\n        }\n    }\n    // Cerrar sesión\n    async logout(accessToken) {\n        try {\n            const command = new _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_7__.GlobalSignOutCommand({\n                AccessToken: accessToken\n            });\n            await this.client.send(command);\n        } catch (error) {\n            console.error('Error al cerrar sesión:', error);\n            throw error;\n        }\n    }\n    async refreshToken(refreshToken, email) {\n        try {\n            // Si tenemos email, usarlo; de lo contrario, intentar extraerlo del token\n            let username = email || '';\n            // Si no tenemos username, no podemos generar SECRET_HASH\n            if (!username && this.clientSecret) {\n                throw new Error('Se requiere el email para el refresh token cuando se usa client secret');\n            }\n            // Parámetros para el refresh token\n            const authParams = {\n                REFRESH_TOKEN: refreshToken\n            };\n            // Añadir SECRET_HASH si tenemos username y clientSecret\n            if (username && this.clientSecret) {\n                authParams.SECRET_HASH = this.calculateSecretHash(username);\n            }\n            const command = new _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_5__.InitiateAuthCommand({\n                AuthFlow: \"REFRESH_TOKEN_AUTH\",\n                ClientId: this.clientId,\n                AuthParameters: authParams\n            });\n            const response = await this.client.send(command);\n            if (!response.AuthenticationResult) {\n                throw new Error('Error al refrescar token');\n            }\n            return {\n                accessToken: response.AuthenticationResult.AccessToken,\n                idToken: response.AuthenticationResult.IdToken,\n                refreshToken: refreshToken,\n                expiresIn: response.AuthenticationResult.ExpiresIn || 3600\n            };\n        } catch (error) {\n            console.error('Error al refrescar token:', error);\n            throw error;\n        }\n    }\n    // Crear usuario (solo admin)\n    async createUser(user) {\n        try {\n            const command = new _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_8__.AdminCreateUserCommand({\n                UserPoolId: this.userPoolId,\n                Username: user.email,\n                TemporaryPassword: user.password,\n                UserAttributes: [\n                    {\n                        Name: 'email',\n                        Value: user.email\n                    },\n                    {\n                        Name: 'email_verified',\n                        Value: 'true'\n                    },\n                    {\n                        Name: 'name',\n                        Value: user.name\n                    },\n                    {\n                        Name: 'custom:role',\n                        Value: user.roleId\n                    }\n                ]\n            });\n            await this.client.send(command);\n        // Aquí deberíamos crear también el usuario en nuestra BD\n        // y vincular el id de Cognito\n        } catch (error) {\n            console.error('Error al crear usuario:', error);\n            throw error;\n        }\n    }\n}\n// Singleton para uso en la aplicación\nconst cognitoService = new CognitoAuthService();\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmVyL3NlcnZpY2VzL2F1dGgvY29nbml0b1NlcnZpY2UudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsNkNBQTZDO0FBWU07QUFFbEI7QUFzQjFCLE1BQU1TO0lBTWJDLGFBQWM7UUFDWixJQUFJLENBQUNDLE1BQU0sR0FBRyxJQUFJWCxvR0FBNkJBLENBQUM7WUFDOUNZLFFBQVFDLFFBQVFDLEdBQUcsQ0FBQ0MsVUFBVTtRQUNoQztRQUVBLElBQUksQ0FBQ0MsVUFBVSxHQUFHSCxRQUFRQyxHQUFHLENBQUNHLG9CQUFvQjtRQUNsRCxJQUFJLENBQUNDLFFBQVEsR0FBR0wsUUFBUUMsR0FBRyxDQUFDSyxpQkFBaUI7UUFDN0MsSUFBSSxDQUFDQyxZQUFZLEdBQUdQLFFBQVFDLEdBQUcsQ0FBQ08scUJBQXFCO0lBQ3ZEO0lBRUEsc0NBQXNDO0lBQ3RDLHVCQUF1QjtJQUNmQyxvQkFBb0JDLFFBQWdCLEVBQVU7UUFDcEQsSUFBSSxDQUFDLElBQUksQ0FBQ0gsWUFBWSxFQUFFO1lBQ3RCSSxRQUFRQyxLQUFLLENBQUM7WUFDZCxNQUFNLElBQUlDLE1BQU07UUFDbEI7UUFFQSw4Q0FBOEM7UUFDOUMsTUFBTUMsVUFBVUosV0FBVyxJQUFJLENBQUNMLFFBQVE7UUFDeEMsTUFBTVUsT0FBT3BCLDhDQUFpQixDQUFDLFVBQVUsSUFBSSxDQUFDWSxZQUFZO1FBQzFEUSxLQUFLRSxNQUFNLENBQUNIO1FBQ1osT0FBT0MsS0FBS0csTUFBTSxDQUFDO0lBQ3JCO0lBRUEsNkJBQTZCO0lBQzdCLE1BQU1DLGFBQWFDLE1BQTBCLEVBQW9FO1FBQy9HLElBQUk7WUFDRixNQUFNLEVBQUVDLEtBQUssRUFBRUMsUUFBUSxFQUFFQyxJQUFJLEVBQUUsR0FBR0g7WUFFbEMsOEJBQThCO1lBQzlCLE1BQU1JLGdCQUFnQixJQUFJaEMsb0ZBQWFBLENBQUM7Z0JBQ3RDaUMsVUFBVSxJQUFJLENBQUNwQixRQUFRO2dCQUN2QnFCLFVBQVVMO2dCQUNW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QjtpQkFDRDtZQUNIO1lBRUEsTUFBTSxJQUFJLENBQUM1RSxNQUFNLENBQUNtQyxJQUFJLENBQUNNO1FBRXZCLHlEQUF5RDtRQUN6RCw4QkFBOEI7UUFDaEMsRUFBRSxPQUFPM0IsT0FBTztZQUNkRCxRQUFRQyxLQUFLLENBQUMsMkJBQTJCQTtZQUN6QyxNQUFNQTtRQUNSO0lBQ0Y7QUFDQTtBQUVBLHNDQUFzQztBQUMvQixNQUFNd0UsaUJBQWlCLElBQUl4RixxQkFBcUIiLCJzb3VyY2VzIjpbIi9Vc2Vycy9nYXN0b25tb3JhL0Rlc2t0b3AvUHJveWVjdG9zL1R1bHVtL3NyYy9zZXJ2ZXIvc2VydmljZXMvYXV0aC9jb2duaXRvU2VydmljZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBzcmMvc2VydmVyL3NlcnZpY2VzL2F1dGgvY29nbml0b1NlcnZpY2UudHNcbmltcG9ydCB7IFxuICBDb2duaXRvSWRlbnRpdHlQcm92aWRlckNsaWVudCwgXG4gIEluaXRpYXRlQXV0aENvbW1hbmQsXG4gIFJlc3BvbmRUb0F1dGhDaGFsbGVuZ2VDb21tYW5kLFxuICBHZXRVc2VyQ29tbWFuZCxcbiAgQWRtaW5HZXRVc2VyQ29tbWFuZCxcbiAgQWRtaW5DcmVhdGVVc2VyQ29tbWFuZCxcbiAgR2xvYmFsU2lnbk91dENvbW1hbmQsXG4gIFNpZ25VcENvbW1hbmQsXG4gIENvbmZpcm1TaWduVXBDb21tYW5kLFxuICBSZXNlbmRDb25maXJtYXRpb25Db2RlQ29tbWFuZFxufSBmcm9tIFwiQGF3cy1zZGsvY2xpZW50LWNvZ25pdG8taWRlbnRpdHktcHJvdmlkZXJcIjtcbmltcG9ydCB7IHR5cGUgVXNlciB9IGZyb20gJ0BwcmlzbWEvY2xpZW50JztcbmltcG9ydCAqIGFzIGNyeXB0byBmcm9tICdjcnlwdG8nO1xuXG5pbnRlcmZhY2UgUmVnaXN0ZXJVc2VyUGFyYW1zIHtcbmVtYWlsOiBzdHJpbmc7XG5wYXNzd29yZDogc3RyaW5nO1xubmFtZTogc3RyaW5nO1xufVxuXG4vLyBJbnRlcmZhY2VzXG5leHBvcnQgaW50ZXJmYWNlIExvZ2luQ3JlZGVudGlhbHMge1xuICBlbWFpbDogc3RyaW5nO1xuICBwYXNzd29yZDogc3RyaW5nO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEF1dGhSZXN1bHQge1xudXNlcjogT21pdDxVc2VyLCAncGFzc3dvcmQnPjtcbmFjY2Vzc1Rva2VuOiBzdHJpbmc7XG5yZWZyZXNoVG9rZW46IHN0cmluZztcbmlkVG9rZW46IHN0cmluZztcbmV4cGlyZXNJbjogbnVtYmVyO1xufVxuXG5leHBvcnQgY2xhc3MgQ29nbml0b0F1dGhTZXJ2aWNlIHtcbnByaXZhdGUgY2xpZW50OiBDb2duaXRvSWRlbnRpdHlQcm92aWRlckNsaWVudDtcbnByaXZhdGUgdXNlclBvb2xJZDogc3RyaW5nO1xucHJpdmF0ZSBjbGllbnRJZDogc3RyaW5nO1xucHJpdmF0ZSBjbGllbnRTZWNyZXQ6IHN0cmluZztcblxuY29uc3RydWN0b3IoKSB7XG4gIHRoaXMuY2xpZW50ID0gbmV3IENvZ25pdG9JZGVudGl0eVByb3ZpZGVyQ2xpZW50KHtcbiAgICByZWdpb246IHByb2Nlc3MuZW52LkFXU19SRUdJT04gYXMgc3RyaW5nXG4gIH0pO1xuICBcbiAgdGhpcy51c2VyUG9vbElkID0gcHJvY2Vzcy5lbnYuQ09HTklUT19VU0VSX1BPT0xfSUQgYXMgc3RyaW5nO1xuICB0aGlzLmNsaWVudElkID0gcHJvY2Vzcy5lbnYuQ09HTklUT19DTElFTlRfSUQgYXMgc3RyaW5nO1xuICB0aGlzLmNsaWVudFNlY3JldCA9IHByb2Nlc3MuZW52LkNPR05JVE9fQ0xJRU5UX1NFQ1JFVCBhcyBzdHJpbmc7XG59XG5cbi8vIE3DqXRvZG8gcGFyYSBjYWxjdWxhciBlbCBTRUNSRVRfSEFTSFxuLy8gRW4gY29nbml0b1NlcnZpY2UudHNcbnByaXZhdGUgY2FsY3VsYXRlU2VjcmV0SGFzaCh1c2VybmFtZTogc3RyaW5nKTogc3RyaW5nIHtcbiAgaWYgKCF0aGlzLmNsaWVudFNlY3JldCkge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0NsaWVudGUgc2VjcmV0IG5vIGVzdMOhIGNvbmZpZ3VyYWRvJyk7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdDbGllbnQgc2VjcmV0IGlzIG5vdCBjb25maWd1cmVkJyk7XG4gIH1cbiAgXG4gIC8vIEVsIGZvcm1hdG8gY29ycmVjdG8gZXMgVVNFUk5BTUUgKyBDTElFTlRfSURcbiAgY29uc3QgbWVzc2FnZSA9IHVzZXJuYW1lICsgdGhpcy5jbGllbnRJZDtcbiAgY29uc3QgaG1hYyA9IGNyeXB0by5jcmVhdGVIbWFjKCdzaGEyNTYnLCB0aGlzLmNsaWVudFNlY3JldCk7XG4gIGhtYWMudXBkYXRlKG1lc3NhZ2UpO1xuICByZXR1cm4gaG1hYy5kaWdlc3QoJ2Jhc2U2NCcpO1xufVxuXG4vLyBSZWdpc3RyYXIgdW4gbnVldm8gdXN1YXJpb1xuYXN5bmMgcmVnaXN0ZXJVc2VyKHBhcmFtczogUmVnaXN0ZXJVc2VyUGFyYW1zKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IHVzZXJJZD86IHN0cmluZzsgbWVzc2FnZT86IHN0cmluZyB9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgeyBlbWFpbCwgcGFzc3dvcmQsIG5hbWUgfSA9IHBhcmFtcztcbiAgICBcbiAgICAvLyBDcmVhciBlbCB1c3VhcmlvIGVuIENvZ25pdG9cbiAgICBjb25zdCBzaWduVXBDb21tYW5kID0gbmV3IFNpZ25VcENvbW1hbmQoe1xuICAgICAgQ2xpZW50SWQ6IHRoaXMuY2xpZW50SWQsXG4gICAgICBVc2VybmFtZTogZW1haWwsXG4gICAgICBQYXNzd29yZDogcGFzc3dvcmQsXG4gICAgICBTZWNyZXRIYXNoOiB0aGlzLmNhbGN1bGF0ZVNlY3JldEhhc2goZW1haWwpLCAvLyBBw7FhZGlyIFNFQ1JFVF9IQVNIXG4gICAgICBVc2VyQXR0cmlidXRlczogW1xuICAgICAgICB7XG4gICAgICAgICAgTmFtZTogJ2VtYWlsJyxcbiAgICAgICAgICBWYWx1ZTogZW1haWxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIE5hbWU6ICduYW1lJyxcbiAgICAgICAgICBWYWx1ZTogbmFtZVxuICAgICAgICB9XG4gICAgICBdXG4gICAgfSk7XG4gICAgXG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLmNsaWVudC5zZW5kKHNpZ25VcENvbW1hbmQpO1xuICAgIFxuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgdXNlcklkOiByZXNwb25zZS5Vc2VyU3ViLFxuICAgICAgbWVzc2FnZTogJ1VzdWFyaW8gcmVnaXN0cmFkbyBjb3JyZWN0YW1lbnRlLiBQb3IgZmF2b3IsIHZlcmlmaXF1ZSBzdSBjb3JyZW8gZWxlY3Ryw7NuaWNvIHBhcmEgY29tcGxldGFyIGVsIHJlZ2lzdHJvLidcbiAgICB9O1xuICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgYWwgcmVnaXN0cmFyIHVzdWFyaW86JywgZXJyb3IpO1xuICAgIFxuICAgIC8vIE1hbmVqYXIgZXJyb3JlcyBlc3BlY8OtZmljb3NcbiAgICBpZiAoZXJyb3IubmFtZSA9PT0gJ1VzZXJuYW1lRXhpc3RzRXhjZXB0aW9uJykge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdFbCBjb3JyZW8gZWxlY3Ryw7NuaWNvIHlhIGVzdMOhIHJlZ2lzdHJhZG8uJ1xuICAgICAgfTtcbiAgICB9XG4gICAgXG4gICAgaWYgKGVycm9yLm5hbWUgPT09ICdJbnZhbGlkUGFzc3dvcmRFeGNlcHRpb24nKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogJ0xhIGNvbnRyYXNlw7FhIG5vIGN1bXBsZSBjb24gbG9zIHJlcXVpc2l0b3MgZGUgc2VndXJpZGFkLidcbiAgICAgIH07XG4gICAgfVxuICAgIFxuICAgIHRocm93IGVycm9yO1xuICB9XG59XG5cbi8vIENvbmZpcm1hciBlbCByZWdpc3RybyBjb24gZWwgY8OzZGlnbyBkZSB2ZXJpZmljYWNpw7NuXG5hc3luYyBjb25maXJtUmVnaXN0cmF0aW9uKGVtYWlsOiBzdHJpbmcsIGNvbmZpcm1hdGlvbkNvZGU6IHN0cmluZyk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuOyBtZXNzYWdlOiBzdHJpbmcgfT4ge1xuICB0cnkge1xuICAgIGNvbnN0IGNvbW1hbmQgPSBuZXcgQ29uZmlybVNpZ25VcENvbW1hbmQoe1xuICAgICAgQ2xpZW50SWQ6IHRoaXMuY2xpZW50SWQsXG4gICAgICBVc2VybmFtZTogZW1haWwsXG4gICAgICBDb25maXJtYXRpb25Db2RlOiBjb25maXJtYXRpb25Db2RlLFxuICAgICAgU2VjcmV0SGFzaDogdGhpcy5jYWxjdWxhdGVTZWNyZXRIYXNoKGVtYWlsKSAvLyBBw7FhZGlyIFNFQ1JFVF9IQVNIXG4gICAgfSk7XG4gICAgXG4gICAgYXdhaXQgdGhpcy5jbGllbnQuc2VuZChjb21tYW5kKTtcbiAgICBcbiAgICByZXR1cm4ge1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIG1lc3NhZ2U6ICdSZWdpc3RybyBjb25maXJtYWRvIGNvcnJlY3RhbWVudGUuJ1xuICAgIH07XG4gIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBhbCBjb25maXJtYXIgcmVnaXN0cm86JywgZXJyb3IpO1xuICAgIFxuICAgIGlmIChlcnJvci5uYW1lID09PSAnQ29kZU1pc21hdGNoRXhjZXB0aW9uJykge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdFbCBjw7NkaWdvIGRlIHZlcmlmaWNhY2nDs24gZXMgaW5jb3JyZWN0by4nXG4gICAgICB9O1xuICAgIH1cbiAgICBcbiAgICBpZiAoZXJyb3IubmFtZSA9PT0gJ0V4cGlyZWRDb2RlRXhjZXB0aW9uJykge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdFbCBjw7NkaWdvIGRlIHZlcmlmaWNhY2nDs24gaGEgZXhwaXJhZG8uJ1xuICAgICAgfTtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgbWVzc2FnZTogJ0Vycm9yIGFsIGNvbmZpcm1hciBlbCByZWdpc3Ryby4gUG9yIGZhdm9yLCBpbnRlbnRlIG51ZXZhbWVudGUuJ1xuICAgIH07XG4gIH1cbn1cblxuLy8gUmVlbnZpYXIgY8OzZGlnbyBkZSBjb25maXJtYWNpw7NuXG5hc3luYyByZXNlbmRDb25maXJtYXRpb25Db2RlKGVtYWlsOiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbWVzc2FnZTogc3RyaW5nIH0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBjb21tYW5kID0gbmV3IFJlc2VuZENvbmZpcm1hdGlvbkNvZGVDb21tYW5kKHtcbiAgICAgIENsaWVudElkOiB0aGlzLmNsaWVudElkLFxuICAgICAgVXNlcm5hbWU6IGVtYWlsLFxuICAgICAgU2VjcmV0SGFzaDogdGhpcy5jYWxjdWxhdGVTZWNyZXRIYXNoKGVtYWlsKSAvLyBBw7FhZGlyIFNFQ1JFVF9IQVNIXG4gICAgfSk7XG4gICAgXG4gICAgYXdhaXQgdGhpcy5jbGllbnQuc2VuZChjb21tYW5kKTtcbiAgICBcbiAgICByZXR1cm4ge1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIG1lc3NhZ2U6ICdTZSBoYSBlbnZpYWRvIHVuIG51ZXZvIGPDs2RpZ28gZGUgdmVyaWZpY2FjacOzbiBhIHN1IGNvcnJlbyBlbGVjdHLDs25pY28uJ1xuICAgIH07XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgYWwgcmVlbnZpYXIgY8OzZGlnbzonLCBlcnJvcik7XG4gICAgXG4gICAgcmV0dXJuIHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgbWVzc2FnZTogJ0Vycm9yIGFsIHJlZW52aWFyIGVsIGPDs2RpZ28gZGUgdmVyaWZpY2FjacOzbi4gUG9yIGZhdm9yLCBpbnRlbnRlIG51ZXZhbWVudGUuJ1xuICAgIH07XG4gIH1cbn1cblxuLy8gTG9naW4gY29uIENvZ25pdG9cbi8vIEVuIGxvZ2luIGRlIGNvZ25pdG9TZXJ2aWNlLnRzXG5hc3luYyBsb2dpbihjcmVkZW50aWFsczogTG9naW5DcmVkZW50aWFscyk6IFByb21pc2U8QXV0aFJlc3VsdD4ge1xuICB0cnkge1xuICAgIGNvbnN0IHsgZW1haWwsIHBhc3N3b3JkIH0gPSBjcmVkZW50aWFscztcbiAgICBjb25zb2xlLmxvZyhcIjEuIEluaWNpYW5kbyBsb2dpbiBjb24gQ29nbml0byBwYXJhOlwiLCBlbWFpbCk7XG4gICAgXG4gICAgLy8gVmVyaWZpY2FyIHF1ZSB0ZW5lbW9zIGxvcyB2YWxvcmVzIGRlIGNvbmZpZ3VyYWNpw7NuXG4gICAgY29uc29sZS5sb2coXCIyLiBWZXJpZmljYW5kbyBjb25maWd1cmFjacOzbjpcIiwge1xuICAgICAgcmVnaW9uOiBwcm9jZXNzLmVudi5BV1NfUkVHSU9OLFxuICAgICAgdXNlclBvb2xJZDogdGhpcy51c2VyUG9vbElkPy5zdWJzdHJpbmcoMCwgNSkgKyAnLi4uJyxcbiAgICAgIGNsaWVudElkOiB0aGlzLmNsaWVudElkPy5zdWJzdHJpbmcoMCwgNSkgKyAnLi4uJyxcbiAgICAgIGhhc1NlY3JldDogISF0aGlzLmNsaWVudFNlY3JldFxuICAgIH0pO1xuICAgIFxuICAgIC8vIFNpIHVzYW1vcyBzZWNyZXRvLCBjYWxjdWxhciBTRUNSRVRfSEFTSFxuICAgIGxldCBzZWNyZXRIYXNoO1xuICAgIGlmICh0aGlzLmNsaWVudFNlY3JldCkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgc2VjcmV0SGFzaCA9IHRoaXMuY2FsY3VsYXRlU2VjcmV0SGFzaChlbWFpbCk7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiMy4gU0VDUkVUX0hBU0ggY2FsY3VsYWRvIGNvcnJlY3RhbWVudGVcIik7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgYWwgY2FsY3VsYXIgU0VDUkVUX0hBU0g6XCIsIGVycm9yKTtcbiAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIC8vIENyZWFyIHBhcsOhbWV0cm9zIGRlIGF1dGVudGljYWNpw7NuXG4gICAgY29uc3QgYXV0aFBhcmFtczogUmVjb3JkPHN0cmluZywgc3RyaW5nPiA9IHtcbiAgICAgIFVTRVJOQU1FOiBlbWFpbCxcbiAgICAgIFBBU1NXT1JEOiBwYXNzd29yZFxuICAgIH07XG4gICAgXG4gICAgLy8gQcOxYWRpciBTRUNSRVRfSEFTSCBzaSBleGlzdGVcbiAgICBpZiAoc2VjcmV0SGFzaCkge1xuICAgICAgYXV0aFBhcmFtcy5TRUNSRVRfSEFTSCA9IHNlY3JldEhhc2g7XG4gICAgfVxuICAgIFxuICAgIGNvbnNvbGUubG9nKFwiNC4gUGFyw6FtZXRyb3MgZGUgYXV0ZW50aWNhY2nDs24gcHJlcGFyYWRvc1wiKTtcbiAgICBcbiAgICBjb25zdCBjb21tYW5kID0gbmV3IEluaXRpYXRlQXV0aENvbW1hbmQoe1xuICAgICAgQXV0aEZsb3c6IFwiVVNFUl9QQVNTV09SRF9BVVRIXCIsXG4gICAgICBDbGllbnRJZDogdGhpcy5jbGllbnRJZCxcbiAgICAgIEF1dGhQYXJhbWV0ZXJzOiBhdXRoUGFyYW1zXG4gICAgfSk7XG4gICAgXG4gICAgY29uc29sZS5sb2coXCI1LiBFbnZpYW5kbyBzb2xpY2l0dWQgYSBDb2duaXRvLi4uXCIpO1xuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy5jbGllbnQuc2VuZChjb21tYW5kKTtcbiAgICBjb25zb2xlLmxvZyhcIjYuIFJlc3B1ZXN0YSByZWNpYmlkYSBkZSBDb2duaXRvOlwiLCBcbiAgICAgIHJlc3BvbnNlPy5BdXRoZW50aWNhdGlvblJlc3VsdCA/IFwiQ29uIHRva2Vuc1wiIDogXCJTaW4gdG9rZW5zXCIsXG4gICAgICByZXNwb25zZT8uQ2hhbGxlbmdlTmFtZSA/IGBEZXNhZsOtbzogJHtyZXNwb25zZS5DaGFsbGVuZ2VOYW1lfWAgOiBcIlNpbiBkZXNhZsOtb1wiXG4gICAgKTtcbiAgICBcbiAgICBpZiAoIXJlc3BvbnNlLkF1dGhlbnRpY2F0aW9uUmVzdWx0KSB7XG4gICAgICBpZiAocmVzcG9uc2UuQ2hhbGxlbmdlTmFtZSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFNlIHJlcXVpZXJlIGNvbXBsZXRhciBkZXNhZsOtbzogJHtyZXNwb25zZS5DaGFsbGVuZ2VOYW1lfWApO1xuICAgICAgfVxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdFcnJvciBkZSBhdXRlbnRpY2FjacOzbjogTm8gc2UgcmVjaWJpZXJvbiB0b2tlbnMgZGUgYXV0ZW50aWNhY2nDs24nKTtcbiAgICB9XG4gICAgXG4gICAgLy8gT2J0ZW5lciBpbmZvcm1hY2nDs24gZGVsIHVzdWFyaW8gYXV0ZW50aWNhZG9cbiAgICBjb25zb2xlLmxvZyhcIjcuIE9idGVuaWVuZG8gaW5mb3JtYWNpw7NuIGRlbCB1c3VhcmlvLi4uXCIpO1xuICAgIGNvbnN0IHVzZXJJbmZvID0gYXdhaXQgdGhpcy5nZXRVc2VySW5mbyhyZXNwb25zZS5BdXRoZW50aWNhdGlvblJlc3VsdC5BY2Nlc3NUb2tlbiBhcyBzdHJpbmcpO1xuICAgIGNvbnNvbGUubG9nKFwiOC4gSW5mb3JtYWNpw7NuIGRlIHVzdWFyaW8gb2J0ZW5pZGE6XCIsIHVzZXJJbmZvLmVtYWlsKTtcbiAgICBcbiAgICByZXR1cm4ge1xuICAgICAgdXNlcjogdXNlckluZm8sXG4gICAgICBhY2Nlc3NUb2tlbjogcmVzcG9uc2UuQXV0aGVudGljYXRpb25SZXN1bHQuQWNjZXNzVG9rZW4gYXMgc3RyaW5nLFxuICAgICAgcmVmcmVzaFRva2VuOiByZXNwb25zZS5BdXRoZW50aWNhdGlvblJlc3VsdC5SZWZyZXNoVG9rZW4gYXMgc3RyaW5nLFxuICAgICAgaWRUb2tlbjogcmVzcG9uc2UuQXV0aGVudGljYXRpb25SZXN1bHQuSWRUb2tlbiBhcyBzdHJpbmcsXG4gICAgICBleHBpcmVzSW46IHJlc3BvbnNlLkF1dGhlbnRpY2F0aW9uUmVzdWx0LkV4cGlyZXNJbiB8fCAzNjAwXG4gICAgfTtcbiAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGRldGFsbGFkbyBlbiBsb2dpbiBDb2duaXRvOicsIGVycm9yKTtcbiAgICBpZiAoZXJyb3IuJG1ldGFkYXRhKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdNZXRhZGF0b3MgZGVsIGVycm9yOicsIGVycm9yLiRtZXRhZGF0YSk7XG4gICAgfVxuICAgIGlmIChlcnJvci5fX3R5cGUpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1RpcG8gZGUgZXJyb3IgQVdTOicsIGVycm9yLl9fdHlwZSk7XG4gICAgfVxuICAgIGlmIChlcnJvci5tZXNzYWdlKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdNZW5zYWplIGRlIGVycm9yOicsIGVycm9yLm1lc3NhZ2UpO1xuICAgIH1cbiAgICB0aHJvdyBlcnJvcjtcbiAgfVxufVxuXG4vLyBPYnRlbmVyIGluZm9ybWFjacOzbiBkZWwgdXN1YXJpbyBkZXNkZSBDb2duaXRvXG5wcml2YXRlIGFzeW5jIGdldFVzZXJJbmZvKGFjY2Vzc1Rva2VuOiBzdHJpbmcpOiBQcm9taXNlPE9taXQ8VXNlciwgJ3Bhc3N3b3JkJz4+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBjb21tYW5kID0gbmV3IEdldFVzZXJDb21tYW5kKHtcbiAgICAgIEFjY2Vzc1Rva2VuOiBhY2Nlc3NUb2tlblxuICAgIH0pO1xuICAgIFxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy5jbGllbnQuc2VuZChjb21tYW5kKTtcbiAgICBcbiAgICAvLyBNYXBlYXIgYXRyaWJ1dG9zIGRlIENvZ25pdG8gYSBudWVzdHJvIG1vZGVsbyBkZSB1c3VhcmlvXG4gICAgY29uc3QgYXR0cmlidXRlcyA9IHJlc3BvbnNlLlVzZXJBdHRyaWJ1dGVzIHx8IFtdO1xuICAgIGNvbnN0IGVtYWlsID0gYXR0cmlidXRlcy5maW5kKGF0dHIgPT4gYXR0ci5OYW1lID09PSAnZW1haWwnKT8uVmFsdWUgfHwgJyc7XG4gICAgY29uc3QgbmFtZSA9IGF0dHJpYnV0ZXMuZmluZChhdHRyID0+IGF0dHIuTmFtZSA9PT0gJ25hbWUnKT8uVmFsdWUgfHwgJyc7XG4gICAgY29uc3Qgc3ViID0gYXR0cmlidXRlcy5maW5kKGF0dHIgPT4gYXR0ci5OYW1lID09PSAnc3ViJyk/LlZhbHVlIHx8ICcnO1xuICAgIFxuICAgIC8vIEFxdcOtIGRlYmVyw61hbW9zIG9idGVuZXIgZWwgdXN1YXJpbyBkZSBudWVzdHJhIGJhc2UgZGUgZGF0b3NcbiAgICAvLyB1c2FuZG8gZWwgc3ViIGNvbW8gaWRlbnRpZmljYWRvciBleHRlcm5vXG4gICAgLy8gUG9yIGFob3JhLCBkZXZvbHZlbW9zIHVuIHVzdWFyaW8gYsOhc2ljb1xuICAgIFxuICAgIHJldHVybiB7XG4gICAgICBpZDogc3ViLFxuICAgICAgZW1haWwsXG4gICAgICBuYW1lLFxuICAgICAgcm9sZUlkOiAndXNlcicsIC8vIFBvciBkZWZlY3RvLCBsdWVnbyBhY3R1YWxpemFtb3MgY29uIGluZm8gZGUgQkRcbiAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIHN1Y3Vyc2FsSWQ6IG51bGxcbiAgICB9O1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGFsIG9idGVuZXIgaW5mbyBkZSB1c3VhcmlvOicsIGVycm9yKTtcbiAgICB0aHJvdyBlcnJvcjtcbiAgfVxufVxuXG4vLyBDZXJyYXIgc2VzacOzblxuYXN5bmMgbG9nb3V0KGFjY2Vzc1Rva2VuOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBjb21tYW5kID0gbmV3IEdsb2JhbFNpZ25PdXRDb21tYW5kKHtcbiAgICAgIEFjY2Vzc1Rva2VuOiBhY2Nlc3NUb2tlblxuICAgIH0pO1xuICAgIFxuICAgIGF3YWl0IHRoaXMuY2xpZW50LnNlbmQoY29tbWFuZCk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgYWwgY2VycmFyIHNlc2nDs246JywgZXJyb3IpO1xuICAgIHRocm93IGVycm9yO1xuICB9XG59XG5cbmFzeW5jIHJlZnJlc2hUb2tlbihyZWZyZXNoVG9rZW46IHN0cmluZywgZW1haWw/OiBzdHJpbmcpOiBQcm9taXNlPE9taXQ8QXV0aFJlc3VsdCwgJ3VzZXInPj4ge1xuICB0cnkge1xuICAgIC8vIFNpIHRlbmVtb3MgZW1haWwsIHVzYXJsbzsgZGUgbG8gY29udHJhcmlvLCBpbnRlbnRhciBleHRyYWVybG8gZGVsIHRva2VuXG4gICAgbGV0IHVzZXJuYW1lID0gZW1haWwgfHwgJyc7XG4gICAgXG4gICAgLy8gU2kgbm8gdGVuZW1vcyB1c2VybmFtZSwgbm8gcG9kZW1vcyBnZW5lcmFyIFNFQ1JFVF9IQVNIXG4gICAgaWYgKCF1c2VybmFtZSAmJiB0aGlzLmNsaWVudFNlY3JldCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdTZSByZXF1aWVyZSBlbCBlbWFpbCBwYXJhIGVsIHJlZnJlc2ggdG9rZW4gY3VhbmRvIHNlIHVzYSBjbGllbnQgc2VjcmV0Jyk7XG4gICAgfVxuICAgIFxuICAgIC8vIFBhcsOhbWV0cm9zIHBhcmEgZWwgcmVmcmVzaCB0b2tlblxuICAgIGNvbnN0IGF1dGhQYXJhbXM6IFJlY29yZDxzdHJpbmcsIHN0cmluZz4gPSB7XG4gICAgICBSRUZSRVNIX1RPS0VOOiByZWZyZXNoVG9rZW5cbiAgICB9O1xuICAgIFxuICAgIC8vIEHDsWFkaXIgU0VDUkVUX0hBU0ggc2kgdGVuZW1vcyB1c2VybmFtZSB5IGNsaWVudFNlY3JldFxuICAgIGlmICh1c2VybmFtZSAmJiB0aGlzLmNsaWVudFNlY3JldCkge1xuICAgICAgYXV0aFBhcmFtcy5TRUNSRVRfSEFTSCA9IHRoaXMuY2FsY3VsYXRlU2VjcmV0SGFzaCh1c2VybmFtZSk7XG4gICAgfVxuICAgIFxuICAgIGNvbnN0IGNvbW1hbmQgPSBuZXcgSW5pdGlhdGVBdXRoQ29tbWFuZCh7XG4gICAgICBBdXRoRmxvdzogXCJSRUZSRVNIX1RPS0VOX0FVVEhcIixcbiAgICAgIENsaWVudElkOiB0aGlzLmNsaWVudElkLFxuICAgICAgQXV0aFBhcmFtZXRlcnM6IGF1dGhQYXJhbXNcbiAgICB9KTtcbiAgICBcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHRoaXMuY2xpZW50LnNlbmQoY29tbWFuZCk7XG4gICAgXG4gICAgaWYgKCFyZXNwb25zZS5BdXRoZW50aWNhdGlvblJlc3VsdCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdFcnJvciBhbCByZWZyZXNjYXIgdG9rZW4nKTtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIHtcbiAgICAgIGFjY2Vzc1Rva2VuOiByZXNwb25zZS5BdXRoZW50aWNhdGlvblJlc3VsdC5BY2Nlc3NUb2tlbiBhcyBzdHJpbmcsXG4gICAgICBpZFRva2VuOiByZXNwb25zZS5BdXRoZW50aWNhdGlvblJlc3VsdC5JZFRva2VuIGFzIHN0cmluZyxcbiAgICAgIHJlZnJlc2hUb2tlbjogcmVmcmVzaFRva2VuLCAvLyBNYW50ZW5lciBlbCBtaXNtbyByZWZyZXNoIHRva2VuXG4gICAgICBleHBpcmVzSW46IHJlc3BvbnNlLkF1dGhlbnRpY2F0aW9uUmVzdWx0LkV4cGlyZXNJbiB8fCAzNjAwXG4gICAgfTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBhbCByZWZyZXNjYXIgdG9rZW46JywgZXJyb3IpO1xuICAgIHRocm93IGVycm9yO1xuICB9XG59XG5cbi8vIENyZWFyIHVzdWFyaW8gKHNvbG8gYWRtaW4pXG5hc3luYyBjcmVhdGVVc2VyKHVzZXI6IHtcbiAgZW1haWw6IHN0cmluZztcbiAgbmFtZTogc3RyaW5nO1xuICBwYXNzd29yZDogc3RyaW5nO1xuICByb2xlSWQ6IHN0cmluZztcbn0pOiBQcm9taXNlPHZvaWQ+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBjb21tYW5kID0gbmV3IEFkbWluQ3JlYXRlVXNlckNvbW1hbmQoe1xuICAgICAgVXNlclBvb2xJZDogdGhpcy51c2VyUG9vbElkLFxuICAgICAgVXNlcm5hbWU6IHVzZXIuZW1haWwsXG4gICAgICBUZW1wb3JhcnlQYXNzd29yZDogdXNlci5wYXNzd29yZCxcbiAgICAgIFVzZXJBdHRyaWJ1dGVzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBOYW1lOiAnZW1haWwnLFxuICAgICAgICAgIFZhbHVlOiB1c2VyLmVtYWlsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBOYW1lOiAnZW1haWxfdmVyaWZpZWQnLFxuICAgICAgICAgIFZhbHVlOiAndHJ1ZSdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIE5hbWU6ICduYW1lJyxcbiAgICAgICAgICBWYWx1ZTogdXNlci5uYW1lXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBOYW1lOiAnY3VzdG9tOnJvbGUnLFxuICAgICAgICAgIFZhbHVlOiB1c2VyLnJvbGVJZFxuICAgICAgICB9XG4gICAgICBdXG4gICAgfSk7XG4gICAgXG4gICAgYXdhaXQgdGhpcy5jbGllbnQuc2VuZChjb21tYW5kKTtcbiAgICBcbiAgICAvLyBBcXXDrSBkZWJlcsOtYW1vcyBjcmVhciB0YW1iacOpbiBlbCB1c3VhcmlvIGVuIG51ZXN0cmEgQkRcbiAgICAvLyB5IHZpbmN1bGFyIGVsIGlkIGRlIENvZ25pdG9cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBhbCBjcmVhciB1c3VhcmlvOicsIGVycm9yKTtcbiAgICB0aHJvdyBlcnJvcjtcbiAgfVxufVxufVxuXG4vLyBTaW5nbGV0b24gcGFyYSB1c28gZW4gbGEgYXBsaWNhY2nDs25cbmV4cG9ydCBjb25zdCBjb2duaXRvU2VydmljZSA9IG5ldyBDb2duaXRvQXV0aFNlcnZpY2UoKTsiXSwibmFtZXMiOlsiQ29nbml0b0lkZW50aXR5UHJvdmlkZXJDbGllbnQiLCJJbml0aWF0ZUF1dGhDb21tYW5kIiwiR2V0VXNlckNvbW1hbmQiLCJBZG1pbkNyZWF0ZVVzZXJDb21tYW5kIiwiR2xvYmFsU2lnbk91dENvbW1hbmQiLCJTaWduVXBDb21tYW5kIiwiQ29uZmlybVNpZ25VcENvbW1hbmQiLCJSZXNlbmRDb25maXJtYXRpb25Db2RlQ29tbWFuZCIsImNyeXB0byIsIkNvZ25pdG9BdXRoU2VydmljZSIsImNvbnN0cnVjdG9yIiwiY2xpZW50IiwicmVnaW9uIiwicHJvY2VzcyIsImVudiIsIkFXU19SRUdJT04iLCJ1c2VyUG9vbElkIiwiQ09HTklUT19VU0VSX1BPT0xfSUQiLCJjbGllbnRJZCIsIkNPR05JVE9fQ0xJRU5UX0lEIiwiY2xpZW50U2VjcmV0IiwiQ09HTklUT19DTElFTlRfU0VDUkVUIiwiY2FsY3VsYXRlU2VjcmV0SGFzaCIsInVzZXJuYW1lIiwiY29uc29sZSIsImVycm9yIiwiRXJyb3IiLCJtZXNzYWdlIiwiaG1hYyIsImNyZWF0ZUhtYWMiLCJ1cGRhdGUiLCJkaWdlc3QiLCJyZWdpc3RlclVzZXIiLCJwYXJhbXMiLCJlbWFpbCIsInBhc3N3b3JkIiwibmFtZSIsInNpZ25VcENvbW1hbmQiLCJDbGllbnRJZCIsIlVzZXJuYW1lIiwiUGFzc3dvcmQiLCJTZWNyZXRIYXNoIiwiVXNlckF0dHJpYnV0ZXMiLCJOYW1lIiwiVmFsdWUiLCJyZXNwb25zZSIsInNlbmQiLCJzdWNjZXNzIiwidXNlcklkIiwiVXNlclN1YiIsImNvbmZpcm1SZWdpc3RyYXRpb24iLCJjb25maXJtYXRpb25Db2RlIiwiY29tbWFuZCIsIkNvbmZpcm1hdGlvbkNvZGUiLCJyZXNlbmRDb25maXJtYXRpb25Db2RlIiwibG9naW4iLCJjcmVkZW50aWFscyIsImxvZyIsInN1YnN0cmluZyIsImhhc1NlY3JldCIsInNlY3JldEhhc2giLCJhdXRoUGFyYW1zIiwiVVNFUk5BTUUiLCJQQVNTV09SRCIsIlNFQ1JFVF9IQVNIIiwiQXV0aEZsb3ciLCJBdXRoUGFyYW1ldGVycyIsIkF1dGhlbnRpY2F0aW9uUmVzdWx0IiwiQ2hhbGxlbmdlTmFtZSIsInVzZXJJbmZvIiwiZ2V0VXNlckluZm8iLCJBY2Nlc3NUb2tlbiIsInVzZXIiLCJhY2Nlc3NUb2tlbiIsInJlZnJlc2hUb2tlbiIsIlJlZnJlc2hUb2tlbiIsImlkVG9rZW4iLCJJZFRva2VuIiwiZXhwaXJlc0luIiwiRXhwaXJlc0luIiwiJG1ldGFkYXRhIiwiX190eXBlIiwiYXR0cmlidXRlcyIsImZpbmQiLCJhdHRyIiwic3ViIiwiaWQiLCJyb2xlSWQiLCJjcmVhdGVkQXQiLCJEYXRlIiwidXBkYXRlZEF0Iiwic3VjdXJzYWxJZCIsImxvZ291dCIsIlJFRlJFU0hfVE9LRU4iLCJjcmVhdGVVc2VyIiwiVXNlclBvb2xJZCIsIlRlbXBvcmFyeVBhc3N3b3JkIiwiY29nbml0b1NlcnZpY2UiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/server/services/auth/cognitoService.ts\n");

/***/ }),

/***/ "(ssr)/./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true!":
/*!******************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true! ***!
  \******************************************************************************************************/
/***/ (() => {



/***/ }),

/***/ "../app-render/after-task-async-storage.external":
/*!***********************************************************************************!*\
  !*** external "next/dist/server/app-render/after-task-async-storage.external.js" ***!
  \***********************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/after-task-async-storage.external.js");

/***/ }),

/***/ "../app-render/work-async-storage.external":
/*!*****************************************************************************!*\
  !*** external "next/dist/server/app-render/work-async-storage.external.js" ***!
  \*****************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/work-async-storage.external.js");

/***/ }),

/***/ "./work-unit-async-storage.external":
/*!**********************************************************************************!*\
  !*** external "next/dist/server/app-render/work-unit-async-storage.external.js" ***!
  \**********************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/work-unit-async-storage.external.js");

/***/ }),

/***/ "@prisma/client":
/*!*********************************!*\
  !*** external "@prisma/client" ***!
  \*********************************/
/***/ ((module) => {

"use strict";
module.exports = require("@prisma/client");

/***/ }),

/***/ "buffer":
/*!*************************!*\
  !*** external "buffer" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("buffer");

/***/ }),

/***/ "child_process":
/*!********************************!*\
  !*** external "child_process" ***!
  \********************************/
/***/ ((module) => {

"use strict";
module.exports = require("child_process");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("crypto");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

"use strict";
module.exports = require("fs");

/***/ }),

/***/ "fs/promises":
/*!******************************!*\
  !*** external "fs/promises" ***!
  \******************************/
/***/ ((module) => {

"use strict";
module.exports = require("fs/promises");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("http");

/***/ }),

/***/ "http2":
/*!************************!*\
  !*** external "http2" ***!
  \************************/
/***/ ((module) => {

"use strict";
module.exports = require("http2");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

"use strict";
module.exports = require("https");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "node:stream":
/*!******************************!*\
  !*** external "node:stream" ***!
  \******************************/
/***/ ((module) => {

"use strict";
module.exports = require("node:stream");

/***/ }),

/***/ "os":
/*!*********************!*\
  !*** external "os" ***!
  \*********************/
/***/ ((module) => {

"use strict";
module.exports = require("os");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("path");

/***/ }),

/***/ "process":
/*!**************************!*\
  !*** external "process" ***!
  \**************************/
/***/ ((module) => {

"use strict";
module.exports = require("process");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("stream");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = require("url");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("util");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/@aws-sdk","vendor-chunks/next","vendor-chunks/@smithy"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fauth%2Fme%2Froute&page=%2Fapi%2Fauth%2Fme%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fauth%2Fme%2Froute.ts&appDir=%2FUsers%2Fgastonmora%2FDesktop%2FProyectos%2FTulum%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fgastonmora%2FDesktop%2FProyectos%2FTulum&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();