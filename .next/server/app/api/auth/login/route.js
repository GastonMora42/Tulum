/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/auth/login/route";
exports.ids = ["app/api/auth/login/route"];
exports.modules = {

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fauth%2Flogin%2Froute&page=%2Fapi%2Fauth%2Flogin%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fauth%2Flogin%2Froute.ts&appDir=%2FUsers%2Fgastonmora%2FDesktop%2FProyectos%2FTulum%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fgastonmora%2FDesktop%2FProyectos%2FTulum&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!**********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fauth%2Flogin%2Froute&page=%2Fapi%2Fauth%2Flogin%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fauth%2Flogin%2Froute.ts&appDir=%2FUsers%2Fgastonmora%2FDesktop%2FProyectos%2FTulum%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fgastonmora%2FDesktop%2FProyectos%2FTulum&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \**********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   workAsyncStorage: () => (/* binding */ workAsyncStorage),\n/* harmony export */   workUnitAsyncStorage: () => (/* binding */ workUnitAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/route-kind */ \"(rsc)/./node_modules/next/dist/server/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_gastonmora_Desktop_Proyectos_Tulum_src_app_api_auth_login_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/auth/login/route.ts */ \"(rsc)/./src/app/api/auth/login/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/auth/login/route\",\n        pathname: \"/api/auth/login\",\n        filename: \"route\",\n        bundlePath: \"app/api/auth/login/route\"\n    },\n    resolvedPagePath: \"/Users/gastonmora/Desktop/Proyectos/Tulum/src/app/api/auth/login/route.ts\",\n    nextConfigOutput,\n    userland: _Users_gastonmora_Desktop_Proyectos_Tulum_src_app_api_auth_login_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { workAsyncStorage, workUnitAsyncStorage, serverHooks } = routeModule;\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        workAsyncStorage,\n        workUnitAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIvaW5kZXguanM/bmFtZT1hcHAlMkZhcGklMkZhdXRoJTJGbG9naW4lMkZyb3V0ZSZwYWdlPSUyRmFwaSUyRmF1dGglMkZsb2dpbiUyRnJvdXRlJmFwcFBhdGhzPSZwYWdlUGF0aD1wcml2YXRlLW5leHQtYXBwLWRpciUyRmFwaSUyRmF1dGglMkZsb2dpbiUyRnJvdXRlLnRzJmFwcERpcj0lMkZVc2VycyUyRmdhc3Rvbm1vcmElMkZEZXNrdG9wJTJGUHJveWVjdG9zJTJGVHVsdW0lMkZzcmMlMkZhcHAmcGFnZUV4dGVuc2lvbnM9dHN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPWpzeCZwYWdlRXh0ZW5zaW9ucz1qcyZyb290RGlyPSUyRlVzZXJzJTJGZ2FzdG9ubW9yYSUyRkRlc2t0b3AlMkZQcm95ZWN0b3MlMkZUdWx1bSZpc0Rldj10cnVlJnRzY29uZmlnUGF0aD10c2NvbmZpZy5qc29uJmJhc2VQYXRoPSZhc3NldFByZWZpeD0mbmV4dENvbmZpZ091dHB1dD0mcHJlZmVycmVkUmVnaW9uPSZtaWRkbGV3YXJlQ29uZmlnPWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7QUFBK0Y7QUFDdkM7QUFDcUI7QUFDeUI7QUFDdEc7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLHlHQUFtQjtBQUMzQztBQUNBLGNBQWMsa0VBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLFlBQVk7QUFDWixDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsUUFBUSxzREFBc0Q7QUFDOUQ7QUFDQSxXQUFXLDRFQUFXO0FBQ3RCO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDMEY7O0FBRTFGIiwic291cmNlcyI6WyIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwUm91dGVSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL3JvdXRlLW1vZHVsZXMvYXBwLXJvdXRlL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgcGF0Y2hGZXRjaCBhcyBfcGF0Y2hGZXRjaCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi9wYXRjaC1mZXRjaFwiO1xuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIi9Vc2Vycy9nYXN0b25tb3JhL0Rlc2t0b3AvUHJveWVjdG9zL1R1bHVtL3NyYy9hcHAvYXBpL2F1dGgvbG9naW4vcm91dGUudHNcIjtcbi8vIFdlIGluamVjdCB0aGUgbmV4dENvbmZpZ091dHB1dCBoZXJlIHNvIHRoYXQgd2UgY2FuIHVzZSB0aGVtIGluIHRoZSByb3V0ZVxuLy8gbW9kdWxlLlxuY29uc3QgbmV4dENvbmZpZ091dHB1dCA9IFwiXCJcbmNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IEFwcFJvdXRlUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLkFQUF9ST1VURSxcbiAgICAgICAgcGFnZTogXCIvYXBpL2F1dGgvbG9naW4vcm91dGVcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9hdXRoL2xvZ2luXCIsXG4gICAgICAgIGZpbGVuYW1lOiBcInJvdXRlXCIsXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiYXBwL2FwaS9hdXRoL2xvZ2luL3JvdXRlXCJcbiAgICB9LFxuICAgIHJlc29sdmVkUGFnZVBhdGg6IFwiL1VzZXJzL2dhc3Rvbm1vcmEvRGVza3RvcC9Qcm95ZWN0b3MvVHVsdW0vc3JjL2FwcC9hcGkvYXV0aC9sb2dpbi9yb3V0ZS50c1wiLFxuICAgIG5leHRDb25maWdPdXRwdXQsXG4gICAgdXNlcmxhbmRcbn0pO1xuLy8gUHVsbCBvdXQgdGhlIGV4cG9ydHMgdGhhdCB3ZSBuZWVkIHRvIGV4cG9zZSBmcm9tIHRoZSBtb2R1bGUuIFRoaXMgc2hvdWxkXG4vLyBiZSBlbGltaW5hdGVkIHdoZW4gd2UndmUgbW92ZWQgdGhlIG90aGVyIHJvdXRlcyB0byB0aGUgbmV3IGZvcm1hdC4gVGhlc2Vcbi8vIGFyZSB1c2VkIHRvIGhvb2sgaW50byB0aGUgcm91dGUuXG5jb25zdCB7IHdvcmtBc3luY1N0b3JhZ2UsIHdvcmtVbml0QXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcyB9ID0gcm91dGVNb2R1bGU7XG5mdW5jdGlvbiBwYXRjaEZldGNoKCkge1xuICAgIHJldHVybiBfcGF0Y2hGZXRjaCh7XG4gICAgICAgIHdvcmtBc3luY1N0b3JhZ2UsXG4gICAgICAgIHdvcmtVbml0QXN5bmNTdG9yYWdlXG4gICAgfSk7XG59XG5leHBvcnQgeyByb3V0ZU1vZHVsZSwgd29ya0FzeW5jU3RvcmFnZSwgd29ya1VuaXRBc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzLCBwYXRjaEZldGNoLCAgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXBwLXJvdXRlLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fauth%2Flogin%2Froute&page=%2Fapi%2Fauth%2Flogin%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fauth%2Flogin%2Froute.ts&appDir=%2FUsers%2Fgastonmora%2FDesktop%2FProyectos%2FTulum%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fgastonmora%2FDesktop%2FProyectos%2FTulum&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true!":
/*!******************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true! ***!
  \******************************************************************************************************/
/***/ (() => {



/***/ }),

/***/ "(rsc)/./src/app/api/auth/login/route.ts":
/*!*****************************************!*\
  !*** ./src/app/api/auth/login/route.ts ***!
  \*****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _server_services_auth_authService__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/server/services/auth/authService */ \"(rsc)/./src/server/services/auth/authService.ts\");\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! zod */ \"(rsc)/./node_modules/zod/lib/index.mjs\");\n// src/app/api/auth/login/route.ts\n\n\n\n// Esquema de validación\nconst loginSchema = zod__WEBPACK_IMPORTED_MODULE_2__.z.object({\n    email: zod__WEBPACK_IMPORTED_MODULE_2__.z.string().email({\n        message: 'Email inválido'\n    }),\n    password: zod__WEBPACK_IMPORTED_MODULE_2__.z.string().min(6, {\n        message: 'Contraseña debe tener al menos 6 caracteres'\n    })\n});\nasync function POST(req) {\n    try {\n        const body = await req.json();\n        console.log(\"Intento de login para:\", body.email);\n        // Validar datos de entrada\n        const validation = loginSchema.safeParse(body);\n        if (!validation.success) {\n            console.log(\"Error de validación:\", validation.error.errors);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: 'Datos de entrada inválidos',\n                details: validation.error.errors\n            }, {\n                status: 400\n            });\n        }\n        // Intentar login\n        try {\n            const result = await _server_services_auth_authService__WEBPACK_IMPORTED_MODULE_1__.authService.login({\n                email: body.email,\n                password: body.password\n            });\n            console.log(\"Login exitoso para:\", body.email);\n            // Retornar resultado exitoso\n            if (!result) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: 'Error en la autenticación'\n                }, {\n                    status: 500\n                });\n            }\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                user: result.user,\n                accessToken: result.accessToken,\n                refreshToken: result.refreshToken,\n                idToken: result.idToken\n            });\n        } catch (loginError) {\n            console.error(\"Error específico de login:\", loginError);\n            // Manejar diferentes tipos de errores\n            if (loginError.message?.includes('NotAuthorizedException') || loginError.message?.includes('Incorrect username or password')) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: 'Credenciales incorrectas'\n                }, {\n                    status: 401\n                });\n            }\n            if (loginError.message?.includes('UserNotConfirmedException')) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: 'Usuario no confirmado. Por favor verifica tu correo electrónico.'\n                }, {\n                    status: 403\n                });\n            }\n            throw loginError; // Re-lanzar para el manejador global\n        }\n    } catch (error) {\n        console.error('Error general en login API:', error);\n        // Crear un mensaje de error más amigable\n        let errorMessage = 'Error en el servidor';\n        if (error.message) {\n            // Sanitizar el mensaje de error para no exponer detalles técnicos\n            errorMessage = error.message.includes('AWS') || error.message.includes('Cognito') ? 'Error en el servicio de autenticación' : error.message;\n        }\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: errorMessage\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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dXJjZXMiOlsiL1VzZXJzL2dhc3Rvbm1vcmEvRGVza3RvcC9Qcm95ZWN0b3MvVHVsdW0vc3JjL2FwcC9hcGkvYXV0aC9sb2dpbi9yb3V0ZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBzcmMvYXBwL2FwaS9hdXRoL2xvZ2luL3JvdXRlLnRzXG5pbXBvcnQgeyBOZXh0UmVxdWVzdCwgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInO1xuaW1wb3J0IHsgYXV0aFNlcnZpY2UgfSBmcm9tICdAL3NlcnZlci9zZXJ2aWNlcy9hdXRoL2F1dGhTZXJ2aWNlJztcbmltcG9ydCB7IHogfSBmcm9tICd6b2QnO1xuXG4vLyBFc3F1ZW1hIGRlIHZhbGlkYWNpw7NuXG5jb25zdCBsb2dpblNjaGVtYSA9IHoub2JqZWN0KHtcbiAgZW1haWw6IHouc3RyaW5nKCkuZW1haWwoeyBtZXNzYWdlOiAnRW1haWwgaW52w6FsaWRvJyB9KSxcbiAgcGFzc3dvcmQ6IHouc3RyaW5nKCkubWluKDYsIHsgbWVzc2FnZTogJ0NvbnRyYXNlw7FhIGRlYmUgdGVuZXIgYWwgbWVub3MgNiBjYXJhY3RlcmVzJyB9KVxufSk7XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBQT1NUKHJlcTogTmV4dFJlcXVlc3QpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBib2R5ID0gYXdhaXQgcmVxLmpzb24oKTtcbiAgICBjb25zb2xlLmxvZyhcIkludGVudG8gZGUgbG9naW4gcGFyYTpcIiwgYm9keS5lbWFpbCk7XG4gICAgXG4gICAgLy8gVmFsaWRhciBkYXRvcyBkZSBlbnRyYWRhXG4gICAgY29uc3QgdmFsaWRhdGlvbiA9IGxvZ2luU2NoZW1hLnNhZmVQYXJzZShib2R5KTtcbiAgICBpZiAoIXZhbGlkYXRpb24uc3VjY2Vzcykge1xuICAgICAgY29uc29sZS5sb2coXCJFcnJvciBkZSB2YWxpZGFjacOzbjpcIiwgdmFsaWRhdGlvbi5lcnJvci5lcnJvcnMpO1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IGVycm9yOiAnRGF0b3MgZGUgZW50cmFkYSBpbnbDoWxpZG9zJywgZGV0YWlsczogdmFsaWRhdGlvbi5lcnJvci5lcnJvcnMgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICApO1xuICAgIH1cbiAgICBcbiAgICAvLyBJbnRlbnRhciBsb2dpblxuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBhdXRoU2VydmljZS5sb2dpbih7XG4gICAgICAgIGVtYWlsOiBib2R5LmVtYWlsLFxuICAgICAgICBwYXNzd29yZDogYm9keS5wYXNzd29yZFxuICAgICAgfSk7XG4gICAgICBcbiAgICAgIGNvbnNvbGUubG9nKFwiTG9naW4gZXhpdG9zbyBwYXJhOlwiLCBib2R5LmVtYWlsKTtcbiAgICAgIFxuICAgICAgLy8gUmV0b3JuYXIgcmVzdWx0YWRvIGV4aXRvc29cbiAgICAgIGlmICghcmVzdWx0KSB7XG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgICB7IGVycm9yOiAnRXJyb3IgZW4gbGEgYXV0ZW50aWNhY2nDs24nIH0sXG4gICAgICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICAgIHVzZXI6IHJlc3VsdC51c2VyLFxuICAgICAgICBhY2Nlc3NUb2tlbjogcmVzdWx0LmFjY2Vzc1Rva2VuLFxuICAgICAgICByZWZyZXNoVG9rZW46IHJlc3VsdC5yZWZyZXNoVG9rZW4sXG4gICAgICAgIGlkVG9rZW46IHJlc3VsdC5pZFRva2VuXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChsb2dpbkVycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBlc3BlY8OtZmljbyBkZSBsb2dpbjpcIiwgbG9naW5FcnJvcik7XG4gICAgICBcbiAgICAgIC8vIE1hbmVqYXIgZGlmZXJlbnRlcyB0aXBvcyBkZSBlcnJvcmVzXG4gICAgICBpZiAobG9naW5FcnJvci5tZXNzYWdlPy5pbmNsdWRlcygnTm90QXV0aG9yaXplZEV4Y2VwdGlvbicpIHx8IFxuICAgICAgICAgIGxvZ2luRXJyb3IubWVzc2FnZT8uaW5jbHVkZXMoJ0luY29ycmVjdCB1c2VybmFtZSBvciBwYXNzd29yZCcpKSB7XG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgICB7IGVycm9yOiAnQ3JlZGVuY2lhbGVzIGluY29ycmVjdGFzJyB9LFxuICAgICAgICAgIHsgc3RhdHVzOiA0MDEgfVxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgXG4gICAgICBpZiAobG9naW5FcnJvci5tZXNzYWdlPy5pbmNsdWRlcygnVXNlck5vdENvbmZpcm1lZEV4Y2VwdGlvbicpKSB7XG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgICB7IGVycm9yOiAnVXN1YXJpbyBubyBjb25maXJtYWRvLiBQb3IgZmF2b3IgdmVyaWZpY2EgdHUgY29ycmVvIGVsZWN0csOzbmljby4nIH0sXG4gICAgICAgICAgeyBzdGF0dXM6IDQwMyB9XG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIHRocm93IGxvZ2luRXJyb3I7IC8vIFJlLWxhbnphciBwYXJhIGVsIG1hbmVqYWRvciBnbG9iYWxcbiAgICB9XG4gIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBnZW5lcmFsIGVuIGxvZ2luIEFQSTonLCBlcnJvcik7XG4gICAgXG4gICAgLy8gQ3JlYXIgdW4gbWVuc2FqZSBkZSBlcnJvciBtw6FzIGFtaWdhYmxlXG4gICAgbGV0IGVycm9yTWVzc2FnZSA9ICdFcnJvciBlbiBlbCBzZXJ2aWRvcic7XG4gICAgXG4gICAgaWYgKGVycm9yLm1lc3NhZ2UpIHtcbiAgICAgIC8vIFNhbml0aXphciBlbCBtZW5zYWplIGRlIGVycm9yIHBhcmEgbm8gZXhwb25lciBkZXRhbGxlcyB0w6ljbmljb3NcbiAgICAgIGVycm9yTWVzc2FnZSA9IGVycm9yLm1lc3NhZ2UuaW5jbHVkZXMoJ0FXUycpIHx8IGVycm9yLm1lc3NhZ2UuaW5jbHVkZXMoJ0NvZ25pdG8nKSBcbiAgICAgICAgPyAnRXJyb3IgZW4gZWwgc2VydmljaW8gZGUgYXV0ZW50aWNhY2nDs24nIFxuICAgICAgICA6IGVycm9yLm1lc3NhZ2U7XG4gICAgfVxuICAgIFxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgIHsgZXJyb3I6IGVycm9yTWVzc2FnZSB9LFxuICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgKTtcbiAgfVxufSJdLCJuYW1lcyI6WyJOZXh0UmVzcG9uc2UiLCJhdXRoU2VydmljZSIsInoiLCJsb2dpblNjaGVtYSIsIm9iamVjdCIsImVtYWlsIiwic3RyaW5nIiwibWVzc2FnZSIsInBhc3N3b3JkIiwibWluIiwiUE9TVCIsInJlcSIsImJvZHkiLCJqc29uIiwiY29uc29sZSIsImxvZyIsInZhbGlkYXRpb24iLCJzYWZlUGFyc2UiLCJzdWNjZXNzIiwiZXJyb3IiLCJlcnJvcnMiLCJkZXRhaWxzIiwic3RhdHVzIiwicmVzdWx0IiwibG9naW4iLCJ1c2VyIiwiYWNjZXNzVG9rZW4iLCJyZWZyZXNoVG9rZW4iLCJpZFRva2VuIiwibG9naW5FcnJvciIsImluY2x1ZGVzIiwiZXJyb3JNZXNzYWdlIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/auth/login/route.ts\n");

/***/ }),

/***/ "(rsc)/./src/server/db/client.ts":
/*!*********************************!*\
  !*** ./src/server/db/client.ts ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @prisma/client */ \"@prisma/client\");\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_prisma_client__WEBPACK_IMPORTED_MODULE_0__);\n// src/server/db/client.ts\n\n// Evitar múltiples instancias en desarrollo\nconst globalForPrisma = global;\nconst prisma = globalForPrisma.prisma ?? new _prisma_client__WEBPACK_IMPORTED_MODULE_0__.PrismaClient({\n    log:  true ? [\n        'query',\n        'error',\n        'warn'\n    ] : 0\n});\nif (true) globalForPrisma.prisma = prisma;\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (prisma);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmVyL2RiL2NsaWVudC50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSwwQkFBMEI7QUFDb0I7QUFFOUMsNENBQTRDO0FBQzVDLE1BQU1DLGtCQUFrQkM7QUFJeEIsTUFBTUMsU0FBU0YsZ0JBQWdCRSxNQUFNLElBQ25DLElBQUlILHdEQUFZQSxDQUFDO0lBQ2ZJLEtBQUtDLEtBQXNDLEdBQ3ZDO1FBQUM7UUFBUztRQUFTO0tBQU8sR0FDMUIsQ0FBUztBQUNmO0FBRUYsSUFBSUEsSUFBcUMsRUFBRUosZ0JBQWdCRSxNQUFNLEdBQUdBO0FBRXBFLGlFQUFlQSxNQUFNQSxFQUFDIiwic291cmNlcyI6WyIvVXNlcnMvZ2FzdG9ubW9yYS9EZXNrdG9wL1Byb3llY3Rvcy9UdWx1bS9zcmMvc2VydmVyL2RiL2NsaWVudC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBzcmMvc2VydmVyL2RiL2NsaWVudC50c1xuaW1wb3J0IHsgUHJpc21hQ2xpZW50IH0gZnJvbSAnQHByaXNtYS9jbGllbnQnO1xuXG4vLyBFdml0YXIgbcO6bHRpcGxlcyBpbnN0YW5jaWFzIGVuIGRlc2Fycm9sbG9cbmNvbnN0IGdsb2JhbEZvclByaXNtYSA9IGdsb2JhbCBhcyB1bmtub3duIGFzIHtcbiAgcHJpc21hOiBQcmlzbWFDbGllbnQgfCB1bmRlZmluZWQ7XG59O1xuXG5jb25zdCBwcmlzbWEgPSBnbG9iYWxGb3JQcmlzbWEucHJpc21hID8/IFxuICBuZXcgUHJpc21hQ2xpZW50KHtcbiAgICBsb2c6IHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAnZGV2ZWxvcG1lbnQnIFxuICAgICAgPyBbJ3F1ZXJ5JywgJ2Vycm9yJywgJ3dhcm4nXSBcbiAgICAgIDogWydlcnJvciddLFxuICB9KTtcblxuaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicpIGdsb2JhbEZvclByaXNtYS5wcmlzbWEgPSBwcmlzbWE7XG5cbmV4cG9ydCBkZWZhdWx0IHByaXNtYTsiXSwibmFtZXMiOlsiUHJpc21hQ2xpZW50IiwiZ2xvYmFsRm9yUHJpc21hIiwiZ2xvYmFsIiwicHJpc21hIiwibG9nIiwicHJvY2VzcyJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/server/db/client.ts\n");

/***/ }),

/***/ "(rsc)/./src/server/services/auth/authService.ts":
/*!*************************************************!*\
  !*** ./src/server/services/auth/authService.ts ***!
  \*************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   AuthService: () => (/* binding */ AuthService),\n/* harmony export */   authService: () => (/* binding */ authService),\n/* harmony export */   refreshToken: () => (/* binding */ refreshToken)\n/* harmony export */ });\n/* harmony import */ var _server_db_client__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/server/db/client */ \"(rsc)/./src/server/db/client.ts\");\n/* harmony import */ var _cognitoService__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./cognitoService */ \"(rsc)/./src/server/services/auth/cognitoService.ts\");\n// src/server/services/auth/authService.ts\n\n\n// Servicio de autenticación que actúa como fachada para Cognito\nclass AuthService {\n    // Login\n    async login(credentials) {\n        try {\n            // Autenticar con Cognito\n            const cognitoResult = await _cognitoService__WEBPACK_IMPORTED_MODULE_1__.cognitoService.login(credentials);\n            // Buscar usuario en nuestra BD\n            let user = await _server_db_client__WEBPACK_IMPORTED_MODULE_0__[\"default\"].user.findFirst({\n                where: {\n                    email: credentials.email\n                },\n                include: {\n                    role: true\n                }\n            });\n            // Si no existe el usuario, lo creamos\n            if (!user) {\n                console.log(\"Usuario no encontrado en BD local, creando...\");\n                // Buscar primero un rol (preferiblemente admin)\n                let role = await _server_db_client__WEBPACK_IMPORTED_MODULE_0__[\"default\"].role.findFirst({\n                    where: {\n                        name: 'admin'\n                    }\n                });\n                // Si no existe ningún rol, necesitamos crear al menos uno\n                if (!role) {\n                    console.log(\"Creando rol 'admin' porque no existe\");\n                    role = await _server_db_client__WEBPACK_IMPORTED_MODULE_0__[\"default\"].role.create({\n                        data: {\n                            name: 'admin',\n                            permissions: [\n                                '*'\n                            ] // Todos los permisos como JSON\n                        }\n                    });\n                }\n                // Crear el usuario con el rol encontrado o creado\n                user = await _server_db_client__WEBPACK_IMPORTED_MODULE_0__[\"default\"].user.create({\n                    data: {\n                        id: cognitoResult.user.id,\n                        email: credentials.email,\n                        name: cognitoResult.user.name || credentials.email.split('@')[0],\n                        roleId: role.id\n                    },\n                    include: {\n                        role: true\n                    }\n                });\n                console.log(\"Usuario creado exitosamente:\", user.id);\n            }\n            // Devolvemos el resultado combinado\n            return {\n                ...cognitoResult,\n                user: {\n                    ...user,\n                    // Asegurarse de que usamos los datos de nuestra BD\n                    id: user.id,\n                    roleId: user.roleId\n                }\n            };\n        } catch (error) {\n            console.error('Error en login:', error);\n            throw error; // Propagar el error para que el cliente pueda manejarlo\n        }\n    }\n    // Cerrar sesión\n    async logout(accessToken) {\n        try {\n            await _cognitoService__WEBPACK_IMPORTED_MODULE_1__.cognitoService.logout(accessToken);\n            return true;\n        } catch (error) {\n            console.error('Error en logout:', error);\n            return false;\n        }\n    }\n    // Refrescar token\n    async refreshUserToken(refreshToken) {\n        try {\n            return await _cognitoService__WEBPACK_IMPORTED_MODULE_1__.cognitoService.refreshToken(refreshToken);\n        } catch (error) {\n            console.error('Error al refrescar token:', error);\n            return null;\n        }\n    }\n    // Obtener usuario por ID\n    async getUserById(userId) {\n        try {\n            const user = await _server_db_client__WEBPACK_IMPORTED_MODULE_0__[\"default\"].user.findUnique({\n                where: {\n                    id: userId\n                },\n                include: {\n                    role: true\n                }\n            });\n            if (!user) return null;\n            return user;\n        } catch (error) {\n            console.error('Error al obtener usuario:', error);\n            return null;\n        }\n    }\n    // Crear usuario (admin)\n    async createUser(userData) {\n        try {\n            // Verificar que el rol existe\n            const roleExists = await _server_db_client__WEBPACK_IMPORTED_MODULE_0__[\"default\"].role.findUnique({\n                where: {\n                    id: userData.roleId\n                }\n            });\n            if (!roleExists) {\n                throw new Error(`El rol con ID ${userData.roleId} no existe`);\n            }\n            // Si se proporciona sucursalId, verificar que existe\n            if (userData.sucursalId) {\n                const sucursalExists = await _server_db_client__WEBPACK_IMPORTED_MODULE_0__[\"default\"].ubicacion.findUnique({\n                    where: {\n                        id: userData.sucursalId\n                    }\n                });\n                if (!sucursalExists) {\n                    throw new Error(`La ubicación con ID ${userData.sucursalId} no existe`);\n                }\n            }\n            // Crear usuario en Cognito\n            await _cognitoService__WEBPACK_IMPORTED_MODULE_1__.cognitoService.createUser({\n                email: userData.email,\n                name: userData.name,\n                password: userData.password,\n                roleId: userData.roleId\n            });\n            // Crear usuario en nuestra BD\n            const user = await _server_db_client__WEBPACK_IMPORTED_MODULE_0__[\"default\"].user.create({\n                data: {\n                    email: userData.email,\n                    name: userData.name,\n                    roleId: userData.roleId,\n                    sucursalId: userData.sucursalId || null\n                }\n            });\n            return user;\n        } catch (error) {\n            console.error('Error al crear usuario:', error);\n            throw error;\n        }\n    }\n    // Registrar un nuevo usuario\n    async registerUser(userData) {\n        try {\n            // Registrar en Cognito\n            const cognitoResult = await _cognitoService__WEBPACK_IMPORTED_MODULE_1__.cognitoService.registerUser({\n                email: userData.email,\n                name: userData.name,\n                password: userData.password\n            });\n            if (!cognitoResult.success) {\n                return {\n                    success: false,\n                    message: cognitoResult.message || 'Error al registrar usuario en Cognito',\n                    userId: cognitoResult.userId\n                };\n            }\n            return {\n                success: true,\n                message: cognitoResult.message || 'Usuario registrado exitosamente',\n                userId: cognitoResult.userId\n            };\n        } catch (error) {\n            console.error('Error en registro:', error);\n            return {\n                success: false,\n                message: 'Error al registrar usuario'\n            };\n        }\n    }\n    // Confirmar registro\n    async confirmRegistration(email, code) {\n        try {\n            return await _cognitoService__WEBPACK_IMPORTED_MODULE_1__.cognitoService.confirmRegistration(email, code);\n        } catch (error) {\n            console.error('Error al confirmar registro:', error);\n            return {\n                success: false,\n                message: 'Error al confirmar el registro'\n            };\n        }\n    }\n    // Reenviar código de confirmación\n    async resendConfirmationCode(email) {\n        try {\n            return await _cognitoService__WEBPACK_IMPORTED_MODULE_1__.cognitoService.resendConfirmationCode(email);\n        } catch (error) {\n            console.error('Error al reenviar código:', error);\n            return {\n                success: false,\n                message: 'Error al reenviar el código de verificación'\n            };\n        }\n    }\n}\n// Singleton para uso en la aplicación\nconst authService = new AuthService();\n// Función para el cliente (frontend)\nasync function refreshToken() {\n    const refreshToken = localStorage.getItem('refreshToken');\n    if (!refreshToken) return false;\n    try {\n        const response = await fetch('/api/auth/refresh', {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json'\n            },\n            body: JSON.stringify({\n                refreshToken\n            })\n        });\n        if (!response.ok) return false;\n        const data = await response.json();\n        // Actualizar tokens\n        localStorage.setItem('accessToken', data.accessToken);\n        localStorage.setItem('idToken', data.idToken);\n        return true;\n    } catch (error) {\n        console.error('Error al refrescar token:', error);\n        return false;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmVyL3NlcnZpY2VzL2F1dGgvYXV0aFNlcnZpY2UudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQSwwQ0FBMEM7QUFFRjtBQUN3QztBQUVoRixnRUFBZ0U7QUFDekQsTUFBTUU7SUFDWCxRQUFRO0lBQ1IsTUFBTUMsTUFBTUMsV0FBNkIsRUFBOEI7UUFDckUsSUFBSTtZQUNGLHlCQUF5QjtZQUN6QixNQUFNQyxnQkFBZ0IsTUFBTUosMkRBQWNBLENBQUNFLEtBQUssQ0FBQ0M7WUFFakQsK0JBQStCO1lBQy9CLElBQUlFLE9BQU8sTUFBTU4seURBQU1BLENBQUNNLElBQUksQ0FBQ0MsU0FBUyxDQUFDO2dCQUNyQ0MsT0FBTztvQkFDTEMsT0FBT0wsWUFBWUssS0FBSztnQkFDMUI7Z0JBQ0FDLFNBQVM7b0JBQ1BDLE1BQU07Z0JBQ1I7WUFDRjtZQUVBLHNDQUFzQztZQUN0QyxJQUFJLENBQUNMLE1BQU07Z0JBQ1RNLFFBQVFDLEdBQUcsQ0FBQztnQkFFWixnREFBZ0Q7Z0JBQ2hELElBQUlGLE9BQU8sTUFBTVgseURBQU1BLENBQUNXLElBQUksQ0FBQ0osU0FBUyxDQUFDO29CQUNyQ0MsT0FBTzt3QkFBRU0sTUFBTTtvQkFBUTtnQkFDekI7Z0JBRUEsMERBQTBEO2dCQUMxRCxJQUFJLENBQUNILE1BQU07b0JBQ1RDLFFBQVFDLEdBQUcsQ0FBQztvQkFDWkYsT0FBTyxNQUFNWCx5REFBTUEsQ0FBQ1csSUFBSSxDQUFDSSxNQUFNLENBQUM7d0JBQzlCQyxNQUFNOzRCQUNKRixNQUFNOzRCQUNORyxhQUFhO2dDQUFDOzZCQUFJLENBQUMsK0JBQStCO3dCQUNwRDtvQkFDRjtnQkFDRjtnQkFFQSxrREFBa0Q7Z0JBQ2xEWCxPQUFPLE1BQU1OLHlEQUFNQSxDQUFDTSxJQUFJLENBQUNTLE1BQU0sQ0FBQztvQkFDOUJDLE1BQU07d0JBQ0pFLElBQUliLGNBQWNDLElBQUksQ0FBQ1ksRUFBRTt3QkFDekJULE9BQU9MLFlBQVlLLEtBQUs7d0JBQ3hC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LEtBQUssQ0FBQyxnQ0FBZ0NBO1lBQzlDLE9BQU87Z0JBQ0xpQixTQUFTO2dCQUNUQyxTQUFTO1lBQ1g7UUFDRjtJQUNGO0lBRUEsa0NBQWtDO0lBQ2xDLE1BQU1HLHVCQUF1QmpDLEtBQWEsRUFBa0Q7UUFDMUYsSUFBSTtZQUNGLE9BQU8sTUFBTVIsMkRBQWNBLENBQUN5QyxzQkFBc0IsQ0FBQ2pDO1FBQ3JELEVBQUUsT0FBT1ksT0FBTztZQUNkVCxRQUFRUyxLQUFLLENBQUMsNkJBQTZCQTtZQUMzQyxPQUFPO2dCQUNMaUIsU0FBUztnQkFDVEMsU0FBUztZQUNYO1FBQ0Y7SUFDRjtBQUNGO0FBRUEsc0NBQXNDO0FBQy9CLE1BQU1JLGNBQWMsSUFBSXpDLGNBQWM7QUFFN0MscUNBQXFDO0FBQzlCLGVBQWV1QjtJQUNwQixNQUFNQSxlQUFlbUIsYUFBYUMsT0FBTyxDQUFDO0lBQzFDLElBQUksQ0FBQ3BCLGNBQWMsT0FBTztJQUUxQixJQUFJO1FBQ0YsTUFBTXFCLFdBQVcsTUFBTUMsTUFBTSxxQkFBcUI7WUFDaERDLFFBQVE7WUFDUkMsU0FBUztnQkFBRSxnQkFBZ0I7WUFBbUI7WUFDOUNDLE1BQU1DLEtBQUtDLFNBQVMsQ0FBQztnQkFBRTNCO1lBQWE7UUFDdEM7UUFFQSxJQUFJLENBQUNxQixTQUFTTyxFQUFFLEVBQUUsT0FBTztRQUV6QixNQUFNckMsT0FBTyxNQUFNOEIsU0FBU1EsSUFBSTtRQUVoQyxvQkFBb0I7UUFDcEJWLGFBQWFXLE9BQU8sQ0FBQyxlQUFldkMsS0FBS08sV0FBVztRQUNwRHFCLGFBQWFXLE9BQU8sQ0FBQyxXQUFXdkMsS0FBS3dDLE9BQU87UUFFNUMsT0FBTztJQUNULEVBQUUsT0FBT25DLE9BQU87UUFDZFQsUUFBUVMsS0FBSyxDQUFDLDZCQUE2QkE7UUFDM0MsT0FBTztJQUNUO0FBQ0YiLCJzb3VyY2VzIjpbIi9Vc2Vycy9nYXN0b25tb3JhL0Rlc2t0b3AvUHJveWVjdG9zL1R1bHVtL3NyYy9zZXJ2ZXIvc2VydmljZXMvYXV0aC9hdXRoU2VydmljZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBzcmMvc2VydmVyL3NlcnZpY2VzL2F1dGgvYXV0aFNlcnZpY2UudHNcbmltcG9ydCB7IFVzZXIgfSBmcm9tICdAcHJpc21hL2NsaWVudCc7XG5pbXBvcnQgcHJpc21hIGZyb20gJ0Avc2VydmVyL2RiL2NsaWVudCc7XG5pbXBvcnQgeyBjb2duaXRvU2VydmljZSwgTG9naW5DcmVkZW50aWFscywgQXV0aFJlc3VsdCB9IGZyb20gJy4vY29nbml0b1NlcnZpY2UnO1xuXG4vLyBTZXJ2aWNpbyBkZSBhdXRlbnRpY2FjacOzbiBxdWUgYWN0w7phIGNvbW8gZmFjaGFkYSBwYXJhIENvZ25pdG9cbmV4cG9ydCBjbGFzcyBBdXRoU2VydmljZSB7XG4gIC8vIExvZ2luXG4gIGFzeW5jIGxvZ2luKGNyZWRlbnRpYWxzOiBMb2dpbkNyZWRlbnRpYWxzKTogUHJvbWlzZTxBdXRoUmVzdWx0IHwgbnVsbD4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBBdXRlbnRpY2FyIGNvbiBDb2duaXRvXG4gICAgICBjb25zdCBjb2duaXRvUmVzdWx0ID0gYXdhaXQgY29nbml0b1NlcnZpY2UubG9naW4oY3JlZGVudGlhbHMpO1xuICAgICAgXG4gICAgICAvLyBCdXNjYXIgdXN1YXJpbyBlbiBudWVzdHJhIEJEXG4gICAgICBsZXQgdXNlciA9IGF3YWl0IHByaXNtYS51c2VyLmZpbmRGaXJzdCh7XG4gICAgICAgIHdoZXJlOiB7IFxuICAgICAgICAgIGVtYWlsOiBjcmVkZW50aWFscy5lbWFpbCBcbiAgICAgICAgfSxcbiAgICAgICAgaW5jbHVkZTogeyBcbiAgICAgICAgICByb2xlOiB0cnVlIFxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgLy8gU2kgbm8gZXhpc3RlIGVsIHVzdWFyaW8sIGxvIGNyZWFtb3NcbiAgICAgIGlmICghdXNlcikge1xuICAgICAgICBjb25zb2xlLmxvZyhcIlVzdWFyaW8gbm8gZW5jb250cmFkbyBlbiBCRCBsb2NhbCwgY3JlYW5kby4uLlwiKTtcbiAgICAgICAgXG4gICAgICAgIC8vIEJ1c2NhciBwcmltZXJvIHVuIHJvbCAocHJlZmVyaWJsZW1lbnRlIGFkbWluKVxuICAgICAgICBsZXQgcm9sZSA9IGF3YWl0IHByaXNtYS5yb2xlLmZpbmRGaXJzdCh7XG4gICAgICAgICAgd2hlcmU6IHsgbmFtZTogJ2FkbWluJyB9XG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgLy8gU2kgbm8gZXhpc3RlIG5pbmfDum4gcm9sLCBuZWNlc2l0YW1vcyBjcmVhciBhbCBtZW5vcyB1bm9cbiAgICAgICAgaWYgKCFyb2xlKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coXCJDcmVhbmRvIHJvbCAnYWRtaW4nIHBvcnF1ZSBubyBleGlzdGVcIik7XG4gICAgICAgICAgcm9sZSA9IGF3YWl0IHByaXNtYS5yb2xlLmNyZWF0ZSh7XG4gICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgIG5hbWU6ICdhZG1pbicsXG4gICAgICAgICAgICAgIHBlcm1pc3Npb25zOiBbJyonXSAvLyBUb2RvcyBsb3MgcGVybWlzb3MgY29tbyBKU09OXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIC8vIENyZWFyIGVsIHVzdWFyaW8gY29uIGVsIHJvbCBlbmNvbnRyYWRvIG8gY3JlYWRvXG4gICAgICAgIHVzZXIgPSBhd2FpdCBwcmlzbWEudXNlci5jcmVhdGUoe1xuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIGlkOiBjb2duaXRvUmVzdWx0LnVzZXIuaWQsIC8vIFVzYXIgZWwgc3ViIGRlIENvZ25pdG8gY29tbyBJRFxuICAgICAgICAgICAgZW1haWw6IGNyZWRlbnRpYWxzLmVtYWlsLFxuICAgICAgICAgICAgbmFtZTogY29nbml0b1Jlc3VsdC51c2VyLm5hbWUgfHwgY3JlZGVudGlhbHMuZW1haWwuc3BsaXQoJ0AnKVswXSxcbiAgICAgICAgICAgIHJvbGVJZDogcm9sZS5pZCxcbiAgICAgICAgICAgIC8vIE5vIGluY2x1aW1vcyBzdWN1cnNhbElkIHlhIHF1ZSBlcyBvcGNpb25hbCBlbiB0dSBlc3F1ZW1hXG4gICAgICAgICAgfSxcbiAgICAgICAgICBpbmNsdWRlOiB7IFxuICAgICAgICAgICAgcm9sZTogdHJ1ZSBcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgY29uc29sZS5sb2coXCJVc3VhcmlvIGNyZWFkbyBleGl0b3NhbWVudGU6XCIsIHVzZXIuaWQpO1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBEZXZvbHZlbW9zIGVsIHJlc3VsdGFkbyBjb21iaW5hZG9cbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLmNvZ25pdG9SZXN1bHQsXG4gICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAuLi51c2VyLFxuICAgICAgICAgIC8vIEFzZWd1cmFyc2UgZGUgcXVlIHVzYW1vcyBsb3MgZGF0b3MgZGUgbnVlc3RyYSBCRFxuICAgICAgICAgIGlkOiB1c2VyLmlkLFxuICAgICAgICAgIHJvbGVJZDogdXNlci5yb2xlSWRcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZW4gbG9naW46JywgZXJyb3IpO1xuICAgICAgdGhyb3cgZXJyb3I7IC8vIFByb3BhZ2FyIGVsIGVycm9yIHBhcmEgcXVlIGVsIGNsaWVudGUgcHVlZGEgbWFuZWphcmxvXG4gICAgfVxuICB9XG4gIFxuICAvLyBDZXJyYXIgc2VzacOzblxuICBhc3luYyBsb2dvdXQoYWNjZXNzVG9rZW46IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCBjb2duaXRvU2VydmljZS5sb2dvdXQoYWNjZXNzVG9rZW4pO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGVuIGxvZ291dDonLCBlcnJvcik7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG4gIFxuICAvLyBSZWZyZXNjYXIgdG9rZW5cbiAgYXN5bmMgcmVmcmVzaFVzZXJUb2tlbihyZWZyZXNoVG9rZW46IHN0cmluZyk6IFByb21pc2U8T21pdDxBdXRoUmVzdWx0LCAndXNlcic+IHwgbnVsbD4ge1xuICAgIHRyeSB7XG4gICAgICByZXR1cm4gYXdhaXQgY29nbml0b1NlcnZpY2UucmVmcmVzaFRva2VuKHJlZnJlc2hUb2tlbik7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGFsIHJlZnJlc2NhciB0b2tlbjonLCBlcnJvcik7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gIH1cbiAgXG4gIC8vIE9idGVuZXIgdXN1YXJpbyBwb3IgSURcbiAgYXN5bmMgZ2V0VXNlckJ5SWQodXNlcklkOiBzdHJpbmcpOiBQcm9taXNlPE9taXQ8VXNlciwgJ3Bhc3N3b3JkJz4gfCBudWxsPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBwcmlzbWEudXNlci5maW5kVW5pcXVlKHtcbiAgICAgICAgd2hlcmU6IHsgaWQ6IHVzZXJJZCB9LFxuICAgICAgICBpbmNsdWRlOiB7IHJvbGU6IHRydWUgfVxuICAgICAgfSk7XG4gICAgICBcbiAgICAgIGlmICghdXNlcikgcmV0dXJuIG51bGw7XG4gICAgICBcbiAgICAgIHJldHVybiB1c2VyO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBhbCBvYnRlbmVyIHVzdWFyaW86JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICB9XG4gIFxuICAvLyBDcmVhciB1c3VhcmlvIChhZG1pbilcbiAgYXN5bmMgY3JlYXRlVXNlcih1c2VyRGF0YToge1xuICAgIGVtYWlsOiBzdHJpbmc7XG4gICAgbmFtZTogc3RyaW5nO1xuICAgIHBhc3N3b3JkOiBzdHJpbmc7XG4gICAgcm9sZUlkOiBzdHJpbmc7XG4gICAgc3VjdXJzYWxJZD86IHN0cmluZztcbiAgfSk6IFByb21pc2U8VXNlciB8IG51bGw+IHtcbiAgICB0cnkge1xuICAgICAgLy8gVmVyaWZpY2FyIHF1ZSBlbCByb2wgZXhpc3RlXG4gICAgICBjb25zdCByb2xlRXhpc3RzID0gYXdhaXQgcHJpc21hLnJvbGUuZmluZFVuaXF1ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkOiB1c2VyRGF0YS5yb2xlSWQgfVxuICAgICAgfSk7XG4gICAgICBcbiAgICAgIGlmICghcm9sZUV4aXN0cykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEVsIHJvbCBjb24gSUQgJHt1c2VyRGF0YS5yb2xlSWR9IG5vIGV4aXN0ZWApO1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBTaSBzZSBwcm9wb3JjaW9uYSBzdWN1cnNhbElkLCB2ZXJpZmljYXIgcXVlIGV4aXN0ZVxuICAgICAgaWYgKHVzZXJEYXRhLnN1Y3Vyc2FsSWQpIHtcbiAgICAgICAgY29uc3Qgc3VjdXJzYWxFeGlzdHMgPSBhd2FpdCBwcmlzbWEudWJpY2FjaW9uLmZpbmRVbmlxdWUoe1xuICAgICAgICAgIHdoZXJlOiB7IGlkOiB1c2VyRGF0YS5zdWN1cnNhbElkIH1cbiAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICBpZiAoIXN1Y3Vyc2FsRXhpc3RzKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBMYSB1YmljYWNpw7NuIGNvbiBJRCAke3VzZXJEYXRhLnN1Y3Vyc2FsSWR9IG5vIGV4aXN0ZWApO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIENyZWFyIHVzdWFyaW8gZW4gQ29nbml0b1xuICAgICAgYXdhaXQgY29nbml0b1NlcnZpY2UuY3JlYXRlVXNlcih7XG4gICAgICAgIGVtYWlsOiB1c2VyRGF0YS5lbWFpbCxcbiAgICAgICAgbmFtZTogdXNlckRhdGEubmFtZSxcbiAgICAgICAgcGFzc3dvcmQ6IHVzZXJEYXRhLnBhc3N3b3JkLFxuICAgICAgICByb2xlSWQ6IHVzZXJEYXRhLnJvbGVJZFxuICAgICAgfSk7XG4gICAgICBcbiAgICAgIC8vIENyZWFyIHVzdWFyaW8gZW4gbnVlc3RyYSBCRFxuICAgICAgY29uc3QgdXNlciA9IGF3YWl0IHByaXNtYS51c2VyLmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBlbWFpbDogdXNlckRhdGEuZW1haWwsXG4gICAgICAgICAgbmFtZTogdXNlckRhdGEubmFtZSxcbiAgICAgICAgICByb2xlSWQ6IHVzZXJEYXRhLnJvbGVJZCxcbiAgICAgICAgICBzdWN1cnNhbElkOiB1c2VyRGF0YS5zdWN1cnNhbElkIHx8IG51bGxcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICBcbiAgICAgIHJldHVybiB1c2VyO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBhbCBjcmVhciB1c3VhcmlvOicsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIC8vIFJlZ2lzdHJhciB1biBudWV2byB1c3VhcmlvXG4gIGFzeW5jIHJlZ2lzdGVyVXNlcih1c2VyRGF0YToge1xuICAgIGVtYWlsOiBzdHJpbmc7XG4gICAgbmFtZTogc3RyaW5nO1xuICAgIHBhc3N3b3JkOiBzdHJpbmc7XG4gIH0pOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbWVzc2FnZTogc3RyaW5nOyB1c2VySWQ/OiBzdHJpbmcgfT4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBSZWdpc3RyYXIgZW4gQ29nbml0b1xuICAgICAgY29uc3QgY29nbml0b1Jlc3VsdCA9IGF3YWl0IGNvZ25pdG9TZXJ2aWNlLnJlZ2lzdGVyVXNlcih7XG4gICAgICAgIGVtYWlsOiB1c2VyRGF0YS5lbWFpbCxcbiAgICAgICAgbmFtZTogdXNlckRhdGEubmFtZSxcbiAgICAgICAgcGFzc3dvcmQ6IHVzZXJEYXRhLnBhc3N3b3JkXG4gICAgICB9KTtcbiAgICAgIGlmICghY29nbml0b1Jlc3VsdC5zdWNjZXNzKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgbWVzc2FnZTogY29nbml0b1Jlc3VsdC5tZXNzYWdlIHx8ICdFcnJvciBhbCByZWdpc3RyYXIgdXN1YXJpbyBlbiBDb2duaXRvJyxcbiAgICAgICAgICB1c2VySWQ6IGNvZ25pdG9SZXN1bHQudXNlcklkXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICBcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIG1lc3NhZ2U6IGNvZ25pdG9SZXN1bHQubWVzc2FnZSB8fCAnVXN1YXJpbyByZWdpc3RyYWRvIGV4aXRvc2FtZW50ZScsXG4gICAgICAgIHVzZXJJZDogY29nbml0b1Jlc3VsdC51c2VySWRcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGVuIHJlZ2lzdHJvOicsIGVycm9yKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnRXJyb3IgYWwgcmVnaXN0cmFyIHVzdWFyaW8nXG4gICAgICB9O1xuICAgIH1cbiAgfVxuXG4gIC8vIENvbmZpcm1hciByZWdpc3Ryb1xuICBhc3luYyBjb25maXJtUmVnaXN0cmF0aW9uKGVtYWlsOiBzdHJpbmcsIGNvZGU6IHN0cmluZyk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuOyBtZXNzYWdlOiBzdHJpbmcgfT4ge1xuICAgIHRyeSB7XG4gICAgICByZXR1cm4gYXdhaXQgY29nbml0b1NlcnZpY2UuY29uZmlybVJlZ2lzdHJhdGlvbihlbWFpbCwgY29kZSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGFsIGNvbmZpcm1hciByZWdpc3RybzonLCBlcnJvcik7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogJ0Vycm9yIGFsIGNvbmZpcm1hciBlbCByZWdpc3RybydcbiAgICAgIH07XG4gICAgfVxuICB9XG5cbiAgLy8gUmVlbnZpYXIgY8OzZGlnbyBkZSBjb25maXJtYWNpw7NuXG4gIGFzeW5jIHJlc2VuZENvbmZpcm1hdGlvbkNvZGUoZW1haWw6IHN0cmluZyk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuOyBtZXNzYWdlOiBzdHJpbmcgfT4ge1xuICAgIHRyeSB7XG4gICAgICByZXR1cm4gYXdhaXQgY29nbml0b1NlcnZpY2UucmVzZW5kQ29uZmlybWF0aW9uQ29kZShlbWFpbCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGFsIHJlZW52aWFyIGPDs2RpZ286JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdFcnJvciBhbCByZWVudmlhciBlbCBjw7NkaWdvIGRlIHZlcmlmaWNhY2nDs24nXG4gICAgICB9O1xuICAgIH1cbiAgfVxufVxuXG4vLyBTaW5nbGV0b24gcGFyYSB1c28gZW4gbGEgYXBsaWNhY2nDs25cbmV4cG9ydCBjb25zdCBhdXRoU2VydmljZSA9IG5ldyBBdXRoU2VydmljZSgpO1xuXG4vLyBGdW5jacOzbiBwYXJhIGVsIGNsaWVudGUgKGZyb250ZW5kKVxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHJlZnJlc2hUb2tlbigpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgY29uc3QgcmVmcmVzaFRva2VuID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3JlZnJlc2hUb2tlbicpO1xuICBpZiAoIXJlZnJlc2hUb2tlbikgcmV0dXJuIGZhbHNlO1xuICBcbiAgdHJ5IHtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKCcvYXBpL2F1dGgvcmVmcmVzaCcsIHtcbiAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgaGVhZGVyczogeyAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nIH0sXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IHJlZnJlc2hUb2tlbiB9KVxuICAgIH0pO1xuICAgIFxuICAgIGlmICghcmVzcG9uc2Uub2spIHJldHVybiBmYWxzZTtcbiAgICBcbiAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuICAgIFxuICAgIC8vIEFjdHVhbGl6YXIgdG9rZW5zXG4gICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2FjY2Vzc1Rva2VuJywgZGF0YS5hY2Nlc3NUb2tlbik7XG4gICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2lkVG9rZW4nLCBkYXRhLmlkVG9rZW4pO1xuICAgIFxuICAgIHJldHVybiB0cnVlO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGFsIHJlZnJlc2NhciB0b2tlbjonLCBlcnJvcik7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG59Il0sIm5hbWVzIjpbInByaXNtYSIsImNvZ25pdG9TZXJ2aWNlIiwiQXV0aFNlcnZpY2UiLCJsb2dpbiIsImNyZWRlbnRpYWxzIiwiY29nbml0b1Jlc3VsdCIsInVzZXIiLCJmaW5kRmlyc3QiLCJ3aGVyZSIsImVtYWlsIiwiaW5jbHVkZSIsInJvbGUiLCJjb25zb2xlIiwibG9nIiwibmFtZSIsImNyZWF0ZSIsImRhdGEiLCJwZXJtaXNzaW9ucyIsImlkIiwic3BsaXQiLCJyb2xlSWQiLCJlcnJvciIsImxvZ291dCIsImFjY2Vzc1Rva2VuIiwicmVmcmVzaFVzZXJUb2tlbiIsInJlZnJlc2hUb2tlbiIsImdldFVzZXJCeUlkIiwidXNlcklkIiwiZmluZFVuaXF1ZSIsImNyZWF0ZVVzZXIiLCJ1c2VyRGF0YSIsInJvbGVFeGlzdHMiLCJFcnJvciIsInN1Y3Vyc2FsSWQiLCJzdWN1cnNhbEV4aXN0cyIsInViaWNhY2lvbiIsInBhc3N3b3JkIiwicmVnaXN0ZXJVc2VyIiwic3VjY2VzcyIsIm1lc3NhZ2UiLCJjb25maXJtUmVnaXN0cmF0aW9uIiwiY29kZSIsInJlc2VuZENvbmZpcm1hdGlvbkNvZGUiLCJhdXRoU2VydmljZSIsImxvY2FsU3RvcmFnZSIsImdldEl0ZW0iLCJyZXNwb25zZSIsImZldGNoIiwibWV0aG9kIiwiaGVhZGVycyIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5Iiwib2siLCJqc29uIiwic2V0SXRlbSIsImlkVG9rZW4iXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/server/services/auth/authService.ts\n");

/***/ }),

/***/ "(rsc)/./src/server/services/auth/cognitoService.ts":
/*!****************************************************!*\
  !*** ./src/server/services/auth/cognitoService.ts ***!
  \****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   CognitoAuthService: () => (/* binding */ CognitoAuthService),\n/* harmony export */   cognitoService: () => (/* binding */ cognitoService)\n/* harmony export */ });\n/* harmony import */ var _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @aws-sdk/client-cognito-identity-provider */ \"(rsc)/./node_modules/@aws-sdk/client-cognito-identity-provider/dist-es/CognitoIdentityProviderClient.js\");\n/* harmony import */ var _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @aws-sdk/client-cognito-identity-provider */ \"(rsc)/./node_modules/@aws-sdk/client-cognito-identity-provider/dist-es/commands/SignUpCommand.js\");\n/* harmony import */ var _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @aws-sdk/client-cognito-identity-provider */ \"(rsc)/./node_modules/@aws-sdk/client-cognito-identity-provider/dist-es/commands/ConfirmSignUpCommand.js\");\n/* harmony import */ var _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @aws-sdk/client-cognito-identity-provider */ \"(rsc)/./node_modules/@aws-sdk/client-cognito-identity-provider/dist-es/commands/ResendConfirmationCodeCommand.js\");\n/* harmony import */ var _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @aws-sdk/client-cognito-identity-provider */ \"(rsc)/./node_modules/@aws-sdk/client-cognito-identity-provider/dist-es/commands/InitiateAuthCommand.js\");\n/* harmony import */ var _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @aws-sdk/client-cognito-identity-provider */ \"(rsc)/./node_modules/@aws-sdk/client-cognito-identity-provider/dist-es/commands/GetUserCommand.js\");\n/* harmony import */ var _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @aws-sdk/client-cognito-identity-provider */ \"(rsc)/./node_modules/@aws-sdk/client-cognito-identity-provider/dist-es/commands/GlobalSignOutCommand.js\");\n/* harmony import */ var _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! @aws-sdk/client-cognito-identity-provider */ \"(rsc)/./node_modules/@aws-sdk/client-cognito-identity-provider/dist-es/commands/AdminCreateUserCommand.js\");\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! crypto */ \"crypto\");\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(crypto__WEBPACK_IMPORTED_MODULE_0__);\n// src/server/services/auth/cognitoService.ts\n\n\nclass CognitoAuthService {\n    constructor(){\n        this.client = new _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_1__.CognitoIdentityProviderClient({\n            region: process.env.AWS_REGION\n        });\n        this.userPoolId = process.env.COGNITO_USER_POOL_ID;\n        this.clientId = process.env.COGNITO_CLIENT_ID;\n        this.clientSecret = process.env.COGNITO_CLIENT_SECRET;\n    }\n    // Método para calcular el SECRET_HASH\n    // En cognitoService.ts\n    calculateSecretHash(username) {\n        if (!this.clientSecret) {\n            console.error('Cliente secret no está configurado');\n            throw new Error('Client secret is not configured');\n        }\n        // El formato correcto es USERNAME + CLIENT_ID\n        const message = username + this.clientId;\n        const hmac = crypto__WEBPACK_IMPORTED_MODULE_0__.createHmac('sha256', this.clientSecret);\n        hmac.update(message);\n        return hmac.digest('base64');\n    }\n    // Registrar un nuevo usuario\n    async registerUser(params) {\n        try {\n            const { email, password, name } = params;\n            // Crear el usuario en Cognito\n            const signUpCommand = new _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_2__.SignUpCommand({\n                ClientId: this.clientId,\n                Username: email,\n                Password: password,\n                SecretHash: this.calculateSecretHash(email),\n                UserAttributes: [\n                    {\n                        Name: 'email',\n                        Value: email\n                    },\n                    {\n                        Name: 'name',\n                        Value: name\n                    }\n                ]\n            });\n            const response = await this.client.send(signUpCommand);\n            return {\n                success: true,\n                userId: response.UserSub,\n                message: 'Usuario registrado correctamente. Por favor, verifique su correo electrónico para completar el registro.'\n            };\n        } catch (error) {\n            console.error('Error al registrar usuario:', error);\n            // Manejar errores específicos\n            if (error.name === 'UsernameExistsException') {\n                return {\n                    success: false,\n                    message: 'El correo electrónico ya está registrado.'\n                };\n            }\n            if (error.name === 'InvalidPasswordException') {\n                return {\n                    success: false,\n                    message: 'La contraseña no cumple con los requisitos de seguridad.'\n                };\n            }\n            throw error;\n        }\n    }\n    // Confirmar el registro con el código de verificación\n    async confirmRegistration(email, confirmationCode) {\n        try {\n            const command = new _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_3__.ConfirmSignUpCommand({\n                ClientId: this.clientId,\n                Username: email,\n                ConfirmationCode: confirmationCode,\n                SecretHash: this.calculateSecretHash(email) // Añadir SECRET_HASH\n            });\n            await this.client.send(command);\n            return {\n                success: true,\n                message: 'Registro confirmado correctamente.'\n            };\n        } catch (error) {\n            console.error('Error al confirmar registro:', error);\n            if (error.name === 'CodeMismatchException') {\n                return {\n                    success: false,\n                    message: 'El código de verificación es incorrecto.'\n                };\n            }\n            if (error.name === 'ExpiredCodeException') {\n                return {\n                    success: false,\n                    message: 'El código de verificación ha expirado.'\n                };\n            }\n            return {\n                success: false,\n                message: 'Error al confirmar el registro. Por favor, intente nuevamente.'\n            };\n        }\n    }\n    // Reenviar código de confirmación\n    async resendConfirmationCode(email) {\n        try {\n            const command = new _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_4__.ResendConfirmationCodeCommand({\n                ClientId: this.clientId,\n                Username: email,\n                SecretHash: this.calculateSecretHash(email) // Añadir SECRET_HASH\n            });\n            await this.client.send(command);\n            return {\n                success: true,\n                message: 'Se ha enviado un nuevo código de verificación a su correo electrónico.'\n            };\n        } catch (error) {\n            console.error('Error al reenviar código:', error);\n            return {\n                success: false,\n                message: 'Error al reenviar el código de verificación. Por favor, intente nuevamente.'\n            };\n        }\n    }\n    // Login con Cognito\n    // En login de cognitoService.ts\n    async login(credentials) {\n        try {\n            const { email, password } = credentials;\n            console.log(\"1. Iniciando login con Cognito para:\", email);\n            // Verificar que tenemos los valores de configuración\n            console.log(\"2. Verificando configuración:\", {\n                region: process.env.AWS_REGION,\n                userPoolId: this.userPoolId?.substring(0, 5) + '...',\n                clientId: this.clientId?.substring(0, 5) + '...',\n                hasSecret: !!this.clientSecret\n            });\n            // Si usamos secreto, calcular SECRET_HASH\n            let secretHash;\n            if (this.clientSecret) {\n                try {\n                    secretHash = this.calculateSecretHash(email);\n                    console.log(\"3. SECRET_HASH calculado correctamente\");\n                } catch (error) {\n                    console.error(\"Error al calcular SECRET_HASH:\", error);\n                    throw error;\n                }\n            }\n            // Crear parámetros de autenticación\n            const authParams = {\n                USERNAME: email,\n                PASSWORD: password\n            };\n            // Añadir SECRET_HASH si existe\n            if (secretHash) {\n                authParams.SECRET_HASH = secretHash;\n            }\n            console.log(\"4. Parámetros de autenticación preparados\");\n            const command = new _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_5__.InitiateAuthCommand({\n                AuthFlow: \"USER_PASSWORD_AUTH\",\n                ClientId: this.clientId,\n                AuthParameters: authParams\n            });\n            console.log(\"5. Enviando solicitud a Cognito...\");\n            const response = await this.client.send(command);\n            console.log(\"6. Respuesta recibida de Cognito:\", response?.AuthenticationResult ? \"Con tokens\" : \"Sin tokens\", response?.ChallengeName ? `Desafío: ${response.ChallengeName}` : \"Sin desafío\");\n            if (!response.AuthenticationResult) {\n                if (response.ChallengeName) {\n                    throw new Error(`Se requiere completar desafío: ${response.ChallengeName}`);\n                }\n                throw new Error('Error de autenticación: No se recibieron tokens de autenticación');\n            }\n            // Obtener información del usuario autenticado\n            console.log(\"7. Obteniendo información del usuario...\");\n            const userInfo = await this.getUserInfo(response.AuthenticationResult.AccessToken);\n            console.log(\"8. Información de usuario obtenida:\", userInfo.email);\n            return {\n                user: userInfo,\n                accessToken: response.AuthenticationResult.AccessToken,\n                refreshToken: response.AuthenticationResult.RefreshToken,\n                idToken: response.AuthenticationResult.IdToken,\n                expiresIn: response.AuthenticationResult.ExpiresIn || 3600\n            };\n        } catch (error) {\n            console.error('Error detallado en login Cognito:', error);\n            if (error.$metadata) {\n                console.error('Metadatos del error:', error.$metadata);\n            }\n            if (error.__type) {\n                console.error('Tipo de error AWS:', error.__type);\n            }\n            if (error.message) {\n                console.error('Mensaje de error:', error.message);\n            }\n            throw error;\n        }\n    }\n    // Obtener información del usuario desde Cognito\n    async getUserInfo(accessToken) {\n        try {\n            const command = new _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_6__.GetUserCommand({\n                AccessToken: accessToken\n            });\n            const response = await this.client.send(command);\n            // Mapear atributos de Cognito a nuestro modelo de usuario\n            const attributes = response.UserAttributes || [];\n            const email = attributes.find((attr)=>attr.Name === 'email')?.Value || '';\n            const name = attributes.find((attr)=>attr.Name === 'name')?.Value || '';\n            const sub = attributes.find((attr)=>attr.Name === 'sub')?.Value || '';\n            // Aquí deberíamos obtener el usuario de nuestra base de datos\n            // usando el sub como identificador externo\n            // Por ahora, devolvemos un usuario básico\n            return {\n                id: sub,\n                email,\n                name,\n                roleId: 'user',\n                createdAt: new Date(),\n                updatedAt: new Date(),\n                sucursalId: null\n            };\n        } catch (error) {\n            console.error('Error al obtener info de usuario:', error);\n            throw error;\n        }\n    }\n    // Cerrar sesión\n    async logout(accessToken) {\n        try {\n            const command = new _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_7__.GlobalSignOutCommand({\n                AccessToken: accessToken\n            });\n            await this.client.send(command);\n        } catch (error) {\n            console.error('Error al cerrar sesión:', error);\n            throw error;\n        }\n    }\n    // Refrescar token\n    async refreshToken(refreshToken) {\n        try {\n            // Para refresh token no se necesita username, así que no podemos calcular el SECRET_HASH\n            const command = new _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_5__.InitiateAuthCommand({\n                AuthFlow: \"REFRESH_TOKEN_AUTH\",\n                ClientId: this.clientId,\n                AuthParameters: {\n                    REFRESH_TOKEN: refreshToken\n                }\n            });\n            const response = await this.client.send(command);\n            if (!response.AuthenticationResult) {\n                throw new Error('Error al refrescar token');\n            }\n            return {\n                accessToken: response.AuthenticationResult.AccessToken,\n                idToken: response.AuthenticationResult.IdToken,\n                refreshToken: refreshToken,\n                expiresIn: response.AuthenticationResult.ExpiresIn || 3600\n            };\n        } catch (error) {\n            console.error('Error al refrescar token:', error);\n            throw error;\n        }\n    }\n    // Crear usuario (solo admin)\n    async createUser(user) {\n        try {\n            const command = new _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_8__.AdminCreateUserCommand({\n                UserPoolId: this.userPoolId,\n                Username: user.email,\n                TemporaryPassword: user.password,\n                UserAttributes: [\n                    {\n                        Name: 'email',\n                        Value: user.email\n                    },\n                    {\n                        Name: 'email_verified',\n                        Value: 'true'\n                    },\n                    {\n                        Name: 'name',\n                        Value: user.name\n                    },\n                    {\n                        Name: 'custom:role',\n                        Value: user.roleId\n                    }\n                ]\n            });\n            await this.client.send(command);\n        // Aquí deberíamos crear también el usuario en nuestra BD\n        // y vincular el id de Cognito\n        } catch (error) {\n            console.error('Error al crear usuario:', error);\n            throw error;\n        }\n    }\n}\n// Singleton para uso en la aplicación\nconst cognitoService = new CognitoAuthService();\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmVyL3NlcnZpY2VzL2F1dGgvY29nbml0b1NlcnZpY2UudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsNkNBQTZDO0FBWU07QUFFbEI7QUFzQjFCLE1BQU1TO0lBTWJDLGFBQWM7UUFDWixJQUFJLENBQUNDLE1BQU0sR0FBRyxJQUFJWCxvR0FBNkJBLENBQUM7WUFDOUNZLFFBQVFDLFFBQVFDLEdBQUcsQ0FBQ0MsVUFBVTtRQUNoQztRQUVBLElBQUksQ0FBQ0MsVUFBVSxHQUFHSCxRQUFRQyxHQUFHLENBQUNHLG9CQUFvQjtRQUNsRCxJQUFJLENBQUNDLFFBQVEsR0FBR0wsUUFBUUMsR0FBRyxDQUFDSyxpQkFBaUI7UUFDN0MsSUFBSSxDQUFDQyxZQUFZLEdBQUdQLFFBQVFDLEdBQUcsQ0FBQ08scUJBQXFCO0lBQ3ZEO0lBRUEsc0NBQXNDO0lBQ3RDLHVCQUF1QjtJQUNmQyxvQkFBb0JDLFFBQWdCLEVBQVU7UUFDcEQsSUFBSSxDQUFDLElBQUksQ0FBQ0gsWUFBWSxFQUFFO1lBQ3RCSSxRQUFRQyxLQUFLLENBQUM7WUFDZCxNQUFNLElBQUlDLE1BQU07UUFDbEI7UUFFQSw4Q0FBOEM7UUFDOUMsTUFBTUMsVUFBVUosV0FBVyxJQUFJLENBQUNMLFFBQVE7UUFDeEMsTUFBTVUsT0FBT3BCLDhDQUFpQixDQUFDLFVBQVUsSUFBSSxDQUFDWSxZQUFZO1FBQzFEUSxLQUFLRSxNQUFNLENBQUNIO1FBQ1osT0FBT0MsS0FBS0csTUFBTSxDQUFDO0lBQ3JCO0lBRUEsNkJBQTZCO0lBQzdCLE1BQU1DLGFBQWFDLE1BQTBCLEVBQW9FO1FBQy9HLElBQUk7WUFDRixNQUFNLEVBQUVDLEtBQUssRUFBRUMsUUFBUSxFQUFFQyxJQUFJLEVBQUUsR0FBR0g7WUFFbEMsOEJBQThCO1lBQzlCLE1BQU1JLGdCQUFnQixJQUFJaEMsb0ZBQWFBLENBQUM7Z0JBQ3RDaUMsVUFBVSxJQUFJLENBQUNwQixRQUFRO2dCQUN2QnFCLFVBQVVMO2dCQUNW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b3AvUHJveWVjdG9zL1R1bHVtL3NyYy9zZXJ2ZXIvc2VydmljZXMvYXV0aC9jb2duaXRvU2VydmljZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBzcmMvc2VydmVyL3NlcnZpY2VzL2F1dGgvY29nbml0b1NlcnZpY2UudHNcbmltcG9ydCB7IFxuICBDb2duaXRvSWRlbnRpdHlQcm92aWRlckNsaWVudCwgXG4gIEluaXRpYXRlQXV0aENvbW1hbmQsXG4gIFJlc3BvbmRUb0F1dGhDaGFsbGVuZ2VDb21tYW5kLFxuICBHZXRVc2VyQ29tbWFuZCxcbiAgQWRtaW5HZXRVc2VyQ29tbWFuZCxcbiAgQWRtaW5DcmVhdGVVc2VyQ29tbWFuZCxcbiAgR2xvYmFsU2lnbk91dENvbW1hbmQsXG4gIFNpZ25VcENvbW1hbmQsXG4gIENvbmZpcm1TaWduVXBDb21tYW5kLFxuICBSZXNlbmRDb25maXJtYXRpb25Db2RlQ29tbWFuZFxufSBmcm9tIFwiQGF3cy1zZGsvY2xpZW50LWNvZ25pdG8taWRlbnRpdHktcHJvdmlkZXJcIjtcbmltcG9ydCB7IHR5cGUgVXNlciB9IGZyb20gJ0BwcmlzbWEvY2xpZW50JztcbmltcG9ydCAqIGFzIGNyeXB0byBmcm9tICdjcnlwdG8nO1xuXG5pbnRlcmZhY2UgUmVnaXN0ZXJVc2VyUGFyYW1zIHtcbmVtYWlsOiBzdHJpbmc7XG5wYXNzd29yZDogc3RyaW5nO1xubmFtZTogc3RyaW5nO1xufVxuXG4vLyBJbnRlcmZhY2VzXG5leHBvcnQgaW50ZXJmYWNlIExvZ2luQ3JlZGVudGlhbHMge1xuICBlbWFpbDogc3RyaW5nO1xuICBwYXNzd29yZDogc3RyaW5nO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEF1dGhSZXN1bHQge1xudXNlcjogT21pdDxVc2VyLCAncGFzc3dvcmQnPjtcbmFjY2Vzc1Rva2VuOiBzdHJpbmc7XG5yZWZyZXNoVG9rZW46IHN0cmluZztcbmlkVG9rZW46IHN0cmluZztcbmV4cGlyZXNJbjogbnVtYmVyO1xufVxuXG5leHBvcnQgY2xhc3MgQ29nbml0b0F1dGhTZXJ2aWNlIHtcbnByaXZhdGUgY2xpZW50OiBDb2duaXRvSWRlbnRpdHlQcm92aWRlckNsaWVudDtcbnByaXZhdGUgdXNlclBvb2xJZDogc3RyaW5nO1xucHJpdmF0ZSBjbGllbnRJZDogc3RyaW5nO1xucHJpdmF0ZSBjbGllbnRTZWNyZXQ6IHN0cmluZztcblxuY29uc3RydWN0b3IoKSB7XG4gIHRoaXMuY2xpZW50ID0gbmV3IENvZ25pdG9JZGVudGl0eVByb3ZpZGVyQ2xpZW50KHtcbiAgICByZWdpb246IHByb2Nlc3MuZW52LkFXU19SRUdJT04gYXMgc3RyaW5nXG4gIH0pO1xuICBcbiAgdGhpcy51c2VyUG9vbElkID0gcHJvY2Vzcy5lbnYuQ09HTklUT19VU0VSX1BPT0xfSUQgYXMgc3RyaW5nO1xuICB0aGlzLmNsaWVudElkID0gcHJvY2Vzcy5lbnYuQ09HTklUT19DTElFTlRfSUQgYXMgc3RyaW5nO1xuICB0aGlzLmNsaWVudFNlY3JldCA9IHByb2Nlc3MuZW52LkNPR05JVE9fQ0xJRU5UX1NFQ1JFVCBhcyBzdHJpbmc7XG59XG5cbi8vIE3DqXRvZG8gcGFyYSBjYWxjdWxhciBlbCBTRUNSRVRfSEFTSFxuLy8gRW4gY29nbml0b1NlcnZpY2UudHNcbnByaXZhdGUgY2FsY3VsYXRlU2VjcmV0SGFzaCh1c2VybmFtZTogc3RyaW5nKTogc3RyaW5nIHtcbiAgaWYgKCF0aGlzLmNsaWVudFNlY3JldCkge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0NsaWVudGUgc2VjcmV0IG5vIGVzdMOhIGNvbmZpZ3VyYWRvJyk7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdDbGllbnQgc2VjcmV0IGlzIG5vdCBjb25maWd1cmVkJyk7XG4gIH1cbiAgXG4gIC8vIEVsIGZvcm1hdG8gY29ycmVjdG8gZXMgVVNFUk5BTUUgKyBDTElFTlRfSURcbiAgY29uc3QgbWVzc2FnZSA9IHVzZXJuYW1lICsgdGhpcy5jbGllbnRJZDtcbiAgY29uc3QgaG1hYyA9IGNyeXB0by5jcmVhdGVIbWFjKCdzaGEyNTYnLCB0aGlzLmNsaWVudFNlY3JldCk7XG4gIGhtYWMudXBkYXRlKG1lc3NhZ2UpO1xuICByZXR1cm4gaG1hYy5kaWdlc3QoJ2Jhc2U2NCcpO1xufVxuXG4vLyBSZWdpc3RyYXIgdW4gbnVldm8gdXN1YXJpb1xuYXN5bmMgcmVnaXN0ZXJVc2VyKHBhcmFtczogUmVnaXN0ZXJVc2VyUGFyYW1zKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IHVzZXJJZD86IHN0cmluZzsgbWVzc2FnZT86IHN0cmluZyB9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgeyBlbWFpbCwgcGFzc3dvcmQsIG5hbWUgfSA9IHBhcmFtcztcbiAgICBcbiAgICAvLyBDcmVhciBlbCB1c3VhcmlvIGVuIENvZ25pdG9cbiAgICBjb25zdCBzaWduVXBDb21tYW5kID0gbmV3IFNpZ25VcENvbW1hbmQoe1xuICAgICAgQ2xpZW50SWQ6IHRoaXMuY2xpZW50SWQsXG4gICAgICBVc2VybmFtZTogZW1haWwsXG4gICAgICBQYXNzd29yZDogcGFzc3dvcmQsXG4gICAgICBTZWNyZXRIYXNoOiB0aGlzLmNhbGN1bGF0ZVNlY3JldEhhc2goZW1haWwpLCAvLyBBw7FhZGlyIFNFQ1JFVF9IQVNIXG4gICAgICBVc2VyQXR0cmlidXRlczogW1xuICAgICAgICB7XG4gICAgICAgICAgTmFtZTogJ2VtYWlsJyxcbiAgICAgICAgICBWYWx1ZTogZW1haWxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIE5hbWU6ICduYW1lJyxcbiAgICAgICAgICBWYWx1ZTogbmFtZVxuICAgICAgICB9XG4gICAgICBdXG4gICAgfSk7XG4gICAgXG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLmNsaWVudC5zZW5kKHNpZ25VcENvbW1hbmQpO1xuICAgIFxuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgdXNlcklkOiByZXNwb25zZS5Vc2VyU3ViLFxuICAgICAgbWVzc2FnZTogJ1VzdWFyaW8gcmVnaXN0cmFkbyBjb3JyZWN0YW1lbnRlLiBQb3IgZmF2b3IsIHZlcmlmaXF1ZSBzdSBjb3JyZW8gZWxlY3Ryw7NuaWNvIHBhcmEgY29tcGxldGFyIGVsIHJlZ2lzdHJvLidcbiAgICB9O1xuICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgYWwgcmVnaXN0cmFyIHVzdWFyaW86JywgZXJyb3IpO1xuICAgIFxuICAgIC8vIE1hbmVqYXIgZXJyb3JlcyBlc3BlY8OtZmljb3NcbiAgICBpZiAoZXJyb3IubmFtZSA9PT0gJ1VzZXJuYW1lRXhpc3RzRXhjZXB0aW9uJykge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdFbCBjb3JyZW8gZWxlY3Ryw7NuaWNvIHlhIGVzdMOhIHJlZ2lzdHJhZG8uJ1xuICAgICAgfTtcbiAgICB9XG4gICAgXG4gICAgaWYgKGVycm9yLm5hbWUgPT09ICdJbnZhbGlkUGFzc3dvcmRFeGNlcHRpb24nKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogJ0xhIGNvbnRyYXNlw7FhIG5vIGN1bXBsZSBjb24gbG9zIHJlcXVpc2l0b3MgZGUgc2VndXJpZGFkLidcbiAgICAgIH07XG4gICAgfVxuICAgIFxuICAgIHRocm93IGVycm9yO1xuICB9XG59XG5cbi8vIENvbmZpcm1hciBlbCByZWdpc3RybyBjb24gZWwgY8OzZGlnbyBkZSB2ZXJpZmljYWNpw7NuXG5hc3luYyBjb25maXJtUmVnaXN0cmF0aW9uKGVtYWlsOiBzdHJpbmcsIGNvbmZpcm1hdGlvbkNvZGU6IHN0cmluZyk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuOyBtZXNzYWdlOiBzdHJpbmcgfT4ge1xuICB0cnkge1xuICAgIGNvbnN0IGNvbW1hbmQgPSBuZXcgQ29uZmlybVNpZ25VcENvbW1hbmQoe1xuICAgICAgQ2xpZW50SWQ6IHRoaXMuY2xpZW50SWQsXG4gICAgICBVc2VybmFtZTogZW1haWwsXG4gICAgICBDb25maXJtYXRpb25Db2RlOiBjb25maXJtYXRpb25Db2RlLFxuICAgICAgU2VjcmV0SGFzaDogdGhpcy5jYWxjdWxhdGVTZWNyZXRIYXNoKGVtYWlsKSAvLyBBw7FhZGlyIFNFQ1JFVF9IQVNIXG4gICAgfSk7XG4gICAgXG4gICAgYXdhaXQgdGhpcy5jbGllbnQuc2VuZChjb21tYW5kKTtcbiAgICBcbiAgICByZXR1cm4ge1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIG1lc3NhZ2U6ICdSZWdpc3RybyBjb25maXJtYWRvIGNvcnJlY3RhbWVudGUuJ1xuICAgIH07XG4gIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBhbCBjb25maXJtYXIgcmVnaXN0cm86JywgZXJyb3IpO1xuICAgIFxuICAgIGlmIChlcnJvci5uYW1lID09PSAnQ29kZU1pc21hdGNoRXhjZXB0aW9uJykge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdFbCBjw7NkaWdvIGRlIHZlcmlmaWNhY2nDs24gZXMgaW5jb3JyZWN0by4nXG4gICAgICB9O1xuICAgIH1cbiAgICBcbiAgICBpZiAoZXJyb3IubmFtZSA9PT0gJ0V4cGlyZWRDb2RlRXhjZXB0aW9uJykge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdFbCBjw7NkaWdvIGRlIHZlcmlmaWNhY2nDs24gaGEgZXhwaXJhZG8uJ1xuICAgICAgfTtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgbWVzc2FnZTogJ0Vycm9yIGFsIGNvbmZpcm1hciBlbCByZWdpc3Ryby4gUG9yIGZhdm9yLCBpbnRlbnRlIG51ZXZhbWVudGUuJ1xuICAgIH07XG4gIH1cbn1cblxuLy8gUmVlbnZpYXIgY8OzZGlnbyBkZSBjb25maXJtYWNpw7NuXG5hc3luYyByZXNlbmRDb25maXJtYXRpb25Db2RlKGVtYWlsOiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbWVzc2FnZTogc3RyaW5nIH0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBjb21tYW5kID0gbmV3IFJlc2VuZENvbmZpcm1hdGlvbkNvZGVDb21tYW5kKHtcbiAgICAgIENsaWVudElkOiB0aGlzLmNsaWVudElkLFxuICAgICAgVXNlcm5hbWU6IGVtYWlsLFxuICAgICAgU2VjcmV0SGFzaDogdGhpcy5jYWxjdWxhdGVTZWNyZXRIYXNoKGVtYWlsKSAvLyBBw7FhZGlyIFNFQ1JFVF9IQVNIXG4gICAgfSk7XG4gICAgXG4gICAgYXdhaXQgdGhpcy5jbGllbnQuc2VuZChjb21tYW5kKTtcbiAgICBcbiAgICByZXR1cm4ge1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIG1lc3NhZ2U6ICdTZSBoYSBlbnZpYWRvIHVuIG51ZXZvIGPDs2RpZ28gZGUgdmVyaWZpY2FjacOzbiBhIHN1IGNvcnJlbyBlbGVjdHLDs25pY28uJ1xuICAgIH07XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgYWwgcmVlbnZpYXIgY8OzZGlnbzonLCBlcnJvcik7XG4gICAgXG4gICAgcmV0dXJuIHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgbWVzc2FnZTogJ0Vycm9yIGFsIHJlZW52aWFyIGVsIGPDs2RpZ28gZGUgdmVyaWZpY2FjacOzbi4gUG9yIGZhdm9yLCBpbnRlbnRlIG51ZXZhbWVudGUuJ1xuICAgIH07XG4gIH1cbn1cblxuLy8gTG9naW4gY29uIENvZ25pdG9cbi8vIEVuIGxvZ2luIGRlIGNvZ25pdG9TZXJ2aWNlLnRzXG5hc3luYyBsb2dpbihjcmVkZW50aWFsczogTG9naW5DcmVkZW50aWFscyk6IFByb21pc2U8QXV0aFJlc3VsdD4ge1xuICB0cnkge1xuICAgIGNvbnN0IHsgZW1haWwsIHBhc3N3b3JkIH0gPSBjcmVkZW50aWFscztcbiAgICBjb25zb2xlLmxvZyhcIjEuIEluaWNpYW5kbyBsb2dpbiBjb24gQ29nbml0byBwYXJhOlwiLCBlbWFpbCk7XG4gICAgXG4gICAgLy8gVmVyaWZpY2FyIHF1ZSB0ZW5lbW9zIGxvcyB2YWxvcmVzIGRlIGNvbmZpZ3VyYWNpw7NuXG4gICAgY29uc29sZS5sb2coXCIyLiBWZXJpZmljYW5kbyBjb25maWd1cmFjacOzbjpcIiwge1xuICAgICAgcmVnaW9uOiBwcm9jZXNzLmVudi5BV1NfUkVHSU9OLFxuICAgICAgdXNlclBvb2xJZDogdGhpcy51c2VyUG9vbElkPy5zdWJzdHJpbmcoMCwgNSkgKyAnLi4uJyxcbiAgICAgIGNsaWVudElkOiB0aGlzLmNsaWVudElkPy5zdWJzdHJpbmcoMCwgNSkgKyAnLi4uJyxcbiAgICAgIGhhc1NlY3JldDogISF0aGlzLmNsaWVudFNlY3JldFxuICAgIH0pO1xuICAgIFxuICAgIC8vIFNpIHVzYW1vcyBzZWNyZXRvLCBjYWxjdWxhciBTRUNSRVRfSEFTSFxuICAgIGxldCBzZWNyZXRIYXNoO1xuICAgIGlmICh0aGlzLmNsaWVudFNlY3JldCkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgc2VjcmV0SGFzaCA9IHRoaXMuY2FsY3VsYXRlU2VjcmV0SGFzaChlbWFpbCk7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiMy4gU0VDUkVUX0hBU0ggY2FsY3VsYWRvIGNvcnJlY3RhbWVudGVcIik7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgYWwgY2FsY3VsYXIgU0VDUkVUX0hBU0g6XCIsIGVycm9yKTtcbiAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIC8vIENyZWFyIHBhcsOhbWV0cm9zIGRlIGF1dGVudGljYWNpw7NuXG4gICAgY29uc3QgYXV0aFBhcmFtczogUmVjb3JkPHN0cmluZywgc3RyaW5nPiA9IHtcbiAgICAgIFVTRVJOQU1FOiBlbWFpbCxcbiAgICAgIFBBU1NXT1JEOiBwYXNzd29yZFxuICAgIH07XG4gICAgXG4gICAgLy8gQcOxYWRpciBTRUNSRVRfSEFTSCBzaSBleGlzdGVcbiAgICBpZiAoc2VjcmV0SGFzaCkge1xuICAgICAgYXV0aFBhcmFtcy5TRUNSRVRfSEFTSCA9IHNlY3JldEhhc2g7XG4gICAgfVxuICAgIFxuICAgIGNvbnNvbGUubG9nKFwiNC4gUGFyw6FtZXRyb3MgZGUgYXV0ZW50aWNhY2nDs24gcHJlcGFyYWRvc1wiKTtcbiAgICBcbiAgICBjb25zdCBjb21tYW5kID0gbmV3IEluaXRpYXRlQXV0aENvbW1hbmQoe1xuICAgICAgQXV0aEZsb3c6IFwiVVNFUl9QQVNTV09SRF9BVVRIXCIsXG4gICAgICBDbGllbnRJZDogdGhpcy5jbGllbnRJZCxcbiAgICAgIEF1dGhQYXJhbWV0ZXJzOiBhdXRoUGFyYW1zXG4gICAgfSk7XG4gICAgXG4gICAgY29uc29sZS5sb2coXCI1LiBFbnZpYW5kbyBzb2xpY2l0dWQgYSBDb2duaXRvLi4uXCIpO1xuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy5jbGllbnQuc2VuZChjb21tYW5kKTtcbiAgICBjb25zb2xlLmxvZyhcIjYuIFJlc3B1ZXN0YSByZWNpYmlkYSBkZSBDb2duaXRvOlwiLCBcbiAgICAgIHJlc3BvbnNlPy5BdXRoZW50aWNhdGlvblJlc3VsdCA/IFwiQ29uIHRva2Vuc1wiIDogXCJTaW4gdG9rZW5zXCIsXG4gICAgICByZXNwb25zZT8uQ2hhbGxlbmdlTmFtZSA/IGBEZXNhZsOtbzogJHtyZXNwb25zZS5DaGFsbGVuZ2VOYW1lfWAgOiBcIlNpbiBkZXNhZsOtb1wiXG4gICAgKTtcbiAgICBcbiAgICBpZiAoIXJlc3BvbnNlLkF1dGhlbnRpY2F0aW9uUmVzdWx0KSB7XG4gICAgICBpZiAocmVzcG9uc2UuQ2hhbGxlbmdlTmFtZSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFNlIHJlcXVpZXJlIGNvbXBsZXRhciBkZXNhZsOtbzogJHtyZXNwb25zZS5DaGFsbGVuZ2VOYW1lfWApO1xuICAgICAgfVxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdFcnJvciBkZSBhdXRlbnRpY2FjacOzbjogTm8gc2UgcmVjaWJpZXJvbiB0b2tlbnMgZGUgYXV0ZW50aWNhY2nDs24nKTtcbiAgICB9XG4gICAgXG4gICAgLy8gT2J0ZW5lciBpbmZvcm1hY2nDs24gZGVsIHVzdWFyaW8gYXV0ZW50aWNhZG9cbiAgICBjb25zb2xlLmxvZyhcIjcuIE9idGVuaWVuZG8gaW5mb3JtYWNpw7NuIGRlbCB1c3VhcmlvLi4uXCIpO1xuICAgIGNvbnN0IHVzZXJJbmZvID0gYXdhaXQgdGhpcy5nZXRVc2VySW5mbyhyZXNwb25zZS5BdXRoZW50aWNhdGlvblJlc3VsdC5BY2Nlc3NUb2tlbiBhcyBzdHJpbmcpO1xuICAgIGNvbnNvbGUubG9nKFwiOC4gSW5mb3JtYWNpw7NuIGRlIHVzdWFyaW8gb2J0ZW5pZGE6XCIsIHVzZXJJbmZvLmVtYWlsKTtcbiAgICBcbiAgICByZXR1cm4ge1xuICAgICAgdXNlcjogdXNlckluZm8sXG4gICAgICBhY2Nlc3NUb2tlbjogcmVzcG9uc2UuQXV0aGVudGljYXRpb25SZXN1bHQuQWNjZXNzVG9rZW4gYXMgc3RyaW5nLFxuICAgICAgcmVmcmVzaFRva2VuOiByZXNwb25zZS5BdXRoZW50aWNhdGlvblJlc3VsdC5SZWZyZXNoVG9rZW4gYXMgc3RyaW5nLFxuICAgICAgaWRUb2tlbjogcmVzcG9uc2UuQXV0aGVudGljYXRpb25SZXN1bHQuSWRUb2tlbiBhcyBzdHJpbmcsXG4gICAgICBleHBpcmVzSW46IHJlc3BvbnNlLkF1dGhlbnRpY2F0aW9uUmVzdWx0LkV4cGlyZXNJbiB8fCAzNjAwXG4gICAgfTtcbiAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGRldGFsbGFkbyBlbiBsb2dpbiBDb2duaXRvOicsIGVycm9yKTtcbiAgICBpZiAoZXJyb3IuJG1ldGFkYXRhKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdNZXRhZGF0b3MgZGVsIGVycm9yOicsIGVycm9yLiRtZXRhZGF0YSk7XG4gICAgfVxuICAgIGlmIChlcnJvci5fX3R5cGUpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1RpcG8gZGUgZXJyb3IgQVdTOicsIGVycm9yLl9fdHlwZSk7XG4gICAgfVxuICAgIGlmIChlcnJvci5tZXNzYWdlKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdNZW5zYWplIGRlIGVycm9yOicsIGVycm9yLm1lc3NhZ2UpO1xuICAgIH1cbiAgICB0aHJvdyBlcnJvcjtcbiAgfVxufVxuXG4vLyBPYnRlbmVyIGluZm9ybWFjacOzbiBkZWwgdXN1YXJpbyBkZXNkZSBDb2duaXRvXG5wcml2YXRlIGFzeW5jIGdldFVzZXJJbmZvKGFjY2Vzc1Rva2VuOiBzdHJpbmcpOiBQcm9taXNlPE9taXQ8VXNlciwgJ3Bhc3N3b3JkJz4+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBjb21tYW5kID0gbmV3IEdldFVzZXJDb21tYW5kKHtcbiAgICAgIEFjY2Vzc1Rva2VuOiBhY2Nlc3NUb2tlblxuICAgIH0pO1xuICAgIFxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy5jbGllbnQuc2VuZChjb21tYW5kKTtcbiAgICBcbiAgICAvLyBNYXBlYXIgYXRyaWJ1dG9zIGRlIENvZ25pdG8gYSBudWVzdHJvIG1vZGVsbyBkZSB1c3VhcmlvXG4gICAgY29uc3QgYXR0cmlidXRlcyA9IHJlc3BvbnNlLlVzZXJBdHRyaWJ1dGVzIHx8IFtdO1xuICAgIGNvbnN0IGVtYWlsID0gYXR0cmlidXRlcy5maW5kKGF0dHIgPT4gYXR0ci5OYW1lID09PSAnZW1haWwnKT8uVmFsdWUgfHwgJyc7XG4gICAgY29uc3QgbmFtZSA9IGF0dHJpYnV0ZXMuZmluZChhdHRyID0+IGF0dHIuTmFtZSA9PT0gJ25hbWUnKT8uVmFsdWUgfHwgJyc7XG4gICAgY29uc3Qgc3ViID0gYXR0cmlidXRlcy5maW5kKGF0dHIgPT4gYXR0ci5OYW1lID09PSAnc3ViJyk/LlZhbHVlIHx8ICcnO1xuICAgIFxuICAgIC8vIEFxdcOtIGRlYmVyw61hbW9zIG9idGVuZXIgZWwgdXN1YXJpbyBkZSBudWVzdHJhIGJhc2UgZGUgZGF0b3NcbiAgICAvLyB1c2FuZG8gZWwgc3ViIGNvbW8gaWRlbnRpZmljYWRvciBleHRlcm5vXG4gICAgLy8gUG9yIGFob3JhLCBkZXZvbHZlbW9zIHVuIHVzdWFyaW8gYsOhc2ljb1xuICAgIFxuICAgIHJldHVybiB7XG4gICAgICBpZDogc3ViLFxuICAgICAgZW1haWwsXG4gICAgICBuYW1lLFxuICAgICAgcm9sZUlkOiAndXNlcicsIC8vIFBvciBkZWZlY3RvLCBsdWVnbyBhY3R1YWxpemFtb3MgY29uIGluZm8gZGUgQkRcbiAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIHN1Y3Vyc2FsSWQ6IG51bGxcbiAgICB9O1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGFsIG9idGVuZXIgaW5mbyBkZSB1c3VhcmlvOicsIGVycm9yKTtcbiAgICB0aHJvdyBlcnJvcjtcbiAgfVxufVxuXG4vLyBDZXJyYXIgc2VzacOzblxuYXN5bmMgbG9nb3V0KGFjY2Vzc1Rva2VuOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBjb21tYW5kID0gbmV3IEdsb2JhbFNpZ25PdXRDb21tYW5kKHtcbiAgICAgIEFjY2Vzc1Rva2VuOiBhY2Nlc3NUb2tlblxuICAgIH0pO1xuICAgIFxuICAgIGF3YWl0IHRoaXMuY2xpZW50LnNlbmQoY29tbWFuZCk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgYWwgY2VycmFyIHNlc2nDs246JywgZXJyb3IpO1xuICAgIHRocm93IGVycm9yO1xuICB9XG59XG5cbi8vIFJlZnJlc2NhciB0b2tlblxuYXN5bmMgcmVmcmVzaFRva2VuKHJlZnJlc2hUb2tlbjogc3RyaW5nKTogUHJvbWlzZTxPbWl0PEF1dGhSZXN1bHQsICd1c2VyJz4+IHtcbiAgdHJ5IHtcbiAgICAvLyBQYXJhIHJlZnJlc2ggdG9rZW4gbm8gc2UgbmVjZXNpdGEgdXNlcm5hbWUsIGFzw60gcXVlIG5vIHBvZGVtb3MgY2FsY3VsYXIgZWwgU0VDUkVUX0hBU0hcbiAgICBjb25zdCBjb21tYW5kID0gbmV3IEluaXRpYXRlQXV0aENvbW1hbmQoe1xuICAgICAgQXV0aEZsb3c6IFwiUkVGUkVTSF9UT0tFTl9BVVRIXCIsXG4gICAgICBDbGllbnRJZDogdGhpcy5jbGllbnRJZCxcbiAgICAgIEF1dGhQYXJhbWV0ZXJzOiB7XG4gICAgICAgIFJFRlJFU0hfVE9LRU46IHJlZnJlc2hUb2tlblxuICAgICAgICAvLyBTRUNSRVRfSEFTSCBubyBzZSB1c2EgZW4gZXN0ZSBmbHVqb1xuICAgICAgfVxuICAgIH0pO1xuICAgIFxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy5jbGllbnQuc2VuZChjb21tYW5kKTtcbiAgICBcbiAgICBpZiAoIXJlc3BvbnNlLkF1dGhlbnRpY2F0aW9uUmVzdWx0KSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0Vycm9yIGFsIHJlZnJlc2NhciB0b2tlbicpO1xuICAgIH1cbiAgICBcbiAgICByZXR1cm4ge1xuICAgICAgYWNjZXNzVG9rZW46IHJlc3BvbnNlLkF1dGhlbnRpY2F0aW9uUmVzdWx0LkFjY2Vzc1Rva2VuIGFzIHN0cmluZyxcbiAgICAgIGlkVG9rZW46IHJlc3BvbnNlLkF1dGhlbnRpY2F0aW9uUmVzdWx0LklkVG9rZW4gYXMgc3RyaW5nLFxuICAgICAgcmVmcmVzaFRva2VuOiByZWZyZXNoVG9rZW4sIC8vIE1hbnRlbmVyIGVsIG1pc21vIHJlZnJlc2ggdG9rZW5cbiAgICAgIGV4cGlyZXNJbjogcmVzcG9uc2UuQXV0aGVudGljYXRpb25SZXN1bHQuRXhwaXJlc0luIHx8IDM2MDBcbiAgICB9O1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGFsIHJlZnJlc2NhciB0b2tlbjonLCBlcnJvcik7XG4gICAgdGhyb3cgZXJyb3I7XG4gIH1cbn1cblxuLy8gQ3JlYXIgdXN1YXJpbyAoc29sbyBhZG1pbilcbmFzeW5jIGNyZWF0ZVVzZXIodXNlcjoge1xuICBlbWFpbDogc3RyaW5nO1xuICBuYW1lOiBzdHJpbmc7XG4gIHBhc3N3b3JkOiBzdHJpbmc7XG4gIHJvbGVJZDogc3RyaW5nO1xufSk6IFByb21pc2U8dm9pZD4ge1xuICB0cnkge1xuICAgIGNvbnN0IGNvbW1hbmQgPSBuZXcgQWRtaW5DcmVhdGVVc2VyQ29tbWFuZCh7XG4gICAgICBVc2VyUG9vbElkOiB0aGlzLnVzZXJQb29sSWQsXG4gICAgICBVc2VybmFtZTogdXNlci5lbWFpbCxcbiAgICAgIFRlbXBvcmFyeVBhc3N3b3JkOiB1c2VyLnBhc3N3b3JkLFxuICAgICAgVXNlckF0dHJpYnV0ZXM6IFtcbiAgICAgICAge1xuICAgICAgICAgIE5hbWU6ICdlbWFpbCcsXG4gICAgICAgICAgVmFsdWU6IHVzZXIuZW1haWxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIE5hbWU6ICdlbWFpbF92ZXJpZmllZCcsXG4gICAgICAgICAgVmFsdWU6ICd0cnVlJ1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgTmFtZTogJ25hbWUnLFxuICAgICAgICAgIFZhbHVlOiB1c2VyLm5hbWVcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIE5hbWU6ICdjdXN0b206cm9sZScsXG4gICAgICAgICAgVmFsdWU6IHVzZXIucm9sZUlkXG4gICAgICAgIH1cbiAgICAgIF1cbiAgICB9KTtcbiAgICBcbiAgICBhd2FpdCB0aGlzLmNsaWVudC5zZW5kKGNvbW1hbmQpO1xuICAgIFxuICAgIC8vIEFxdcOtIGRlYmVyw61hbW9zIGNyZWFyIHRhbWJpw6luIGVsIHVzdWFyaW8gZW4gbnVlc3RyYSBCRFxuICAgIC8vIHkgdmluY3VsYXIgZWwgaWQgZGUgQ29nbml0b1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGFsIGNyZWFyIHVzdWFyaW86JywgZXJyb3IpO1xuICAgIHRocm93IGVycm9yO1xuICB9XG59XG59XG5cbi8vIFNpbmdsZXRvbiBwYXJhIHVzbyBlbiBsYSBhcGxpY2FjacOzblxuZXhwb3J0IGNvbnN0IGNvZ25pdG9TZXJ2aWNlID0gbmV3IENvZ25pdG9BdXRoU2VydmljZSgpOyJdLCJuYW1lcyI6WyJDb2duaXRvSWRlbnRpdHlQcm92aWRlckNsaWVudCIsIkluaXRpYXRlQXV0aENvbW1hbmQiLCJHZXRVc2VyQ29tbWFuZCIsIkFkbWluQ3JlYXRlVXNlckNvbW1hbmQiLCJHbG9iYWxTaWduT3V0Q29tbWFuZCIsIlNpZ25VcENvbW1hbmQiLCJDb25maXJtU2lnblVwQ29tbWFuZCIsIlJlc2VuZENvbmZpcm1hdGlvbkNvZGVDb21tYW5kIiwiY3J5cHRvIiwiQ29nbml0b0F1dGhTZXJ2aWNlIiwiY29uc3RydWN0b3IiLCJjbGllbnQiLCJyZWdpb24iLCJwcm9jZXNzIiwiZW52IiwiQVdTX1JFR0lPTiIsInVzZXJQb29sSWQiLCJDT0dOSVRPX1VTRVJfUE9PTF9JRCIsImNsaWVudElkIiwiQ09HTklUT19DTElFTlRfSUQiLCJjbGllbnRTZWNyZXQiLCJDT0dOSVRPX0NMSUVOVF9TRUNSRVQiLCJjYWxjdWxhdGVTZWNyZXRIYXNoIiwidXNlcm5hbWUiLCJjb25zb2xlIiwiZXJyb3IiLCJFcnJvciIsIm1lc3NhZ2UiLCJobWFjIiwiY3JlYXRlSG1hYyIsInVwZGF0ZSIsImRpZ2VzdCIsInJlZ2lzdGVyVXNlciIsInBhcmFtcyIsImVtYWlsIiwicGFzc3dvcmQiLCJuYW1lIiwic2lnblVwQ29tbWFuZCIsIkNsaWVudElkIiwiVXNlcm5hbWUiLCJQYXNzd29yZCIsIlNlY3JldEhhc2giLCJVc2VyQXR0cmlidXRlcyIsIk5hbWUiLCJWYWx1ZSIsInJlc3BvbnNlIiwic2VuZCIsInN1Y2Nlc3MiLCJ1c2VySWQiLCJVc2VyU3ViIiwiY29uZmlybVJlZ2lzdHJhdGlvbiIsImNvbmZpcm1hdGlvbkNvZGUiLCJjb21tYW5kIiwiQ29uZmlybWF0aW9uQ29kZSIsInJlc2VuZENvbmZpcm1hdGlvbkNvZGUiLCJsb2dpbiIsImNyZWRlbnRpYWxzIiwibG9nIiwic3Vic3RyaW5nIiwiaGFzU2VjcmV0Iiwic2VjcmV0SGFzaCIsImF1dGhQYXJhbXMiLCJVU0VSTkFNRSIsIlBBU1NXT1JEIiwiU0VDUkVUX0hBU0giLCJBdXRoRmxvdyIsIkF1dGhQYXJhbWV0ZXJzIiwiQXV0aGVudGljYXRpb25SZXN1bHQiLCJDaGFsbGVuZ2VOYW1lIiwidXNlckluZm8iLCJnZXRVc2VySW5mbyIsIkFjY2Vzc1Rva2VuIiwidXNlciIsImFjY2Vzc1Rva2VuIiwicmVmcmVzaFRva2VuIiwiUmVmcmVzaFRva2VuIiwiaWRUb2tlbiIsIklkVG9rZW4iLCJleHBpcmVzSW4iLCJFeHBpcmVzSW4iLCIkbWV0YWRhdGEiLCJfX3R5cGUiLCJhdHRyaWJ1dGVzIiwiZmluZCIsImF0dHIiLCJzdWIiLCJpZCIsInJvbGVJZCIsImNyZWF0ZWRBdCIsIkRhdGUiLCJ1cGRhdGVkQXQiLCJzdWN1cnNhbElkIiwibG9nb3V0IiwiUkVGUkVTSF9UT0tFTiIsImNyZWF0ZVVzZXIiLCJVc2VyUG9vbElkIiwiVGVtcG9yYXJ5UGFzc3dvcmQiLCJjb2duaXRvU2VydmljZSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/server/services/auth/cognitoService.ts\n");

/***/ }),

/***/ "(ssr)/./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true!":
/*!******************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true! ***!
  \******************************************************************************************************/
/***/ (() => {



/***/ }),

/***/ "../app-render/after-task-async-storage.external":
/*!***********************************************************************************!*\
  !*** external "next/dist/server/app-render/after-task-async-storage.external.js" ***!
  \***********************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/after-task-async-storage.external.js");

/***/ }),

/***/ "../app-render/work-async-storage.external":
/*!*****************************************************************************!*\
  !*** external "next/dist/server/app-render/work-async-storage.external.js" ***!
  \*****************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/work-async-storage.external.js");

/***/ }),

/***/ "./work-unit-async-storage.external":
/*!**********************************************************************************!*\
  !*** external "next/dist/server/app-render/work-unit-async-storage.external.js" ***!
  \**********************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/work-unit-async-storage.external.js");

/***/ }),

/***/ "@prisma/client":
/*!*********************************!*\
  !*** external "@prisma/client" ***!
  \*********************************/
/***/ ((module) => {

"use strict";
module.exports = require("@prisma/client");

/***/ }),

/***/ "buffer":
/*!*************************!*\
  !*** external "buffer" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("buffer");

/***/ }),

/***/ "child_process":
/*!********************************!*\
  !*** external "child_process" ***!
  \********************************/
/***/ ((module) => {

"use strict";
module.exports = require("child_process");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("crypto");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

"use strict";
module.exports = require("fs");

/***/ }),

/***/ "fs/promises":
/*!******************************!*\
  !*** external "fs/promises" ***!
  \******************************/
/***/ ((module) => {

"use strict";
module.exports = require("fs/promises");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("http");

/***/ }),

/***/ "http2":
/*!************************!*\
  !*** external "http2" ***!
  \************************/
/***/ ((module) => {

"use strict";
module.exports = require("http2");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

"use strict";
module.exports = require("https");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "node:stream":
/*!******************************!*\
  !*** external "node:stream" ***!
  \******************************/
/***/ ((module) => {

"use strict";
module.exports = require("node:stream");

/***/ }),

/***/ "os":
/*!*********************!*\
  !*** external "os" ***!
  \*********************/
/***/ ((module) => {

"use strict";
module.exports = require("os");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("path");

/***/ }),

/***/ "process":
/*!**************************!*\
  !*** external "process" ***!
  \**************************/
/***/ ((module) => {

"use strict";
module.exports = require("process");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("stream");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = require("url");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("util");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/@aws-sdk","vendor-chunks/@smithy","vendor-chunks/next","vendor-chunks/zod"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fauth%2Flogin%2Froute&page=%2Fapi%2Fauth%2Flogin%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fauth%2Flogin%2Froute.ts&appDir=%2FUsers%2Fgastonmora%2FDesktop%2FProyectos%2FTulum%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fgastonmora%2FDesktop%2FProyectos%2FTulum&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();