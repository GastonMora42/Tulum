/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/auth/refresh/route";
exports.ids = ["app/api/auth/refresh/route"];
exports.modules = {

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fauth%2Frefresh%2Froute&page=%2Fapi%2Fauth%2Frefresh%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fauth%2Frefresh%2Froute.ts&appDir=%2FUsers%2Fgastonmora%2FDesktop%2FProyectos%2FTulum%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fgastonmora%2FDesktop%2FProyectos%2FTulum&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fauth%2Frefresh%2Froute&page=%2Fapi%2Fauth%2Frefresh%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fauth%2Frefresh%2Froute.ts&appDir=%2FUsers%2Fgastonmora%2FDesktop%2FProyectos%2FTulum%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fgastonmora%2FDesktop%2FProyectos%2FTulum&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   workAsyncStorage: () => (/* binding */ workAsyncStorage),\n/* harmony export */   workUnitAsyncStorage: () => (/* binding */ workUnitAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/route-kind */ \"(rsc)/./node_modules/next/dist/server/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_gastonmora_Desktop_Proyectos_Tulum_src_app_api_auth_refresh_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/auth/refresh/route.ts */ \"(rsc)/./src/app/api/auth/refresh/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/auth/refresh/route\",\n        pathname: \"/api/auth/refresh\",\n        filename: \"route\",\n        bundlePath: \"app/api/auth/refresh/route\"\n    },\n    resolvedPagePath: \"/Users/gastonmora/Desktop/Proyectos/Tulum/src/app/api/auth/refresh/route.ts\",\n    nextConfigOutput,\n    userland: _Users_gastonmora_Desktop_Proyectos_Tulum_src_app_api_auth_refresh_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { workAsyncStorage, workUnitAsyncStorage, serverHooks } = routeModule;\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        workAsyncStorage,\n        workUnitAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIvaW5kZXguanM/bmFtZT1hcHAlMkZhcGklMkZhdXRoJTJGcmVmcmVzaCUyRnJvdXRlJnBhZ2U9JTJGYXBpJTJGYXV0aCUyRnJlZnJlc2glMkZyb3V0ZSZhcHBQYXRocz0mcGFnZVBhdGg9cHJpdmF0ZS1uZXh0LWFwcC1kaXIlMkZhcGklMkZhdXRoJTJGcmVmcmVzaCUyRnJvdXRlLnRzJmFwcERpcj0lMkZVc2VycyUyRmdhc3Rvbm1vcmElMkZEZXNrdG9wJTJGUHJveWVjdG9zJTJGVHVsdW0lMkZzcmMlMkZhcHAmcGFnZUV4dGVuc2lvbnM9dHN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPWpzeCZwYWdlRXh0ZW5zaW9ucz1qcyZyb290RGlyPSUyRlVzZXJzJTJGZ2FzdG9ubW9yYSUyRkRlc2t0b3AlMkZQcm95ZWN0b3MlMkZUdWx1bSZpc0Rldj10cnVlJnRzY29uZmlnUGF0aD10c2NvbmZpZy5qc29uJmJhc2VQYXRoPSZhc3NldFByZWZpeD0mbmV4dENvbmZpZ091dHB1dD0mcHJlZmVycmVkUmVnaW9uPSZtaWRkbGV3YXJlQ29uZmlnPWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7QUFBK0Y7QUFDdkM7QUFDcUI7QUFDMkI7QUFDeEc7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLHlHQUFtQjtBQUMzQztBQUNBLGNBQWMsa0VBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLFlBQVk7QUFDWixDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsUUFBUSxzREFBc0Q7QUFDOUQ7QUFDQSxXQUFXLDRFQUFXO0FBQ3RCO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDMEY7O0FBRTFGIiwic291cmNlcyI6WyIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwUm91dGVSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL3JvdXRlLW1vZHVsZXMvYXBwLXJvdXRlL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgcGF0Y2hGZXRjaCBhcyBfcGF0Y2hGZXRjaCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi9wYXRjaC1mZXRjaFwiO1xuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIi9Vc2Vycy9nYXN0b25tb3JhL0Rlc2t0b3AvUHJveWVjdG9zL1R1bHVtL3NyYy9hcHAvYXBpL2F1dGgvcmVmcmVzaC9yb3V0ZS50c1wiO1xuLy8gV2UgaW5qZWN0IHRoZSBuZXh0Q29uZmlnT3V0cHV0IGhlcmUgc28gdGhhdCB3ZSBjYW4gdXNlIHRoZW0gaW4gdGhlIHJvdXRlXG4vLyBtb2R1bGUuXG5jb25zdCBuZXh0Q29uZmlnT3V0cHV0ID0gXCJcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvYXV0aC9yZWZyZXNoL3JvdXRlXCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkvYXV0aC9yZWZyZXNoXCIsXG4gICAgICAgIGZpbGVuYW1lOiBcInJvdXRlXCIsXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiYXBwL2FwaS9hdXRoL3JlZnJlc2gvcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCIvVXNlcnMvZ2FzdG9ubW9yYS9EZXNrdG9wL1Byb3llY3Rvcy9UdWx1bS9zcmMvYXBwL2FwaS9hdXRoL3JlZnJlc2gvcm91dGUudHNcIixcbiAgICBuZXh0Q29uZmlnT3V0cHV0LFxuICAgIHVzZXJsYW5kXG59KTtcbi8vIFB1bGwgb3V0IHRoZSBleHBvcnRzIHRoYXQgd2UgbmVlZCB0byBleHBvc2UgZnJvbSB0aGUgbW9kdWxlLiBUaGlzIHNob3VsZFxuLy8gYmUgZWxpbWluYXRlZCB3aGVuIHdlJ3ZlIG1vdmVkIHRoZSBvdGhlciByb3V0ZXMgdG8gdGhlIG5ldyBmb3JtYXQuIFRoZXNlXG4vLyBhcmUgdXNlZCB0byBob29rIGludG8gdGhlIHJvdXRlLlxuY29uc3QgeyB3b3JrQXN5bmNTdG9yYWdlLCB3b3JrVW5pdEFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MgfSA9IHJvdXRlTW9kdWxlO1xuZnVuY3Rpb24gcGF0Y2hGZXRjaCgpIHtcbiAgICByZXR1cm4gX3BhdGNoRmV0Y2goe1xuICAgICAgICB3b3JrQXN5bmNTdG9yYWdlLFxuICAgICAgICB3b3JrVW5pdEFzeW5jU3RvcmFnZVxuICAgIH0pO1xufVxuZXhwb3J0IHsgcm91dGVNb2R1bGUsIHdvcmtBc3luY1N0b3JhZ2UsIHdvcmtVbml0QXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgcGF0Y2hGZXRjaCwgIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFwcC1yb3V0ZS5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fauth%2Frefresh%2Froute&page=%2Fapi%2Fauth%2Frefresh%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fauth%2Frefresh%2Froute.ts&appDir=%2FUsers%2Fgastonmora%2FDesktop%2FProyectos%2FTulum%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fgastonmora%2FDesktop%2FProyectos%2FTulum&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true!":
/*!******************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true! ***!
  \******************************************************************************************************/
/***/ (() => {



/***/ }),

/***/ "(rsc)/./src/app/api/auth/refresh/route.ts":
/*!*******************************************!*\
  !*** ./src/app/api/auth/refresh/route.ts ***!
  \*******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _server_services_auth_authService__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/server/services/auth/authService */ \"(rsc)/./src/server/services/auth/authService.ts\");\n// src/app/api/auth/refresh/route.ts\n\n\nasync function POST(req) {\n    try {\n        const body = await req.json();\n        const { refreshToken, email } = body;\n        if (!refreshToken) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: 'Refresh token no proporcionado'\n            }, {\n                status: 400\n            });\n        }\n        // Refrescar token\n        const result = await _server_services_auth_authService__WEBPACK_IMPORTED_MODULE_1__.authService.refreshUserToken(refreshToken, email);\n        if (!result) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: 'Refresh token inválido o expirado'\n            }, {\n                status: 401\n            });\n        }\n        // Retornar nuevos tokens\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            accessToken: result.accessToken,\n            idToken: result.idToken\n        });\n    } catch (error) {\n        console.error('Error en refresh API:', error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: error.message || 'Error en el servidor'\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBwL2FwaS9hdXRoL3JlZnJlc2gvcm91dGUudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsb0NBQW9DO0FBQ29CO0FBQ1M7QUFFMUQsZUFBZUUsS0FBS0MsR0FBZ0I7SUFDekMsSUFBSTtRQUNGLE1BQU1DLE9BQU8sTUFBTUQsSUFBSUUsSUFBSTtRQUMzQixNQUFNLEVBQUVDLFlBQVksRUFBRUMsS0FBSyxFQUFFLEdBQUdIO1FBRWhDLElBQUksQ0FBQ0UsY0FBYztZQUNqQixPQUFPTixxREFBWUEsQ0FBQ0ssSUFBSSxDQUN0QjtnQkFBRUcsT0FBTztZQUFpQyxHQUMxQztnQkFBRUMsUUFBUTtZQUFJO1FBRWxCO1FBRUEsa0JBQWtCO1FBQ2xCLE1BQU1DLFNBQVMsTUFBTVQsMEVBQVdBLENBQUNVLGdCQUFnQixDQUFDTCxjQUFjQztRQUVoRSxJQUFJLENBQUNHLFFBQVE7WUFDWCxPQUFPVixxREFBWUEsQ0FBQ0ssSUFBSSxDQUN0QjtnQkFBRUcsT0FBTztZQUFvQyxHQUM3QztnQkFBRUMsUUFBUTtZQUFJO1FBRWxCO1FBRUEseUJBQXlCO1FBQ3pCLE9BQU9ULHFEQUFZQSxDQUFDSyxJQUFJLENBQUM7WUFDdkJPLGFBQWFGLE9BQU9FLFdBQVc7WUFDL0JDLFNBQVNILE9BQU9HLE9BQU87UUFDekI7SUFDRixFQUFFLE9BQU9MLE9BQVk7UUFDbkJNLFFBQVFOLEtBQUssQ0FBQyx5QkFBeUJBO1FBQ3ZDLE9BQU9SLHFEQUFZQSxDQUFDSyxJQUFJLENBQ3RCO1lBQUVHLE9BQU9BLE1BQU1PLE9BQU8sSUFBSTtRQUF1QixHQUNqRDtZQUFFTixRQUFRO1FBQUk7SUFFbEI7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL2dhc3Rvbm1vcmEvRGVza3RvcC9Qcm95ZWN0b3MvVHVsdW0vc3JjL2FwcC9hcGkvYXV0aC9yZWZyZXNoL3JvdXRlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIHNyYy9hcHAvYXBpL2F1dGgvcmVmcmVzaC9yb3V0ZS50c1xuaW1wb3J0IHsgTmV4dFJlcXVlc3QsIE5leHRSZXNwb25zZSB9IGZyb20gJ25leHQvc2VydmVyJztcbmltcG9ydCB7IGF1dGhTZXJ2aWNlIH0gZnJvbSAnQC9zZXJ2ZXIvc2VydmljZXMvYXV0aC9hdXRoU2VydmljZSc7XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBQT1NUKHJlcTogTmV4dFJlcXVlc3QpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBib2R5ID0gYXdhaXQgcmVxLmpzb24oKTtcbiAgICBjb25zdCB7IHJlZnJlc2hUb2tlbiwgZW1haWwgfSA9IGJvZHk7XG4gICAgXG4gICAgaWYgKCFyZWZyZXNoVG9rZW4pIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBlcnJvcjogJ1JlZnJlc2ggdG9rZW4gbm8gcHJvcG9yY2lvbmFkbycgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICApO1xuICAgIH1cbiAgICBcbiAgICAvLyBSZWZyZXNjYXIgdG9rZW5cbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBhdXRoU2VydmljZS5yZWZyZXNoVXNlclRva2VuKHJlZnJlc2hUb2tlbiwgZW1haWwpO1xuICAgIFxuICAgIGlmICghcmVzdWx0KSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgZXJyb3I6ICdSZWZyZXNoIHRva2VuIGludsOhbGlkbyBvIGV4cGlyYWRvJyB9LFxuICAgICAgICB7IHN0YXR1czogNDAxIH1cbiAgICAgICk7XG4gICAgfVxuICAgIFxuICAgIC8vIFJldG9ybmFyIG51ZXZvcyB0b2tlbnNcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgYWNjZXNzVG9rZW46IHJlc3VsdC5hY2Nlc3NUb2tlbixcbiAgICAgIGlkVG9rZW46IHJlc3VsdC5pZFRva2VuXG4gICAgfSk7XG4gIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBlbiByZWZyZXNoIEFQSTonLCBlcnJvcik7XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgeyBlcnJvcjogZXJyb3IubWVzc2FnZSB8fCAnRXJyb3IgZW4gZWwgc2Vydmlkb3InIH0sXG4gICAgICB7IHN0YXR1czogNTAwIH1cbiAgICApO1xuICB9XG59Il0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsImF1dGhTZXJ2aWNlIiwiUE9TVCIsInJlcSIsImJvZHkiLCJqc29uIiwicmVmcmVzaFRva2VuIiwiZW1haWwiLCJlcnJvciIsInN0YXR1cyIsInJlc3VsdCIsInJlZnJlc2hVc2VyVG9rZW4iLCJhY2Nlc3NUb2tlbiIsImlkVG9rZW4iLCJjb25zb2xlIiwibWVzc2FnZSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/auth/refresh/route.ts\n");

/***/ }),

/***/ "(rsc)/./src/server/db/client.ts":
/*!*********************************!*\
  !*** ./src/server/db/client.ts ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @prisma/client */ \"@prisma/client\");\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_prisma_client__WEBPACK_IMPORTED_MODULE_0__);\n// src/server/db/client.ts\n\n// Evitar múltiples instancias en desarrollo\nconst globalForPrisma = global;\nconst prisma = globalForPrisma.prisma ?? new _prisma_client__WEBPACK_IMPORTED_MODULE_0__.PrismaClient({\n    log:  true ? [\n        'query',\n        'error',\n        'warn'\n    ] : 0\n});\nif (true) globalForPrisma.prisma = prisma;\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (prisma);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmVyL2RiL2NsaWVudC50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSwwQkFBMEI7QUFDb0I7QUFFOUMsNENBQTRDO0FBQzVDLE1BQU1DLGtCQUFrQkM7QUFJeEIsTUFBTUMsU0FBU0YsZ0JBQWdCRSxNQUFNLElBQ25DLElBQUlILHdEQUFZQSxDQUFDO0lBQ2ZJLEtBQUtDLEtBQXNDLEdBQ3ZDO1FBQUM7UUFBUztRQUFTO0tBQU8sR0FDMUIsQ0FBUztBQUNmO0FBRUYsSUFBSUEsSUFBcUMsRUFBRUosZ0JBQWdCRSxNQUFNLEdBQUdBO0FBRXBFLGlFQUFlQSxNQUFNQSxFQUFDIiwic291cmNlcyI6WyIvVXNlcnMvZ2FzdG9ubW9yYS9EZXNrdG9wL1Byb3llY3Rvcy9UdWx1bS9zcmMvc2VydmVyL2RiL2NsaWVudC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBzcmMvc2VydmVyL2RiL2NsaWVudC50c1xuaW1wb3J0IHsgUHJpc21hQ2xpZW50IH0gZnJvbSAnQHByaXNtYS9jbGllbnQnO1xuXG4vLyBFdml0YXIgbcO6bHRpcGxlcyBpbnN0YW5jaWFzIGVuIGRlc2Fycm9sbG9cbmNvbnN0IGdsb2JhbEZvclByaXNtYSA9IGdsb2JhbCBhcyB1bmtub3duIGFzIHtcbiAgcHJpc21hOiBQcmlzbWFDbGllbnQgfCB1bmRlZmluZWQ7XG59O1xuXG5jb25zdCBwcmlzbWEgPSBnbG9iYWxGb3JQcmlzbWEucHJpc21hID8/IFxuICBuZXcgUHJpc21hQ2xpZW50KHtcbiAgICBsb2c6IHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAnZGV2ZWxvcG1lbnQnIFxuICAgICAgPyBbJ3F1ZXJ5JywgJ2Vycm9yJywgJ3dhcm4nXSBcbiAgICAgIDogWydlcnJvciddLFxuICB9KTtcblxuaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicpIGdsb2JhbEZvclByaXNtYS5wcmlzbWEgPSBwcmlzbWE7XG5cbmV4cG9ydCBkZWZhdWx0IHByaXNtYTsiXSwibmFtZXMiOlsiUHJpc21hQ2xpZW50IiwiZ2xvYmFsRm9yUHJpc21hIiwiZ2xvYmFsIiwicHJpc21hIiwibG9nIiwicHJvY2VzcyJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/server/db/client.ts\n");

/***/ }),

/***/ "(rsc)/./src/server/services/auth/authService.ts":
/*!*************************************************!*\
  !*** ./src/server/services/auth/authService.ts ***!
  \*************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   AuthService: () => (/* binding */ AuthService),\n/* harmony export */   authService: () => (/* binding */ authService),\n/* harmony export */   refreshToken: () => (/* binding */ refreshToken)\n/* harmony export */ });\n/* harmony import */ var _server_db_client__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/server/db/client */ \"(rsc)/./src/server/db/client.ts\");\n/* harmony import */ var _cognitoService__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./cognitoService */ \"(rsc)/./src/server/services/auth/cognitoService.ts\");\n// src/server/services/auth/authService.ts\n\n\n// Servicio de autenticación que actúa como fachada para Cognito\nclass AuthService {\n    // Login\n    async login(credentials) {\n        try {\n            // Autenticar con Cognito\n            const cognitoResult = await _cognitoService__WEBPACK_IMPORTED_MODULE_1__.cognitoService.login(credentials);\n            // Buscar usuario en nuestra BD\n            let user = await _server_db_client__WEBPACK_IMPORTED_MODULE_0__[\"default\"].user.findFirst({\n                where: {\n                    email: credentials.email\n                },\n                include: {\n                    role: true\n                }\n            });\n            console.log('Usuario encontrado:', user);\n            console.log('Rol del usuario:', user?.role);\n            // Si no existe el usuario, lo creamos\n            if (!user) {\n                console.log(\"Usuario no encontrado en BD local, creando...\");\n                // Buscar primero un rol (preferiblemente admin)\n                let role = await _server_db_client__WEBPACK_IMPORTED_MODULE_0__[\"default\"].role.findFirst({\n                    where: {\n                        name: 'admin'\n                    }\n                });\n                // Si no existe ningún rol, necesitamos crear al menos uno\n                if (!role) {\n                    console.log(\"Creando rol 'admin' porque no existe\");\n                    role = await _server_db_client__WEBPACK_IMPORTED_MODULE_0__[\"default\"].role.create({\n                        data: {\n                            name: 'admin',\n                            permissions: [\n                                '*'\n                            ] // Todos los permisos como JSON\n                        }\n                    });\n                }\n                // Crear el usuario con el rol encontrado o creado\n                user = await _server_db_client__WEBPACK_IMPORTED_MODULE_0__[\"default\"].user.create({\n                    data: {\n                        id: cognitoResult.user.id,\n                        email: credentials.email,\n                        name: cognitoResult.user.name || credentials.email.split('@')[0],\n                        roleId: role.id\n                    },\n                    include: {\n                        role: true\n                    }\n                });\n                console.log(\"Usuario creado exitosamente:\", user.id);\n            }\n            // Devolvemos el resultado combinado\n            return {\n                ...cognitoResult,\n                user: {\n                    ...user,\n                    // Asegurarse de que usamos los datos de nuestra BD\n                    id: user.id,\n                    roleId: user.roleId\n                }\n            };\n        } catch (error) {\n            console.error('Error en login:', error);\n            throw error; // Propagar el error para que el cliente pueda manejarlo\n        }\n    }\n    // Cerrar sesión\n    async logout(accessToken) {\n        try {\n            await _cognitoService__WEBPACK_IMPORTED_MODULE_1__.cognitoService.logout(accessToken);\n            return true;\n        } catch (error) {\n            console.error('Error en logout:', error);\n            return false;\n        }\n    }\n    // Refrescar token\n    async refreshUserToken(refreshToken, email) {\n        try {\n            return await _cognitoService__WEBPACK_IMPORTED_MODULE_1__.cognitoService.refreshToken(refreshToken, email);\n        } catch (error) {\n            console.error('Error al refrescar token:', error);\n            return null;\n        }\n    }\n    // Obtener usuario por ID\n    async getUserById(userId) {\n        try {\n            const user = await _server_db_client__WEBPACK_IMPORTED_MODULE_0__[\"default\"].user.findUnique({\n                where: {\n                    id: userId\n                },\n                include: {\n                    role: true\n                }\n            });\n            if (!user) return null;\n            return user;\n        } catch (error) {\n            console.error('Error al obtener usuario:', error);\n            return null;\n        }\n    }\n    // Crear usuario (admin)\n    async createUser(userData) {\n        try {\n            // Verificar que el rol existe\n            const roleExists = await _server_db_client__WEBPACK_IMPORTED_MODULE_0__[\"default\"].role.findUnique({\n                where: {\n                    id: userData.roleId\n                }\n            });\n            if (!roleExists) {\n                throw new Error(`El rol con ID ${userData.roleId} no existe`);\n            }\n            // Si se proporciona sucursalId, verificar que existe\n            if (userData.sucursalId) {\n                const sucursalExists = await _server_db_client__WEBPACK_IMPORTED_MODULE_0__[\"default\"].ubicacion.findUnique({\n                    where: {\n                        id: userData.sucursalId\n                    }\n                });\n                if (!sucursalExists) {\n                    throw new Error(`La ubicación con ID ${userData.sucursalId} no existe`);\n                }\n            }\n            // Crear usuario en Cognito\n            await _cognitoService__WEBPACK_IMPORTED_MODULE_1__.cognitoService.createUser({\n                email: userData.email,\n                name: userData.name,\n                password: userData.password,\n                roleId: userData.roleId\n            });\n            // Crear usuario en nuestra BD\n            const user = await _server_db_client__WEBPACK_IMPORTED_MODULE_0__[\"default\"].user.create({\n                data: {\n                    email: userData.email,\n                    name: userData.name,\n                    roleId: userData.roleId,\n                    sucursalId: userData.sucursalId || null\n                }\n            });\n            return user;\n        } catch (error) {\n            console.error('Error al crear usuario:', error);\n            throw error;\n        }\n    }\n    // Registrar un nuevo usuario\n    async registerUser(userData) {\n        try {\n            // Registrar en Cognito\n            const cognitoResult = await _cognitoService__WEBPACK_IMPORTED_MODULE_1__.cognitoService.registerUser({\n                email: userData.email,\n                name: userData.name,\n                password: userData.password\n            });\n            if (!cognitoResult.success) {\n                return {\n                    success: false,\n                    message: cognitoResult.message || 'Error al registrar usuario en Cognito',\n                    userId: cognitoResult.userId\n                };\n            }\n            return {\n                success: true,\n                message: cognitoResult.message || 'Usuario registrado exitosamente',\n                userId: cognitoResult.userId\n            };\n        } catch (error) {\n            console.error('Error en registro:', error);\n            return {\n                success: false,\n                message: 'Error al registrar usuario'\n            };\n        }\n    }\n    // Confirmar registro\n    async confirmRegistration(email, code) {\n        try {\n            return await _cognitoService__WEBPACK_IMPORTED_MODULE_1__.cognitoService.confirmRegistration(email, code);\n        } catch (error) {\n            console.error('Error al confirmar registro:', error);\n            return {\n                success: false,\n                message: 'Error al confirmar el registro'\n            };\n        }\n    }\n    // Reenviar código de confirmación\n    async resendConfirmationCode(email) {\n        try {\n            return await _cognitoService__WEBPACK_IMPORTED_MODULE_1__.cognitoService.resendConfirmationCode(email);\n        } catch (error) {\n            console.error('Error al reenviar código:', error);\n            return {\n                success: false,\n                message: 'Error al reenviar el código de verificación'\n            };\n        }\n    }\n}\n// Singleton para uso en la aplicación\nconst authService = new AuthService();\n// Función para el cliente (frontend)\nasync function refreshToken() {\n    const refreshToken = localStorage.getItem('refreshToken');\n    if (!refreshToken) return false;\n    try {\n        const response = await fetch('/api/auth/refresh', {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json'\n            },\n            body: JSON.stringify({\n                refreshToken\n            })\n        });\n        if (!response.ok) return false;\n        const data = await response.json();\n        // Actualizar tokens\n        localStorage.setItem('accessToken', data.accessToken);\n        localStorage.setItem('idToken', data.idToken);\n        return true;\n    } catch (error) {\n        console.error('Error al refrescar token:', error);\n        return false;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmVyL3NlcnZpY2VzL2F1dGgvYXV0aFNlcnZpY2UudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQSwwQ0FBMEM7QUFFRjtBQUN3QztBQUVoRixnRUFBZ0U7QUFDekQsTUFBTUU7SUFDWCxRQUFRO0lBQ1IsTUFBTUMsTUFBTUMsV0FBNkIsRUFBOEI7UUFDckUsSUFBSTtZQUNGLHlCQUF5QjtZQUN6QixNQUFNQyxnQkFBZ0IsTUFBTUosMkRBQWNBLENBQUNFLEtBQUssQ0FBQ0M7WUFFakQsK0JBQStCO1lBQy9CLElBQUlFLE9BQU8sTUFBTU4seURBQU1BLENBQUNNLElBQUksQ0FBQ0MsU0FBUyxDQUFDO2dCQUNyQ0MsT0FBTztvQkFDTEMsT0FBT0wsWUFBWUssS0FBSztnQkFDMUI7Z0JBQ0FDLFNBQVM7b0JBQ1BDLE1BQU07Z0JBQ1I7WUFDRjtZQUVJQyxRQUFRQyxHQUFHLENBQUMsdUJBQXVCUDtZQUN6Q00sUUFBUUMsR0FBRyxDQUFDLG9CQUFvQlAsTUFBTUs7WUFFcEMsc0NBQXNDO1lBQ3RDLElBQUksQ0FBQ0wsTUFBTTtnQkFDVE0sUUFBUUMsR0FBRyxDQUFDO2dCQUVaLGdEQUFnRDtnQkFDaEQsSUFBSUYsT0FBTyxNQUFNWCx5REFBTUEsQ0FBQ1csSUFBSSxDQUFDSixTQUFTLENBQUM7b0JBQ3JDQyxPQUFPO3dCQUFFTSxNQUFNO29CQUFRO2dCQUN6QjtnQkFFQSwwREFBMEQ7Z0JBQzFELElBQUksQ0FBQ0gsTUFBTTtvQkFDVEMsUUFBUUMsR0FBRyxDQUFDO29CQUNaRixPQUFPLE1BQU1YLHlEQUFNQSxDQUFDVyxJQUFJLENBQUNJLE1BQU0sQ0FBQzt3QkFDOUJDLE1BQU07NEJBQ0pGLE1BQU07NEJBQ05HLGFBQWE7Z0NBQUM7NkJBQUksQ0FBQywrQkFBK0I7d0JBQ3BEO29CQUNGO2dCQUNGO2dCQUVBLGtEQUFrRDtnQkFDbERYLE9BQU8sTUFBTU4seURBQU1BLENBQUNNLElBQUksQ0FBQ1MsTUFBTSxDQUFDO29CQUM5QkMsTUFB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ZXJzL2dhc3Rvbm1vcmEvRGVza3RvcC9Qcm95ZWN0b3MvVHVsdW0vc3JjL3NlcnZlci9zZXJ2aWNlcy9hdXRoL2F1dGhTZXJ2aWNlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIHNyYy9zZXJ2ZXIvc2VydmljZXMvYXV0aC9hdXRoU2VydmljZS50c1xuaW1wb3J0IHsgVXNlciB9IGZyb20gJ0BwcmlzbWEvY2xpZW50JztcbmltcG9ydCBwcmlzbWEgZnJvbSAnQC9zZXJ2ZXIvZGIvY2xpZW50JztcbmltcG9ydCB7IGNvZ25pdG9TZXJ2aWNlLCBMb2dpbkNyZWRlbnRpYWxzLCBBdXRoUmVzdWx0IH0gZnJvbSAnLi9jb2duaXRvU2VydmljZSc7XG5cbi8vIFNlcnZpY2lvIGRlIGF1dGVudGljYWNpw7NuIHF1ZSBhY3TDumEgY29tbyBmYWNoYWRhIHBhcmEgQ29nbml0b1xuZXhwb3J0IGNsYXNzIEF1dGhTZXJ2aWNlIHtcbiAgLy8gTG9naW5cbiAgYXN5bmMgbG9naW4oY3JlZGVudGlhbHM6IExvZ2luQ3JlZGVudGlhbHMpOiBQcm9taXNlPEF1dGhSZXN1bHQgfCBudWxsPiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIEF1dGVudGljYXIgY29uIENvZ25pdG9cbiAgICAgIGNvbnN0IGNvZ25pdG9SZXN1bHQgPSBhd2FpdCBjb2duaXRvU2VydmljZS5sb2dpbihjcmVkZW50aWFscyk7XG4gICAgICBcbiAgICAgIC8vIEJ1c2NhciB1c3VhcmlvIGVuIG51ZXN0cmEgQkRcbiAgICAgIGxldCB1c2VyID0gYXdhaXQgcHJpc21hLnVzZXIuZmluZEZpcnN0KHtcbiAgICAgICAgd2hlcmU6IHsgXG4gICAgICAgICAgZW1haWw6IGNyZWRlbnRpYWxzLmVtYWlsIFxuICAgICAgICB9LFxuICAgICAgICBpbmNsdWRlOiB7IFxuICAgICAgICAgIHJvbGU6IHRydWUgXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgXG4gICAgICAgICAgY29uc29sZS5sb2coJ1VzdWFyaW8gZW5jb250cmFkbzonLCB1c2VyKTtcbiAgICBjb25zb2xlLmxvZygnUm9sIGRlbCB1c3VhcmlvOicsIHVzZXI/LnJvbGUpO1xuICAgIFxuICAgICAgLy8gU2kgbm8gZXhpc3RlIGVsIHVzdWFyaW8sIGxvIGNyZWFtb3NcbiAgICAgIGlmICghdXNlcikge1xuICAgICAgICBjb25zb2xlLmxvZyhcIlVzdWFyaW8gbm8gZW5jb250cmFkbyBlbiBCRCBsb2NhbCwgY3JlYW5kby4uLlwiKTtcbiAgICAgICAgXG4gICAgICAgIC8vIEJ1c2NhciBwcmltZXJvIHVuIHJvbCAocHJlZmVyaWJsZW1lbnRlIGFkbWluKVxuICAgICAgICBsZXQgcm9sZSA9IGF3YWl0IHByaXNtYS5yb2xlLmZpbmRGaXJzdCh7XG4gICAgICAgICAgd2hlcmU6IHsgbmFtZTogJ2FkbWluJyB9XG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgLy8gU2kgbm8gZXhpc3RlIG5pbmfDum4gcm9sLCBuZWNlc2l0YW1vcyBjcmVhciBhbCBtZW5vcyB1bm9cbiAgICAgICAgaWYgKCFyb2xlKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coXCJDcmVhbmRvIHJvbCAnYWRtaW4nIHBvcnF1ZSBubyBleGlzdGVcIik7XG4gICAgICAgICAgcm9sZSA9IGF3YWl0IHByaXNtYS5yb2xlLmNyZWF0ZSh7XG4gICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgIG5hbWU6ICdhZG1pbicsXG4gICAgICAgICAgICAgIHBlcm1pc3Npb25zOiBbJyonXSAvLyBUb2RvcyBsb3MgcGVybWlzb3MgY29tbyBKU09OXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIC8vIENyZWFyIGVsIHVzdWFyaW8gY29uIGVsIHJvbCBlbmNvbnRyYWRvIG8gY3JlYWRvXG4gICAgICAgIHVzZXIgPSBhd2FpdCBwcmlzbWEudXNlci5jcmVhdGUoe1xuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIGlkOiBjb2duaXRvUmVzdWx0LnVzZXIuaWQsIC8vIFVzYXIgZWwgc3ViIGRlIENvZ25pdG8gY29tbyBJRFxuICAgICAgICAgICAgZW1haWw6IGNyZWRlbnRpYWxzLmVtYWlsLFxuICAgICAgICAgICAgbmFtZTogY29nbml0b1Jlc3VsdC51c2VyLm5hbWUgfHwgY3JlZGVudGlhbHMuZW1haWwuc3BsaXQoJ0AnKVswXSxcbiAgICAgICAgICAgIHJvbGVJZDogcm9sZS5pZCxcbiAgICAgICAgICAgIC8vIE5vIGluY2x1aW1vcyBzdWN1cnNhbElkIHlhIHF1ZSBlcyBvcGNpb25hbCBlbiB0dSBlc3F1ZW1hXG4gICAgICAgICAgfSxcbiAgICAgICAgICBpbmNsdWRlOiB7IFxuICAgICAgICAgICAgcm9sZTogdHJ1ZSBcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgY29uc29sZS5sb2coXCJVc3VhcmlvIGNyZWFkbyBleGl0b3NhbWVudGU6XCIsIHVzZXIuaWQpO1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBEZXZvbHZlbW9zIGVsIHJlc3VsdGFkbyBjb21iaW5hZG9cbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLmNvZ25pdG9SZXN1bHQsXG4gICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAuLi51c2VyLFxuICAgICAgICAgIC8vIEFzZWd1cmFyc2UgZGUgcXVlIHVzYW1vcyBsb3MgZGF0b3MgZGUgbnVlc3RyYSBCRFxuICAgICAgICAgIGlkOiB1c2VyLmlkLFxuICAgICAgICAgIHJvbGVJZDogdXNlci5yb2xlSWRcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZW4gbG9naW46JywgZXJyb3IpO1xuICAgICAgdGhyb3cgZXJyb3I7IC8vIFByb3BhZ2FyIGVsIGVycm9yIHBhcmEgcXVlIGVsIGNsaWVudGUgcHVlZGEgbWFuZWphcmxvXG4gICAgfVxuICB9XG4gIFxuICAvLyBDZXJyYXIgc2VzacOzblxuICBhc3luYyBsb2dvdXQoYWNjZXNzVG9rZW46IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCBjb2duaXRvU2VydmljZS5sb2dvdXQoYWNjZXNzVG9rZW4pO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGVuIGxvZ291dDonLCBlcnJvcik7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG4gIFxuICAvLyBSZWZyZXNjYXIgdG9rZW5cbiAgYXN5bmMgcmVmcmVzaFVzZXJUb2tlbihyZWZyZXNoVG9rZW46IHN0cmluZywgZW1haWw/OiBzdHJpbmcpOiBQcm9taXNlPE9taXQ8QXV0aFJlc3VsdCwgJ3VzZXInPiB8IG51bGw+IHtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIGF3YWl0IGNvZ25pdG9TZXJ2aWNlLnJlZnJlc2hUb2tlbihyZWZyZXNoVG9rZW4sIGVtYWlsKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgYWwgcmVmcmVzY2FyIHRva2VuOicsIGVycm9yKTtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgfVxuICBcbiAgLy8gT2J0ZW5lciB1c3VhcmlvIHBvciBJRFxuICBhc3luYyBnZXRVc2VyQnlJZCh1c2VySWQ6IHN0cmluZyk6IFByb21pc2U8T21pdDxVc2VyLCAncGFzc3dvcmQnPiB8IG51bGw+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgdXNlciA9IGF3YWl0IHByaXNtYS51c2VyLmZpbmRVbmlxdWUoe1xuICAgICAgICB3aGVyZTogeyBpZDogdXNlcklkIH0sXG4gICAgICAgIGluY2x1ZGU6IHsgcm9sZTogdHJ1ZSB9XG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgaWYgKCF1c2VyKSByZXR1cm4gbnVsbDtcbiAgICAgIFxuICAgICAgcmV0dXJuIHVzZXI7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGFsIG9idGVuZXIgdXN1YXJpbzonLCBlcnJvcik7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gIH1cbiAgXG4gIC8vIENyZWFyIHVzdWFyaW8gKGFkbWluKVxuICBhc3luYyBjcmVhdGVVc2VyKHVzZXJEYXRhOiB7XG4gICAgZW1haWw6IHN0cmluZztcbiAgICBuYW1lOiBzdHJpbmc7XG4gICAgcGFzc3dvcmQ6IHN0cmluZztcbiAgICByb2xlSWQ6IHN0cmluZztcbiAgICBzdWN1cnNhbElkPzogc3RyaW5nO1xuICB9KTogUHJvbWlzZTxVc2VyIHwgbnVsbD4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBWZXJpZmljYXIgcXVlIGVsIHJvbCBleGlzdGVcbiAgICAgIGNvbnN0IHJvbGVFeGlzdHMgPSBhd2FpdCBwcmlzbWEucm9sZS5maW5kVW5pcXVlKHtcbiAgICAgICAgd2hlcmU6IHsgaWQ6IHVzZXJEYXRhLnJvbGVJZCB9XG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgaWYgKCFyb2xlRXhpc3RzKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgRWwgcm9sIGNvbiBJRCAke3VzZXJEYXRhLnJvbGVJZH0gbm8gZXhpc3RlYCk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIFNpIHNlIHByb3BvcmNpb25hIHN1Y3Vyc2FsSWQsIHZlcmlmaWNhciBxdWUgZXhpc3RlXG4gICAgICBpZiAodXNlckRhdGEuc3VjdXJzYWxJZCkge1xuICAgICAgICBjb25zdCBzdWN1cnNhbEV4aXN0cyA9IGF3YWl0IHByaXNtYS51YmljYWNpb24uZmluZFVuaXF1ZSh7XG4gICAgICAgICAgd2hlcmU6IHsgaWQ6IHVzZXJEYXRhLnN1Y3Vyc2FsSWQgfVxuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIGlmICghc3VjdXJzYWxFeGlzdHMpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYExhIHViaWNhY2nDs24gY29uIElEICR7dXNlckRhdGEuc3VjdXJzYWxJZH0gbm8gZXhpc3RlYCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gQ3JlYXIgdXN1YXJpbyBlbiBDb2duaXRvXG4gICAgICBhd2FpdCBjb2duaXRvU2VydmljZS5jcmVhdGVVc2VyKHtcbiAgICAgICAgZW1haWw6IHVzZXJEYXRhLmVtYWlsLFxuICAgICAgICBuYW1lOiB1c2VyRGF0YS5uYW1lLFxuICAgICAgICBwYXNzd29yZDogdXNlckRhdGEucGFzc3dvcmQsXG4gICAgICAgIHJvbGVJZDogdXNlckRhdGEucm9sZUlkXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgLy8gQ3JlYXIgdXN1YXJpbyBlbiBudWVzdHJhIEJEXG4gICAgICBjb25zdCB1c2VyID0gYXdhaXQgcHJpc21hLnVzZXIuY3JlYXRlKHtcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIGVtYWlsOiB1c2VyRGF0YS5lbWFpbCxcbiAgICAgICAgICBuYW1lOiB1c2VyRGF0YS5uYW1lLFxuICAgICAgICAgIHJvbGVJZDogdXNlckRhdGEucm9sZUlkLFxuICAgICAgICAgIHN1Y3Vyc2FsSWQ6IHVzZXJEYXRhLnN1Y3Vyc2FsSWQgfHwgbnVsbFxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgcmV0dXJuIHVzZXI7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGFsIGNyZWFyIHVzdWFyaW86JywgZXJyb3IpO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgLy8gUmVnaXN0cmFyIHVuIG51ZXZvIHVzdWFyaW9cbiAgYXN5bmMgcmVnaXN0ZXJVc2VyKHVzZXJEYXRhOiB7XG4gICAgZW1haWw6IHN0cmluZztcbiAgICBuYW1lOiBzdHJpbmc7XG4gICAgcGFzc3dvcmQ6IHN0cmluZztcbiAgfSk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuOyBtZXNzYWdlOiBzdHJpbmc7IHVzZXJJZD86IHN0cmluZyB9PiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIFJlZ2lzdHJhciBlbiBDb2duaXRvXG4gICAgICBjb25zdCBjb2duaXRvUmVzdWx0ID0gYXdhaXQgY29nbml0b1NlcnZpY2UucmVnaXN0ZXJVc2VyKHtcbiAgICAgICAgZW1haWw6IHVzZXJEYXRhLmVtYWlsLFxuICAgICAgICBuYW1lOiB1c2VyRGF0YS5uYW1lLFxuICAgICAgICBwYXNzd29yZDogdXNlckRhdGEucGFzc3dvcmRcbiAgICAgIH0pO1xuICAgICAgaWYgKCFjb2duaXRvUmVzdWx0LnN1Y2Nlc3MpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBtZXNzYWdlOiBjb2duaXRvUmVzdWx0Lm1lc3NhZ2UgfHwgJ0Vycm9yIGFsIHJlZ2lzdHJhciB1c3VhcmlvIGVuIENvZ25pdG8nLFxuICAgICAgICAgIHVzZXJJZDogY29nbml0b1Jlc3VsdC51c2VySWRcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgbWVzc2FnZTogY29nbml0b1Jlc3VsdC5tZXNzYWdlIHx8ICdVc3VhcmlvIHJlZ2lzdHJhZG8gZXhpdG9zYW1lbnRlJyxcbiAgICAgICAgdXNlcklkOiBjb2duaXRvUmVzdWx0LnVzZXJJZFxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZW4gcmVnaXN0cm86JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdFcnJvciBhbCByZWdpc3RyYXIgdXN1YXJpbydcbiAgICAgIH07XG4gICAgfVxuICB9XG5cbiAgLy8gQ29uZmlybWFyIHJlZ2lzdHJvXG4gIGFzeW5jIGNvbmZpcm1SZWdpc3RyYXRpb24oZW1haWw6IHN0cmluZywgY29kZTogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG1lc3NhZ2U6IHN0cmluZyB9PiB7XG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiBhd2FpdCBjb2duaXRvU2VydmljZS5jb25maXJtUmVnaXN0cmF0aW9uKGVtYWlsLCBjb2RlKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgYWwgY29uZmlybWFyIHJlZ2lzdHJvOicsIGVycm9yKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnRXJyb3IgYWwgY29uZmlybWFyIGVsIHJlZ2lzdHJvJ1xuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICAvLyBSZWVudmlhciBjw7NkaWdvIGRlIGNvbmZpcm1hY2nDs25cbiAgYXN5bmMgcmVzZW5kQ29uZmlybWF0aW9uQ29kZShlbWFpbDogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG1lc3NhZ2U6IHN0cmluZyB9PiB7XG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiBhd2FpdCBjb2duaXRvU2VydmljZS5yZXNlbmRDb25maXJtYXRpb25Db2RlKGVtYWlsKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgYWwgcmVlbnZpYXIgY8OzZGlnbzonLCBlcnJvcik7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogJ0Vycm9yIGFsIHJlZW52aWFyIGVsIGPDs2RpZ28gZGUgdmVyaWZpY2FjacOzbidcbiAgICAgIH07XG4gICAgfVxuICB9XG59XG5cbi8vIFNpbmdsZXRvbiBwYXJhIHVzbyBlbiBsYSBhcGxpY2FjacOzblxuZXhwb3J0IGNvbnN0IGF1dGhTZXJ2aWNlID0gbmV3IEF1dGhTZXJ2aWNlKCk7XG5cbi8vIEZ1bmNpw7NuIHBhcmEgZWwgY2xpZW50ZSAoZnJvbnRlbmQpXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcmVmcmVzaFRva2VuKCk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICBjb25zdCByZWZyZXNoVG9rZW4gPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgncmVmcmVzaFRva2VuJyk7XG4gIGlmICghcmVmcmVzaFRva2VuKSByZXR1cm4gZmFsc2U7XG4gIFxuICB0cnkge1xuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goJy9hcGkvYXV0aC9yZWZyZXNoJywge1xuICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICBoZWFkZXJzOiB7ICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicgfSxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgcmVmcmVzaFRva2VuIH0pXG4gICAgfSk7XG4gICAgXG4gICAgaWYgKCFyZXNwb25zZS5vaykgcmV0dXJuIGZhbHNlO1xuICAgIFxuICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgXG4gICAgLy8gQWN0dWFsaXphciB0b2tlbnNcbiAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnYWNjZXNzVG9rZW4nLCBkYXRhLmFjY2Vzc1Rva2VuKTtcbiAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnaWRUb2tlbicsIGRhdGEuaWRUb2tlbik7XG4gICAgXG4gICAgcmV0dXJuIHRydWU7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgYWwgcmVmcmVzY2FyIHRva2VuOicsIGVycm9yKTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbn0iXSwibmFtZXMiOlsicHJpc21hIiwiY29nbml0b1NlcnZpY2UiLCJBdXRoU2VydmljZSIsImxvZ2luIiwiY3JlZGVudGlhbHMiLCJjb2duaXRvUmVzdWx0IiwidXNlciIsImZpbmRGaXJzdCIsIndoZXJlIiwiZW1haWwiLCJpbmNsdWRlIiwicm9sZSIsImNvbnNvbGUiLCJsb2ciLCJuYW1lIiwiY3JlYXRlIiwiZGF0YSIsInBlcm1pc3Npb25zIiwiaWQiLCJzcGxpdCIsInJvbGVJZCIsImVycm9yIiwibG9nb3V0IiwiYWNjZXNzVG9rZW4iLCJyZWZyZXNoVXNlclRva2VuIiwicmVmcmVzaFRva2VuIiwiZ2V0VXNlckJ5SWQiLCJ1c2VySWQiLCJmaW5kVW5pcXVlIiwiY3JlYXRlVXNlciIsInVzZXJEYXRhIiwicm9sZUV4aXN0cyIsIkVycm9yIiwic3VjdXJzYWxJZCIsInN1Y3Vyc2FsRXhpc3RzIiwidWJpY2FjaW9uIiwicGFzc3dvcmQiLCJyZWdpc3RlclVzZXIiLCJzdWNjZXNzIiwibWVzc2FnZSIsImNvbmZpcm1SZWdpc3RyYXRpb24iLCJjb2RlIiwicmVzZW5kQ29uZmlybWF0aW9uQ29kZSIsImF1dGhTZXJ2aWNlIiwibG9jYWxTdG9yYWdlIiwiZ2V0SXRlbSIsInJlc3BvbnNlIiwiZmV0Y2giLCJtZXRob2QiLCJoZWFkZXJzIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJvayIsImpzb24iLCJzZXRJdGVtIiwiaWRUb2tlbiJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/server/services/auth/authService.ts\n");

/***/ }),

/***/ "(rsc)/./src/server/services/auth/cognitoService.ts":
/*!****************************************************!*\
  !*** ./src/server/services/auth/cognitoService.ts ***!
  \****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   CognitoAuthService: () => (/* binding */ CognitoAuthService),\n/* harmony export */   cognitoService: () => (/* binding */ cognitoService)\n/* harmony export */ });\n/* harmony import */ var _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @aws-sdk/client-cognito-identity-provider */ \"(rsc)/./node_modules/@aws-sdk/client-cognito-identity-provider/dist-es/CognitoIdentityProviderClient.js\");\n/* harmony import */ var _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @aws-sdk/client-cognito-identity-provider */ \"(rsc)/./node_modules/@aws-sdk/client-cognito-identity-provider/dist-es/commands/SignUpCommand.js\");\n/* harmony import */ var _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @aws-sdk/client-cognito-identity-provider */ \"(rsc)/./node_modules/@aws-sdk/client-cognito-identity-provider/dist-es/commands/ConfirmSignUpCommand.js\");\n/* harmony import */ var _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @aws-sdk/client-cognito-identity-provider */ \"(rsc)/./node_modules/@aws-sdk/client-cognito-identity-provider/dist-es/commands/ResendConfirmationCodeCommand.js\");\n/* harmony import */ var _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @aws-sdk/client-cognito-identity-provider */ \"(rsc)/./node_modules/@aws-sdk/client-cognito-identity-provider/dist-es/commands/InitiateAuthCommand.js\");\n/* harmony import */ var _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @aws-sdk/client-cognito-identity-provider */ \"(rsc)/./node_modules/@aws-sdk/client-cognito-identity-provider/dist-es/commands/GetUserCommand.js\");\n/* harmony import */ var _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @aws-sdk/client-cognito-identity-provider */ \"(rsc)/./node_modules/@aws-sdk/client-cognito-identity-provider/dist-es/commands/GlobalSignOutCommand.js\");\n/* harmony import */ var _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! @aws-sdk/client-cognito-identity-provider */ \"(rsc)/./node_modules/@aws-sdk/client-cognito-identity-provider/dist-es/commands/AdminCreateUserCommand.js\");\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! crypto */ \"crypto\");\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(crypto__WEBPACK_IMPORTED_MODULE_0__);\n// src/server/services/auth/cognitoService.ts\n\n\nclass CognitoAuthService {\n    constructor(){\n        this.client = new _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_1__.CognitoIdentityProviderClient({\n            region: process.env.AWS_REGION\n        });\n        this.userPoolId = process.env.COGNITO_USER_POOL_ID;\n        this.clientId = process.env.COGNITO_CLIENT_ID;\n        this.clientSecret = process.env.COGNITO_CLIENT_SECRET;\n    }\n    // Método para calcular el SECRET_HASH\n    // En cognitoService.ts\n    calculateSecretHash(username) {\n        if (!this.clientSecret) {\n            console.error('Cliente secret no está configurado');\n            throw new Error('Client secret is not configured');\n        }\n        // El formato correcto es USERNAME + CLIENT_ID\n        const message = username + this.clientId;\n        const hmac = crypto__WEBPACK_IMPORTED_MODULE_0__.createHmac('sha256', this.clientSecret);\n        hmac.update(message);\n        return hmac.digest('base64');\n    }\n    // Registrar un nuevo usuario\n    async registerUser(params) {\n        try {\n            const { email, password, name } = params;\n            // Crear el usuario en Cognito\n            const signUpCommand = new _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_2__.SignUpCommand({\n                ClientId: this.clientId,\n                Username: email,\n                Password: password,\n                SecretHash: this.calculateSecretHash(email),\n                UserAttributes: [\n                    {\n                        Name: 'email',\n                        Value: email\n                    },\n                    {\n                        Name: 'name',\n                        Value: name\n                    }\n                ]\n            });\n            const response = await this.client.send(signUpCommand);\n            return {\n                success: true,\n                userId: response.UserSub,\n                message: 'Usuario registrado correctamente. Por favor, verifique su correo electrónico para completar el registro.'\n            };\n        } catch (error) {\n            console.error('Error al registrar usuario:', error);\n            // Manejar errores específicos\n            if (error.name === 'UsernameExistsException') {\n                return {\n                    success: false,\n                    message: 'El correo electrónico ya está registrado.'\n                };\n            }\n            if (error.name === 'InvalidPasswordException') {\n                return {\n                    success: false,\n                    message: 'La contraseña no cumple con los requisitos de seguridad.'\n                };\n            }\n            throw error;\n        }\n    }\n    // Confirmar el registro con el código de verificación\n    async confirmRegistration(email, confirmationCode) {\n        try {\n            const command = new _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_3__.ConfirmSignUpCommand({\n                ClientId: this.clientId,\n                Username: email,\n                ConfirmationCode: confirmationCode,\n                SecretHash: this.calculateSecretHash(email) // Añadir SECRET_HASH\n            });\n            await this.client.send(command);\n            return {\n                success: true,\n                message: 'Registro confirmado correctamente.'\n            };\n        } catch (error) {\n            console.error('Error al confirmar registro:', error);\n            if (error.name === 'CodeMismatchException') {\n                return {\n                    success: false,\n                    message: 'El código de verificación es incorrecto.'\n                };\n            }\n            if (error.name === 'ExpiredCodeException') {\n                return {\n                    success: false,\n                    message: 'El código de verificación ha expirado.'\n                };\n            }\n            return {\n                success: false,\n                message: 'Error al confirmar el registro. Por favor, intente nuevamente.'\n            };\n        }\n    }\n    // Reenviar código de confirmación\n    async resendConfirmationCode(email) {\n        try {\n            const command = new _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_4__.ResendConfirmationCodeCommand({\n                ClientId: this.clientId,\n                Username: email,\n                SecretHash: this.calculateSecretHash(email) // Añadir SECRET_HASH\n            });\n            await this.client.send(command);\n            return {\n                success: true,\n                message: 'Se ha enviado un nuevo código de verificación a su correo electrónico.'\n            };\n        } catch (error) {\n            console.error('Error al reenviar código:', error);\n            return {\n                success: false,\n                message: 'Error al reenviar el código de verificación. Por favor, intente nuevamente.'\n            };\n        }\n    }\n    // Login con Cognito\n    // En login de cognitoService.ts\n    async login(credentials) {\n        try {\n            const { email, password } = credentials;\n            console.log(\"1. Iniciando login con Cognito para:\", email);\n            // Verificar que tenemos los valores de configuración\n            console.log(\"2. Verificando configuración:\", {\n                region: process.env.AWS_REGION,\n                userPoolId: this.userPoolId?.substring(0, 5) + '...',\n                clientId: this.clientId?.substring(0, 5) + '...',\n                hasSecret: !!this.clientSecret\n            });\n            // Si usamos secreto, calcular SECRET_HASH\n            let secretHash;\n            if (this.clientSecret) {\n                try {\n                    secretHash = this.calculateSecretHash(email);\n                    console.log(\"3. SECRET_HASH calculado correctamente\");\n                } catch (error) {\n                    console.error(\"Error al calcular SECRET_HASH:\", error);\n                    throw error;\n                }\n            }\n            // Crear parámetros de autenticación\n            const authParams = {\n                USERNAME: email,\n                PASSWORD: password\n            };\n            // Añadir SECRET_HASH si existe\n            if (secretHash) {\n                authParams.SECRET_HASH = secretHash;\n            }\n            console.log(\"4. Parámetros de autenticación preparados\");\n            const command = new _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_5__.InitiateAuthCommand({\n                AuthFlow: \"USER_PASSWORD_AUTH\",\n                ClientId: this.clientId,\n                AuthParameters: authParams\n            });\n            console.log(\"5. Enviando solicitud a Cognito...\");\n            const response = await this.client.send(command);\n            console.log(\"6. Respuesta recibida de Cognito:\", response?.AuthenticationResult ? \"Con tokens\" : \"Sin tokens\", response?.ChallengeName ? `Desafío: ${response.ChallengeName}` : \"Sin desafío\");\n            if (!response.AuthenticationResult) {\n                if (response.ChallengeName) {\n                    throw new Error(`Se requiere completar desafío: ${response.ChallengeName}`);\n                }\n                throw new Error('Error de autenticación: No se recibieron tokens de autenticación');\n            }\n            // Obtener información del usuario autenticado\n            console.log(\"7. Obteniendo información del usuario...\");\n            const userInfo = await this.getUserInfo(response.AuthenticationResult.AccessToken);\n            console.log(\"8. Información de usuario obtenida:\", userInfo.email);\n            return {\n                user: userInfo,\n                accessToken: response.AuthenticationResult.AccessToken,\n                refreshToken: response.AuthenticationResult.RefreshToken,\n                idToken: response.AuthenticationResult.IdToken,\n                expiresIn: response.AuthenticationResult.ExpiresIn || 3600\n            };\n        } catch (error) {\n            console.error('Error detallado en login Cognito:', error);\n            if (error.$metadata) {\n                console.error('Metadatos del error:', error.$metadata);\n            }\n            if (error.__type) {\n                console.error('Tipo de error AWS:', error.__type);\n            }\n            if (error.message) {\n                console.error('Mensaje de error:', error.message);\n            }\n            throw error;\n        }\n    }\n    // Obtener información del usuario desde Cognito\n    async getUserInfo(accessToken) {\n        try {\n            const command = new _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_6__.GetUserCommand({\n                AccessToken: accessToken\n            });\n            const response = await this.client.send(command);\n            // Mapear atributos de Cognito a nuestro modelo de usuario\n            const attributes = response.UserAttributes || [];\n            const email = attributes.find((attr)=>attr.Name === 'email')?.Value || '';\n            const name = attributes.find((attr)=>attr.Name === 'name')?.Value || '';\n            const sub = attributes.find((attr)=>attr.Name === 'sub')?.Value || '';\n            // Aquí deberíamos obtener el usuario de nuestra base de datos\n            // usando el sub como identificador externo\n            // Por ahora, devolvemos un usuario básico\n            return {\n                id: sub,\n                email,\n                name,\n                roleId: 'user',\n                createdAt: new Date(),\n                updatedAt: new Date(),\n                sucursalId: null\n            };\n        } catch (error) {\n            console.error('Error al obtener info de usuario:', error);\n            throw error;\n        }\n    }\n    // Cerrar sesión\n    async logout(accessToken) {\n        try {\n            const command = new _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_7__.GlobalSignOutCommand({\n                AccessToken: accessToken\n            });\n            await this.client.send(command);\n        } catch (error) {\n            console.error('Error al cerrar sesión:', error);\n            throw error;\n        }\n    }\n    // Refrescar token\n    // En src/server/services/auth/cognitoService.ts\n    async refreshToken(refreshToken) {\n        try {\n            // Para el refresh token necesitamos conocer el username\n            // Intentar extraer el username del token (normalmente estará en el payload)\n            let username = '';\n            try {\n                // Intentar extraer del payload del JWT\n                const tokenParts = refreshToken.split('.');\n                if (tokenParts.length >= 2) {\n                    const payload = JSON.parse(atob(tokenParts[1]));\n                    username = payload.username || payload.email || '';\n                }\n            } catch (e) {\n                console.error('No se pudo extraer username del token:', e);\n                // Si no se puede extraer, usar un valor almacenado en localStorage\n                if (typeof localStorage !== 'undefined') {\n                    username = localStorage.getItem('userEmail') || '';\n                }\n            }\n            // Si no tenemos username, no podemos generar SECRET_HASH\n            if (!username && this.clientSecret) {\n                throw new Error('Se requiere el username para el refresh token cuando se usa client secret');\n            }\n            // Parámetros para el refresh token\n            const authParams = {\n                REFRESH_TOKEN: refreshToken\n            };\n            // Añadir SECRET_HASH si tenemos username y clientSecret\n            if (username && this.clientSecret) {\n                authParams.SECRET_HASH = this.calculateSecretHash(username);\n            }\n            const command = new _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_5__.InitiateAuthCommand({\n                AuthFlow: \"REFRESH_TOKEN_AUTH\",\n                ClientId: this.clientId,\n                AuthParameters: authParams\n            });\n            const response = await this.client.send(command);\n            if (!response.AuthenticationResult) {\n                throw new Error('Error al refrescar token');\n            }\n            return {\n                accessToken: response.AuthenticationResult.AccessToken,\n                idToken: response.AuthenticationResult.IdToken,\n                refreshToken: refreshToken,\n                expiresIn: response.AuthenticationResult.ExpiresIn || 3600\n            };\n        } catch (error) {\n            console.error('Error al refrescar token:', error);\n            throw error;\n        }\n    }\n    // Crear usuario (solo admin)\n    async createUser(user) {\n        try {\n            const command = new _aws_sdk_client_cognito_identity_provider__WEBPACK_IMPORTED_MODULE_8__.AdminCreateUserCommand({\n                UserPoolId: this.userPoolId,\n                Username: user.email,\n                TemporaryPassword: user.password,\n                UserAttributes: [\n                    {\n                        Name: 'email',\n                        Value: user.email\n                    },\n                    {\n                        Name: 'email_verified',\n                        Value: 'true'\n                    },\n                    {\n                        Name: 'name',\n                        Value: user.name\n                    },\n                    {\n                        Name: 'custom:role',\n                        Value: user.roleId\n                    }\n                ]\n            });\n            await this.client.send(command);\n        // Aquí deberíamos crear también el usuario en nuestra BD\n        // y vincular el id de Cognito\n        } catch (error) {\n            console.error('Error al crear usuario:', error);\n            throw error;\n        }\n    }\n}\n// Singleton para uso en la aplicación\nconst cognitoService = new CognitoAuthService();\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmVyL3NlcnZpY2VzL2F1dGgvY29nbml0b1NlcnZpY2UudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsNkNBQTZDO0FBWU07QUFFbEI7QUFzQjFCLE1BQU1TO0lBTWJDLGFBQWM7UUFDWixJQUFJLENBQUNDLE1BQU0sR0FBRyxJQUFJWCxvR0FBNkJBLENBQUM7WUFDOUNZLFFBQVFDLFFBQVFDLEdBQUcsQ0FBQ0MsVUFBVTtRQUNoQztRQUVBLElBQUksQ0FBQ0MsVUFBVSxHQUFHSCxRQUFRQyxHQUFHLENBQUNHLG9CQUFvQjtRQUNsRCxJQUFJLENBQUNDLFFBQVEsR0FBR0wsUUFBUUMsR0FBRyxDQUFDSyxpQkFBaUI7UUFDN0MsSUFBSSxDQUFDQyxZQUFZLEdBQUdQLFFBQVFDLEdBQUcsQ0FBQ08scUJBQXFCO0lBQ3ZEO0lBRUEsc0NBQXNDO0lBQ3RDLHVCQUF1QjtJQUNmQyxvQkFBb0JDLFFBQWdCLEVBQVU7UUFDcEQsSUFBSSxDQUFDLElBQUksQ0FBQ0gsWUFBWSxFQUFFO1lBQ3RCSSxRQUFRQyxLQUFLLENBQUM7WUFDZCxNQUFNLElBQUlDLE1BQU07UUFDbEI7UUFFQSw4Q0FBOEM7UUFDOUMsTUFBTUMsVUFBVUosV0FBVyxJQUFJLENBQUNMLFFBQVE7UUFDeEMsTUFBTVUsT0FBT3BCLDhDQUFpQixDQUFDLFVBQVUsSUFBSSxDQUFDWSxZQUFZO1FBQzFEUSxLQUFLRSxNQUFNLENBQUNIO1FBQ1osT0FBT0MsS0FBS0csTUFBTSxDQUFDO0lBQ3JCO0lBRUEsNkJBQTZCO0lBQzdCLE1BQU1DLGFBQWFDLE1BQTBCLEVBQW9FO1FBQy9HLElBQUk7WUFDRixNQUFNLEVBQUVDLEtBQUssRUFBRUMsUUFBUSxFQUFFQyxJQUFJLEVBQUUsR0FBR0g7WUFFbEMsOEJBQThCO1lBQzlCLE1BQU1JLGdCQUFnQixJQUFJaEMsb0ZBQWFBLENBQUM7Z0JBQ3RDaUMsVUFBVSxJQUFJLENBQUNwQixRQUFRO2dCQUN2QnFCLFVBQVVMO2dCQUNW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O0lBRUEsNkJBQTZCO0lBQzdCLE1BQU0rRSxXQUFXaEMsSUFLaEIsRUFBaUI7UUFDaEIsSUFBSTtZQUNGLE1BQU1wQixVQUFVLElBQUlqRCw2RkFBc0JBLENBQUM7Z0JBQ3pDc0csWUFBWSxJQUFJLENBQUN6RixVQUFVO2dCQUMzQnVCLFVBQVVpQyxLQUFLdEMsS0FBSztnQkFDcEJ3RSxtQkFBbUJsQyxLQUFLckMsUUFBUTtnQkFDaENPLGdCQUFnQjtvQkFDZDt3QkFDRUMsTUFBTTt3QkFDTkMsT0FBTzRCLEtBQUt0QyxLQUFLO29CQUNuQjtvQkFDQTt3QkFDRVMsTUFBTTt3QkFDTkMsT0FBTztvQkFDVDtvQkFDQTt3QkFDRUQsTUFBTTt3QkFDTkMsT0FBTzRCLEtBQUtwQyxJQUFJO29CQUNsQjtvQkFDQTt3QkFDRU8sTUFBTTt3QkFDTkMsT0FBTzRCLEtBQUtlLE1BQU07b0JBQ3BCO2lCQUNEO1lBQ0g7WUFFQSxNQUFNLElBQUksQ0FBQzVFLE1BQU0sQ0FBQ21DLElBQUksQ0FBQ007UUFFdkIseURBQXlEO1FBQ3pELDhCQUE4QjtRQUNoQyxFQUFFLE9BQU8zQixPQUFPO1lBQ2RELFFBQVFDLEtBQUssQ0FBQywyQkFBMkJBO1lBQ3pDLE1BQU1BO1FBQ1I7SUFDRjtBQUNBO0FBRUEsc0NBQXNDO0FBQy9CLE1BQU1rRixpQkFBaUIsSUFBSWxHLHFCQUFxQiIsInNvdXJjZXMiOlsiL1VzZXJzL2dhc3Rvbm1vcmEvRGVza3RvcC9Qcm95ZWN0b3MvVHVsdW0vc3JjL3NlcnZlci9zZXJ2aWNlcy9hdXRoL2NvZ25pdG9TZXJ2aWNlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIHNyYy9zZXJ2ZXIvc2VydmljZXMvYXV0aC9jb2duaXRvU2VydmljZS50c1xuaW1wb3J0IHsgXG4gIENvZ25pdG9JZGVudGl0eVByb3ZpZGVyQ2xpZW50LCBcbiAgSW5pdGlhdGVBdXRoQ29tbWFuZCxcbiAgUmVzcG9uZFRvQXV0aENoYWxsZW5nZUNvbW1hbmQsXG4gIEdldFVzZXJDb21tYW5kLFxuICBBZG1pbkdldFVzZXJDb21tYW5kLFxuICBBZG1pbkNyZWF0ZVVzZXJDb21tYW5kLFxuICBHbG9iYWxTaWduT3V0Q29tbWFuZCxcbiAgU2lnblVwQ29tbWFuZCxcbiAgQ29uZmlybVNpZ25VcENvbW1hbmQsXG4gIFJlc2VuZENvbmZpcm1hdGlvbkNvZGVDb21tYW5kXG59IGZyb20gXCJAYXdzLXNkay9jbGllbnQtY29nbml0by1pZGVudGl0eS1wcm92aWRlclwiO1xuaW1wb3J0IHsgdHlwZSBVc2VyIH0gZnJvbSAnQHByaXNtYS9jbGllbnQnO1xuaW1wb3J0ICogYXMgY3J5cHRvIGZyb20gJ2NyeXB0byc7XG5cbmludGVyZmFjZSBSZWdpc3RlclVzZXJQYXJhbXMge1xuZW1haWw6IHN0cmluZztcbnBhc3N3b3JkOiBzdHJpbmc7XG5uYW1lOiBzdHJpbmc7XG59XG5cbi8vIEludGVyZmFjZXNcbmV4cG9ydCBpbnRlcmZhY2UgTG9naW5DcmVkZW50aWFscyB7XG4gIGVtYWlsOiBzdHJpbmc7XG4gIHBhc3N3b3JkOiBzdHJpbmc7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQXV0aFJlc3VsdCB7XG51c2VyOiBPbWl0PFVzZXIsICdwYXNzd29yZCc+O1xuYWNjZXNzVG9rZW46IHN0cmluZztcbnJlZnJlc2hUb2tlbjogc3RyaW5nO1xuaWRUb2tlbjogc3RyaW5nO1xuZXhwaXJlc0luOiBudW1iZXI7XG59XG5cbmV4cG9ydCBjbGFzcyBDb2duaXRvQXV0aFNlcnZpY2Uge1xucHJpdmF0ZSBjbGllbnQ6IENvZ25pdG9JZGVudGl0eVByb3ZpZGVyQ2xpZW50O1xucHJpdmF0ZSB1c2VyUG9vbElkOiBzdHJpbmc7XG5wcml2YXRlIGNsaWVudElkOiBzdHJpbmc7XG5wcml2YXRlIGNsaWVudFNlY3JldDogc3RyaW5nO1xuXG5jb25zdHJ1Y3RvcigpIHtcbiAgdGhpcy5jbGllbnQgPSBuZXcgQ29nbml0b0lkZW50aXR5UHJvdmlkZXJDbGllbnQoe1xuICAgIHJlZ2lvbjogcHJvY2Vzcy5lbnYuQVdTX1JFR0lPTiBhcyBzdHJpbmdcbiAgfSk7XG4gIFxuICB0aGlzLnVzZXJQb29sSWQgPSBwcm9jZXNzLmVudi5DT0dOSVRPX1VTRVJfUE9PTF9JRCBhcyBzdHJpbmc7XG4gIHRoaXMuY2xpZW50SWQgPSBwcm9jZXNzLmVudi5DT0dOSVRPX0NMSUVOVF9JRCBhcyBzdHJpbmc7XG4gIHRoaXMuY2xpZW50U2VjcmV0ID0gcHJvY2Vzcy5lbnYuQ09HTklUT19DTElFTlRfU0VDUkVUIGFzIHN0cmluZztcbn1cblxuLy8gTcOpdG9kbyBwYXJhIGNhbGN1bGFyIGVsIFNFQ1JFVF9IQVNIXG4vLyBFbiBjb2duaXRvU2VydmljZS50c1xucHJpdmF0ZSBjYWxjdWxhdGVTZWNyZXRIYXNoKHVzZXJuYW1lOiBzdHJpbmcpOiBzdHJpbmcge1xuICBpZiAoIXRoaXMuY2xpZW50U2VjcmV0KSB7XG4gICAgY29uc29sZS5lcnJvcignQ2xpZW50ZSBzZWNyZXQgbm8gZXN0w6EgY29uZmlndXJhZG8nKTtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0NsaWVudCBzZWNyZXQgaXMgbm90IGNvbmZpZ3VyZWQnKTtcbiAgfVxuICBcbiAgLy8gRWwgZm9ybWF0byBjb3JyZWN0byBlcyBVU0VSTkFNRSArIENMSUVOVF9JRFxuICBjb25zdCBtZXNzYWdlID0gdXNlcm5hbWUgKyB0aGlzLmNsaWVudElkO1xuICBjb25zdCBobWFjID0gY3J5cHRvLmNyZWF0ZUhtYWMoJ3NoYTI1NicsIHRoaXMuY2xpZW50U2VjcmV0KTtcbiAgaG1hYy51cGRhdGUobWVzc2FnZSk7XG4gIHJldHVybiBobWFjLmRpZ2VzdCgnYmFzZTY0Jyk7XG59XG5cbi8vIFJlZ2lzdHJhciB1biBudWV2byB1c3VhcmlvXG5hc3luYyByZWdpc3RlclVzZXIocGFyYW1zOiBSZWdpc3RlclVzZXJQYXJhbXMpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgdXNlcklkPzogc3RyaW5nOyBtZXNzYWdlPzogc3RyaW5nIH0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCB7IGVtYWlsLCBwYXNzd29yZCwgbmFtZSB9ID0gcGFyYW1zO1xuICAgIFxuICAgIC8vIENyZWFyIGVsIHVzdWFyaW8gZW4gQ29nbml0b1xuICAgIGNvbnN0IHNpZ25VcENvbW1hbmQgPSBuZXcgU2lnblVwQ29tbWFuZCh7XG4gICAgICBDbGllbnRJZDogdGhpcy5jbGllbnRJZCxcbiAgICAgIFVzZXJuYW1lOiBlbWFpbCxcbiAgICAgIFBhc3N3b3JkOiBwYXNzd29yZCxcbiAgICAgIFNlY3JldEhhc2g6IHRoaXMuY2FsY3VsYXRlU2VjcmV0SGFzaChlbWFpbCksIC8vIEHDsWFkaXIgU0VDUkVUX0hBU0hcbiAgICAgIFVzZXJBdHRyaWJ1dGVzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBOYW1lOiAnZW1haWwnLFxuICAgICAgICAgIFZhbHVlOiBlbWFpbFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgTmFtZTogJ25hbWUnLFxuICAgICAgICAgIFZhbHVlOiBuYW1lXG4gICAgICAgIH1cbiAgICAgIF1cbiAgICB9KTtcbiAgICBcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHRoaXMuY2xpZW50LnNlbmQoc2lnblVwQ29tbWFuZCk7XG4gICAgXG4gICAgcmV0dXJuIHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICB1c2VySWQ6IHJlc3BvbnNlLlVzZXJTdWIsXG4gICAgICBtZXNzYWdlOiAnVXN1YXJpbyByZWdpc3RyYWRvIGNvcnJlY3RhbWVudGUuIFBvciBmYXZvciwgdmVyaWZpcXVlIHN1IGNvcnJlbyBlbGVjdHLDs25pY28gcGFyYSBjb21wbGV0YXIgZWwgcmVnaXN0cm8uJ1xuICAgIH07XG4gIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBhbCByZWdpc3RyYXIgdXN1YXJpbzonLCBlcnJvcik7XG4gICAgXG4gICAgLy8gTWFuZWphciBlcnJvcmVzIGVzcGVjw61maWNvc1xuICAgIGlmIChlcnJvci5uYW1lID09PSAnVXNlcm5hbWVFeGlzdHNFeGNlcHRpb24nKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogJ0VsIGNvcnJlbyBlbGVjdHLDs25pY28geWEgZXN0w6EgcmVnaXN0cmFkby4nXG4gICAgICB9O1xuICAgIH1cbiAgICBcbiAgICBpZiAoZXJyb3IubmFtZSA9PT0gJ0ludmFsaWRQYXNzd29yZEV4Y2VwdGlvbicpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnTGEgY29udHJhc2XDsWEgbm8gY3VtcGxlIGNvbiBsb3MgcmVxdWlzaXRvcyBkZSBzZWd1cmlkYWQuJ1xuICAgICAgfTtcbiAgICB9XG4gICAgXG4gICAgdGhyb3cgZXJyb3I7XG4gIH1cbn1cblxuLy8gQ29uZmlybWFyIGVsIHJlZ2lzdHJvIGNvbiBlbCBjw7NkaWdvIGRlIHZlcmlmaWNhY2nDs25cbmFzeW5jIGNvbmZpcm1SZWdpc3RyYXRpb24oZW1haWw6IHN0cmluZywgY29uZmlybWF0aW9uQ29kZTogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG1lc3NhZ2U6IHN0cmluZyB9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgY29tbWFuZCA9IG5ldyBDb25maXJtU2lnblVwQ29tbWFuZCh7XG4gICAgICBDbGllbnRJZDogdGhpcy5jbGllbnRJZCxcbiAgICAgIFVzZXJuYW1lOiBlbWFpbCxcbiAgICAgIENvbmZpcm1hdGlvbkNvZGU6IGNvbmZpcm1hdGlvbkNvZGUsXG4gICAgICBTZWNyZXRIYXNoOiB0aGlzLmNhbGN1bGF0ZVNlY3JldEhhc2goZW1haWwpIC8vIEHDsWFkaXIgU0VDUkVUX0hBU0hcbiAgICB9KTtcbiAgICBcbiAgICBhd2FpdCB0aGlzLmNsaWVudC5zZW5kKGNvbW1hbmQpO1xuICAgIFxuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgbWVzc2FnZTogJ1JlZ2lzdHJvIGNvbmZpcm1hZG8gY29ycmVjdGFtZW50ZS4nXG4gICAgfTtcbiAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGFsIGNvbmZpcm1hciByZWdpc3RybzonLCBlcnJvcik7XG4gICAgXG4gICAgaWYgKGVycm9yLm5hbWUgPT09ICdDb2RlTWlzbWF0Y2hFeGNlcHRpb24nKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogJ0VsIGPDs2RpZ28gZGUgdmVyaWZpY2FjacOzbiBlcyBpbmNvcnJlY3RvLidcbiAgICAgIH07XG4gICAgfVxuICAgIFxuICAgIGlmIChlcnJvci5uYW1lID09PSAnRXhwaXJlZENvZGVFeGNlcHRpb24nKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogJ0VsIGPDs2RpZ28gZGUgdmVyaWZpY2FjacOzbiBoYSBleHBpcmFkby4nXG4gICAgICB9O1xuICAgIH1cbiAgICBcbiAgICByZXR1cm4ge1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBtZXNzYWdlOiAnRXJyb3IgYWwgY29uZmlybWFyIGVsIHJlZ2lzdHJvLiBQb3IgZmF2b3IsIGludGVudGUgbnVldmFtZW50ZS4nXG4gICAgfTtcbiAgfVxufVxuXG4vLyBSZWVudmlhciBjw7NkaWdvIGRlIGNvbmZpcm1hY2nDs25cbmFzeW5jIHJlc2VuZENvbmZpcm1hdGlvbkNvZGUoZW1haWw6IHN0cmluZyk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuOyBtZXNzYWdlOiBzdHJpbmcgfT4ge1xuICB0cnkge1xuICAgIGNvbnN0IGNvbW1hbmQgPSBuZXcgUmVzZW5kQ29uZmlybWF0aW9uQ29kZUNvbW1hbmQoe1xuICAgICAgQ2xpZW50SWQ6IHRoaXMuY2xpZW50SWQsXG4gICAgICBVc2VybmFtZTogZW1haWwsXG4gICAgICBTZWNyZXRIYXNoOiB0aGlzLmNhbGN1bGF0ZVNlY3JldEhhc2goZW1haWwpIC8vIEHDsWFkaXIgU0VDUkVUX0hBU0hcbiAgICB9KTtcbiAgICBcbiAgICBhd2FpdCB0aGlzLmNsaWVudC5zZW5kKGNvbW1hbmQpO1xuICAgIFxuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgbWVzc2FnZTogJ1NlIGhhIGVudmlhZG8gdW4gbnVldm8gY8OzZGlnbyBkZSB2ZXJpZmljYWNpw7NuIGEgc3UgY29ycmVvIGVsZWN0csOzbmljby4nXG4gICAgfTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBhbCByZWVudmlhciBjw7NkaWdvOicsIGVycm9yKTtcbiAgICBcbiAgICByZXR1cm4ge1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBtZXNzYWdlOiAnRXJyb3IgYWwgcmVlbnZpYXIgZWwgY8OzZGlnbyBkZSB2ZXJpZmljYWNpw7NuLiBQb3IgZmF2b3IsIGludGVudGUgbnVldmFtZW50ZS4nXG4gICAgfTtcbiAgfVxufVxuXG4vLyBMb2dpbiBjb24gQ29nbml0b1xuLy8gRW4gbG9naW4gZGUgY29nbml0b1NlcnZpY2UudHNcbmFzeW5jIGxvZ2luKGNyZWRlbnRpYWxzOiBMb2dpbkNyZWRlbnRpYWxzKTogUHJvbWlzZTxBdXRoUmVzdWx0PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgeyBlbWFpbCwgcGFzc3dvcmQgfSA9IGNyZWRlbnRpYWxzO1xuICAgIGNvbnNvbGUubG9nKFwiMS4gSW5pY2lhbmRvIGxvZ2luIGNvbiBDb2duaXRvIHBhcmE6XCIsIGVtYWlsKTtcbiAgICBcbiAgICAvLyBWZXJpZmljYXIgcXVlIHRlbmVtb3MgbG9zIHZhbG9yZXMgZGUgY29uZmlndXJhY2nDs25cbiAgICBjb25zb2xlLmxvZyhcIjIuIFZlcmlmaWNhbmRvIGNvbmZpZ3VyYWNpw7NuOlwiLCB7XG4gICAgICByZWdpb246IHByb2Nlc3MuZW52LkFXU19SRUdJT04sXG4gICAgICB1c2VyUG9vbElkOiB0aGlzLnVzZXJQb29sSWQ/LnN1YnN0cmluZygwLCA1KSArICcuLi4nLFxuICAgICAgY2xpZW50SWQ6IHRoaXMuY2xpZW50SWQ/LnN1YnN0cmluZygwLCA1KSArICcuLi4nLFxuICAgICAgaGFzU2VjcmV0OiAhIXRoaXMuY2xpZW50U2VjcmV0XG4gICAgfSk7XG4gICAgXG4gICAgLy8gU2kgdXNhbW9zIHNlY3JldG8sIGNhbGN1bGFyIFNFQ1JFVF9IQVNIXG4gICAgbGV0IHNlY3JldEhhc2g7XG4gICAgaWYgKHRoaXMuY2xpZW50U2VjcmV0KSB7XG4gICAgICB0cnkge1xuICAgICAgICBzZWNyZXRIYXNoID0gdGhpcy5jYWxjdWxhdGVTZWNyZXRIYXNoKGVtYWlsKTtcbiAgICAgICAgY29uc29sZS5sb2coXCIzLiBTRUNSRVRfSEFTSCBjYWxjdWxhZG8gY29ycmVjdGFtZW50ZVwiKTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBhbCBjYWxjdWxhciBTRUNSRVRfSEFTSDpcIiwgZXJyb3IpO1xuICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgLy8gQ3JlYXIgcGFyw6FtZXRyb3MgZGUgYXV0ZW50aWNhY2nDs25cbiAgICBjb25zdCBhdXRoUGFyYW1zOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+ID0ge1xuICAgICAgVVNFUk5BTUU6IGVtYWlsLFxuICAgICAgUEFTU1dPUkQ6IHBhc3N3b3JkXG4gICAgfTtcbiAgICBcbiAgICAvLyBBw7FhZGlyIFNFQ1JFVF9IQVNIIHNpIGV4aXN0ZVxuICAgIGlmIChzZWNyZXRIYXNoKSB7XG4gICAgICBhdXRoUGFyYW1zLlNFQ1JFVF9IQVNIID0gc2VjcmV0SGFzaDtcbiAgICB9XG4gICAgXG4gICAgY29uc29sZS5sb2coXCI0LiBQYXLDoW1ldHJvcyBkZSBhdXRlbnRpY2FjacOzbiBwcmVwYXJhZG9zXCIpO1xuICAgIFxuICAgIGNvbnN0IGNvbW1hbmQgPSBuZXcgSW5pdGlhdGVBdXRoQ29tbWFuZCh7XG4gICAgICBBdXRoRmxvdzogXCJVU0VSX1BBU1NXT1JEX0FVVEhcIixcbiAgICAgIENsaWVudElkOiB0aGlzLmNsaWVudElkLFxuICAgICAgQXV0aFBhcmFtZXRlcnM6IGF1dGhQYXJhbXNcbiAgICB9KTtcbiAgICBcbiAgICBjb25zb2xlLmxvZyhcIjUuIEVudmlhbmRvIHNvbGljaXR1ZCBhIENvZ25pdG8uLi5cIik7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLmNsaWVudC5zZW5kKGNvbW1hbmQpO1xuICAgIGNvbnNvbGUubG9nKFwiNi4gUmVzcHVlc3RhIHJlY2liaWRhIGRlIENvZ25pdG86XCIsIFxuICAgICAgcmVzcG9uc2U/LkF1dGhlbnRpY2F0aW9uUmVzdWx0ID8gXCJDb24gdG9rZW5zXCIgOiBcIlNpbiB0b2tlbnNcIixcbiAgICAgIHJlc3BvbnNlPy5DaGFsbGVuZ2VOYW1lID8gYERlc2Fmw61vOiAke3Jlc3BvbnNlLkNoYWxsZW5nZU5hbWV9YCA6IFwiU2luIGRlc2Fmw61vXCJcbiAgICApO1xuICAgIFxuICAgIGlmICghcmVzcG9uc2UuQXV0aGVudGljYXRpb25SZXN1bHQpIHtcbiAgICAgIGlmIChyZXNwb25zZS5DaGFsbGVuZ2VOYW1lKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgU2UgcmVxdWllcmUgY29tcGxldGFyIGRlc2Fmw61vOiAke3Jlc3BvbnNlLkNoYWxsZW5nZU5hbWV9YCk7XG4gICAgICB9XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0Vycm9yIGRlIGF1dGVudGljYWNpw7NuOiBObyBzZSByZWNpYmllcm9uIHRva2VucyBkZSBhdXRlbnRpY2FjacOzbicpO1xuICAgIH1cbiAgICBcbiAgICAvLyBPYnRlbmVyIGluZm9ybWFjacOzbiBkZWwgdXN1YXJpbyBhdXRlbnRpY2Fkb1xuICAgIGNvbnNvbGUubG9nKFwiNy4gT2J0ZW5pZW5kbyBpbmZvcm1hY2nDs24gZGVsIHVzdWFyaW8uLi5cIik7XG4gICAgY29uc3QgdXNlckluZm8gPSBhd2FpdCB0aGlzLmdldFVzZXJJbmZvKHJlc3BvbnNlLkF1dGhlbnRpY2F0aW9uUmVzdWx0LkFjY2Vzc1Rva2VuIGFzIHN0cmluZyk7XG4gICAgY29uc29sZS5sb2coXCI4LiBJbmZvcm1hY2nDs24gZGUgdXN1YXJpbyBvYnRlbmlkYTpcIiwgdXNlckluZm8uZW1haWwpO1xuICAgIFxuICAgIHJldHVybiB7XG4gICAgICB1c2VyOiB1c2VySW5mbyxcbiAgICAgIGFjY2Vzc1Rva2VuOiByZXNwb25zZS5BdXRoZW50aWNhdGlvblJlc3VsdC5BY2Nlc3NUb2tlbiBhcyBzdHJpbmcsXG4gICAgICByZWZyZXNoVG9rZW46IHJlc3BvbnNlLkF1dGhlbnRpY2F0aW9uUmVzdWx0LlJlZnJlc2hUb2tlbiBhcyBzdHJpbmcsXG4gICAgICBpZFRva2VuOiByZXNwb25zZS5BdXRoZW50aWNhdGlvblJlc3VsdC5JZFRva2VuIGFzIHN0cmluZyxcbiAgICAgIGV4cGlyZXNJbjogcmVzcG9uc2UuQXV0aGVudGljYXRpb25SZXN1bHQuRXhwaXJlc0luIHx8IDM2MDBcbiAgICB9O1xuICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgZGV0YWxsYWRvIGVuIGxvZ2luIENvZ25pdG86JywgZXJyb3IpO1xuICAgIGlmIChlcnJvci4kbWV0YWRhdGEpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ01ldGFkYXRvcyBkZWwgZXJyb3I6JywgZXJyb3IuJG1ldGFkYXRhKTtcbiAgICB9XG4gICAgaWYgKGVycm9yLl9fdHlwZSkge1xuICAgICAgY29uc29sZS5lcnJvcignVGlwbyBkZSBlcnJvciBBV1M6JywgZXJyb3IuX190eXBlKTtcbiAgICB9XG4gICAgaWYgKGVycm9yLm1lc3NhZ2UpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ01lbnNhamUgZGUgZXJyb3I6JywgZXJyb3IubWVzc2FnZSk7XG4gICAgfVxuICAgIHRocm93IGVycm9yO1xuICB9XG59XG5cbi8vIE9idGVuZXIgaW5mb3JtYWNpw7NuIGRlbCB1c3VhcmlvIGRlc2RlIENvZ25pdG9cbnByaXZhdGUgYXN5bmMgZ2V0VXNlckluZm8oYWNjZXNzVG9rZW46IHN0cmluZyk6IFByb21pc2U8T21pdDxVc2VyLCAncGFzc3dvcmQnPj4ge1xuICB0cnkge1xuICAgIGNvbnN0IGNvbW1hbmQgPSBuZXcgR2V0VXNlckNvbW1hbmQoe1xuICAgICAgQWNjZXNzVG9rZW46IGFjY2Vzc1Rva2VuXG4gICAgfSk7XG4gICAgXG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLmNsaWVudC5zZW5kKGNvbW1hbmQpO1xuICAgIFxuICAgIC8vIE1hcGVhciBhdHJpYnV0b3MgZGUgQ29nbml0byBhIG51ZXN0cm8gbW9kZWxvIGRlIHVzdWFyaW9cbiAgICBjb25zdCBhdHRyaWJ1dGVzID0gcmVzcG9uc2UuVXNlckF0dHJpYnV0ZXMgfHwgW107XG4gICAgY29uc3QgZW1haWwgPSBhdHRyaWJ1dGVzLmZpbmQoYXR0ciA9PiBhdHRyLk5hbWUgPT09ICdlbWFpbCcpPy5WYWx1ZSB8fCAnJztcbiAgICBjb25zdCBuYW1lID0gYXR0cmlidXRlcy5maW5kKGF0dHIgPT4gYXR0ci5OYW1lID09PSAnbmFtZScpPy5WYWx1ZSB8fCAnJztcbiAgICBjb25zdCBzdWIgPSBhdHRyaWJ1dGVzLmZpbmQoYXR0ciA9PiBhdHRyLk5hbWUgPT09ICdzdWInKT8uVmFsdWUgfHwgJyc7XG4gICAgXG4gICAgLy8gQXF1w60gZGViZXLDrWFtb3Mgb2J0ZW5lciBlbCB1c3VhcmlvIGRlIG51ZXN0cmEgYmFzZSBkZSBkYXRvc1xuICAgIC8vIHVzYW5kbyBlbCBzdWIgY29tbyBpZGVudGlmaWNhZG9yIGV4dGVybm9cbiAgICAvLyBQb3IgYWhvcmEsIGRldm9sdmVtb3MgdW4gdXN1YXJpbyBiw6FzaWNvXG4gICAgXG4gICAgcmV0dXJuIHtcbiAgICAgIGlkOiBzdWIsXG4gICAgICBlbWFpbCxcbiAgICAgIG5hbWUsXG4gICAgICByb2xlSWQ6ICd1c2VyJywgLy8gUG9yIGRlZmVjdG8sIGx1ZWdvIGFjdHVhbGl6YW1vcyBjb24gaW5mbyBkZSBCRFxuICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgc3VjdXJzYWxJZDogbnVsbFxuICAgIH07XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgYWwgb2J0ZW5lciBpbmZvIGRlIHVzdWFyaW86JywgZXJyb3IpO1xuICAgIHRocm93IGVycm9yO1xuICB9XG59XG5cbi8vIENlcnJhciBzZXNpw7NuXG5hc3luYyBsb2dvdXQoYWNjZXNzVG9rZW46IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICB0cnkge1xuICAgIGNvbnN0IGNvbW1hbmQgPSBuZXcgR2xvYmFsU2lnbk91dENvbW1hbmQoe1xuICAgICAgQWNjZXNzVG9rZW46IGFjY2Vzc1Rva2VuXG4gICAgfSk7XG4gICAgXG4gICAgYXdhaXQgdGhpcy5jbGllbnQuc2VuZChjb21tYW5kKTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBhbCBjZXJyYXIgc2VzacOzbjonLCBlcnJvcik7XG4gICAgdGhyb3cgZXJyb3I7XG4gIH1cbn1cblxuLy8gUmVmcmVzY2FyIHRva2VuXG4vLyBFbiBzcmMvc2VydmVyL3NlcnZpY2VzL2F1dGgvY29nbml0b1NlcnZpY2UudHNcbmFzeW5jIHJlZnJlc2hUb2tlbihyZWZyZXNoVG9rZW46IHN0cmluZyk6IFByb21pc2U8T21pdDxBdXRoUmVzdWx0LCAndXNlcic+PiB7XG4gIHRyeSB7XG4gICAgLy8gUGFyYSBlbCByZWZyZXNoIHRva2VuIG5lY2VzaXRhbW9zIGNvbm9jZXIgZWwgdXNlcm5hbWVcbiAgICAvLyBJbnRlbnRhciBleHRyYWVyIGVsIHVzZXJuYW1lIGRlbCB0b2tlbiAobm9ybWFsbWVudGUgZXN0YXLDoSBlbiBlbCBwYXlsb2FkKVxuICAgIGxldCB1c2VybmFtZSA9ICcnO1xuICAgIHRyeSB7XG4gICAgICAvLyBJbnRlbnRhciBleHRyYWVyIGRlbCBwYXlsb2FkIGRlbCBKV1RcbiAgICAgIGNvbnN0IHRva2VuUGFydHMgPSByZWZyZXNoVG9rZW4uc3BsaXQoJy4nKTtcbiAgICAgIGlmICh0b2tlblBhcnRzLmxlbmd0aCA+PSAyKSB7XG4gICAgICAgIGNvbnN0IHBheWxvYWQgPSBKU09OLnBhcnNlKGF0b2IodG9rZW5QYXJ0c1sxXSkpO1xuICAgICAgICB1c2VybmFtZSA9IHBheWxvYWQudXNlcm5hbWUgfHwgcGF5bG9hZC5lbWFpbCB8fCAnJztcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdObyBzZSBwdWRvIGV4dHJhZXIgdXNlcm5hbWUgZGVsIHRva2VuOicsIGUpO1xuICAgICAgLy8gU2kgbm8gc2UgcHVlZGUgZXh0cmFlciwgdXNhciB1biB2YWxvciBhbG1hY2VuYWRvIGVuIGxvY2FsU3RvcmFnZVxuICAgICAgaWYgKHR5cGVvZiBsb2NhbFN0b3JhZ2UgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgIHVzZXJuYW1lID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3VzZXJFbWFpbCcpIHx8ICcnO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIFNpIG5vIHRlbmVtb3MgdXNlcm5hbWUsIG5vIHBvZGVtb3MgZ2VuZXJhciBTRUNSRVRfSEFTSFxuICAgIGlmICghdXNlcm5hbWUgJiYgdGhpcy5jbGllbnRTZWNyZXQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignU2UgcmVxdWllcmUgZWwgdXNlcm5hbWUgcGFyYSBlbCByZWZyZXNoIHRva2VuIGN1YW5kbyBzZSB1c2EgY2xpZW50IHNlY3JldCcpO1xuICAgIH1cbiAgICBcbiAgICAvLyBQYXLDoW1ldHJvcyBwYXJhIGVsIHJlZnJlc2ggdG9rZW5cbiAgICBjb25zdCBhdXRoUGFyYW1zOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+ID0ge1xuICAgICAgUkVGUkVTSF9UT0tFTjogcmVmcmVzaFRva2VuXG4gICAgfTtcbiAgICBcbiAgICAvLyBBw7FhZGlyIFNFQ1JFVF9IQVNIIHNpIHRlbmVtb3MgdXNlcm5hbWUgeSBjbGllbnRTZWNyZXRcbiAgICBpZiAodXNlcm5hbWUgJiYgdGhpcy5jbGllbnRTZWNyZXQpIHtcbiAgICAgIGF1dGhQYXJhbXMuU0VDUkVUX0hBU0ggPSB0aGlzLmNhbGN1bGF0ZVNlY3JldEhhc2godXNlcm5hbWUpO1xuICAgIH1cbiAgICBcbiAgICBjb25zdCBjb21tYW5kID0gbmV3IEluaXRpYXRlQXV0aENvbW1hbmQoe1xuICAgICAgQXV0aEZsb3c6IFwiUkVGUkVTSF9UT0tFTl9BVVRIXCIsXG4gICAgICBDbGllbnRJZDogdGhpcy5jbGllbnRJZCxcbiAgICAgIEF1dGhQYXJhbWV0ZXJzOiBhdXRoUGFyYW1zXG4gICAgfSk7XG4gICAgXG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLmNsaWVudC5zZW5kKGNvbW1hbmQpO1xuICAgIFxuICAgIGlmICghcmVzcG9uc2UuQXV0aGVudGljYXRpb25SZXN1bHQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignRXJyb3IgYWwgcmVmcmVzY2FyIHRva2VuJyk7XG4gICAgfVxuICAgIFxuICAgIHJldHVybiB7XG4gICAgICBhY2Nlc3NUb2tlbjogcmVzcG9uc2UuQXV0aGVudGljYXRpb25SZXN1bHQuQWNjZXNzVG9rZW4gYXMgc3RyaW5nLFxuICAgICAgaWRUb2tlbjogcmVzcG9uc2UuQXV0aGVudGljYXRpb25SZXN1bHQuSWRUb2tlbiBhcyBzdHJpbmcsXG4gICAgICByZWZyZXNoVG9rZW46IHJlZnJlc2hUb2tlbiwgLy8gTWFudGVuZXIgZWwgbWlzbW8gcmVmcmVzaCB0b2tlblxuICAgICAgZXhwaXJlc0luOiByZXNwb25zZS5BdXRoZW50aWNhdGlvblJlc3VsdC5FeHBpcmVzSW4gfHwgMzYwMFxuICAgIH07XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgYWwgcmVmcmVzY2FyIHRva2VuOicsIGVycm9yKTtcbiAgICB0aHJvdyBlcnJvcjtcbiAgfVxufVxuXG4vLyBDcmVhciB1c3VhcmlvIChzb2xvIGFkbWluKVxuYXN5bmMgY3JlYXRlVXNlcih1c2VyOiB7XG4gIGVtYWlsOiBzdHJpbmc7XG4gIG5hbWU6IHN0cmluZztcbiAgcGFzc3dvcmQ6IHN0cmluZztcbiAgcm9sZUlkOiBzdHJpbmc7XG59KTogUHJvbWlzZTx2b2lkPiB7XG4gIHRyeSB7XG4gICAgY29uc3QgY29tbWFuZCA9IG5ldyBBZG1pbkNyZWF0ZVVzZXJDb21tYW5kKHtcbiAgICAgIFVzZXJQb29sSWQ6IHRoaXMudXNlclBvb2xJZCxcbiAgICAgIFVzZXJuYW1lOiB1c2VyLmVtYWlsLFxuICAgICAgVGVtcG9yYXJ5UGFzc3dvcmQ6IHVzZXIucGFzc3dvcmQsXG4gICAgICBVc2VyQXR0cmlidXRlczogW1xuICAgICAgICB7XG4gICAgICAgICAgTmFtZTogJ2VtYWlsJyxcbiAgICAgICAgICBWYWx1ZTogdXNlci5lbWFpbFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgTmFtZTogJ2VtYWlsX3ZlcmlmaWVkJyxcbiAgICAgICAgICBWYWx1ZTogJ3RydWUnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBOYW1lOiAnbmFtZScsXG4gICAgICAgICAgVmFsdWU6IHVzZXIubmFtZVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgTmFtZTogJ2N1c3RvbTpyb2xlJyxcbiAgICAgICAgICBWYWx1ZTogdXNlci5yb2xlSWRcbiAgICAgICAgfVxuICAgICAgXVxuICAgIH0pO1xuICAgIFxuICAgIGF3YWl0IHRoaXMuY2xpZW50LnNlbmQoY29tbWFuZCk7XG4gICAgXG4gICAgLy8gQXF1w60gZGViZXLDrWFtb3MgY3JlYXIgdGFtYmnDqW4gZWwgdXN1YXJpbyBlbiBudWVzdHJhIEJEXG4gICAgLy8geSB2aW5jdWxhciBlbCBpZCBkZSBDb2duaXRvXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgYWwgY3JlYXIgdXN1YXJpbzonLCBlcnJvcik7XG4gICAgdGhyb3cgZXJyb3I7XG4gIH1cbn1cbn1cblxuLy8gU2luZ2xldG9uIHBhcmEgdXNvIGVuIGxhIGFwbGljYWNpw7NuXG5leHBvcnQgY29uc3QgY29nbml0b1NlcnZpY2UgPSBuZXcgQ29nbml0b0F1dGhTZXJ2aWNlKCk7Il0sIm5hbWVzIjpbIkNvZ25pdG9JZGVudGl0eVByb3ZpZGVyQ2xpZW50IiwiSW5pdGlhdGVBdXRoQ29tbWFuZCIsIkdldFVzZXJDb21tYW5kIiwiQWRtaW5DcmVhdGVVc2VyQ29tbWFuZCIsIkdsb2JhbFNpZ25PdXRDb21tYW5kIiwiU2lnblVwQ29tbWFuZCIsIkNvbmZpcm1TaWduVXBDb21tYW5kIiwiUmVzZW5kQ29uZmlybWF0aW9uQ29kZUNvbW1hbmQiLCJjcnlwdG8iLCJDb2duaXRvQXV0aFNlcnZpY2UiLCJjb25zdHJ1Y3RvciIsImNsaWVudCIsInJlZ2lvbiIsInByb2Nlc3MiLCJlbnYiLCJBV1NfUkVHSU9OIiwidXNlclBvb2xJZCIsIkNPR05JVE9fVVNFUl9QT09MX0lEIiwiY2xpZW50SWQiLCJDT0dOSVRPX0NMSUVOVF9JRCIsImNsaWVudFNlY3JldCIsIkNPR05JVE9fQ0xJRU5UX1NFQ1JFVCIsImNhbGN1bGF0ZVNlY3JldEhhc2giLCJ1c2VybmFtZSIsImNvbnNvbGUiLCJlcnJvciIsIkVycm9yIiwibWVzc2FnZSIsImhtYWMiLCJjcmVhdGVIbWFjIiwidXBkYXRlIiwiZGlnZXN0IiwicmVnaXN0ZXJVc2VyIiwicGFyYW1zIiwiZW1haWwiLCJwYXNzd29yZCIsIm5hbWUiLCJzaWduVXBDb21tYW5kIiwiQ2xpZW50SWQiLCJVc2VybmFtZSIsIlBhc3N3b3JkIiwiU2VjcmV0SGFzaCIsIlVzZXJBdHRyaWJ1dGVzIiwiTmFtZSIsIlZhbHVlIiwicmVzcG9uc2UiLCJzZW5kIiwic3VjY2VzcyIsInVzZXJJZCIsIlVzZXJTdWIiLCJjb25maXJtUmVnaXN0cmF0aW9uIiwiY29uZmlybWF0aW9uQ29kZSIsImNvbW1hbmQiLCJDb25maXJtYXRpb25Db2RlIiwicmVzZW5kQ29uZmlybWF0aW9uQ29kZSIsImxvZ2luIiwiY3JlZGVudGlhbHMiLCJsb2ciLCJzdWJzdHJpbmciLCJoYXNTZWNyZXQiLCJzZWNyZXRIYXNoIiwiYXV0aFBhcmFtcyIsIlVTRVJOQU1FIiwiUEFTU1dPUkQiLCJTRUNSRVRfSEFTSCIsIkF1dGhGbG93IiwiQXV0aFBhcmFtZXRlcnMiLCJBdXRoZW50aWNhdGlvblJlc3VsdCIsIkNoYWxsZW5nZU5hbWUiLCJ1c2VySW5mbyIsImdldFVzZXJJbmZvIiwiQWNjZXNzVG9rZW4iLCJ1c2VyIiwiYWNjZXNzVG9rZW4iLCJyZWZyZXNoVG9rZW4iLCJSZWZyZXNoVG9rZW4iLCJpZFRva2VuIiwiSWRUb2tlbiIsImV4cGlyZXNJbiIsIkV4cGlyZXNJbiIsIiRtZXRhZGF0YSIsIl9fdHlwZSIsImF0dHJpYnV0ZXMiLCJmaW5kIiwiYXR0ciIsInN1YiIsImlkIiwicm9sZUlkIiwiY3JlYXRlZEF0IiwiRGF0ZSIsInVwZGF0ZWRBdCIsInN1Y3Vyc2FsSWQiLCJsb2dvdXQiLCJ0b2tlblBhcnRzIiwic3BsaXQiLCJsZW5ndGgiLCJwYXlsb2FkIiwiSlNPTiIsInBhcnNlIiwiYXRvYiIsImUiLCJsb2NhbFN0b3JhZ2UiLCJnZXRJdGVtIiwiUkVGUkVTSF9UT0tFTiIsImNyZWF0ZVVzZXIiLCJVc2VyUG9vbElkIiwiVGVtcG9yYXJ5UGFzc3dvcmQiLCJjb2duaXRvU2VydmljZSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/server/services/auth/cognitoService.ts\n");

/***/ }),

/***/ "(ssr)/./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true!":
/*!******************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true! ***!
  \******************************************************************************************************/
/***/ (() => {



/***/ }),

/***/ "../app-render/after-task-async-storage.external":
/*!***********************************************************************************!*\
  !*** external "next/dist/server/app-render/after-task-async-storage.external.js" ***!
  \***********************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/after-task-async-storage.external.js");

/***/ }),

/***/ "../app-render/work-async-storage.external":
/*!*****************************************************************************!*\
  !*** external "next/dist/server/app-render/work-async-storage.external.js" ***!
  \*****************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/work-async-storage.external.js");

/***/ }),

/***/ "./work-unit-async-storage.external":
/*!**********************************************************************************!*\
  !*** external "next/dist/server/app-render/work-unit-async-storage.external.js" ***!
  \**********************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/work-unit-async-storage.external.js");

/***/ }),

/***/ "@prisma/client":
/*!*********************************!*\
  !*** external "@prisma/client" ***!
  \*********************************/
/***/ ((module) => {

"use strict";
module.exports = require("@prisma/client");

/***/ }),

/***/ "buffer":
/*!*************************!*\
  !*** external "buffer" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("buffer");

/***/ }),

/***/ "child_process":
/*!********************************!*\
  !*** external "child_process" ***!
  \********************************/
/***/ ((module) => {

"use strict";
module.exports = require("child_process");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("crypto");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

"use strict";
module.exports = require("fs");

/***/ }),

/***/ "fs/promises":
/*!******************************!*\
  !*** external "fs/promises" ***!
  \******************************/
/***/ ((module) => {

"use strict";
module.exports = require("fs/promises");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("http");

/***/ }),

/***/ "http2":
/*!************************!*\
  !*** external "http2" ***!
  \************************/
/***/ ((module) => {

"use strict";
module.exports = require("http2");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

"use strict";
module.exports = require("https");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "node:stream":
/*!******************************!*\
  !*** external "node:stream" ***!
  \******************************/
/***/ ((module) => {

"use strict";
module.exports = require("node:stream");

/***/ }),

/***/ "os":
/*!*********************!*\
  !*** external "os" ***!
  \*********************/
/***/ ((module) => {

"use strict";
module.exports = require("os");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("path");

/***/ }),

/***/ "process":
/*!**************************!*\
  !*** external "process" ***!
  \**************************/
/***/ ((module) => {

"use strict";
module.exports = require("process");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("stream");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = require("url");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("util");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/@aws-sdk","vendor-chunks/@smithy","vendor-chunks/next"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fauth%2Frefresh%2Froute&page=%2Fapi%2Fauth%2Frefresh%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fauth%2Frefresh%2Froute.ts&appDir=%2FUsers%2Fgastonmora%2FDesktop%2FProyectos%2FTulum%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fgastonmora%2FDesktop%2FProyectos%2FTulum&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();